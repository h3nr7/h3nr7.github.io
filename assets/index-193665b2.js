var mz=Object.defineProperty;var bz=(t,e,n)=>e in t?mz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Sb=(t,e,n)=>(bz(t,typeof e!="symbol"?e+"":e,n),n);function yz(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const o in i)if(o!=="default"&&!(o in t)){const r=Object.getOwnPropertyDescriptor(i,o);r&&Object.defineProperty(t,o,r.get?r:{enumerable:!0,get:()=>i[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();function LI(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var nN={exports:{}},lm={},iN={exports:{}},Dt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Md=Symbol.for("react.element"),vz=Symbol.for("react.portal"),Gz=Symbol.for("react.fragment"),Bz=Symbol.for("react.strict_mode"),Zz=Symbol.for("react.profiler"),wz=Symbol.for("react.provider"),Sz=Symbol.for("react.context"),Rz=Symbol.for("react.forward_ref"),Wz=Symbol.for("react.suspense"),xz=Symbol.for("react.memo"),Vz=Symbol.for("react.lazy"),yR=Symbol.iterator;function Xz(t){return t===null||typeof t!="object"?null:(t=yR&&t[yR]||t["@@iterator"],typeof t=="function"?t:null)}var oN={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rN=Object.assign,sN={};function EI(t,e,n){this.props=t,this.context=e,this.refs=sN,this.updater=n||oN}EI.prototype.isReactComponent={};EI.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};EI.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function aN(){}aN.prototype=EI.prototype;function QB(t,e,n){this.props=t,this.context=e,this.refs=sN,this.updater=n||oN}var jB=QB.prototype=new aN;jB.constructor=QB;rN(jB,EI.prototype);jB.isPureReactComponent=!0;var vR=Array.isArray,lN=Object.prototype.hasOwnProperty,qB={current:null},gN={key:!0,ref:!0,__self:!0,__source:!0};function cN(t,e,n){var i,o={},r=null,s=null;if(e!=null)for(i in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(r=""+e.key),e)lN.call(e,i)&&!gN.hasOwnProperty(i)&&(o[i]=e[i]);var a=arguments.length-2;if(a===1)o.children=n;else if(1<a){for(var l=Array(a),g=0;g<a;g++)l[g]=arguments[g+2];o.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)o[i]===void 0&&(o[i]=a[i]);return{$$typeof:Md,type:t,key:r,ref:s,props:o,_owner:qB.current}}function Nz(t,e){return{$$typeof:Md,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function $B(t){return typeof t=="object"&&t!==null&&t.$$typeof===Md}function Yz(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var GR=/\/+/g;function Rb(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Yz(""+t.key):e.toString(36)}function Wp(t,e,n,i,o){var r=typeof t;(r==="undefined"||r==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(r){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case Md:case vz:s=!0}}if(s)return s=t,o=o(s),t=i===""?"."+Rb(s,0):i,vR(o)?(n="",t!=null&&(n=t.replace(GR,"$&/")+"/"),Wp(o,e,n,"",function(g){return g})):o!=null&&($B(o)&&(o=Nz(o,n+(!o.key||s&&s.key===o.key?"":(""+o.key).replace(GR,"$&/")+"/")+t)),e.push(o)),1;if(s=0,i=i===""?".":i+":",vR(t))for(var a=0;a<t.length;a++){r=t[a];var l=i+Rb(r,a);s+=Wp(r,e,n,l,o)}else if(l=Xz(t),typeof l=="function")for(t=l.call(t),a=0;!(r=t.next()).done;)r=r.value,l=i+Rb(r,a++),s+=Wp(r,e,n,l,o);else if(r==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function sA(t,e,n){if(t==null)return t;var i=[],o=0;return Wp(t,i,"","",function(r){return e.call(n,r,o++)}),i}function Mz(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var lo={current:null},xp={transition:null},Hz={ReactCurrentDispatcher:lo,ReactCurrentBatchConfig:xp,ReactCurrentOwner:qB};Dt.Children={map:sA,forEach:function(t,e,n){sA(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return sA(t,function(){e++}),e},toArray:function(t){return sA(t,function(e){return e})||[]},only:function(t){if(!$B(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Dt.Component=EI;Dt.Fragment=Gz;Dt.Profiler=Zz;Dt.PureComponent=QB;Dt.StrictMode=Bz;Dt.Suspense=Wz;Dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hz;Dt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=rN({},t.props),o=t.key,r=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,s=qB.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)lN.call(e,l)&&!gN.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var g=0;g<l;g++)a[g]=arguments[g+2];i.children=a}return{$$typeof:Md,type:t.type,key:o,ref:r,props:i,_owner:s}};Dt.createContext=function(t){return t={$$typeof:Sz,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:wz,_context:t},t.Consumer=t};Dt.createElement=cN;Dt.createFactory=function(t){var e=cN.bind(null,t);return e.type=t,e};Dt.createRef=function(){return{current:null}};Dt.forwardRef=function(t){return{$$typeof:Rz,render:t}};Dt.isValidElement=$B;Dt.lazy=function(t){return{$$typeof:Vz,_payload:{_status:-1,_result:t},_init:Mz}};Dt.memo=function(t,e){return{$$typeof:xz,type:t,compare:e===void 0?null:e}};Dt.startTransition=function(t){var e=xp.transition;xp.transition={};try{t()}finally{xp.transition=e}};Dt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Dt.useCallback=function(t,e){return lo.current.useCallback(t,e)};Dt.useContext=function(t){return lo.current.useContext(t)};Dt.useDebugValue=function(){};Dt.useDeferredValue=function(t){return lo.current.useDeferredValue(t)};Dt.useEffect=function(t,e){return lo.current.useEffect(t,e)};Dt.useId=function(){return lo.current.useId()};Dt.useImperativeHandle=function(t,e,n){return lo.current.useImperativeHandle(t,e,n)};Dt.useInsertionEffect=function(t,e){return lo.current.useInsertionEffect(t,e)};Dt.useLayoutEffect=function(t,e){return lo.current.useLayoutEffect(t,e)};Dt.useMemo=function(t,e){return lo.current.useMemo(t,e)};Dt.useReducer=function(t,e,n){return lo.current.useReducer(t,e,n)};Dt.useRef=function(t){return lo.current.useRef(t)};Dt.useState=function(t){return lo.current.useState(t)};Dt.useSyncExternalStore=function(t,e,n){return lo.current.useSyncExternalStore(t,e,n)};Dt.useTransition=function(){return lo.current.useTransition()};Dt.version="18.2.0";iN.exports=Dt;var x=iN.exports;const ne=LI(x),IN=yz({__proto__:null,default:ne},[x]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fz=x,Kz=Symbol.for("react.element"),zz=Symbol.for("react.fragment"),Lz=Object.prototype.hasOwnProperty,Ez=Fz.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kz={key:!0,ref:!0,__self:!0,__source:!0};function uN(t,e,n){var i,o={},r=null,s=null;n!==void 0&&(r=""+n),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(s=e.ref);for(i in e)Lz.call(e,i)&&!kz.hasOwnProperty(i)&&(o[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)o[i]===void 0&&(o[i]=e[i]);return{$$typeof:Kz,type:t,key:r,ref:s,props:o,_owner:Ez.current}}lm.Fragment=zz;lm.jsx=uN;lm.jsxs=uN;nN.exports=lm;var Pe=nN.exports,mv={},CN={exports:{}},Uo={},dN={exports:{}},hN={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(H,D){var T=H.length;H.push(D);e:for(;0<T;){var J=T-1>>>1,$=H[J];if(0<o($,D))H[J]=D,H[T]=$,T=J;else break e}}function n(H){return H.length===0?null:H[0]}function i(H){if(H.length===0)return null;var D=H[0],T=H.pop();if(T!==D){H[0]=T;e:for(var J=0,$=H.length,Ie=$>>>1;J<Ie;){var fe=2*(J+1)-1,ve=H[fe],Ge=fe+1,Me=H[Ge];if(0>o(ve,T))Ge<$&&0>o(Me,ve)?(H[J]=Me,H[Ge]=T,J=Ge):(H[J]=ve,H[fe]=T,J=fe);else if(Ge<$&&0>o(Me,T))H[J]=Me,H[Ge]=T,J=Ge;else break e}}return D}function o(H,D){var T=H.sortIndex-D.sortIndex;return T!==0?T:H.id-D.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var s=Date,a=s.now();t.unstable_now=function(){return s.now()-a}}var l=[],g=[],c=1,C=null,d=3,h=!1,p=!1,v=!1,f=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(H){for(var D=n(g);D!==null;){if(D.callback===null)i(g);else if(D.startTime<=H)i(g),D.sortIndex=D.expirationTime,e(l,D);else break;D=n(g)}}function B(H){if(v=!1,m(H),!p)if(n(l)!==null)p=!0,re(Z);else{var D=n(g);D!==null&&se(B,D.startTime-H)}}function Z(H,D){p=!1,v&&(v=!1,A(X),X=-1),h=!0;var T=d;try{for(m(D),C=n(l);C!==null&&(!(C.expirationTime>D)||H&&!z());){var J=C.callback;if(typeof J=="function"){C.callback=null,d=C.priorityLevel;var $=J(C.expirationTime<=D);D=t.unstable_now(),typeof $=="function"?C.callback=$:C===n(l)&&i(l),m(D)}else i(l);C=n(l)}if(C!==null)var Ie=!0;else{var fe=n(g);fe!==null&&se(B,fe.startTime-D),Ie=!1}return Ie}finally{C=null,d=T,h=!1}}var w=!1,W=null,X=-1,V=5,Y=-1;function z(){return!(t.unstable_now()-Y<V)}function q(){if(W!==null){var H=t.unstable_now();Y=H;var D=!0;try{D=W(!0,H)}finally{D?O():(w=!1,W=null)}}else w=!1}var O;if(typeof b=="function")O=function(){b(q)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,oe=te.port2;te.port1.onmessage=q,O=function(){oe.postMessage(null)}}else O=function(){f(q,0)};function re(H){W=H,w||(w=!0,O())}function se(H,D){X=f(function(){H(t.unstable_now())},D)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(H){H.callback=null},t.unstable_continueExecution=function(){p||h||(p=!0,re(Z))},t.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):V=0<H?Math.floor(1e3/H):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(H){switch(d){case 1:case 2:case 3:var D=3;break;default:D=d}var T=d;d=D;try{return H()}finally{d=T}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(H,D){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var T=d;d=H;try{return D()}finally{d=T}},t.unstable_scheduleCallback=function(H,D,T){var J=t.unstable_now();switch(typeof T=="object"&&T!==null?(T=T.delay,T=typeof T=="number"&&0<T?J+T:J):T=J,H){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=T+$,H={id:c++,callback:D,priorityLevel:H,startTime:T,expirationTime:$,sortIndex:-1},T>J?(H.sortIndex=T,e(g,H),n(l)===null&&H===n(g)&&(v?(A(X),X=-1):v=!0,se(B,T-J))):(H.sortIndex=$,e(l,H),p||h||(p=!0,re(Z))),H},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(H){var D=d;return function(){var T=d;d=D;try{return H.apply(this,arguments)}finally{d=T}}}})(hN);dN.exports=hN;var Tz=dN.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AN=x,_o=Tz;function Ee(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var pN=new Set,zC={};function Fg(t,e){mI(t,e),mI(t+"Capture",e)}function mI(t,e){for(zC[t]=e,t=0;t<e.length;t++)pN.add(e[t])}var ga=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bv=Object.prototype.hasOwnProperty,_z=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,BR={},ZR={};function Uz(t){return bv.call(ZR,t)?!0:bv.call(BR,t)?!1:_z.test(t)?ZR[t]=!0:(BR[t]=!0,!1)}function Pz(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Dz(t,e,n,i){if(e===null||typeof e>"u"||Pz(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function go(t,e,n,i,o,r,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=r,this.removeEmptyString=s}var Ri={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ri[t]=new go(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ri[e]=new go(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ri[t]=new go(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ri[t]=new go(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ri[t]=new go(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ri[t]=new go(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ri[t]=new go(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ri[t]=new go(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ri[t]=new go(t,5,!1,t.toLowerCase(),null,!1,!1)});var eZ=/[\-:]([a-z])/g;function tZ(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(eZ,tZ);Ri[e]=new go(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(eZ,tZ);Ri[e]=new go(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(eZ,tZ);Ri[e]=new go(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ri[t]=new go(t,1,!1,t.toLowerCase(),null,!1,!1)});Ri.xlinkHref=new go("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ri[t]=new go(t,1,!1,t.toLowerCase(),null,!0,!0)});function nZ(t,e,n,i){var o=Ri.hasOwnProperty(e)?Ri[e]:null;(o!==null?o.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Dz(e,n,o,i)&&(n=null),i||o===null?Uz(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):o.mustUseProperty?t[o.propertyName]=n===null?o.type===3?!1:"":n:(e=o.attributeName,i=o.attributeNamespace,n===null?t.removeAttribute(e):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var ma=AN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,aA=Symbol.for("react.element"),Lc=Symbol.for("react.portal"),Ec=Symbol.for("react.fragment"),iZ=Symbol.for("react.strict_mode"),yv=Symbol.for("react.profiler"),fN=Symbol.for("react.provider"),mN=Symbol.for("react.context"),oZ=Symbol.for("react.forward_ref"),vv=Symbol.for("react.suspense"),Gv=Symbol.for("react.suspense_list"),rZ=Symbol.for("react.memo"),La=Symbol.for("react.lazy"),bN=Symbol.for("react.offscreen"),wR=Symbol.iterator;function wu(t){return t===null||typeof t!="object"?null:(t=wR&&t[wR]||t["@@iterator"],typeof t=="function"?t:null)}var En=Object.assign,Wb;function oC(t){if(Wb===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Wb=e&&e[1]||""}return`
`+Wb+t}var xb=!1;function Vb(t,e){if(!t||xb)return"";xb=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(g){var i=g}Reflect.construct(t,[],e)}else{try{e.call()}catch(g){i=g}t.call(e.prototype)}else{try{throw Error()}catch(g){i=g}t()}}catch(g){if(g&&i&&typeof g.stack=="string"){for(var o=g.stack.split(`
`),r=i.stack.split(`
`),s=o.length-1,a=r.length-1;1<=s&&0<=a&&o[s]!==r[a];)a--;for(;1<=s&&0<=a;s--,a--)if(o[s]!==r[a]){if(s!==1||a!==1)do if(s--,a--,0>a||o[s]!==r[a]){var l=`
`+o[s].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=s&&0<=a);break}}}finally{xb=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?oC(t):""}function Jz(t){switch(t.tag){case 5:return oC(t.type);case 16:return oC("Lazy");case 13:return oC("Suspense");case 19:return oC("SuspenseList");case 0:case 2:case 15:return t=Vb(t.type,!1),t;case 11:return t=Vb(t.type.render,!1),t;case 1:return t=Vb(t.type,!0),t;default:return""}}function Bv(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ec:return"Fragment";case Lc:return"Portal";case yv:return"Profiler";case iZ:return"StrictMode";case vv:return"Suspense";case Gv:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case mN:return(t.displayName||"Context")+".Consumer";case fN:return(t._context.displayName||"Context")+".Provider";case oZ:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case rZ:return e=t.displayName||null,e!==null?e:Bv(t.type)||"Memo";case La:e=t._payload,t=t._init;try{return Bv(t(e))}catch{}}return null}function Oz(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Bv(e);case 8:return e===iZ?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Il(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function yN(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Qz(t){var e=yN(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,r=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(s){i=""+s,r.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(s){i=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function lA(t){t._valueTracker||(t._valueTracker=Qz(t))}function vN(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=yN(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function rf(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Zv(t,e){var n=e.checked;return En({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function SR(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Il(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function GN(t,e){e=e.checked,e!=null&&nZ(t,"checked",e,!1)}function wv(t,e){GN(t,e);var n=Il(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Sv(t,e.type,n):e.hasOwnProperty("defaultValue")&&Sv(t,e.type,Il(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function RR(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Sv(t,e,n){(e!=="number"||rf(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var rC=Array.isArray;function rI(t,e,n,i){if(t=t.options,e){e={};for(var o=0;o<n.length;o++)e["$"+n[o]]=!0;for(n=0;n<t.length;n++)o=e.hasOwnProperty("$"+t[n].value),t[n].selected!==o&&(t[n].selected=o),o&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Il(n),e=null,o=0;o<t.length;o++){if(t[o].value===n){t[o].selected=!0,i&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function Rv(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ee(91));return En({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function WR(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Ee(92));if(rC(n)){if(1<n.length)throw Error(Ee(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Il(n)}}function BN(t,e){var n=Il(e.value),i=Il(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function xR(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function ZN(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Wv(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?ZN(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var gA,wN=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,o){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(gA=gA||document.createElement("div"),gA.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=gA.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function LC(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var hC={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},jz=["Webkit","ms","Moz","O"];Object.keys(hC).forEach(function(t){jz.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),hC[e]=hC[t]})});function SN(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||hC.hasOwnProperty(t)&&hC[t]?(""+e).trim():e+"px"}function RN(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,o=SN(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,o):t[n]=o}}var qz=En({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xv(t,e){if(e){if(qz[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ee(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ee(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ee(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ee(62))}}function Vv(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xv=null;function sZ(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Nv=null,sI=null,aI=null;function VR(t){if(t=Kd(t)){if(typeof Nv!="function")throw Error(Ee(280));var e=t.stateNode;e&&(e=Cm(e),Nv(t.stateNode,t.type,e))}}function WN(t){sI?aI?aI.push(t):aI=[t]:sI=t}function xN(){if(sI){var t=sI,e=aI;if(aI=sI=null,VR(t),e)for(t=0;t<e.length;t++)VR(e[t])}}function VN(t,e){return t(e)}function XN(){}var Xb=!1;function NN(t,e,n){if(Xb)return t(e,n);Xb=!0;try{return VN(t,e,n)}finally{Xb=!1,(sI!==null||aI!==null)&&(XN(),xN())}}function EC(t,e){var n=t.stateNode;if(n===null)return null;var i=Cm(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Ee(231,e,typeof n));return n}var Yv=!1;if(ga)try{var Su={};Object.defineProperty(Su,"passive",{get:function(){Yv=!0}}),window.addEventListener("test",Su,Su),window.removeEventListener("test",Su,Su)}catch{Yv=!1}function $z(t,e,n,i,o,r,s,a,l){var g=Array.prototype.slice.call(arguments,3);try{e.apply(n,g)}catch(c){this.onError(c)}}var AC=!1,sf=null,af=!1,Mv=null,eL={onError:function(t){AC=!0,sf=t}};function tL(t,e,n,i,o,r,s,a,l){AC=!1,sf=null,$z.apply(eL,arguments)}function nL(t,e,n,i,o,r,s,a,l){if(tL.apply(this,arguments),AC){if(AC){var g=sf;AC=!1,sf=null}else throw Error(Ee(198));af||(af=!0,Mv=g)}}function Kg(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function YN(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function XR(t){if(Kg(t)!==t)throw Error(Ee(188))}function iL(t){var e=t.alternate;if(!e){if(e=Kg(t),e===null)throw Error(Ee(188));return e!==t?null:t}for(var n=t,i=e;;){var o=n.return;if(o===null)break;var r=o.alternate;if(r===null){if(i=o.return,i!==null){n=i;continue}break}if(o.child===r.child){for(r=o.child;r;){if(r===n)return XR(o),t;if(r===i)return XR(o),e;r=r.sibling}throw Error(Ee(188))}if(n.return!==i.return)n=o,i=r;else{for(var s=!1,a=o.child;a;){if(a===n){s=!0,n=o,i=r;break}if(a===i){s=!0,i=o,n=r;break}a=a.sibling}if(!s){for(a=r.child;a;){if(a===n){s=!0,n=r,i=o;break}if(a===i){s=!0,i=r,n=o;break}a=a.sibling}if(!s)throw Error(Ee(189))}}if(n.alternate!==i)throw Error(Ee(190))}if(n.tag!==3)throw Error(Ee(188));return n.stateNode.current===n?t:e}function MN(t){return t=iL(t),t!==null?HN(t):null}function HN(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=HN(t);if(e!==null)return e;t=t.sibling}return null}var FN=_o.unstable_scheduleCallback,NR=_o.unstable_cancelCallback,oL=_o.unstable_shouldYield,rL=_o.unstable_requestPaint,jn=_o.unstable_now,sL=_o.unstable_getCurrentPriorityLevel,aZ=_o.unstable_ImmediatePriority,KN=_o.unstable_UserBlockingPriority,lf=_o.unstable_NormalPriority,aL=_o.unstable_LowPriority,zN=_o.unstable_IdlePriority,gm=null,ms=null;function lL(t){if(ms&&typeof ms.onCommitFiberRoot=="function")try{ms.onCommitFiberRoot(gm,t,void 0,(t.current.flags&128)===128)}catch{}}var zr=Math.clz32?Math.clz32:IL,gL=Math.log,cL=Math.LN2;function IL(t){return t>>>=0,t===0?32:31-(gL(t)/cL|0)|0}var cA=64,IA=4194304;function sC(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function gf(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,o=t.suspendedLanes,r=t.pingedLanes,s=n&268435455;if(s!==0){var a=s&~o;a!==0?i=sC(a):(r&=s,r!==0&&(i=sC(r)))}else s=n&~o,s!==0?i=sC(s):r!==0&&(i=sC(r));if(i===0)return 0;if(e!==0&&e!==i&&!(e&o)&&(o=i&-i,r=e&-e,o>=r||o===16&&(r&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-zr(e),o=1<<n,i|=t[n],e&=~o;return i}function uL(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function CL(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,o=t.expirationTimes,r=t.pendingLanes;0<r;){var s=31-zr(r),a=1<<s,l=o[s];l===-1?(!(a&n)||a&i)&&(o[s]=uL(a,e)):l<=e&&(t.expiredLanes|=a),r&=~a}}function Hv(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function LN(){var t=cA;return cA<<=1,!(cA&4194240)&&(cA=64),t}function Nb(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Hd(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-zr(e),t[e]=n}function dL(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var o=31-zr(n),r=1<<o;e[o]=0,i[o]=-1,t[o]=-1,n&=~r}}function lZ(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-zr(n),o=1<<i;o&e|t[i]&e&&(t[i]|=e),n&=~o}}var In=0;function EN(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var kN,gZ,TN,_N,UN,Fv=!1,uA=[],Qa=null,ja=null,qa=null,kC=new Map,TC=new Map,ka=[],hL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function YR(t,e){switch(t){case"focusin":case"focusout":Qa=null;break;case"dragenter":case"dragleave":ja=null;break;case"mouseover":case"mouseout":qa=null;break;case"pointerover":case"pointerout":kC.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":TC.delete(e.pointerId)}}function Ru(t,e,n,i,o,r){return t===null||t.nativeEvent!==r?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:r,targetContainers:[o]},e!==null&&(e=Kd(e),e!==null&&gZ(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function AL(t,e,n,i,o){switch(e){case"focusin":return Qa=Ru(Qa,t,e,n,i,o),!0;case"dragenter":return ja=Ru(ja,t,e,n,i,o),!0;case"mouseover":return qa=Ru(qa,t,e,n,i,o),!0;case"pointerover":var r=o.pointerId;return kC.set(r,Ru(kC.get(r)||null,t,e,n,i,o)),!0;case"gotpointercapture":return r=o.pointerId,TC.set(r,Ru(TC.get(r)||null,t,e,n,i,o)),!0}return!1}function PN(t){var e=og(t.target);if(e!==null){var n=Kg(e);if(n!==null){if(e=n.tag,e===13){if(e=YN(n),e!==null){t.blockedOn=e,UN(t.priority,function(){TN(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Vp(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Kv(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Xv=i,n.target.dispatchEvent(i),Xv=null}else return e=Kd(n),e!==null&&gZ(e),t.blockedOn=n,!1;e.shift()}return!0}function MR(t,e,n){Vp(t)&&n.delete(e)}function pL(){Fv=!1,Qa!==null&&Vp(Qa)&&(Qa=null),ja!==null&&Vp(ja)&&(ja=null),qa!==null&&Vp(qa)&&(qa=null),kC.forEach(MR),TC.forEach(MR)}function Wu(t,e){t.blockedOn===e&&(t.blockedOn=null,Fv||(Fv=!0,_o.unstable_scheduleCallback(_o.unstable_NormalPriority,pL)))}function _C(t){function e(o){return Wu(o,t)}if(0<uA.length){Wu(uA[0],t);for(var n=1;n<uA.length;n++){var i=uA[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Qa!==null&&Wu(Qa,t),ja!==null&&Wu(ja,t),qa!==null&&Wu(qa,t),kC.forEach(e),TC.forEach(e),n=0;n<ka.length;n++)i=ka[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<ka.length&&(n=ka[0],n.blockedOn===null);)PN(n),n.blockedOn===null&&ka.shift()}var lI=ma.ReactCurrentBatchConfig,cf=!0;function fL(t,e,n,i){var o=In,r=lI.transition;lI.transition=null;try{In=1,cZ(t,e,n,i)}finally{In=o,lI.transition=r}}function mL(t,e,n,i){var o=In,r=lI.transition;lI.transition=null;try{In=4,cZ(t,e,n,i)}finally{In=o,lI.transition=r}}function cZ(t,e,n,i){if(cf){var o=Kv(t,e,n,i);if(o===null)Tb(t,e,i,If,n),YR(t,i);else if(AL(o,t,e,n,i))i.stopPropagation();else if(YR(t,i),e&4&&-1<hL.indexOf(t)){for(;o!==null;){var r=Kd(o);if(r!==null&&kN(r),r=Kv(t,e,n,i),r===null&&Tb(t,e,i,If,n),r===o)break;o=r}o!==null&&i.stopPropagation()}else Tb(t,e,i,null,n)}}var If=null;function Kv(t,e,n,i){if(If=null,t=sZ(i),t=og(t),t!==null)if(e=Kg(t),e===null)t=null;else if(n=e.tag,n===13){if(t=YN(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return If=t,null}function DN(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(sL()){case aZ:return 1;case KN:return 4;case lf:case aL:return 16;case zN:return 536870912;default:return 16}default:return 16}}var _a=null,IZ=null,Xp=null;function JN(){if(Xp)return Xp;var t,e=IZ,n=e.length,i,o="value"in _a?_a.value:_a.textContent,r=o.length;for(t=0;t<n&&e[t]===o[t];t++);var s=n-t;for(i=1;i<=s&&e[n-i]===o[r-i];i++);return Xp=o.slice(t,1<i?1-i:void 0)}function Np(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function CA(){return!0}function HR(){return!1}function Po(t){function e(n,i,o,r,s){this._reactName=n,this._targetInst=o,this.type=i,this.nativeEvent=r,this.target=s,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(r):r[a]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?CA:HR,this.isPropagationStopped=HR,this}return En(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=CA)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=CA)},persist:function(){},isPersistent:CA}),e}var kI={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uZ=Po(kI),Fd=En({},kI,{view:0,detail:0}),bL=Po(Fd),Yb,Mb,xu,cm=En({},Fd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:CZ,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==xu&&(xu&&t.type==="mousemove"?(Yb=t.screenX-xu.screenX,Mb=t.screenY-xu.screenY):Mb=Yb=0,xu=t),Yb)},movementY:function(t){return"movementY"in t?t.movementY:Mb}}),FR=Po(cm),yL=En({},cm,{dataTransfer:0}),vL=Po(yL),GL=En({},Fd,{relatedTarget:0}),Hb=Po(GL),BL=En({},kI,{animationName:0,elapsedTime:0,pseudoElement:0}),ZL=Po(BL),wL=En({},kI,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),SL=Po(wL),RL=En({},kI,{data:0}),KR=Po(RL),WL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},VL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function XL(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=VL[t])?!!e[t]:!1}function CZ(){return XL}var NL=En({},Fd,{key:function(t){if(t.key){var e=WL[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Np(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?xL[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:CZ,charCode:function(t){return t.type==="keypress"?Np(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Np(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),YL=Po(NL),ML=En({},cm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zR=Po(ML),HL=En({},Fd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:CZ}),FL=Po(HL),KL=En({},kI,{propertyName:0,elapsedTime:0,pseudoElement:0}),zL=Po(KL),LL=En({},cm,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),EL=Po(LL),kL=[9,13,27,32],dZ=ga&&"CompositionEvent"in window,pC=null;ga&&"documentMode"in document&&(pC=document.documentMode);var TL=ga&&"TextEvent"in window&&!pC,ON=ga&&(!dZ||pC&&8<pC&&11>=pC),LR=String.fromCharCode(32),ER=!1;function QN(t,e){switch(t){case"keyup":return kL.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jN(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var kc=!1;function _L(t,e){switch(t){case"compositionend":return jN(e);case"keypress":return e.which!==32?null:(ER=!0,LR);case"textInput":return t=e.data,t===LR&&ER?null:t;default:return null}}function UL(t,e){if(kc)return t==="compositionend"||!dZ&&QN(t,e)?(t=JN(),Xp=IZ=_a=null,kc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return ON&&e.locale!=="ko"?null:e.data;default:return null}}var PL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kR(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!PL[t.type]:e==="textarea"}function qN(t,e,n,i){WN(i),e=uf(e,"onChange"),0<e.length&&(n=new uZ("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var fC=null,UC=null;function DL(t){gY(t,0)}function Im(t){var e=Uc(t);if(vN(e))return t}function JL(t,e){if(t==="change")return e}var $N=!1;if(ga){var Fb;if(ga){var Kb="oninput"in document;if(!Kb){var TR=document.createElement("div");TR.setAttribute("oninput","return;"),Kb=typeof TR.oninput=="function"}Fb=Kb}else Fb=!1;$N=Fb&&(!document.documentMode||9<document.documentMode)}function _R(){fC&&(fC.detachEvent("onpropertychange",eY),UC=fC=null)}function eY(t){if(t.propertyName==="value"&&Im(UC)){var e=[];qN(e,UC,t,sZ(t)),NN(DL,e)}}function OL(t,e,n){t==="focusin"?(_R(),fC=e,UC=n,fC.attachEvent("onpropertychange",eY)):t==="focusout"&&_R()}function QL(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Im(UC)}function jL(t,e){if(t==="click")return Im(e)}function qL(t,e){if(t==="input"||t==="change")return Im(e)}function $L(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Tr=typeof Object.is=="function"?Object.is:$L;function PC(t,e){if(Tr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var o=n[i];if(!bv.call(e,o)||!Tr(t[o],e[o]))return!1}return!0}function UR(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function PR(t,e){var n=UR(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=UR(n)}}function tY(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?tY(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function nY(){for(var t=window,e=rf();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=rf(t.document)}return e}function hZ(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function eE(t){var e=nY(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&tY(n.ownerDocument.documentElement,n)){if(i!==null&&hZ(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=n.textContent.length,r=Math.min(i.start,o);i=i.end===void 0?r:Math.min(i.end,o),!t.extend&&r>i&&(o=i,i=r,r=o),o=PR(n,r);var s=PR(n,i);o&&s&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==s.node||t.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),r>i?(t.addRange(e),t.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var tE=ga&&"documentMode"in document&&11>=document.documentMode,Tc=null,zv=null,mC=null,Lv=!1;function DR(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Lv||Tc==null||Tc!==rf(i)||(i=Tc,"selectionStart"in i&&hZ(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),mC&&PC(mC,i)||(mC=i,i=uf(zv,"onSelect"),0<i.length&&(e=new uZ("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Tc)))}function dA(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var _c={animationend:dA("Animation","AnimationEnd"),animationiteration:dA("Animation","AnimationIteration"),animationstart:dA("Animation","AnimationStart"),transitionend:dA("Transition","TransitionEnd")},zb={},iY={};ga&&(iY=document.createElement("div").style,"AnimationEvent"in window||(delete _c.animationend.animation,delete _c.animationiteration.animation,delete _c.animationstart.animation),"TransitionEvent"in window||delete _c.transitionend.transition);function um(t){if(zb[t])return zb[t];if(!_c[t])return t;var e=_c[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in iY)return zb[t]=e[n];return t}var oY=um("animationend"),rY=um("animationiteration"),sY=um("animationstart"),aY=um("transitionend"),lY=new Map,JR="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function bl(t,e){lY.set(t,e),Fg(e,[t])}for(var Lb=0;Lb<JR.length;Lb++){var Eb=JR[Lb],nE=Eb.toLowerCase(),iE=Eb[0].toUpperCase()+Eb.slice(1);bl(nE,"on"+iE)}bl(oY,"onAnimationEnd");bl(rY,"onAnimationIteration");bl(sY,"onAnimationStart");bl("dblclick","onDoubleClick");bl("focusin","onFocus");bl("focusout","onBlur");bl(aY,"onTransitionEnd");mI("onMouseEnter",["mouseout","mouseover"]);mI("onMouseLeave",["mouseout","mouseover"]);mI("onPointerEnter",["pointerout","pointerover"]);mI("onPointerLeave",["pointerout","pointerover"]);Fg("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Fg("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Fg("onBeforeInput",["compositionend","keypress","textInput","paste"]);Fg("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Fg("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Fg("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var aC="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),oE=new Set("cancel close invalid load scroll toggle".split(" ").concat(aC));function OR(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,nL(i,e,void 0,t),t.currentTarget=null}function gY(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],o=i.event;i=i.listeners;e:{var r=void 0;if(e)for(var s=i.length-1;0<=s;s--){var a=i[s],l=a.instance,g=a.currentTarget;if(a=a.listener,l!==r&&o.isPropagationStopped())break e;OR(o,a,g),r=l}else for(s=0;s<i.length;s++){if(a=i[s],l=a.instance,g=a.currentTarget,a=a.listener,l!==r&&o.isPropagationStopped())break e;OR(o,a,g),r=l}}}if(af)throw t=Mv,af=!1,Mv=null,t}function Gn(t,e){var n=e[Uv];n===void 0&&(n=e[Uv]=new Set);var i=t+"__bubble";n.has(i)||(cY(e,t,2,!1),n.add(i))}function kb(t,e,n){var i=0;e&&(i|=4),cY(n,t,i,e)}var hA="_reactListening"+Math.random().toString(36).slice(2);function DC(t){if(!t[hA]){t[hA]=!0,pN.forEach(function(n){n!=="selectionchange"&&(oE.has(n)||kb(n,!1,t),kb(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[hA]||(e[hA]=!0,kb("selectionchange",!1,e))}}function cY(t,e,n,i){switch(DN(e)){case 1:var o=fL;break;case 4:o=mL;break;default:o=cZ}n=o.bind(null,e,n,t),o=void 0,!Yv||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),i?o!==void 0?t.addEventListener(e,n,{capture:!0,passive:o}):t.addEventListener(e,n,!0):o!==void 0?t.addEventListener(e,n,{passive:o}):t.addEventListener(e,n,!1)}function Tb(t,e,n,i,o){var r=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var s=i.tag;if(s===3||s===4){var a=i.stateNode.containerInfo;if(a===o||a.nodeType===8&&a.parentNode===o)break;if(s===4)for(s=i.return;s!==null;){var l=s.tag;if((l===3||l===4)&&(l=s.stateNode.containerInfo,l===o||l.nodeType===8&&l.parentNode===o))return;s=s.return}for(;a!==null;){if(s=og(a),s===null)return;if(l=s.tag,l===5||l===6){i=r=s;continue e}a=a.parentNode}}i=i.return}NN(function(){var g=r,c=sZ(n),C=[];e:{var d=lY.get(t);if(d!==void 0){var h=uZ,p=t;switch(t){case"keypress":if(Np(n)===0)break e;case"keydown":case"keyup":h=YL;break;case"focusin":p="focus",h=Hb;break;case"focusout":p="blur",h=Hb;break;case"beforeblur":case"afterblur":h=Hb;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=FR;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=vL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=FL;break;case oY:case rY:case sY:h=ZL;break;case aY:h=zL;break;case"scroll":h=bL;break;case"wheel":h=EL;break;case"copy":case"cut":case"paste":h=SL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=zR}var v=(e&4)!==0,f=!v&&t==="scroll",A=v?d!==null?d+"Capture":null:d;v=[];for(var b=g,m;b!==null;){m=b;var B=m.stateNode;if(m.tag===5&&B!==null&&(m=B,A!==null&&(B=EC(b,A),B!=null&&v.push(JC(b,B,m)))),f)break;b=b.return}0<v.length&&(d=new h(d,p,null,n,c),C.push({event:d,listeners:v}))}}if(!(e&7)){e:{if(d=t==="mouseover"||t==="pointerover",h=t==="mouseout"||t==="pointerout",d&&n!==Xv&&(p=n.relatedTarget||n.fromElement)&&(og(p)||p[ca]))break e;if((h||d)&&(d=c.window===c?c:(d=c.ownerDocument)?d.defaultView||d.parentWindow:window,h?(p=n.relatedTarget||n.toElement,h=g,p=p?og(p):null,p!==null&&(f=Kg(p),p!==f||p.tag!==5&&p.tag!==6)&&(p=null)):(h=null,p=g),h!==p)){if(v=FR,B="onMouseLeave",A="onMouseEnter",b="mouse",(t==="pointerout"||t==="pointerover")&&(v=zR,B="onPointerLeave",A="onPointerEnter",b="pointer"),f=h==null?d:Uc(h),m=p==null?d:Uc(p),d=new v(B,b+"leave",h,n,c),d.target=f,d.relatedTarget=m,B=null,og(c)===g&&(v=new v(A,b+"enter",p,n,c),v.target=m,v.relatedTarget=f,B=v),f=B,h&&p)t:{for(v=h,A=p,b=0,m=v;m;m=gc(m))b++;for(m=0,B=A;B;B=gc(B))m++;for(;0<b-m;)v=gc(v),b--;for(;0<m-b;)A=gc(A),m--;for(;b--;){if(v===A||A!==null&&v===A.alternate)break t;v=gc(v),A=gc(A)}v=null}else v=null;h!==null&&QR(C,d,h,v,!1),p!==null&&f!==null&&QR(C,f,p,v,!0)}}e:{if(d=g?Uc(g):window,h=d.nodeName&&d.nodeName.toLowerCase(),h==="select"||h==="input"&&d.type==="file")var Z=JL;else if(kR(d))if($N)Z=qL;else{Z=QL;var w=OL}else(h=d.nodeName)&&h.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(Z=jL);if(Z&&(Z=Z(t,g))){qN(C,Z,n,c);break e}w&&w(t,d,g),t==="focusout"&&(w=d._wrapperState)&&w.controlled&&d.type==="number"&&Sv(d,"number",d.value)}switch(w=g?Uc(g):window,t){case"focusin":(kR(w)||w.contentEditable==="true")&&(Tc=w,zv=g,mC=null);break;case"focusout":mC=zv=Tc=null;break;case"mousedown":Lv=!0;break;case"contextmenu":case"mouseup":case"dragend":Lv=!1,DR(C,n,c);break;case"selectionchange":if(tE)break;case"keydown":case"keyup":DR(C,n,c)}var W;if(dZ)e:{switch(t){case"compositionstart":var X="onCompositionStart";break e;case"compositionend":X="onCompositionEnd";break e;case"compositionupdate":X="onCompositionUpdate";break e}X=void 0}else kc?QN(t,n)&&(X="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(X="onCompositionStart");X&&(ON&&n.locale!=="ko"&&(kc||X!=="onCompositionStart"?X==="onCompositionEnd"&&kc&&(W=JN()):(_a=c,IZ="value"in _a?_a.value:_a.textContent,kc=!0)),w=uf(g,X),0<w.length&&(X=new KR(X,t,null,n,c),C.push({event:X,listeners:w}),W?X.data=W:(W=jN(n),W!==null&&(X.data=W)))),(W=TL?_L(t,n):UL(t,n))&&(g=uf(g,"onBeforeInput"),0<g.length&&(c=new KR("onBeforeInput","beforeinput",null,n,c),C.push({event:c,listeners:g}),c.data=W))}gY(C,e)})}function JC(t,e,n){return{instance:t,listener:e,currentTarget:n}}function uf(t,e){for(var n=e+"Capture",i=[];t!==null;){var o=t,r=o.stateNode;o.tag===5&&r!==null&&(o=r,r=EC(t,n),r!=null&&i.unshift(JC(t,r,o)),r=EC(t,e),r!=null&&i.push(JC(t,r,o))),t=t.return}return i}function gc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function QR(t,e,n,i,o){for(var r=e._reactName,s=[];n!==null&&n!==i;){var a=n,l=a.alternate,g=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&g!==null&&(a=g,o?(l=EC(n,r),l!=null&&s.unshift(JC(n,l,a))):o||(l=EC(n,r),l!=null&&s.push(JC(n,l,a)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}var rE=/\r\n?/g,sE=/\u0000|\uFFFD/g;function jR(t){return(typeof t=="string"?t:""+t).replace(rE,`
`).replace(sE,"")}function AA(t,e,n){if(e=jR(e),jR(t)!==e&&n)throw Error(Ee(425))}function Cf(){}var Ev=null,kv=null;function Tv(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var _v=typeof setTimeout=="function"?setTimeout:void 0,aE=typeof clearTimeout=="function"?clearTimeout:void 0,qR=typeof Promise=="function"?Promise:void 0,lE=typeof queueMicrotask=="function"?queueMicrotask:typeof qR<"u"?function(t){return qR.resolve(null).then(t).catch(gE)}:_v;function gE(t){setTimeout(function(){throw t})}function _b(t,e){var n=e,i=0;do{var o=n.nextSibling;if(t.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(i===0){t.removeChild(o),_C(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=o}while(n);_C(e)}function $a(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function $R(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var TI=Math.random().toString(36).slice(2),ps="__reactFiber$"+TI,OC="__reactProps$"+TI,ca="__reactContainer$"+TI,Uv="__reactEvents$"+TI,cE="__reactListeners$"+TI,IE="__reactHandles$"+TI;function og(t){var e=t[ps];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ca]||n[ps]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=$R(t);t!==null;){if(n=t[ps])return n;t=$R(t)}return e}t=n,n=t.parentNode}return null}function Kd(t){return t=t[ps]||t[ca],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Uc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ee(33))}function Cm(t){return t[OC]||null}var Pv=[],Pc=-1;function yl(t){return{current:t}}function Sn(t){0>Pc||(t.current=Pv[Pc],Pv[Pc]=null,Pc--)}function vn(t,e){Pc++,Pv[Pc]=t.current,t.current=e}var ul={},Ui=yl(ul),Ro=yl(!1),Zg=ul;function bI(t,e){var n=t.type.contextTypes;if(!n)return ul;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var o={},r;for(r in n)o[r]=e[r];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function Wo(t){return t=t.childContextTypes,t!=null}function df(){Sn(Ro),Sn(Ui)}function e1(t,e,n){if(Ui.current!==ul)throw Error(Ee(168));vn(Ui,e),vn(Ro,n)}function IY(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var o in i)if(!(o in e))throw Error(Ee(108,Oz(t)||"Unknown",o));return En({},n,i)}function hf(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ul,Zg=Ui.current,vn(Ui,t),vn(Ro,Ro.current),!0}function t1(t,e,n){var i=t.stateNode;if(!i)throw Error(Ee(169));n?(t=IY(t,e,Zg),i.__reactInternalMemoizedMergedChildContext=t,Sn(Ro),Sn(Ui),vn(Ui,t)):Sn(Ro),vn(Ro,n)}var Qs=null,dm=!1,Ub=!1;function uY(t){Qs===null?Qs=[t]:Qs.push(t)}function uE(t){dm=!0,uY(t)}function vl(){if(!Ub&&Qs!==null){Ub=!0;var t=0,e=In;try{var n=Qs;for(In=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Qs=null,dm=!1}catch(o){throw Qs!==null&&(Qs=Qs.slice(t+1)),FN(aZ,vl),o}finally{In=e,Ub=!1}}return null}var Dc=[],Jc=0,Af=null,pf=0,rr=[],sr=0,wg=null,ta=1,na="";function Dl(t,e){Dc[Jc++]=pf,Dc[Jc++]=Af,Af=t,pf=e}function CY(t,e,n){rr[sr++]=ta,rr[sr++]=na,rr[sr++]=wg,wg=t;var i=ta;t=na;var o=32-zr(i)-1;i&=~(1<<o),n+=1;var r=32-zr(e)+o;if(30<r){var s=o-o%5;r=(i&(1<<s)-1).toString(32),i>>=s,o-=s,ta=1<<32-zr(e)+o|n<<o|i,na=r+t}else ta=1<<r|n<<o|i,na=t}function AZ(t){t.return!==null&&(Dl(t,1),CY(t,1,0))}function pZ(t){for(;t===Af;)Af=Dc[--Jc],Dc[Jc]=null,pf=Dc[--Jc],Dc[Jc]=null;for(;t===wg;)wg=rr[--sr],rr[sr]=null,na=rr[--sr],rr[sr]=null,ta=rr[--sr],rr[sr]=null}var Eo=null,Lo=null,Vn=!1,Yr=null;function dY(t,e){var n=cr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function n1(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Eo=t,Lo=$a(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Eo=t,Lo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=wg!==null?{id:ta,overflow:na}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=cr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Eo=t,Lo=null,!0):!1;default:return!1}}function Dv(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Jv(t){if(Vn){var e=Lo;if(e){var n=e;if(!n1(t,e)){if(Dv(t))throw Error(Ee(418));e=$a(n.nextSibling);var i=Eo;e&&n1(t,e)?dY(i,n):(t.flags=t.flags&-4097|2,Vn=!1,Eo=t)}}else{if(Dv(t))throw Error(Ee(418));t.flags=t.flags&-4097|2,Vn=!1,Eo=t}}}function i1(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Eo=t}function pA(t){if(t!==Eo)return!1;if(!Vn)return i1(t),Vn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Tv(t.type,t.memoizedProps)),e&&(e=Lo)){if(Dv(t))throw hY(),Error(Ee(418));for(;e;)dY(t,e),e=$a(e.nextSibling)}if(i1(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ee(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Lo=$a(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Lo=null}}else Lo=Eo?$a(t.stateNode.nextSibling):null;return!0}function hY(){for(var t=Lo;t;)t=$a(t.nextSibling)}function yI(){Lo=Eo=null,Vn=!1}function fZ(t){Yr===null?Yr=[t]:Yr.push(t)}var CE=ma.ReactCurrentBatchConfig;function Vr(t,e){if(t&&t.defaultProps){e=En({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var ff=yl(null),mf=null,Oc=null,mZ=null;function bZ(){mZ=Oc=mf=null}function yZ(t){var e=ff.current;Sn(ff),t._currentValue=e}function Ov(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function gI(t,e){mf=t,mZ=Oc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Zo=!0),t.firstContext=null)}function dr(t){var e=t._currentValue;if(mZ!==t)if(t={context:t,memoizedValue:e,next:null},Oc===null){if(mf===null)throw Error(Ee(308));Oc=t,mf.dependencies={lanes:0,firstContext:t}}else Oc=Oc.next=t;return e}var rg=null;function vZ(t){rg===null?rg=[t]:rg.push(t)}function AY(t,e,n,i){var o=e.interleaved;return o===null?(n.next=n,vZ(e)):(n.next=o.next,o.next=n),e.interleaved=n,Ia(t,i)}function Ia(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ea=!1;function GZ(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function pY(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function sa(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function el(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,jt&2){var o=i.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),i.pending=e,Ia(t,n)}return o=i.interleaved,o===null?(e.next=e,vZ(i)):(e.next=o.next,o.next=e),i.interleaved=e,Ia(t,n)}function Yp(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,lZ(t,n)}}function o1(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var o=null,r=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};r===null?o=r=s:r=r.next=s,n=n.next}while(n!==null);r===null?o=r=e:r=r.next=e}else o=r=e;n={baseState:i.baseState,firstBaseUpdate:o,lastBaseUpdate:r,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function bf(t,e,n,i){var o=t.updateQueue;Ea=!1;var r=o.firstBaseUpdate,s=o.lastBaseUpdate,a=o.shared.pending;if(a!==null){o.shared.pending=null;var l=a,g=l.next;l.next=null,s===null?r=g:s.next=g,s=l;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==s&&(a===null?c.firstBaseUpdate=g:a.next=g,c.lastBaseUpdate=l))}if(r!==null){var C=o.baseState;s=0,c=g=l=null,a=r;do{var d=a.lane,h=a.eventTime;if((i&d)===d){c!==null&&(c=c.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,v=a;switch(d=e,h=n,v.tag){case 1:if(p=v.payload,typeof p=="function"){C=p.call(h,C,d);break e}C=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=v.payload,d=typeof p=="function"?p.call(h,C,d):p,d==null)break e;C=En({},C,d);break e;case 2:Ea=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,d=o.effects,d===null?o.effects=[a]:d.push(a))}else h={eventTime:h,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(g=c=h,l=C):c=c.next=h,s|=d;if(a=a.next,a===null){if(a=o.shared.pending,a===null)break;d=a,a=d.next,d.next=null,o.lastBaseUpdate=d,o.shared.pending=null}}while(1);if(c===null&&(l=C),o.baseState=l,o.firstBaseUpdate=g,o.lastBaseUpdate=c,e=o.shared.interleaved,e!==null){o=e;do s|=o.lane,o=o.next;while(o!==e)}else r===null&&(o.shared.lanes=0);Rg|=s,t.lanes=s,t.memoizedState=C}}function r1(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],o=i.callback;if(o!==null){if(i.callback=null,i=n,typeof o!="function")throw Error(Ee(191,o));o.call(i)}}}var fY=new AN.Component().refs;function Qv(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:En({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var hm={isMounted:function(t){return(t=t._reactInternals)?Kg(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=so(),o=nl(t),r=sa(i,o);r.payload=e,n!=null&&(r.callback=n),e=el(t,r,o),e!==null&&(Lr(e,t,o,i),Yp(e,t,o))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=so(),o=nl(t),r=sa(i,o);r.tag=1,r.payload=e,n!=null&&(r.callback=n),e=el(t,r,o),e!==null&&(Lr(e,t,o,i),Yp(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=so(),i=nl(t),o=sa(n,i);o.tag=2,e!=null&&(o.callback=e),e=el(t,o,i),e!==null&&(Lr(e,t,i,n),Yp(e,t,i))}};function s1(t,e,n,i,o,r,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,r,s):e.prototype&&e.prototype.isPureReactComponent?!PC(n,i)||!PC(o,r):!0}function mY(t,e,n){var i=!1,o=ul,r=e.contextType;return typeof r=="object"&&r!==null?r=dr(r):(o=Wo(e)?Zg:Ui.current,i=e.contextTypes,r=(i=i!=null)?bI(t,o):ul),e=new e(n,r),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=hm,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=r),e}function a1(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&hm.enqueueReplaceState(e,e.state,null)}function jv(t,e,n,i){var o=t.stateNode;o.props=n,o.state=t.memoizedState,o.refs=fY,GZ(t);var r=e.contextType;typeof r=="object"&&r!==null?o.context=dr(r):(r=Wo(e)?Zg:Ui.current,o.context=bI(t,r)),o.state=t.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(Qv(t,e,r,n),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&hm.enqueueReplaceState(o,o.state,null),bf(t,n,o,i),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function Vu(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ee(309));var i=n.stateNode}if(!i)throw Error(Ee(147,t));var o=i,r=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(s){var a=o.refs;a===fY&&(a=o.refs={}),s===null?delete a[r]:a[r]=s},e._stringRef=r,e)}if(typeof t!="string")throw Error(Ee(284));if(!n._owner)throw Error(Ee(290,t))}return t}function fA(t,e){throw t=Object.prototype.toString.call(e),Error(Ee(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function l1(t){var e=t._init;return e(t._payload)}function bY(t){function e(A,b){if(t){var m=A.deletions;m===null?(A.deletions=[b],A.flags|=16):m.push(b)}}function n(A,b){if(!t)return null;for(;b!==null;)e(A,b),b=b.sibling;return null}function i(A,b){for(A=new Map;b!==null;)b.key!==null?A.set(b.key,b):A.set(b.index,b),b=b.sibling;return A}function o(A,b){return A=il(A,b),A.index=0,A.sibling=null,A}function r(A,b,m){return A.index=m,t?(m=A.alternate,m!==null?(m=m.index,m<b?(A.flags|=2,b):m):(A.flags|=2,b)):(A.flags|=1048576,b)}function s(A){return t&&A.alternate===null&&(A.flags|=2),A}function a(A,b,m,B){return b===null||b.tag!==6?(b=qb(m,A.mode,B),b.return=A,b):(b=o(b,m),b.return=A,b)}function l(A,b,m,B){var Z=m.type;return Z===Ec?c(A,b,m.props.children,B,m.key):b!==null&&(b.elementType===Z||typeof Z=="object"&&Z!==null&&Z.$$typeof===La&&l1(Z)===b.type)?(B=o(b,m.props),B.ref=Vu(A,b,m),B.return=A,B):(B=Lp(m.type,m.key,m.props,null,A.mode,B),B.ref=Vu(A,b,m),B.return=A,B)}function g(A,b,m,B){return b===null||b.tag!==4||b.stateNode.containerInfo!==m.containerInfo||b.stateNode.implementation!==m.implementation?(b=$b(m,A.mode,B),b.return=A,b):(b=o(b,m.children||[]),b.return=A,b)}function c(A,b,m,B,Z){return b===null||b.tag!==7?(b=Ag(m,A.mode,B,Z),b.return=A,b):(b=o(b,m),b.return=A,b)}function C(A,b,m){if(typeof b=="string"&&b!==""||typeof b=="number")return b=qb(""+b,A.mode,m),b.return=A,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case aA:return m=Lp(b.type,b.key,b.props,null,A.mode,m),m.ref=Vu(A,null,b),m.return=A,m;case Lc:return b=$b(b,A.mode,m),b.return=A,b;case La:var B=b._init;return C(A,B(b._payload),m)}if(rC(b)||wu(b))return b=Ag(b,A.mode,m,null),b.return=A,b;fA(A,b)}return null}function d(A,b,m,B){var Z=b!==null?b.key:null;if(typeof m=="string"&&m!==""||typeof m=="number")return Z!==null?null:a(A,b,""+m,B);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case aA:return m.key===Z?l(A,b,m,B):null;case Lc:return m.key===Z?g(A,b,m,B):null;case La:return Z=m._init,d(A,b,Z(m._payload),B)}if(rC(m)||wu(m))return Z!==null?null:c(A,b,m,B,null);fA(A,m)}return null}function h(A,b,m,B,Z){if(typeof B=="string"&&B!==""||typeof B=="number")return A=A.get(m)||null,a(b,A,""+B,Z);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case aA:return A=A.get(B.key===null?m:B.key)||null,l(b,A,B,Z);case Lc:return A=A.get(B.key===null?m:B.key)||null,g(b,A,B,Z);case La:var w=B._init;return h(A,b,m,w(B._payload),Z)}if(rC(B)||wu(B))return A=A.get(m)||null,c(b,A,B,Z,null);fA(b,B)}return null}function p(A,b,m,B){for(var Z=null,w=null,W=b,X=b=0,V=null;W!==null&&X<m.length;X++){W.index>X?(V=W,W=null):V=W.sibling;var Y=d(A,W,m[X],B);if(Y===null){W===null&&(W=V);break}t&&W&&Y.alternate===null&&e(A,W),b=r(Y,b,X),w===null?Z=Y:w.sibling=Y,w=Y,W=V}if(X===m.length)return n(A,W),Vn&&Dl(A,X),Z;if(W===null){for(;X<m.length;X++)W=C(A,m[X],B),W!==null&&(b=r(W,b,X),w===null?Z=W:w.sibling=W,w=W);return Vn&&Dl(A,X),Z}for(W=i(A,W);X<m.length;X++)V=h(W,A,X,m[X],B),V!==null&&(t&&V.alternate!==null&&W.delete(V.key===null?X:V.key),b=r(V,b,X),w===null?Z=V:w.sibling=V,w=V);return t&&W.forEach(function(z){return e(A,z)}),Vn&&Dl(A,X),Z}function v(A,b,m,B){var Z=wu(m);if(typeof Z!="function")throw Error(Ee(150));if(m=Z.call(m),m==null)throw Error(Ee(151));for(var w=Z=null,W=b,X=b=0,V=null,Y=m.next();W!==null&&!Y.done;X++,Y=m.next()){W.index>X?(V=W,W=null):V=W.sibling;var z=d(A,W,Y.value,B);if(z===null){W===null&&(W=V);break}t&&W&&z.alternate===null&&e(A,W),b=r(z,b,X),w===null?Z=z:w.sibling=z,w=z,W=V}if(Y.done)return n(A,W),Vn&&Dl(A,X),Z;if(W===null){for(;!Y.done;X++,Y=m.next())Y=C(A,Y.value,B),Y!==null&&(b=r(Y,b,X),w===null?Z=Y:w.sibling=Y,w=Y);return Vn&&Dl(A,X),Z}for(W=i(A,W);!Y.done;X++,Y=m.next())Y=h(W,A,X,Y.value,B),Y!==null&&(t&&Y.alternate!==null&&W.delete(Y.key===null?X:Y.key),b=r(Y,b,X),w===null?Z=Y:w.sibling=Y,w=Y);return t&&W.forEach(function(q){return e(A,q)}),Vn&&Dl(A,X),Z}function f(A,b,m,B){if(typeof m=="object"&&m!==null&&m.type===Ec&&m.key===null&&(m=m.props.children),typeof m=="object"&&m!==null){switch(m.$$typeof){case aA:e:{for(var Z=m.key,w=b;w!==null;){if(w.key===Z){if(Z=m.type,Z===Ec){if(w.tag===7){n(A,w.sibling),b=o(w,m.props.children),b.return=A,A=b;break e}}else if(w.elementType===Z||typeof Z=="object"&&Z!==null&&Z.$$typeof===La&&l1(Z)===w.type){n(A,w.sibling),b=o(w,m.props),b.ref=Vu(A,w,m),b.return=A,A=b;break e}n(A,w);break}else e(A,w);w=w.sibling}m.type===Ec?(b=Ag(m.props.children,A.mode,B,m.key),b.return=A,A=b):(B=Lp(m.type,m.key,m.props,null,A.mode,B),B.ref=Vu(A,b,m),B.return=A,A=B)}return s(A);case Lc:e:{for(w=m.key;b!==null;){if(b.key===w)if(b.tag===4&&b.stateNode.containerInfo===m.containerInfo&&b.stateNode.implementation===m.implementation){n(A,b.sibling),b=o(b,m.children||[]),b.return=A,A=b;break e}else{n(A,b);break}else e(A,b);b=b.sibling}b=$b(m,A.mode,B),b.return=A,A=b}return s(A);case La:return w=m._init,f(A,b,w(m._payload),B)}if(rC(m))return p(A,b,m,B);if(wu(m))return v(A,b,m,B);fA(A,m)}return typeof m=="string"&&m!==""||typeof m=="number"?(m=""+m,b!==null&&b.tag===6?(n(A,b.sibling),b=o(b,m),b.return=A,A=b):(n(A,b),b=qb(m,A.mode,B),b.return=A,A=b),s(A)):n(A,b)}return f}var vI=bY(!0),yY=bY(!1),zd={},bs=yl(zd),QC=yl(zd),jC=yl(zd);function sg(t){if(t===zd)throw Error(Ee(174));return t}function BZ(t,e){switch(vn(jC,e),vn(QC,t),vn(bs,zd),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Wv(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Wv(e,t)}Sn(bs),vn(bs,e)}function GI(){Sn(bs),Sn(QC),Sn(jC)}function vY(t){sg(jC.current);var e=sg(bs.current),n=Wv(e,t.type);e!==n&&(vn(QC,t),vn(bs,n))}function ZZ(t){QC.current===t&&(Sn(bs),Sn(QC))}var Fn=yl(0);function yf(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Pb=[];function wZ(){for(var t=0;t<Pb.length;t++)Pb[t]._workInProgressVersionPrimary=null;Pb.length=0}var Mp=ma.ReactCurrentDispatcher,Db=ma.ReactCurrentBatchConfig,Sg=0,Ln=null,ai=null,pi=null,vf=!1,bC=!1,qC=0,dE=0;function Mi(){throw Error(Ee(321))}function SZ(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Tr(t[n],e[n]))return!1;return!0}function RZ(t,e,n,i,o,r){if(Sg=r,Ln=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Mp.current=t===null||t.memoizedState===null?fE:mE,t=n(i,o),bC){r=0;do{if(bC=!1,qC=0,25<=r)throw Error(Ee(301));r+=1,pi=ai=null,e.updateQueue=null,Mp.current=bE,t=n(i,o)}while(bC)}if(Mp.current=Gf,e=ai!==null&&ai.next!==null,Sg=0,pi=ai=Ln=null,vf=!1,e)throw Error(Ee(300));return t}function WZ(){var t=qC!==0;return qC=0,t}function Cs(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pi===null?Ln.memoizedState=pi=t:pi=pi.next=t,pi}function hr(){if(ai===null){var t=Ln.alternate;t=t!==null?t.memoizedState:null}else t=ai.next;var e=pi===null?Ln.memoizedState:pi.next;if(e!==null)pi=e,ai=t;else{if(t===null)throw Error(Ee(310));ai=t,t={memoizedState:ai.memoizedState,baseState:ai.baseState,baseQueue:ai.baseQueue,queue:ai.queue,next:null},pi===null?Ln.memoizedState=pi=t:pi=pi.next=t}return pi}function $C(t,e){return typeof e=="function"?e(t):e}function Jb(t){var e=hr(),n=e.queue;if(n===null)throw Error(Ee(311));n.lastRenderedReducer=t;var i=ai,o=i.baseQueue,r=n.pending;if(r!==null){if(o!==null){var s=o.next;o.next=r.next,r.next=s}i.baseQueue=o=r,n.pending=null}if(o!==null){r=o.next,i=i.baseState;var a=s=null,l=null,g=r;do{var c=g.lane;if((Sg&c)===c)l!==null&&(l=l.next={lane:0,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null}),i=g.hasEagerState?g.eagerState:t(i,g.action);else{var C={lane:c,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null};l===null?(a=l=C,s=i):l=l.next=C,Ln.lanes|=c,Rg|=c}g=g.next}while(g!==null&&g!==r);l===null?s=i:l.next=a,Tr(i,e.memoizedState)||(Zo=!0),e.memoizedState=i,e.baseState=s,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){o=t;do r=o.lane,Ln.lanes|=r,Rg|=r,o=o.next;while(o!==t)}else o===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ob(t){var e=hr(),n=e.queue;if(n===null)throw Error(Ee(311));n.lastRenderedReducer=t;var i=n.dispatch,o=n.pending,r=e.memoizedState;if(o!==null){n.pending=null;var s=o=o.next;do r=t(r,s.action),s=s.next;while(s!==o);Tr(r,e.memoizedState)||(Zo=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),n.lastRenderedState=r}return[r,i]}function GY(){}function BY(t,e){var n=Ln,i=hr(),o=e(),r=!Tr(i.memoizedState,o);if(r&&(i.memoizedState=o,Zo=!0),i=i.queue,xZ(SY.bind(null,n,i,t),[t]),i.getSnapshot!==e||r||pi!==null&&pi.memoizedState.tag&1){if(n.flags|=2048,ed(9,wY.bind(null,n,i,o,e),void 0,null),bi===null)throw Error(Ee(349));Sg&30||ZY(n,e,o)}return o}function ZY(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ln.updateQueue,e===null?(e={lastEffect:null,stores:null},Ln.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function wY(t,e,n,i){e.value=n,e.getSnapshot=i,RY(e)&&WY(t)}function SY(t,e,n){return n(function(){RY(e)&&WY(t)})}function RY(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Tr(t,n)}catch{return!0}}function WY(t){var e=Ia(t,1);e!==null&&Lr(e,t,1,-1)}function g1(t){var e=Cs();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$C,lastRenderedState:t},e.queue=t,t=t.dispatch=pE.bind(null,Ln,t),[e.memoizedState,t]}function ed(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Ln.updateQueue,e===null?(e={lastEffect:null,stores:null},Ln.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function xY(){return hr().memoizedState}function Hp(t,e,n,i){var o=Cs();Ln.flags|=t,o.memoizedState=ed(1|e,n,void 0,i===void 0?null:i)}function Am(t,e,n,i){var o=hr();i=i===void 0?null:i;var r=void 0;if(ai!==null){var s=ai.memoizedState;if(r=s.destroy,i!==null&&SZ(i,s.deps)){o.memoizedState=ed(e,n,r,i);return}}Ln.flags|=t,o.memoizedState=ed(1|e,n,r,i)}function c1(t,e){return Hp(8390656,8,t,e)}function xZ(t,e){return Am(2048,8,t,e)}function VY(t,e){return Am(4,2,t,e)}function XY(t,e){return Am(4,4,t,e)}function NY(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function YY(t,e,n){return n=n!=null?n.concat([t]):null,Am(4,4,NY.bind(null,e,t),n)}function VZ(){}function MY(t,e){var n=hr();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&SZ(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function HY(t,e){var n=hr();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&SZ(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function FY(t,e,n){return Sg&21?(Tr(n,e)||(n=LN(),Ln.lanes|=n,Rg|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Zo=!0),t.memoizedState=n)}function hE(t,e){var n=In;In=n!==0&&4>n?n:4,t(!0);var i=Db.transition;Db.transition={};try{t(!1),e()}finally{In=n,Db.transition=i}}function KY(){return hr().memoizedState}function AE(t,e,n){var i=nl(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},zY(t))LY(e,n);else if(n=AY(t,e,n,i),n!==null){var o=so();Lr(n,t,i,o),EY(n,e,i)}}function pE(t,e,n){var i=nl(t),o={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(zY(t))LY(e,o);else{var r=t.alternate;if(t.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var s=e.lastRenderedState,a=r(s,n);if(o.hasEagerState=!0,o.eagerState=a,Tr(a,s)){var l=e.interleaved;l===null?(o.next=o,vZ(e)):(o.next=l.next,l.next=o),e.interleaved=o;return}}catch{}finally{}n=AY(t,e,o,i),n!==null&&(o=so(),Lr(n,t,i,o),EY(n,e,i))}}function zY(t){var e=t.alternate;return t===Ln||e!==null&&e===Ln}function LY(t,e){bC=vf=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function EY(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,lZ(t,n)}}var Gf={readContext:dr,useCallback:Mi,useContext:Mi,useEffect:Mi,useImperativeHandle:Mi,useInsertionEffect:Mi,useLayoutEffect:Mi,useMemo:Mi,useReducer:Mi,useRef:Mi,useState:Mi,useDebugValue:Mi,useDeferredValue:Mi,useTransition:Mi,useMutableSource:Mi,useSyncExternalStore:Mi,useId:Mi,unstable_isNewReconciler:!1},fE={readContext:dr,useCallback:function(t,e){return Cs().memoizedState=[t,e===void 0?null:e],t},useContext:dr,useEffect:c1,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Hp(4194308,4,NY.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Hp(4194308,4,t,e)},useInsertionEffect:function(t,e){return Hp(4,2,t,e)},useMemo:function(t,e){var n=Cs();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Cs();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=AE.bind(null,Ln,t),[i.memoizedState,t]},useRef:function(t){var e=Cs();return t={current:t},e.memoizedState=t},useState:g1,useDebugValue:VZ,useDeferredValue:function(t){return Cs().memoizedState=t},useTransition:function(){var t=g1(!1),e=t[0];return t=hE.bind(null,t[1]),Cs().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Ln,o=Cs();if(Vn){if(n===void 0)throw Error(Ee(407));n=n()}else{if(n=e(),bi===null)throw Error(Ee(349));Sg&30||ZY(i,e,n)}o.memoizedState=n;var r={value:n,getSnapshot:e};return o.queue=r,c1(SY.bind(null,i,r,t),[t]),i.flags|=2048,ed(9,wY.bind(null,i,r,n,e),void 0,null),n},useId:function(){var t=Cs(),e=bi.identifierPrefix;if(Vn){var n=na,i=ta;n=(i&~(1<<32-zr(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=qC++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=dE++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},mE={readContext:dr,useCallback:MY,useContext:dr,useEffect:xZ,useImperativeHandle:YY,useInsertionEffect:VY,useLayoutEffect:XY,useMemo:HY,useReducer:Jb,useRef:xY,useState:function(){return Jb($C)},useDebugValue:VZ,useDeferredValue:function(t){var e=hr();return FY(e,ai.memoizedState,t)},useTransition:function(){var t=Jb($C)[0],e=hr().memoizedState;return[t,e]},useMutableSource:GY,useSyncExternalStore:BY,useId:KY,unstable_isNewReconciler:!1},bE={readContext:dr,useCallback:MY,useContext:dr,useEffect:xZ,useImperativeHandle:YY,useInsertionEffect:VY,useLayoutEffect:XY,useMemo:HY,useReducer:Ob,useRef:xY,useState:function(){return Ob($C)},useDebugValue:VZ,useDeferredValue:function(t){var e=hr();return ai===null?e.memoizedState=t:FY(e,ai.memoizedState,t)},useTransition:function(){var t=Ob($C)[0],e=hr().memoizedState;return[t,e]},useMutableSource:GY,useSyncExternalStore:BY,useId:KY,unstable_isNewReconciler:!1};function BI(t,e){try{var n="",i=e;do n+=Jz(i),i=i.return;while(i);var o=n}catch(r){o=`
Error generating stack: `+r.message+`
`+r.stack}return{value:t,source:e,stack:o,digest:null}}function Qb(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function qv(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var yE=typeof WeakMap=="function"?WeakMap:Map;function kY(t,e,n){n=sa(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Zf||(Zf=!0,lG=i),qv(t,e)},n}function TY(t,e,n){n=sa(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var o=e.value;n.payload=function(){return i(o)},n.callback=function(){qv(t,e)}}var r=t.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(n.callback=function(){qv(t,e),typeof i!="function"&&(tl===null?tl=new Set([this]):tl.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),n}function I1(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new yE;var o=new Set;i.set(e,o)}else o=i.get(e),o===void 0&&(o=new Set,i.set(e,o));o.has(n)||(o.add(n),t=ME.bind(null,t,e,n),e.then(t,t))}function u1(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function C1(t,e,n,i,o){return t.mode&1?(t.flags|=65536,t.lanes=o,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=sa(-1,1),e.tag=2,el(n,e,1))),n.lanes|=1),t)}var vE=ma.ReactCurrentOwner,Zo=!1;function eo(t,e,n,i){e.child=t===null?yY(e,null,n,i):vI(e,t.child,n,i)}function d1(t,e,n,i,o){n=n.render;var r=e.ref;return gI(e,o),i=RZ(t,e,n,i,r,o),n=WZ(),t!==null&&!Zo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,ua(t,e,o)):(Vn&&n&&AZ(e),e.flags|=1,eo(t,e,i,o),e.child)}function h1(t,e,n,i,o){if(t===null){var r=n.type;return typeof r=="function"&&!zZ(r)&&r.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=r,_Y(t,e,r,i,o)):(t=Lp(n.type,null,i,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(r=t.child,!(t.lanes&o)){var s=r.memoizedProps;if(n=n.compare,n=n!==null?n:PC,n(s,i)&&t.ref===e.ref)return ua(t,e,o)}return e.flags|=1,t=il(r,i),t.ref=e.ref,t.return=e,e.child=t}function _Y(t,e,n,i,o){if(t!==null){var r=t.memoizedProps;if(PC(r,i)&&t.ref===e.ref)if(Zo=!1,e.pendingProps=i=r,(t.lanes&o)!==0)t.flags&131072&&(Zo=!0);else return e.lanes=t.lanes,ua(t,e,o)}return $v(t,e,n,i,o)}function UY(t,e,n){var i=e.pendingProps,o=i.children,r=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},vn(jc,Ko),Ko|=n;else{if(!(n&1073741824))return t=r!==null?r.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,vn(jc,Ko),Ko|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=r!==null?r.baseLanes:n,vn(jc,Ko),Ko|=i}else r!==null?(i=r.baseLanes|n,e.memoizedState=null):i=n,vn(jc,Ko),Ko|=i;return eo(t,e,o,n),e.child}function PY(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function $v(t,e,n,i,o){var r=Wo(n)?Zg:Ui.current;return r=bI(e,r),gI(e,o),n=RZ(t,e,n,i,r,o),i=WZ(),t!==null&&!Zo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,ua(t,e,o)):(Vn&&i&&AZ(e),e.flags|=1,eo(t,e,n,o),e.child)}function A1(t,e,n,i,o){if(Wo(n)){var r=!0;hf(e)}else r=!1;if(gI(e,o),e.stateNode===null)Fp(t,e),mY(e,n,i),jv(e,n,i,o),i=!0;else if(t===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var l=s.context,g=n.contextType;typeof g=="object"&&g!==null?g=dr(g):(g=Wo(n)?Zg:Ui.current,g=bI(e,g));var c=n.getDerivedStateFromProps,C=typeof c=="function"||typeof s.getSnapshotBeforeUpdate=="function";C||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==i||l!==g)&&a1(e,s,i,g),Ea=!1;var d=e.memoizedState;s.state=d,bf(e,i,s,o),l=e.memoizedState,a!==i||d!==l||Ro.current||Ea?(typeof c=="function"&&(Qv(e,n,c,i),l=e.memoizedState),(a=Ea||s1(e,n,a,i,d,l,g))?(C||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),s.props=i,s.state=l,s.context=g,i=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{s=e.stateNode,pY(t,e),a=e.memoizedProps,g=e.type===e.elementType?a:Vr(e.type,a),s.props=g,C=e.pendingProps,d=s.context,l=n.contextType,typeof l=="object"&&l!==null?l=dr(l):(l=Wo(n)?Zg:Ui.current,l=bI(e,l));var h=n.getDerivedStateFromProps;(c=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==C||d!==l)&&a1(e,s,i,l),Ea=!1,d=e.memoizedState,s.state=d,bf(e,i,s,o);var p=e.memoizedState;a!==C||d!==p||Ro.current||Ea?(typeof h=="function"&&(Qv(e,n,h,i),p=e.memoizedState),(g=Ea||s1(e,n,g,i,d,p,l)||!1)?(c||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(i,p,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(i,p,l)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),s.props=i,s.state=p,s.context=l,i=g):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),i=!1)}return eG(t,e,n,i,r,o)}function eG(t,e,n,i,o,r){PY(t,e);var s=(e.flags&128)!==0;if(!i&&!s)return o&&t1(e,n,!1),ua(t,e,r);i=e.stateNode,vE.current=e;var a=s&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&s?(e.child=vI(e,t.child,null,r),e.child=vI(e,null,a,r)):eo(t,e,a,r),e.memoizedState=i.state,o&&t1(e,n,!0),e.child}function DY(t){var e=t.stateNode;e.pendingContext?e1(t,e.pendingContext,e.pendingContext!==e.context):e.context&&e1(t,e.context,!1),BZ(t,e.containerInfo)}function p1(t,e,n,i,o){return yI(),fZ(o),e.flags|=256,eo(t,e,n,i),e.child}var tG={dehydrated:null,treeContext:null,retryLane:0};function nG(t){return{baseLanes:t,cachePool:null,transitions:null}}function JY(t,e,n){var i=e.pendingProps,o=Fn.current,r=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=t!==null&&t.memoizedState===null?!1:(o&2)!==0),a?(r=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),vn(Fn,o&1),t===null)return Jv(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=i.children,t=i.fallback,r?(i=e.mode,r=e.child,s={mode:"hidden",children:s},!(i&1)&&r!==null?(r.childLanes=0,r.pendingProps=s):r=mm(s,i,0,null),t=Ag(t,i,n,null),r.return=e,t.return=e,r.sibling=t,e.child=r,e.child.memoizedState=nG(n),e.memoizedState=tG,t):XZ(e,s));if(o=t.memoizedState,o!==null&&(a=o.dehydrated,a!==null))return GE(t,e,s,i,a,o,n);if(r){r=i.fallback,s=e.mode,o=t.child,a=o.sibling;var l={mode:"hidden",children:i.children};return!(s&1)&&e.child!==o?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=il(o,l),i.subtreeFlags=o.subtreeFlags&14680064),a!==null?r=il(a,r):(r=Ag(r,s,n,null),r.flags|=2),r.return=e,i.return=e,i.sibling=r,e.child=i,i=r,r=e.child,s=t.child.memoizedState,s=s===null?nG(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},r.memoizedState=s,r.childLanes=t.childLanes&~n,e.memoizedState=tG,i}return r=t.child,t=r.sibling,i=il(r,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function XZ(t,e){return e=mm({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function mA(t,e,n,i){return i!==null&&fZ(i),vI(e,t.child,null,n),t=XZ(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function GE(t,e,n,i,o,r,s){if(n)return e.flags&256?(e.flags&=-257,i=Qb(Error(Ee(422))),mA(t,e,s,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(r=i.fallback,o=e.mode,i=mm({mode:"visible",children:i.children},o,0,null),r=Ag(r,o,s,null),r.flags|=2,i.return=e,r.return=e,i.sibling=r,e.child=i,e.mode&1&&vI(e,t.child,null,s),e.child.memoizedState=nG(s),e.memoizedState=tG,r);if(!(e.mode&1))return mA(t,e,s,null);if(o.data==="$!"){if(i=o.nextSibling&&o.nextSibling.dataset,i)var a=i.dgst;return i=a,r=Error(Ee(419)),i=Qb(r,i,void 0),mA(t,e,s,i)}if(a=(s&t.childLanes)!==0,Zo||a){if(i=bi,i!==null){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(i.suspendedLanes|s)?0:o,o!==0&&o!==r.retryLane&&(r.retryLane=o,Ia(t,o),Lr(i,t,o,-1))}return KZ(),i=Qb(Error(Ee(421))),mA(t,e,s,i)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=HE.bind(null,t),o._reactRetry=e,null):(t=r.treeContext,Lo=$a(o.nextSibling),Eo=e,Vn=!0,Yr=null,t!==null&&(rr[sr++]=ta,rr[sr++]=na,rr[sr++]=wg,ta=t.id,na=t.overflow,wg=e),e=XZ(e,i.children),e.flags|=4096,e)}function f1(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Ov(t.return,e,n)}function jb(t,e,n,i,o){var r=t.memoizedState;r===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:o}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=n,r.tailMode=o)}function OY(t,e,n){var i=e.pendingProps,o=i.revealOrder,r=i.tail;if(eo(t,e,i.children,n),i=Fn.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&f1(t,n,e);else if(t.tag===19)f1(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(vn(Fn,i),!(e.mode&1))e.memoizedState=null;else switch(o){case"forwards":for(n=e.child,o=null;n!==null;)t=n.alternate,t!==null&&yf(t)===null&&(o=n),n=n.sibling;n=o,n===null?(o=e.child,e.child=null):(o=n.sibling,n.sibling=null),jb(e,!1,o,n,r);break;case"backwards":for(n=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&yf(t)===null){e.child=o;break}t=o.sibling,o.sibling=n,n=o,o=t}jb(e,!0,n,null,r);break;case"together":jb(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Fp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ua(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Rg|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ee(153));if(e.child!==null){for(t=e.child,n=il(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=il(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function BE(t,e,n){switch(e.tag){case 3:DY(e),yI();break;case 5:vY(e);break;case 1:Wo(e.type)&&hf(e);break;case 4:BZ(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,o=e.memoizedProps.value;vn(ff,i._currentValue),i._currentValue=o;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(vn(Fn,Fn.current&1),e.flags|=128,null):n&e.child.childLanes?JY(t,e,n):(vn(Fn,Fn.current&1),t=ua(t,e,n),t!==null?t.sibling:null);vn(Fn,Fn.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return OY(t,e,n);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),vn(Fn,Fn.current),i)break;return null;case 22:case 23:return e.lanes=0,UY(t,e,n)}return ua(t,e,n)}var QY,iG,jY,qY;QY=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};iG=function(){};jY=function(t,e,n,i){var o=t.memoizedProps;if(o!==i){t=e.stateNode,sg(bs.current);var r=null;switch(n){case"input":o=Zv(t,o),i=Zv(t,i),r=[];break;case"select":o=En({},o,{value:void 0}),i=En({},i,{value:void 0}),r=[];break;case"textarea":o=Rv(t,o),i=Rv(t,i),r=[];break;default:typeof o.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Cf)}xv(n,i);var s;n=null;for(g in o)if(!i.hasOwnProperty(g)&&o.hasOwnProperty(g)&&o[g]!=null)if(g==="style"){var a=o[g];for(s in a)a.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else g!=="dangerouslySetInnerHTML"&&g!=="children"&&g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(zC.hasOwnProperty(g)?r||(r=[]):(r=r||[]).push(g,null));for(g in i){var l=i[g];if(a=o!=null?o[g]:void 0,i.hasOwnProperty(g)&&l!==a&&(l!=null||a!=null))if(g==="style")if(a){for(s in a)!a.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in l)l.hasOwnProperty(s)&&a[s]!==l[s]&&(n||(n={}),n[s]=l[s])}else n||(r||(r=[]),r.push(g,n)),n=l;else g==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(r=r||[]).push(g,l)):g==="children"?typeof l!="string"&&typeof l!="number"||(r=r||[]).push(g,""+l):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&(zC.hasOwnProperty(g)?(l!=null&&g==="onScroll"&&Gn("scroll",t),r||a===l||(r=[])):(r=r||[]).push(g,l))}n&&(r=r||[]).push("style",n);var g=r;(e.updateQueue=g)&&(e.flags|=4)}};qY=function(t,e,n,i){n!==i&&(e.flags|=4)};function Xu(t,e){if(!Vn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Hi(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var o=t.child;o!==null;)n|=o.lanes|o.childLanes,i|=o.subtreeFlags&14680064,i|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)n|=o.lanes|o.childLanes,i|=o.subtreeFlags,i|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function ZE(t,e,n){var i=e.pendingProps;switch(pZ(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hi(e),null;case 1:return Wo(e.type)&&df(),Hi(e),null;case 3:return i=e.stateNode,GI(),Sn(Ro),Sn(Ui),wZ(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(pA(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Yr!==null&&(IG(Yr),Yr=null))),iG(t,e),Hi(e),null;case 5:ZZ(e);var o=sg(jC.current);if(n=e.type,t!==null&&e.stateNode!=null)jY(t,e,n,i,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ee(166));return Hi(e),null}if(t=sg(bs.current),pA(e)){i=e.stateNode,n=e.type;var r=e.memoizedProps;switch(i[ps]=e,i[OC]=r,t=(e.mode&1)!==0,n){case"dialog":Gn("cancel",i),Gn("close",i);break;case"iframe":case"object":case"embed":Gn("load",i);break;case"video":case"audio":for(o=0;o<aC.length;o++)Gn(aC[o],i);break;case"source":Gn("error",i);break;case"img":case"image":case"link":Gn("error",i),Gn("load",i);break;case"details":Gn("toggle",i);break;case"input":SR(i,r),Gn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!r.multiple},Gn("invalid",i);break;case"textarea":WR(i,r),Gn("invalid",i)}xv(n,r),o=null;for(var s in r)if(r.hasOwnProperty(s)){var a=r[s];s==="children"?typeof a=="string"?i.textContent!==a&&(r.suppressHydrationWarning!==!0&&AA(i.textContent,a,t),o=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(r.suppressHydrationWarning!==!0&&AA(i.textContent,a,t),o=["children",""+a]):zC.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&Gn("scroll",i)}switch(n){case"input":lA(i),RR(i,r,!0);break;case"textarea":lA(i),xR(i);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(i.onclick=Cf)}i=o,e.updateQueue=i,i!==null&&(e.flags|=4)}else{s=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=ZN(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=s.createElement(n,{is:i.is}):(t=s.createElement(n),n==="select"&&(s=t,i.multiple?s.multiple=!0:i.size&&(s.size=i.size))):t=s.createElementNS(t,n),t[ps]=e,t[OC]=i,QY(t,e,!1,!1),e.stateNode=t;e:{switch(s=Vv(n,i),n){case"dialog":Gn("cancel",t),Gn("close",t),o=i;break;case"iframe":case"object":case"embed":Gn("load",t),o=i;break;case"video":case"audio":for(o=0;o<aC.length;o++)Gn(aC[o],t);o=i;break;case"source":Gn("error",t),o=i;break;case"img":case"image":case"link":Gn("error",t),Gn("load",t),o=i;break;case"details":Gn("toggle",t),o=i;break;case"input":SR(t,i),o=Zv(t,i),Gn("invalid",t);break;case"option":o=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},o=En({},i,{value:void 0}),Gn("invalid",t);break;case"textarea":WR(t,i),o=Rv(t,i),Gn("invalid",t);break;default:o=i}xv(n,o),a=o;for(r in a)if(a.hasOwnProperty(r)){var l=a[r];r==="style"?RN(t,l):r==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&wN(t,l)):r==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&LC(t,l):typeof l=="number"&&LC(t,""+l):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(zC.hasOwnProperty(r)?l!=null&&r==="onScroll"&&Gn("scroll",t):l!=null&&nZ(t,r,l,s))}switch(n){case"input":lA(t),RR(t,i,!1);break;case"textarea":lA(t),xR(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Il(i.value));break;case"select":t.multiple=!!i.multiple,r=i.value,r!=null?rI(t,!!i.multiple,r,!1):i.defaultValue!=null&&rI(t,!!i.multiple,i.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=Cf)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Hi(e),null;case 6:if(t&&e.stateNode!=null)qY(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ee(166));if(n=sg(jC.current),sg(bs.current),pA(e)){if(i=e.stateNode,n=e.memoizedProps,i[ps]=e,(r=i.nodeValue!==n)&&(t=Eo,t!==null))switch(t.tag){case 3:AA(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&AA(i.nodeValue,n,(t.mode&1)!==0)}r&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[ps]=e,e.stateNode=i}return Hi(e),null;case 13:if(Sn(Fn),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Vn&&Lo!==null&&e.mode&1&&!(e.flags&128))hY(),yI(),e.flags|=98560,r=!1;else if(r=pA(e),i!==null&&i.dehydrated!==null){if(t===null){if(!r)throw Error(Ee(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Ee(317));r[ps]=e}else yI(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Hi(e),r=!1}else Yr!==null&&(IG(Yr),Yr=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Fn.current&1?gi===0&&(gi=3):KZ())),e.updateQueue!==null&&(e.flags|=4),Hi(e),null);case 4:return GI(),iG(t,e),t===null&&DC(e.stateNode.containerInfo),Hi(e),null;case 10:return yZ(e.type._context),Hi(e),null;case 17:return Wo(e.type)&&df(),Hi(e),null;case 19:if(Sn(Fn),r=e.memoizedState,r===null)return Hi(e),null;if(i=(e.flags&128)!==0,s=r.rendering,s===null)if(i)Xu(r,!1);else{if(gi!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=yf(t),s!==null){for(e.flags|=128,Xu(r,!1),i=s.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)r=n,t=i,r.flags&=14680066,s=r.alternate,s===null?(r.childLanes=0,r.lanes=t,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=s.childLanes,r.lanes=s.lanes,r.child=s.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=s.memoizedProps,r.memoizedState=s.memoizedState,r.updateQueue=s.updateQueue,r.type=s.type,t=s.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return vn(Fn,Fn.current&1|2),e.child}t=t.sibling}r.tail!==null&&jn()>ZI&&(e.flags|=128,i=!0,Xu(r,!1),e.lanes=4194304)}else{if(!i)if(t=yf(s),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Xu(r,!0),r.tail===null&&r.tailMode==="hidden"&&!s.alternate&&!Vn)return Hi(e),null}else 2*jn()-r.renderingStartTime>ZI&&n!==1073741824&&(e.flags|=128,i=!0,Xu(r,!1),e.lanes=4194304);r.isBackwards?(s.sibling=e.child,e.child=s):(n=r.last,n!==null?n.sibling=s:e.child=s,r.last=s)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=jn(),e.sibling=null,n=Fn.current,vn(Fn,i?n&1|2:n&1),e):(Hi(e),null);case 22:case 23:return FZ(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Ko&1073741824&&(Hi(e),e.subtreeFlags&6&&(e.flags|=8192)):Hi(e),null;case 24:return null;case 25:return null}throw Error(Ee(156,e.tag))}function wE(t,e){switch(pZ(e),e.tag){case 1:return Wo(e.type)&&df(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return GI(),Sn(Ro),Sn(Ui),wZ(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return ZZ(e),null;case 13:if(Sn(Fn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ee(340));yI()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Sn(Fn),null;case 4:return GI(),null;case 10:return yZ(e.type._context),null;case 22:case 23:return FZ(),null;case 24:return null;default:return null}}var bA=!1,Ei=!1,SE=typeof WeakSet=="function"?WeakSet:Set,st=null;function Qc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){_n(t,e,i)}else n.current=null}function oG(t,e,n){try{n()}catch(i){_n(t,e,i)}}var m1=!1;function RE(t,e){if(Ev=cf,t=nY(),hZ(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var o=i.anchorOffset,r=i.focusNode;i=i.focusOffset;try{n.nodeType,r.nodeType}catch{n=null;break e}var s=0,a=-1,l=-1,g=0,c=0,C=t,d=null;t:for(;;){for(var h;C!==n||o!==0&&C.nodeType!==3||(a=s+o),C!==r||i!==0&&C.nodeType!==3||(l=s+i),C.nodeType===3&&(s+=C.nodeValue.length),(h=C.firstChild)!==null;)d=C,C=h;for(;;){if(C===t)break t;if(d===n&&++g===o&&(a=s),d===r&&++c===i&&(l=s),(h=C.nextSibling)!==null)break;C=d,d=C.parentNode}C=h}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(kv={focusedElem:t,selectionRange:n},cf=!1,st=e;st!==null;)if(e=st,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,st=t;else for(;st!==null;){e=st;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var v=p.memoizedProps,f=p.memoizedState,A=e.stateNode,b=A.getSnapshotBeforeUpdate(e.elementType===e.type?v:Vr(e.type,v),f);A.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var m=e.stateNode.containerInfo;m.nodeType===1?m.textContent="":m.nodeType===9&&m.documentElement&&m.removeChild(m.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ee(163))}}catch(B){_n(e,e.return,B)}if(t=e.sibling,t!==null){t.return=e.return,st=t;break}st=e.return}return p=m1,m1=!1,p}function yC(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var o=i=i.next;do{if((o.tag&t)===t){var r=o.destroy;o.destroy=void 0,r!==void 0&&oG(e,n,r)}o=o.next}while(o!==i)}}function pm(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function rG(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function $Y(t){var e=t.alternate;e!==null&&(t.alternate=null,$Y(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ps],delete e[OC],delete e[Uv],delete e[cE],delete e[IE])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function e5(t){return t.tag===5||t.tag===3||t.tag===4}function b1(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||e5(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function sG(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Cf));else if(i!==4&&(t=t.child,t!==null))for(sG(t,e,n),t=t.sibling;t!==null;)sG(t,e,n),t=t.sibling}function aG(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(aG(t,e,n),t=t.sibling;t!==null;)aG(t,e,n),t=t.sibling}var Bi=null,Nr=!1;function xa(t,e,n){for(n=n.child;n!==null;)t5(t,e,n),n=n.sibling}function t5(t,e,n){if(ms&&typeof ms.onCommitFiberUnmount=="function")try{ms.onCommitFiberUnmount(gm,n)}catch{}switch(n.tag){case 5:Ei||Qc(n,e);case 6:var i=Bi,o=Nr;Bi=null,xa(t,e,n),Bi=i,Nr=o,Bi!==null&&(Nr?(t=Bi,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Bi.removeChild(n.stateNode));break;case 18:Bi!==null&&(Nr?(t=Bi,n=n.stateNode,t.nodeType===8?_b(t.parentNode,n):t.nodeType===1&&_b(t,n),_C(t)):_b(Bi,n.stateNode));break;case 4:i=Bi,o=Nr,Bi=n.stateNode.containerInfo,Nr=!0,xa(t,e,n),Bi=i,Nr=o;break;case 0:case 11:case 14:case 15:if(!Ei&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){o=i=i.next;do{var r=o,s=r.destroy;r=r.tag,s!==void 0&&(r&2||r&4)&&oG(n,e,s),o=o.next}while(o!==i)}xa(t,e,n);break;case 1:if(!Ei&&(Qc(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){_n(n,e,a)}xa(t,e,n);break;case 21:xa(t,e,n);break;case 22:n.mode&1?(Ei=(i=Ei)||n.memoizedState!==null,xa(t,e,n),Ei=i):xa(t,e,n);break;default:xa(t,e,n)}}function y1(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new SE),e.forEach(function(i){var o=FE.bind(null,t,i);n.has(i)||(n.add(i),i.then(o,o))})}}function Br(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var o=n[i];try{var r=t,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:Bi=a.stateNode,Nr=!1;break e;case 3:Bi=a.stateNode.containerInfo,Nr=!0;break e;case 4:Bi=a.stateNode.containerInfo,Nr=!0;break e}a=a.return}if(Bi===null)throw Error(Ee(160));t5(r,s,o),Bi=null,Nr=!1;var l=o.alternate;l!==null&&(l.return=null),o.return=null}catch(g){_n(o,e,g)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)n5(e,t),e=e.sibling}function n5(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Br(e,t),as(t),i&4){try{yC(3,t,t.return),pm(3,t)}catch(v){_n(t,t.return,v)}try{yC(5,t,t.return)}catch(v){_n(t,t.return,v)}}break;case 1:Br(e,t),as(t),i&512&&n!==null&&Qc(n,n.return);break;case 5:if(Br(e,t),as(t),i&512&&n!==null&&Qc(n,n.return),t.flags&32){var o=t.stateNode;try{LC(o,"")}catch(v){_n(t,t.return,v)}}if(i&4&&(o=t.stateNode,o!=null)){var r=t.memoizedProps,s=n!==null?n.memoizedProps:r,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&r.type==="radio"&&r.name!=null&&GN(o,r),Vv(a,s);var g=Vv(a,r);for(s=0;s<l.length;s+=2){var c=l[s],C=l[s+1];c==="style"?RN(o,C):c==="dangerouslySetInnerHTML"?wN(o,C):c==="children"?LC(o,C):nZ(o,c,C,g)}switch(a){case"input":wv(o,r);break;case"textarea":BN(o,r);break;case"select":var d=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!r.multiple;var h=r.value;h!=null?rI(o,!!r.multiple,h,!1):d!==!!r.multiple&&(r.defaultValue!=null?rI(o,!!r.multiple,r.defaultValue,!0):rI(o,!!r.multiple,r.multiple?[]:"",!1))}o[OC]=r}catch(v){_n(t,t.return,v)}}break;case 6:if(Br(e,t),as(t),i&4){if(t.stateNode===null)throw Error(Ee(162));o=t.stateNode,r=t.memoizedProps;try{o.nodeValue=r}catch(v){_n(t,t.return,v)}}break;case 3:if(Br(e,t),as(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{_C(e.containerInfo)}catch(v){_n(t,t.return,v)}break;case 4:Br(e,t),as(t);break;case 13:Br(e,t),as(t),o=t.child,o.flags&8192&&(r=o.memoizedState!==null,o.stateNode.isHidden=r,!r||o.alternate!==null&&o.alternate.memoizedState!==null||(MZ=jn())),i&4&&y1(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(Ei=(g=Ei)||c,Br(e,t),Ei=g):Br(e,t),as(t),i&8192){if(g=t.memoizedState!==null,(t.stateNode.isHidden=g)&&!c&&t.mode&1)for(st=t,c=t.child;c!==null;){for(C=st=c;st!==null;){switch(d=st,h=d.child,d.tag){case 0:case 11:case 14:case 15:yC(4,d,d.return);break;case 1:Qc(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){i=d,n=d.return;try{e=i,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(v){_n(i,n,v)}}break;case 5:Qc(d,d.return);break;case 22:if(d.memoizedState!==null){G1(C);continue}}h!==null?(h.return=d,st=h):G1(C)}c=c.sibling}e:for(c=null,C=t;;){if(C.tag===5){if(c===null){c=C;try{o=C.stateNode,g?(r=o.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(a=C.stateNode,l=C.memoizedProps.style,s=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=SN("display",s))}catch(v){_n(t,t.return,v)}}}else if(C.tag===6){if(c===null)try{C.stateNode.nodeValue=g?"":C.memoizedProps}catch(v){_n(t,t.return,v)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===t)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===t)break e;for(;C.sibling===null;){if(C.return===null||C.return===t)break e;c===C&&(c=null),C=C.return}c===C&&(c=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:Br(e,t),as(t),i&4&&y1(t);break;case 21:break;default:Br(e,t),as(t)}}function as(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(e5(n)){var i=n;break e}n=n.return}throw Error(Ee(160))}switch(i.tag){case 5:var o=i.stateNode;i.flags&32&&(LC(o,""),i.flags&=-33);var r=b1(t);aG(t,r,o);break;case 3:case 4:var s=i.stateNode.containerInfo,a=b1(t);sG(t,a,s);break;default:throw Error(Ee(161))}}catch(l){_n(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function WE(t,e,n){st=t,i5(t)}function i5(t,e,n){for(var i=(t.mode&1)!==0;st!==null;){var o=st,r=o.child;if(o.tag===22&&i){var s=o.memoizedState!==null||bA;if(!s){var a=o.alternate,l=a!==null&&a.memoizedState!==null||Ei;a=bA;var g=Ei;if(bA=s,(Ei=l)&&!g)for(st=o;st!==null;)s=st,l=s.child,s.tag===22&&s.memoizedState!==null?B1(o):l!==null?(l.return=s,st=l):B1(o);for(;r!==null;)st=r,i5(r),r=r.sibling;st=o,bA=a,Ei=g}v1(t)}else o.subtreeFlags&8772&&r!==null?(r.return=o,st=r):v1(t)}}function v1(t){for(;st!==null;){var e=st;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ei||pm(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Ei)if(n===null)i.componentDidMount();else{var o=e.elementType===e.type?n.memoizedProps:Vr(e.type,n.memoizedProps);i.componentDidUpdate(o,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&r1(e,r,i);break;case 3:var s=e.updateQueue;if(s!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}r1(e,s,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var g=e.alternate;if(g!==null){var c=g.memoizedState;if(c!==null){var C=c.dehydrated;C!==null&&_C(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ee(163))}Ei||e.flags&512&&rG(e)}catch(d){_n(e,e.return,d)}}if(e===t){st=null;break}if(n=e.sibling,n!==null){n.return=e.return,st=n;break}st=e.return}}function G1(t){for(;st!==null;){var e=st;if(e===t){st=null;break}var n=e.sibling;if(n!==null){n.return=e.return,st=n;break}st=e.return}}function B1(t){for(;st!==null;){var e=st;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{pm(4,e)}catch(l){_n(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var o=e.return;try{i.componentDidMount()}catch(l){_n(e,o,l)}}var r=e.return;try{rG(e)}catch(l){_n(e,r,l)}break;case 5:var s=e.return;try{rG(e)}catch(l){_n(e,s,l)}}}catch(l){_n(e,e.return,l)}if(e===t){st=null;break}var a=e.sibling;if(a!==null){a.return=e.return,st=a;break}st=e.return}}var xE=Math.ceil,Bf=ma.ReactCurrentDispatcher,NZ=ma.ReactCurrentOwner,Cr=ma.ReactCurrentBatchConfig,jt=0,bi=null,ii=null,wi=0,Ko=0,jc=yl(0),gi=0,td=null,Rg=0,fm=0,YZ=0,vC=null,vo=null,MZ=0,ZI=1/0,Ds=null,Zf=!1,lG=null,tl=null,yA=!1,Ua=null,wf=0,GC=0,gG=null,Kp=-1,zp=0;function so(){return jt&6?jn():Kp!==-1?Kp:Kp=jn()}function nl(t){return t.mode&1?jt&2&&wi!==0?wi&-wi:CE.transition!==null?(zp===0&&(zp=LN()),zp):(t=In,t!==0||(t=window.event,t=t===void 0?16:DN(t.type)),t):1}function Lr(t,e,n,i){if(50<GC)throw GC=0,gG=null,Error(Ee(185));Hd(t,n,i),(!(jt&2)||t!==bi)&&(t===bi&&(!(jt&2)&&(fm|=n),gi===4&&Ta(t,wi)),xo(t,i),n===1&&jt===0&&!(e.mode&1)&&(ZI=jn()+500,dm&&vl()))}function xo(t,e){var n=t.callbackNode;CL(t,e);var i=gf(t,t===bi?wi:0);if(i===0)n!==null&&NR(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&NR(n),e===1)t.tag===0?uE(Z1.bind(null,t)):uY(Z1.bind(null,t)),lE(function(){!(jt&6)&&vl()}),n=null;else{switch(EN(i)){case 1:n=aZ;break;case 4:n=KN;break;case 16:n=lf;break;case 536870912:n=zN;break;default:n=lf}n=I5(n,o5.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function o5(t,e){if(Kp=-1,zp=0,jt&6)throw Error(Ee(327));var n=t.callbackNode;if(cI()&&t.callbackNode!==n)return null;var i=gf(t,t===bi?wi:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Sf(t,i);else{e=i;var o=jt;jt|=2;var r=s5();(bi!==t||wi!==e)&&(Ds=null,ZI=jn()+500,hg(t,e));do try{NE();break}catch(a){r5(t,a)}while(1);bZ(),Bf.current=r,jt=o,ii!==null?e=0:(bi=null,wi=0,e=gi)}if(e!==0){if(e===2&&(o=Hv(t),o!==0&&(i=o,e=cG(t,o))),e===1)throw n=td,hg(t,0),Ta(t,i),xo(t,jn()),n;if(e===6)Ta(t,i);else{if(o=t.current.alternate,!(i&30)&&!VE(o)&&(e=Sf(t,i),e===2&&(r=Hv(t),r!==0&&(i=r,e=cG(t,r))),e===1))throw n=td,hg(t,0),Ta(t,i),xo(t,jn()),n;switch(t.finishedWork=o,t.finishedLanes=i,e){case 0:case 1:throw Error(Ee(345));case 2:Jl(t,vo,Ds);break;case 3:if(Ta(t,i),(i&130023424)===i&&(e=MZ+500-jn(),10<e)){if(gf(t,0)!==0)break;if(o=t.suspendedLanes,(o&i)!==i){so(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=_v(Jl.bind(null,t,vo,Ds),e);break}Jl(t,vo,Ds);break;case 4:if(Ta(t,i),(i&4194240)===i)break;for(e=t.eventTimes,o=-1;0<i;){var s=31-zr(i);r=1<<s,s=e[s],s>o&&(o=s),i&=~r}if(i=o,i=jn()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*xE(i/1960))-i,10<i){t.timeoutHandle=_v(Jl.bind(null,t,vo,Ds),i);break}Jl(t,vo,Ds);break;case 5:Jl(t,vo,Ds);break;default:throw Error(Ee(329))}}}return xo(t,jn()),t.callbackNode===n?o5.bind(null,t):null}function cG(t,e){var n=vC;return t.current.memoizedState.isDehydrated&&(hg(t,e).flags|=256),t=Sf(t,e),t!==2&&(e=vo,vo=n,e!==null&&IG(e)),t}function IG(t){vo===null?vo=t:vo.push.apply(vo,t)}function VE(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var o=n[i],r=o.getSnapshot;o=o.value;try{if(!Tr(r(),o))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ta(t,e){for(e&=~YZ,e&=~fm,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-zr(e),i=1<<n;t[n]=-1,e&=~i}}function Z1(t){if(jt&6)throw Error(Ee(327));cI();var e=gf(t,0);if(!(e&1))return xo(t,jn()),null;var n=Sf(t,e);if(t.tag!==0&&n===2){var i=Hv(t);i!==0&&(e=i,n=cG(t,i))}if(n===1)throw n=td,hg(t,0),Ta(t,e),xo(t,jn()),n;if(n===6)throw Error(Ee(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Jl(t,vo,Ds),xo(t,jn()),null}function HZ(t,e){var n=jt;jt|=1;try{return t(e)}finally{jt=n,jt===0&&(ZI=jn()+500,dm&&vl())}}function Wg(t){Ua!==null&&Ua.tag===0&&!(jt&6)&&cI();var e=jt;jt|=1;var n=Cr.transition,i=In;try{if(Cr.transition=null,In=1,t)return t()}finally{In=i,Cr.transition=n,jt=e,!(jt&6)&&vl()}}function FZ(){Ko=jc.current,Sn(jc)}function hg(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,aE(n)),ii!==null)for(n=ii.return;n!==null;){var i=n;switch(pZ(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&df();break;case 3:GI(),Sn(Ro),Sn(Ui),wZ();break;case 5:ZZ(i);break;case 4:GI();break;case 13:Sn(Fn);break;case 19:Sn(Fn);break;case 10:yZ(i.type._context);break;case 22:case 23:FZ()}n=n.return}if(bi=t,ii=t=il(t.current,null),wi=Ko=e,gi=0,td=null,YZ=fm=Rg=0,vo=vC=null,rg!==null){for(e=0;e<rg.length;e++)if(n=rg[e],i=n.interleaved,i!==null){n.interleaved=null;var o=i.next,r=n.pending;if(r!==null){var s=r.next;r.next=o,i.next=s}n.pending=i}rg=null}return t}function r5(t,e){do{var n=ii;try{if(bZ(),Mp.current=Gf,vf){for(var i=Ln.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}vf=!1}if(Sg=0,pi=ai=Ln=null,bC=!1,qC=0,NZ.current=null,n===null||n.return===null){gi=1,td=e,ii=null;break}e:{var r=t,s=n.return,a=n,l=e;if(e=wi,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var g=l,c=a,C=c.tag;if(!(c.mode&1)&&(C===0||C===11||C===15)){var d=c.alternate;d?(c.updateQueue=d.updateQueue,c.memoizedState=d.memoizedState,c.lanes=d.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=u1(s);if(h!==null){h.flags&=-257,C1(h,s,a,r,e),h.mode&1&&I1(r,g,e),e=h,l=g;var p=e.updateQueue;if(p===null){var v=new Set;v.add(l),e.updateQueue=v}else p.add(l);break e}else{if(!(e&1)){I1(r,g,e),KZ();break e}l=Error(Ee(426))}}else if(Vn&&a.mode&1){var f=u1(s);if(f!==null){!(f.flags&65536)&&(f.flags|=256),C1(f,s,a,r,e),fZ(BI(l,a));break e}}r=l=BI(l,a),gi!==4&&(gi=2),vC===null?vC=[r]:vC.push(r),r=s;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var A=kY(r,l,e);o1(r,A);break e;case 1:a=l;var b=r.type,m=r.stateNode;if(!(r.flags&128)&&(typeof b.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(tl===null||!tl.has(m)))){r.flags|=65536,e&=-e,r.lanes|=e;var B=TY(r,a,e);o1(r,B);break e}}r=r.return}while(r!==null)}l5(n)}catch(Z){e=Z,ii===n&&n!==null&&(ii=n=n.return);continue}break}while(1)}function s5(){var t=Bf.current;return Bf.current=Gf,t===null?Gf:t}function KZ(){(gi===0||gi===3||gi===2)&&(gi=4),bi===null||!(Rg&268435455)&&!(fm&268435455)||Ta(bi,wi)}function Sf(t,e){var n=jt;jt|=2;var i=s5();(bi!==t||wi!==e)&&(Ds=null,hg(t,e));do try{XE();break}catch(o){r5(t,o)}while(1);if(bZ(),jt=n,Bf.current=i,ii!==null)throw Error(Ee(261));return bi=null,wi=0,gi}function XE(){for(;ii!==null;)a5(ii)}function NE(){for(;ii!==null&&!oL();)a5(ii)}function a5(t){var e=c5(t.alternate,t,Ko);t.memoizedProps=t.pendingProps,e===null?l5(t):ii=e,NZ.current=null}function l5(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=wE(n,e),n!==null){n.flags&=32767,ii=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{gi=6,ii=null;return}}else if(n=ZE(n,e,Ko),n!==null){ii=n;return}if(e=e.sibling,e!==null){ii=e;return}ii=e=t}while(e!==null);gi===0&&(gi=5)}function Jl(t,e,n){var i=In,o=Cr.transition;try{Cr.transition=null,In=1,YE(t,e,n,i)}finally{Cr.transition=o,In=i}return null}function YE(t,e,n,i){do cI();while(Ua!==null);if(jt&6)throw Error(Ee(327));n=t.finishedWork;var o=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Ee(177));t.callbackNode=null,t.callbackPriority=0;var r=n.lanes|n.childLanes;if(dL(t,r),t===bi&&(ii=bi=null,wi=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||yA||(yA=!0,I5(lf,function(){return cI(),null})),r=(n.flags&15990)!==0,n.subtreeFlags&15990||r){r=Cr.transition,Cr.transition=null;var s=In;In=1;var a=jt;jt|=4,NZ.current=null,RE(t,n),n5(n,t),eE(kv),cf=!!Ev,kv=Ev=null,t.current=n,WE(n),rL(),jt=a,In=s,Cr.transition=r}else t.current=n;if(yA&&(yA=!1,Ua=t,wf=o),r=t.pendingLanes,r===0&&(tl=null),lL(n.stateNode),xo(t,jn()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)o=e[n],i(o.value,{componentStack:o.stack,digest:o.digest});if(Zf)throw Zf=!1,t=lG,lG=null,t;return wf&1&&t.tag!==0&&cI(),r=t.pendingLanes,r&1?t===gG?GC++:(GC=0,gG=t):GC=0,vl(),null}function cI(){if(Ua!==null){var t=EN(wf),e=Cr.transition,n=In;try{if(Cr.transition=null,In=16>t?16:t,Ua===null)var i=!1;else{if(t=Ua,Ua=null,wf=0,jt&6)throw Error(Ee(331));var o=jt;for(jt|=4,st=t.current;st!==null;){var r=st,s=r.child;if(st.flags&16){var a=r.deletions;if(a!==null){for(var l=0;l<a.length;l++){var g=a[l];for(st=g;st!==null;){var c=st;switch(c.tag){case 0:case 11:case 15:yC(8,c,r)}var C=c.child;if(C!==null)C.return=c,st=C;else for(;st!==null;){c=st;var d=c.sibling,h=c.return;if($Y(c),c===g){st=null;break}if(d!==null){d.return=h,st=d;break}st=h}}}var p=r.alternate;if(p!==null){var v=p.child;if(v!==null){p.child=null;do{var f=v.sibling;v.sibling=null,v=f}while(v!==null)}}st=r}}if(r.subtreeFlags&2064&&s!==null)s.return=r,st=s;else e:for(;st!==null;){if(r=st,r.flags&2048)switch(r.tag){case 0:case 11:case 15:yC(9,r,r.return)}var A=r.sibling;if(A!==null){A.return=r.return,st=A;break e}st=r.return}}var b=t.current;for(st=b;st!==null;){s=st;var m=s.child;if(s.subtreeFlags&2064&&m!==null)m.return=s,st=m;else e:for(s=b;st!==null;){if(a=st,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:pm(9,a)}}catch(Z){_n(a,a.return,Z)}if(a===s){st=null;break e}var B=a.sibling;if(B!==null){B.return=a.return,st=B;break e}st=a.return}}if(jt=o,vl(),ms&&typeof ms.onPostCommitFiberRoot=="function")try{ms.onPostCommitFiberRoot(gm,t)}catch{}i=!0}return i}finally{In=n,Cr.transition=e}}return!1}function w1(t,e,n){e=BI(n,e),e=kY(t,e,1),t=el(t,e,1),e=so(),t!==null&&(Hd(t,1,e),xo(t,e))}function _n(t,e,n){if(t.tag===3)w1(t,t,n);else for(;e!==null;){if(e.tag===3){w1(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(tl===null||!tl.has(i))){t=BI(n,t),t=TY(e,t,1),e=el(e,t,1),t=so(),e!==null&&(Hd(e,1,t),xo(e,t));break}}e=e.return}}function ME(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=so(),t.pingedLanes|=t.suspendedLanes&n,bi===t&&(wi&n)===n&&(gi===4||gi===3&&(wi&130023424)===wi&&500>jn()-MZ?hg(t,0):YZ|=n),xo(t,e)}function g5(t,e){e===0&&(t.mode&1?(e=IA,IA<<=1,!(IA&130023424)&&(IA=4194304)):e=1);var n=so();t=Ia(t,e),t!==null&&(Hd(t,e,n),xo(t,n))}function HE(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),g5(t,n)}function FE(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,o=t.memoizedState;o!==null&&(n=o.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Ee(314))}i!==null&&i.delete(e),g5(t,n)}var c5;c5=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ro.current)Zo=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Zo=!1,BE(t,e,n);Zo=!!(t.flags&131072)}else Zo=!1,Vn&&e.flags&1048576&&CY(e,pf,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Fp(t,e),t=e.pendingProps;var o=bI(e,Ui.current);gI(e,n),o=RZ(null,e,i,t,o,n);var r=WZ();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Wo(i)?(r=!0,hf(e)):r=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,GZ(e),o.updater=hm,e.stateNode=o,o._reactInternals=e,jv(e,i,t,n),e=eG(null,e,i,!0,r,n)):(e.tag=0,Vn&&r&&AZ(e),eo(null,e,o,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Fp(t,e),t=e.pendingProps,o=i._init,i=o(i._payload),e.type=i,o=e.tag=zE(i),t=Vr(i,t),o){case 0:e=$v(null,e,i,t,n);break e;case 1:e=A1(null,e,i,t,n);break e;case 11:e=d1(null,e,i,t,n);break e;case 14:e=h1(null,e,i,Vr(i.type,t),n);break e}throw Error(Ee(306,i,""))}return e;case 0:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Vr(i,o),$v(t,e,i,o,n);case 1:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Vr(i,o),A1(t,e,i,o,n);case 3:e:{if(DY(e),t===null)throw Error(Ee(387));i=e.pendingProps,r=e.memoizedState,o=r.element,pY(t,e),bf(e,i,null,n);var s=e.memoizedState;if(i=s.element,r.isDehydrated)if(r={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){o=BI(Error(Ee(423)),e),e=p1(t,e,i,n,o);break e}else if(i!==o){o=BI(Error(Ee(424)),e),e=p1(t,e,i,n,o);break e}else for(Lo=$a(e.stateNode.containerInfo.firstChild),Eo=e,Vn=!0,Yr=null,n=yY(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(yI(),i===o){e=ua(t,e,n);break e}eo(t,e,i,n)}e=e.child}return e;case 5:return vY(e),t===null&&Jv(e),i=e.type,o=e.pendingProps,r=t!==null?t.memoizedProps:null,s=o.children,Tv(i,o)?s=null:r!==null&&Tv(i,r)&&(e.flags|=32),PY(t,e),eo(t,e,s,n),e.child;case 6:return t===null&&Jv(e),null;case 13:return JY(t,e,n);case 4:return BZ(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=vI(e,null,i,n):eo(t,e,i,n),e.child;case 11:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Vr(i,o),d1(t,e,i,o,n);case 7:return eo(t,e,e.pendingProps,n),e.child;case 8:return eo(t,e,e.pendingProps.children,n),e.child;case 12:return eo(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,o=e.pendingProps,r=e.memoizedProps,s=o.value,vn(ff,i._currentValue),i._currentValue=s,r!==null)if(Tr(r.value,s)){if(r.children===o.children&&!Ro.current){e=ua(t,e,n);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var a=r.dependencies;if(a!==null){s=r.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(r.tag===1){l=sa(-1,n&-n),l.tag=2;var g=r.updateQueue;if(g!==null){g=g.shared;var c=g.pending;c===null?l.next=l:(l.next=c.next,c.next=l),g.pending=l}}r.lanes|=n,l=r.alternate,l!==null&&(l.lanes|=n),Ov(r.return,n,e),a.lanes|=n;break}l=l.next}}else if(r.tag===10)s=r.type===e.type?null:r.child;else if(r.tag===18){if(s=r.return,s===null)throw Error(Ee(341));s.lanes|=n,a=s.alternate,a!==null&&(a.lanes|=n),Ov(s,n,e),s=r.sibling}else s=r.child;if(s!==null)s.return=r;else for(s=r;s!==null;){if(s===e){s=null;break}if(r=s.sibling,r!==null){r.return=s.return,s=r;break}s=s.return}r=s}eo(t,e,o.children,n),e=e.child}return e;case 9:return o=e.type,i=e.pendingProps.children,gI(e,n),o=dr(o),i=i(o),e.flags|=1,eo(t,e,i,n),e.child;case 14:return i=e.type,o=Vr(i,e.pendingProps),o=Vr(i.type,o),h1(t,e,i,o,n);case 15:return _Y(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Vr(i,o),Fp(t,e),e.tag=1,Wo(i)?(t=!0,hf(e)):t=!1,gI(e,n),mY(e,i,o),jv(e,i,o,n),eG(null,e,i,!0,t,n);case 19:return OY(t,e,n);case 22:return UY(t,e,n)}throw Error(Ee(156,e.tag))};function I5(t,e){return FN(t,e)}function KE(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cr(t,e,n,i){return new KE(t,e,n,i)}function zZ(t){return t=t.prototype,!(!t||!t.isReactComponent)}function zE(t){if(typeof t=="function")return zZ(t)?1:0;if(t!=null){if(t=t.$$typeof,t===oZ)return 11;if(t===rZ)return 14}return 2}function il(t,e){var n=t.alternate;return n===null?(n=cr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Lp(t,e,n,i,o,r){var s=2;if(i=t,typeof t=="function")zZ(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case Ec:return Ag(n.children,o,r,e);case iZ:s=8,o|=8;break;case yv:return t=cr(12,n,e,o|2),t.elementType=yv,t.lanes=r,t;case vv:return t=cr(13,n,e,o),t.elementType=vv,t.lanes=r,t;case Gv:return t=cr(19,n,e,o),t.elementType=Gv,t.lanes=r,t;case bN:return mm(n,o,r,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case fN:s=10;break e;case mN:s=9;break e;case oZ:s=11;break e;case rZ:s=14;break e;case La:s=16,i=null;break e}throw Error(Ee(130,t==null?t:typeof t,""))}return e=cr(s,n,e,o),e.elementType=t,e.type=i,e.lanes=r,e}function Ag(t,e,n,i){return t=cr(7,t,i,e),t.lanes=n,t}function mm(t,e,n,i){return t=cr(22,t,i,e),t.elementType=bN,t.lanes=n,t.stateNode={isHidden:!1},t}function qb(t,e,n){return t=cr(6,t,null,e),t.lanes=n,t}function $b(t,e,n){return e=cr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function LE(t,e,n,i,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Nb(0),this.expirationTimes=Nb(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Nb(0),this.identifierPrefix=i,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function LZ(t,e,n,i,o,r,s,a,l){return t=new LE(t,e,n,a,l),e===1?(e=1,r===!0&&(e|=8)):e=0,r=cr(3,null,null,e),t.current=r,r.stateNode=t,r.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},GZ(r),t}function EE(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Lc,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function u5(t){if(!t)return ul;t=t._reactInternals;e:{if(Kg(t)!==t||t.tag!==1)throw Error(Ee(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Wo(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ee(171))}if(t.tag===1){var n=t.type;if(Wo(n))return IY(t,n,e)}return e}function C5(t,e,n,i,o,r,s,a,l){return t=LZ(n,i,!0,t,o,r,s,a,l),t.context=u5(null),n=t.current,i=so(),o=nl(n),r=sa(i,o),r.callback=e??null,el(n,r,o),t.current.lanes=o,Hd(t,o,i),xo(t,i),t}function bm(t,e,n,i){var o=e.current,r=so(),s=nl(o);return n=u5(n),e.context===null?e.context=n:e.pendingContext=n,e=sa(r,s),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=el(o,e,s),t!==null&&(Lr(t,o,s,r),Yp(t,o,s)),s}function Rf(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function S1(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function EZ(t,e){S1(t,e),(t=t.alternate)&&S1(t,e)}function kE(){return null}var d5=typeof reportError=="function"?reportError:function(t){console.error(t)};function kZ(t){this._internalRoot=t}ym.prototype.render=kZ.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ee(409));bm(t,e,null,null)};ym.prototype.unmount=kZ.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Wg(function(){bm(null,t,null,null)}),e[ca]=null}};function ym(t){this._internalRoot=t}ym.prototype.unstable_scheduleHydration=function(t){if(t){var e=_N();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ka.length&&e!==0&&e<ka[n].priority;n++);ka.splice(n,0,t),n===0&&PN(t)}};function TZ(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function vm(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function R1(){}function TE(t,e,n,i,o){if(o){if(typeof i=="function"){var r=i;i=function(){var g=Rf(s);r.call(g)}}var s=C5(e,i,t,0,null,!1,!1,"",R1);return t._reactRootContainer=s,t[ca]=s.current,DC(t.nodeType===8?t.parentNode:t),Wg(),s}for(;o=t.lastChild;)t.removeChild(o);if(typeof i=="function"){var a=i;i=function(){var g=Rf(l);a.call(g)}}var l=LZ(t,0,!1,null,null,!1,!1,"",R1);return t._reactRootContainer=l,t[ca]=l.current,DC(t.nodeType===8?t.parentNode:t),Wg(function(){bm(e,l,n,i)}),l}function Gm(t,e,n,i,o){var r=n._reactRootContainer;if(r){var s=r;if(typeof o=="function"){var a=o;o=function(){var l=Rf(s);a.call(l)}}bm(e,s,t,o)}else s=TE(n,e,t,o,i);return Rf(s)}kN=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=sC(e.pendingLanes);n!==0&&(lZ(e,n|1),xo(e,jn()),!(jt&6)&&(ZI=jn()+500,vl()))}break;case 13:Wg(function(){var i=Ia(t,1);if(i!==null){var o=so();Lr(i,t,1,o)}}),EZ(t,1)}};gZ=function(t){if(t.tag===13){var e=Ia(t,134217728);if(e!==null){var n=so();Lr(e,t,134217728,n)}EZ(t,134217728)}};TN=function(t){if(t.tag===13){var e=nl(t),n=Ia(t,e);if(n!==null){var i=so();Lr(n,t,e,i)}EZ(t,e)}};_N=function(){return In};UN=function(t,e){var n=In;try{return In=t,e()}finally{In=n}};Nv=function(t,e,n){switch(e){case"input":if(wv(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var o=Cm(i);if(!o)throw Error(Ee(90));vN(i),wv(i,o)}}}break;case"textarea":BN(t,n);break;case"select":e=n.value,e!=null&&rI(t,!!n.multiple,e,!1)}};VN=HZ;XN=Wg;var _E={usingClientEntryPoint:!1,Events:[Kd,Uc,Cm,WN,xN,HZ]},Nu={findFiberByHostInstance:og,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},UE={bundleType:Nu.bundleType,version:Nu.version,rendererPackageName:Nu.rendererPackageName,rendererConfig:Nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ma.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=MN(t),t===null?null:t.stateNode},findFiberByHostInstance:Nu.findFiberByHostInstance||kE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vA=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vA.isDisabled&&vA.supportsFiber)try{gm=vA.inject(UE),ms=vA}catch{}}Uo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_E;Uo.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!TZ(e))throw Error(Ee(200));return EE(t,e,null,n)};Uo.createRoot=function(t,e){if(!TZ(t))throw Error(Ee(299));var n=!1,i="",o=d5;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=LZ(t,1,!1,null,null,n,!1,i,o),t[ca]=e.current,DC(t.nodeType===8?t.parentNode:t),new kZ(e)};Uo.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ee(188)):(t=Object.keys(t).join(","),Error(Ee(268,t)));return t=MN(e),t=t===null?null:t.stateNode,t};Uo.flushSync=function(t){return Wg(t)};Uo.hydrate=function(t,e,n){if(!vm(e))throw Error(Ee(200));return Gm(null,t,e,!0,n)};Uo.hydrateRoot=function(t,e,n){if(!TZ(t))throw Error(Ee(405));var i=n!=null&&n.hydratedSources||null,o=!1,r="",s=d5;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(r=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),e=C5(e,null,t,1,n??null,o,!1,r,s),t[ca]=e.current,DC(t),i)for(t=0;t<i.length;t++)n=i[t],o=n._getVersion,o=o(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,o]:e.mutableSourceEagerHydrationData.push(n,o);return new ym(e)};Uo.render=function(t,e,n){if(!vm(e))throw Error(Ee(200));return Gm(null,t,e,!1,n)};Uo.unmountComponentAtNode=function(t){if(!vm(t))throw Error(Ee(40));return t._reactRootContainer?(Wg(function(){Gm(null,null,t,!1,function(){t._reactRootContainer=null,t[ca]=null})}),!0):!1};Uo.unstable_batchedUpdates=HZ;Uo.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!vm(n))throw Error(Ee(200));if(t==null||t._reactInternals===void 0)throw Error(Ee(38));return Gm(t,e,n,!1,i)};Uo.version="18.2.0-next-9e3b772b8-20220608";function h5(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h5)}catch(t){console.error(t)}}h5(),CN.exports=Uo;var Ld=CN.exports;const A5=LI(Ld);var W1=Ld;mv.createRoot=W1.createRoot,mv.hydrateRoot=W1.hydrateRoot;/**
 * @remix-run/router v1.8.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function nd(){return nd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},nd.apply(this,arguments)}var Pa;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Pa||(Pa={}));const x1="popstate";function PE(t){t===void 0&&(t={});function e(o,r){let{pathname:s="/",search:a="",hash:l=""}=zg(o.location.hash.substr(1));return!s.startsWith("/")&&!s.startsWith(".")&&(s="/"+s),uG("",{pathname:s,search:a,hash:l},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(o,r){let s=o.document.querySelector("base"),a="";if(s&&s.getAttribute("href")){let l=o.location.href,g=l.indexOf("#");a=g===-1?l:l.slice(0,g)}return a+"#"+(typeof r=="string"?r:Wf(r))}function i(o,r){Bm(o.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(r)+")")}return JE(e,n,i,t)}function oi(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Bm(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function DE(){return Math.random().toString(36).substr(2,8)}function V1(t,e){return{usr:t.state,key:t.key,idx:e}}function uG(t,e,n,i){return n===void 0&&(n=null),nd({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?zg(e):e,{state:n,key:e&&e.key||i||DE()})}function Wf(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function zg(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function JE(t,e,n,i){i===void 0&&(i={});let{window:o=document.defaultView,v5Compat:r=!1}=i,s=o.history,a=Pa.Pop,l=null,g=c();g==null&&(g=0,s.replaceState(nd({},s.state,{idx:g}),""));function c(){return(s.state||{idx:null}).idx}function C(){a=Pa.Pop;let f=c(),A=f==null?null:f-g;g=f,l&&l({action:a,location:v.location,delta:A})}function d(f,A){a=Pa.Push;let b=uG(v.location,f,A);n&&n(b,f),g=c()+1;let m=V1(b,g),B=v.createHref(b);try{s.pushState(m,"",B)}catch(Z){if(Z instanceof DOMException&&Z.name==="DataCloneError")throw Z;o.location.assign(B)}r&&l&&l({action:a,location:v.location,delta:1})}function h(f,A){a=Pa.Replace;let b=uG(v.location,f,A);n&&n(b,f),g=c();let m=V1(b,g),B=v.createHref(b);s.replaceState(m,"",B),r&&l&&l({action:a,location:v.location,delta:0})}function p(f){let A=o.location.origin!=="null"?o.location.origin:o.location.href,b=typeof f=="string"?f:Wf(f);return oi(A,"No window.location.(origin|href) available to create URL for href: "+b),new URL(b,A)}let v={get action(){return a},get location(){return t(o,s)},listen(f){if(l)throw new Error("A history only accepts one active listener");return o.addEventListener(x1,C),l=f,()=>{o.removeEventListener(x1,C),l=null}},createHref(f){return e(o,f)},createURL:p,encodeLocation(f){let A=p(f);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:d,replace:h,go(f){return s.go(f)}};return v}var X1;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(X1||(X1={}));function OE(t,e,n){n===void 0&&(n="/");let i=typeof e=="string"?zg(e):e,o=_Z(i.pathname||"/",n);if(o==null)return null;let r=p5(t);QE(r);let s=null;for(let a=0;s==null&&a<r.length;++a)s=rk(r[a],lk(o));return s}function p5(t,e,n,i){e===void 0&&(e=[]),n===void 0&&(n=[]),i===void 0&&(i="");let o=(r,s,a)=>{let l={relativePath:a===void 0?r.path||"":a,caseSensitive:r.caseSensitive===!0,childrenIndex:s,route:r};l.relativePath.startsWith("/")&&(oi(l.relativePath.startsWith(i),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(i.length));let g=ol([i,l.relativePath]),c=n.concat(l);r.children&&r.children.length>0&&(oi(r.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+g+'".')),p5(r.children,e,c,g)),!(r.path==null&&!r.index)&&e.push({path:g,score:ik(g,r.index),routesMeta:c})};return t.forEach((r,s)=>{var a;if(r.path===""||!((a=r.path)!=null&&a.includes("?")))o(r,s);else for(let l of f5(r.path))o(r,s,l)}),e}function f5(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,o=n.endsWith("?"),r=n.replace(/\?$/,"");if(i.length===0)return o?[r,""]:[r];let s=f5(i.join("/")),a=[];return a.push(...s.map(l=>l===""?r:[r,l].join("/"))),o&&a.push(...s),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function QE(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:ok(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}const jE=/^:\w+$/,qE=3,$E=2,ek=1,tk=10,nk=-2,N1=t=>t==="*";function ik(t,e){let n=t.split("/"),i=n.length;return n.some(N1)&&(i+=nk),e&&(i+=$E),n.filter(o=>!N1(o)).reduce((o,r)=>o+(jE.test(r)?qE:r===""?ek:tk),i)}function ok(t,e){return t.length===e.length&&t.slice(0,-1).every((i,o)=>i===e[o])?t[t.length-1]-e[e.length-1]:0}function rk(t,e){let{routesMeta:n}=t,i={},o="/",r=[];for(let s=0;s<n.length;++s){let a=n[s],l=s===n.length-1,g=o==="/"?e:e.slice(o.length)||"/",c=sk({path:a.relativePath,caseSensitive:a.caseSensitive,end:l},g);if(!c)return null;Object.assign(i,c.params);let C=a.route;r.push({params:i,pathname:ol([o,c.pathname]),pathnameBase:uk(ol([o,c.pathnameBase])),route:C}),c.pathnameBase!=="/"&&(o=ol([o,c.pathnameBase]))}return r}function sk(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=ak(t.path,t.caseSensitive,t.end),o=e.match(n);if(!o)return null;let r=o[0],s=r.replace(/(.)\/+$/,"$1"),a=o.slice(1);return{params:i.reduce((g,c,C)=>{if(c==="*"){let d=a[C]||"";s=r.slice(0,r.length-d.length).replace(/(.)\/+$/,"$1")}return g[c]=gk(a[C]||"",c),g},{}),pathname:r,pathnameBase:s,pattern:t}}function ak(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Bm(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],o="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(s,a)=>(i.push(a),"/([^\\/]+)"));return t.endsWith("*")?(i.push("*"),o+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":t!==""&&t!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,e?void 0:"i"),i]}function lk(t){try{return decodeURI(t)}catch(e){return Bm(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function gk(t,e){try{return decodeURIComponent(t)}catch(n){return Bm(!1,'The value for the URL param "'+e+'" will not be decoded because'+(' the string "'+t+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+n+").")),t}}function _Z(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}function ck(t,e){e===void 0&&(e="/");let{pathname:n,search:i="",hash:o=""}=typeof t=="string"?zg(t):t;return{pathname:n?n.startsWith("/")?n:Ik(n,e):e,search:Ck(i),hash:dk(o)}}function Ik(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(o=>{o===".."?n.length>1&&n.pop():o!=="."&&n.push(o)}),n.length>1?n.join("/"):"/"}function ey(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function m5(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function b5(t,e,n,i){i===void 0&&(i=!1);let o;typeof t=="string"?o=zg(t):(o=nd({},t),oi(!o.pathname||!o.pathname.includes("?"),ey("?","pathname","search",o)),oi(!o.pathname||!o.pathname.includes("#"),ey("#","pathname","hash",o)),oi(!o.search||!o.search.includes("#"),ey("#","search","hash",o)));let r=t===""||o.pathname==="",s=r?"/":o.pathname,a;if(i||s==null)a=n;else{let C=e.length-1;if(s.startsWith("..")){let d=s.split("/");for(;d[0]==="..";)d.shift(),C-=1;o.pathname=d.join("/")}a=C>=0?e[C]:"/"}let l=ck(o,a),g=s&&s!=="/"&&s.endsWith("/"),c=(r||s===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(g||c)&&(l.pathname+="/"),l}const ol=t=>t.join("/").replace(/\/\/+/g,"/"),uk=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Ck=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,dk=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function hk(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const y5=["post","put","patch","delete"];new Set(y5);const Ak=["get",...y5];new Set(Ak);/**
 * React Router v6.15.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function xf(){return xf=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},xf.apply(this,arguments)}const UZ=x.createContext(null),pk=x.createContext(null),_I=x.createContext(null),Zm=x.createContext(null),Lg=x.createContext({outlet:null,matches:[],isDataRoute:!1}),v5=x.createContext(null);function fk(t,e){let{relative:n}=e===void 0?{}:e;Ed()||oi(!1);let{basename:i,navigator:o}=x.useContext(_I),{hash:r,pathname:s,search:a}=B5(t,{relative:n}),l=s;return i!=="/"&&(l=s==="/"?i:ol([i,s])),o.createHref({pathname:l,search:a,hash:r})}function Ed(){return x.useContext(Zm)!=null}function kd(){return Ed()||oi(!1),x.useContext(Zm).location}function G5(t){x.useContext(_I).static||x.useLayoutEffect(t)}function mk(){let{isDataRoute:t}=x.useContext(Lg);return t?Xk():bk()}function bk(){Ed()||oi(!1);let t=x.useContext(UZ),{basename:e,navigator:n}=x.useContext(_I),{matches:i}=x.useContext(Lg),{pathname:o}=kd(),r=JSON.stringify(m5(i).map(l=>l.pathnameBase)),s=x.useRef(!1);return G5(()=>{s.current=!0}),x.useCallback(function(l,g){if(g===void 0&&(g={}),!s.current)return;if(typeof l=="number"){n.go(l);return}let c=b5(l,JSON.parse(r),o,g.relative==="path");t==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:ol([e,c.pathname])),(g.replace?n.replace:n.push)(c,g.state,g)},[e,n,r,o,t])}function B5(t,e){let{relative:n}=e===void 0?{}:e,{matches:i}=x.useContext(Lg),{pathname:o}=kd(),r=JSON.stringify(m5(i).map(s=>s.pathnameBase));return x.useMemo(()=>b5(t,JSON.parse(r),o,n==="path"),[t,r,o,n])}function yk(t,e){return vk(t,e)}function vk(t,e,n){Ed()||oi(!1);let{navigator:i}=x.useContext(_I),{matches:o}=x.useContext(Lg),r=o[o.length-1],s=r?r.params:{};r&&r.pathname;let a=r?r.pathnameBase:"/";r&&r.route;let l=kd(),g;if(e){var c;let v=typeof e=="string"?zg(e):e;a==="/"||(c=v.pathname)!=null&&c.startsWith(a)||oi(!1),g=v}else g=l;let C=g.pathname||"/",d=a==="/"?C:C.slice(a.length)||"/",h=OE(t,{pathname:d}),p=Sk(h&&h.map(v=>Object.assign({},v,{params:Object.assign({},s,v.params),pathname:ol([a,i.encodeLocation?i.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?a:ol([a,i.encodeLocation?i.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),o,n);return e&&p?x.createElement(Zm.Provider,{value:{location:xf({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:Pa.Pop}},p):p}function Gk(){let t=Vk(),e=hk(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},r=null;return x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},e),n?x.createElement("pre",{style:o},n):null,r)}const Bk=x.createElement(Gk,null);class Zk extends x.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error||n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error?x.createElement(Lg.Provider,{value:this.props.routeContext},x.createElement(v5.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function wk(t){let{routeContext:e,match:n,children:i}=t,o=x.useContext(UZ);return o&&o.static&&o.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=n.route.id),x.createElement(Lg.Provider,{value:e},i)}function Sk(t,e,n){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),t==null){var o;if((o=n)!=null&&o.errors)t=n.matches;else return null}let r=t,s=(i=n)==null?void 0:i.errors;if(s!=null){let a=r.findIndex(l=>l.route.id&&(s==null?void 0:s[l.route.id]));a>=0||oi(!1),r=r.slice(0,Math.min(r.length,a+1))}return r.reduceRight((a,l,g)=>{let c=l.route.id?s==null?void 0:s[l.route.id]:null,C=null;n&&(C=l.route.errorElement||Bk);let d=e.concat(r.slice(0,g+1)),h=()=>{let p;return c?p=C:l.route.Component?p=x.createElement(l.route.Component,null):l.route.element?p=l.route.element:p=a,x.createElement(wk,{match:l,routeContext:{outlet:a,matches:d,isDataRoute:n!=null},children:p})};return n&&(l.route.ErrorBoundary||l.route.errorElement||g===0)?x.createElement(Zk,{location:n.location,revalidation:n.revalidation,component:C,error:c,children:h(),routeContext:{outlet:null,matches:d,isDataRoute:!0}}):h()},null)}var Z5=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Z5||{}),Vf=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Vf||{});function Rk(t){let e=x.useContext(UZ);return e||oi(!1),e}function Wk(t){let e=x.useContext(pk);return e||oi(!1),e}function xk(t){let e=x.useContext(Lg);return e||oi(!1),e}function w5(t){let e=xk(),n=e.matches[e.matches.length-1];return n.route.id||oi(!1),n.route.id}function Vk(){var t;let e=x.useContext(v5),n=Wk(Vf.UseRouteError),i=w5(Vf.UseRouteError);return e||((t=n.errors)==null?void 0:t[i])}function Xk(){let{router:t}=Rk(Z5.UseNavigateStable),e=w5(Vf.UseNavigateStable),n=x.useRef(!1);return G5(()=>{n.current=!0}),x.useCallback(function(o,r){r===void 0&&(r={}),n.current&&(typeof o=="number"?t.navigate(o):t.navigate(o,xf({fromRouteId:e},r)))},[t,e])}function lC(t){oi(!1)}function Nk(t){let{basename:e="/",children:n=null,location:i,navigationType:o=Pa.Pop,navigator:r,static:s=!1}=t;Ed()&&oi(!1);let a=e.replace(/^\/*/,"/"),l=x.useMemo(()=>({basename:a,navigator:r,static:s}),[a,r,s]);typeof i=="string"&&(i=zg(i));let{pathname:g="/",search:c="",hash:C="",state:d=null,key:h="default"}=i,p=x.useMemo(()=>{let v=_Z(g,a);return v==null?null:{location:{pathname:v,search:c,hash:C,state:d,key:h},navigationType:o}},[a,g,c,C,d,h,o]);return p==null?null:x.createElement(_I.Provider,{value:l},x.createElement(Zm.Provider,{children:n,value:p}))}function Yk(t){let{children:e,location:n}=t;return yk(CG(e),n)}new Promise(()=>{});function CG(t,e){e===void 0&&(e=[]);let n=[];return x.Children.forEach(t,(i,o)=>{if(!x.isValidElement(i))return;let r=[...e,o];if(i.type===x.Fragment){n.push.apply(n,CG(i.props.children,r));return}i.type!==lC&&oi(!1),!i.props.index||!i.props.children||oi(!1);let s={id:i.props.id||r.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(s.children=CG(i.props.children,r)),n.push(s)}),n}/**
 * React Router DOM v6.15.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function dG(){return dG=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},dG.apply(this,arguments)}function Mk(t,e){if(t==null)return{};var n={},i=Object.keys(t),o,r;for(r=0;r<i.length;r++)o=i[r],!(e.indexOf(o)>=0)&&(n[o]=t[o]);return n}function Hk(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Fk(t,e){return t.button===0&&(!e||e==="_self")&&!Hk(t)}const Kk=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"],zk="startTransition",Y1=IN[zk];function Lk(t){let{basename:e,children:n,future:i,window:o}=t,r=x.useRef();r.current==null&&(r.current=PE({window:o,v5Compat:!0}));let s=r.current,[a,l]=x.useState({action:s.action,location:s.location}),{v7_startTransition:g}=i||{},c=x.useCallback(C=>{g&&Y1?Y1(()=>l(C)):l(C)},[l,g]);return x.useLayoutEffect(()=>s.listen(c),[s,c]),x.createElement(Nk,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:s})}const Ek=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",kk=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,S5=x.forwardRef(function(e,n){let{onClick:i,relative:o,reloadDocument:r,replace:s,state:a,target:l,to:g,preventScrollReset:c}=e,C=Mk(e,Kk),{basename:d}=x.useContext(_I),h,p=!1;if(typeof g=="string"&&kk.test(g)&&(h=g,Ek))try{let b=new URL(window.location.href),m=g.startsWith("//")?new URL(b.protocol+g):new URL(g),B=_Z(m.pathname,d);m.origin===b.origin&&B!=null?g=B+m.search+m.hash:p=!0}catch{}let v=fk(g,{relative:o}),f=Tk(g,{replace:s,state:a,target:l,preventScrollReset:c,relative:o});function A(b){i&&i(b),b.defaultPrevented||f(b)}return x.createElement("a",dG({},C,{href:h||v,onClick:p||r?i:A,ref:n,target:l}))});var M1;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher"})(M1||(M1={}));var H1;(function(t){t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(H1||(H1={}));function Tk(t,e){let{target:n,replace:i,state:o,preventScrollReset:r,relative:s}=e===void 0?{}:e,a=mk(),l=kd(),g=B5(t,{relative:s});return x.useCallback(c=>{if(Fk(c,n)){c.preventDefault();let C=i!==void 0?i:Wf(l)===Wf(g);a(t,{replace:C,state:o,preventScrollReset:r,relative:s})}},[l,a,g,i,o,n,t,r,s])}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Eg="155",Ol={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Ql={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},R5=0,hG=1,W5=2,_k=3,x5=0,wm=1,BC=2,Xr=3,Ca=0,Si=1,Fr=2,Uk=2,aa=0,pg=1,AG=2,pG=3,fG=4,V5=5,$l=100,X5=101,N5=102,mG=103,bG=104,Y5=200,M5=201,H5=202,F5=203,PZ=204,DZ=205,K5=206,z5=207,L5=208,E5=209,k5=210,T5=0,_5=1,U5=2,Xf=3,P5=4,D5=5,J5=6,O5=7,Td=0,Q5=1,j5=2,ys=0,q5=1,$5=2,eM=3,JZ=4,tM=5,Sm=300,Bs=301,Cl=302,wI=303,id=304,UI=306,od=1e3,ki=1001,rd=1002,Qn=1003,Nf=1004,Pk=1004,ZC=1005,Dk=1005,bn=1006,OZ=1007,Jk=1007,dl=1008,Ok=1008,vs=1009,nM=1010,iM=1011,Rm=1012,QZ=1013,ia=1014,Zi=1015,Ti=1016,jZ=1017,qZ=1018,rl=1020,oM=1021,oo=1023,rM=1024,sM=1025,sl=1026,xg=1027,$Z=1028,e2=1029,aM=1030,t2=1031,n2=1033,Ep=33776,kp=33777,Tp=33778,_p=33779,yG=35840,vG=35841,GG=35842,BG=35843,lM=36196,ZG=37492,wG=37496,SG=37808,RG=37809,WG=37810,xG=37811,VG=37812,XG=37813,NG=37814,YG=37815,MG=37816,HG=37817,FG=37818,KG=37819,zG=37820,LG=37821,Up=36492,gM=36283,EG=36284,kG=36285,TG=36286,cM=2200,IM=2201,uM=2202,sd=2300,ad=2301,Pp=2302,ag=2400,lg=2401,ld=2402,Wm=2500,i2=2501,Qk=0,jk=1,qk=2,o2=3e3,al=3001,CM=3200,dM=3201,Gl=0,hM=1,ll="",Kt="srgb",_r="srgb-linear",r2="display-p3",$k=0,Dp=7680,eT=7681,tT=7682,nT=7683,iT=34055,oT=34056,rT=5386,sT=512,aT=513,lT=514,gT=515,cT=516,IT=517,uT=518,AM=519,pM=512,fM=513,mM=514,bM=515,yM=516,vM=517,GM=518,BM=519,gd=35044,ZM=35048,CT=35040,dT=35045,hT=35049,AT=35041,pT=35046,fT=35050,mT=35042,bT="100",_G="300 es",Yf=1035,fs=2e3,cd=2001;class Rs{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(n)===-1&&i[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const o=this._listeners[e];if(o!==void 0){const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const o=i.slice(0);for(let r=0,s=o.length;r<s;r++)o[r].call(this,e);e.target=null}}}const Fi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let F1=1234567;const fg=Math.PI/180,SI=180/Math.PI;function ko(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Fi[t&255]+Fi[t>>8&255]+Fi[t>>16&255]+Fi[t>>24&255]+"-"+Fi[e&255]+Fi[e>>8&255]+"-"+Fi[e>>16&15|64]+Fi[e>>24&255]+"-"+Fi[n&63|128]+Fi[n>>8&255]+"-"+Fi[n>>16&255]+Fi[n>>24&255]+Fi[i&255]+Fi[i>>8&255]+Fi[i>>16&255]+Fi[i>>24&255]).toLowerCase()}function Un(t,e,n){return Math.max(e,Math.min(n,t))}function s2(t,e){return(t%e+e)%e}function yT(t,e,n,i,o){return i+(t-e)*(o-i)/(n-e)}function vT(t,e,n){return t!==e?(n-t)/(e-t):0}function wC(t,e,n){return(1-n)*t+n*e}function GT(t,e,n,i){return wC(t,e,1-Math.exp(-n*i))}function BT(t,e=1){return e-Math.abs(s2(t,e*2)-e)}function ZT(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function wT(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function ST(t,e){return t+Math.floor(Math.random()*(e-t+1))}function RT(t,e){return t+Math.random()*(e-t)}function WT(t){return t*(.5-Math.random())}function xT(t){t!==void 0&&(F1=t);let e=F1+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function VT(t){return t*fg}function XT(t){return t*SI}function UG(t){return(t&t-1)===0&&t!==0}function wM(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Mf(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function NT(t,e,n,i,o){const r=Math.cos,s=Math.sin,a=r(n/2),l=s(n/2),g=r((e+i)/2),c=s((e+i)/2),C=r((e-i)/2),d=s((e-i)/2),h=r((i-e)/2),p=s((i-e)/2);switch(o){case"XYX":t.set(a*c,l*C,l*d,a*g);break;case"YZY":t.set(l*d,a*c,l*C,a*g);break;case"ZXZ":t.set(l*C,l*d,a*c,a*g);break;case"XZX":t.set(a*c,l*p,l*h,a*g);break;case"YXY":t.set(l*h,a*c,l*p,a*g);break;case"ZYZ":t.set(l*p,l*h,a*c,a*g);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}function Bo(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function zt(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const SM={DEG2RAD:fg,RAD2DEG:SI,generateUUID:ko,clamp:Un,euclideanModulo:s2,mapLinear:yT,inverseLerp:vT,lerp:wC,damp:GT,pingpong:BT,smoothstep:ZT,smootherstep:wT,randInt:ST,randFloat:RT,randFloatSpread:WT,seededRandom:xT,degToRad:VT,radToDeg:XT,isPowerOfTwo:UG,ceilPowerOfTwo:wM,floorPowerOfTwo:Mf,setQuaternionFromProperEuler:NT,normalize:zt,denormalize:Bo};class We{constructor(e=0,n=0){We.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,i=this.y,o=e.elements;return this.x=o[0]*n+o[3]*i+o[6],this.y=o[1]*n+o[4]*i+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos(Un(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y;return n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const i=Math.cos(n),o=Math.sin(n),r=this.x-e.x,s=this.y-e.y;return this.x=r*i-s*o+e.x,this.y=r*o+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Tt{constructor(e,n,i,o,r,s,a,l,g){Tt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,i,o,r,s,a,l,g)}set(e,n,i,o,r,s,a,l,g){const c=this.elements;return c[0]=e,c[1]=o,c[2]=a,c[3]=n,c[4]=r,c[5]=l,c[6]=i,c[7]=s,c[8]=g,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],this}extractBasis(e,n,i){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,o=n.elements,r=this.elements,s=i[0],a=i[3],l=i[6],g=i[1],c=i[4],C=i[7],d=i[2],h=i[5],p=i[8],v=o[0],f=o[3],A=o[6],b=o[1],m=o[4],B=o[7],Z=o[2],w=o[5],W=o[8];return r[0]=s*v+a*b+l*Z,r[3]=s*f+a*m+l*w,r[6]=s*A+a*B+l*W,r[1]=g*v+c*b+C*Z,r[4]=g*f+c*m+C*w,r[7]=g*A+c*B+C*W,r[2]=d*v+h*b+p*Z,r[5]=d*f+h*m+p*w,r[8]=d*A+h*B+p*W,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=e[6],g=e[7],c=e[8];return n*s*c-n*a*g-i*r*c+i*a*l+o*r*g-o*s*l}invert(){const e=this.elements,n=e[0],i=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=e[6],g=e[7],c=e[8],C=c*s-a*g,d=a*l-c*r,h=g*r-s*l,p=n*C+i*d+o*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/p;return e[0]=C*v,e[1]=(o*g-c*i)*v,e[2]=(a*i-o*s)*v,e[3]=d*v,e[4]=(c*n-o*l)*v,e[5]=(o*r-a*n)*v,e[6]=h*v,e[7]=(i*l-g*n)*v,e[8]=(s*n-i*r)*v,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,i,o,r,s,a){const l=Math.cos(r),g=Math.sin(r);return this.set(i*l,i*g,-i*(l*s+g*a)+s+e,-o*g,o*l,-o*(-g*s+l*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(ty.makeScale(e,n)),this}rotate(e){return this.premultiply(ty.makeRotation(-e)),this}translate(e,n){return this.premultiply(ty.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,i,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,i=e.elements;for(let o=0;o<9;o++)if(n[o]!==i[o])return!1;return!0}fromArray(e,n=0){for(let i=0;i<9;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const ty=new Tt;function RM(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const YT={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function qc(t,e){return new YT[t](e)}function Id(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}const K1={};function SC(t){t in K1||(K1[t]=!0,console.warn(t))}function II(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function ny(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const MT=new Tt().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),HT=new Tt().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function FT(t){return t.convertSRGBToLinear().applyMatrix3(HT)}function KT(t){return t.applyMatrix3(MT).convertLinearToSRGB()}const zT={[_r]:t=>t,[Kt]:t=>t.convertSRGBToLinear(),[r2]:FT},LT={[_r]:t=>t,[Kt]:t=>t.convertLinearToSRGB(),[r2]:KT},nr={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(t){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!t},get workingColorSpace(){return _r},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,n){if(this.enabled===!1||e===n||!e||!n)return t;const i=zT[e],o=LT[n];if(i===void 0||o===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${n}".`);return o(i(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}};let cc;class a2{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{cc===void 0&&(cc=Id("canvas")),cc.width=e.width,cc.height=e.height;const i=cc.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=cc}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=Id("canvas");n.width=e.width,n.height=e.height;const i=n.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const o=i.getImageData(0,0,e.width,e.height),r=o.data;for(let s=0;s<r.length;s++)r[s]=II(r[s]/255)*255;return i.putImageData(o,0,0),n}else if(e.data){const n=e.data.slice(0);for(let i=0;i<n.length;i++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[i]=Math.floor(II(n[i]/255)*255):n[i]=II(n[i]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let ET=0;class gg{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:ET++}),this.uuid=ko(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},o=this.data;if(o!==null){let r;if(Array.isArray(o)){r=[];for(let s=0,a=o.length;s<a;s++)o[s].isDataTexture?r.push(iy(o[s].image)):r.push(iy(o[s]))}else r=iy(o);i.url=r}return n||(e.images[this.uuid]=i),i}}function iy(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?a2.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let kT=0;class Xn extends Rs{constructor(e=Xn.DEFAULT_IMAGE,n=Xn.DEFAULT_MAPPING,i=ki,o=ki,r=bn,s=dl,a=oo,l=vs,g=Xn.DEFAULT_ANISOTROPY,c=ll){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:kT++}),this.uuid=ko(),this.name="",this.source=new gg(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=i,this.wrapT=o,this.magFilter=r,this.minFilter=s,this.anisotropy=g,this.format=a,this.internalFormat=null,this.type=l,this.offset=new We(0,0),this.repeat=new We(1,1),this.center=new We(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Tt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof c=="string"?this.colorSpace=c:(SC("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===al?Kt:ll),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),n||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Sm)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case od:e.x=e.x-Math.floor(e.x);break;case ki:e.x=e.x<0?0:1;break;case rd:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case od:e.y=e.y-Math.floor(e.y);break;case ki:e.y=e.y<0?0:1;break;case rd:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return SC("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Kt?al:o2}set encoding(e){SC("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===al?Kt:ll}}Xn.DEFAULT_IMAGE=null;Xn.DEFAULT_MAPPING=Sm;Xn.DEFAULT_ANISOTROPY=1;class cn{constructor(e=0,n=0,i=0,o=1){cn.prototype.isVector4=!0,this.x=e,this.y=n,this.z=i,this.w=o}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,i,o){return this.x=e,this.y=n,this.z=i,this.w=o,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,i=this.y,o=this.z,r=this.w,s=e.elements;return this.x=s[0]*n+s[4]*i+s[8]*o+s[12]*r,this.y=s[1]*n+s[5]*i+s[9]*o+s[13]*r,this.z=s[2]*n+s[6]*i+s[10]*o+s[14]*r,this.w=s[3]*n+s[7]*i+s[11]*o+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,i,o,r;const l=e.elements,g=l[0],c=l[4],C=l[8],d=l[1],h=l[5],p=l[9],v=l[2],f=l[6],A=l[10];if(Math.abs(c-d)<.01&&Math.abs(C-v)<.01&&Math.abs(p-f)<.01){if(Math.abs(c+d)<.1&&Math.abs(C+v)<.1&&Math.abs(p+f)<.1&&Math.abs(g+h+A-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const m=(g+1)/2,B=(h+1)/2,Z=(A+1)/2,w=(c+d)/4,W=(C+v)/4,X=(p+f)/4;return m>B&&m>Z?m<.01?(i=0,o=.707106781,r=.707106781):(i=Math.sqrt(m),o=w/i,r=W/i):B>Z?B<.01?(i=.707106781,o=0,r=.707106781):(o=Math.sqrt(B),i=w/o,r=X/o):Z<.01?(i=.707106781,o=.707106781,r=0):(r=Math.sqrt(Z),i=W/r,o=X/r),this.set(i,o,r,n),this}let b=Math.sqrt((f-p)*(f-p)+(C-v)*(C-v)+(d-c)*(d-c));return Math.abs(b)<.001&&(b=1),this.x=(f-p)/b,this.y=(C-v)/b,this.z=(d-c)/b,this.w=Math.acos((g+h+A-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this.w=Math.max(e.w,Math.min(n.w,this.w)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this.w=Math.max(e,Math.min(n,this.w)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this.w=e.w+(n.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class WM extends Rs{constructor(e=1,n=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=1,this.scissor=new cn(0,0,e,n),this.scissorTest=!1,this.viewport=new cn(0,0,e,n);const o={width:e,height:n,depth:1};i.encoding!==void 0&&(SC("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===al?Kt:ll),this.texture=new Xn(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:bn,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,n,i=1){(this.width!==e||this.height!==n||this.depth!==i)&&(this.width=e,this.height=n,this.depth=i,this.texture.image.width=e,this.texture.image.height=n,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const n=Object.assign({},e.texture.image);return this.texture.source=new gg(n),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ar extends WM{constructor(e=1,n=1,i={}){super(e,n,i),this.isWebGLRenderTarget=!0}}class xm extends Xn{constructor(e=null,n=1,i=1,o=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:i,depth:o},this.magFilter=Qn,this.minFilter=Qn,this.wrapR=ki,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class TT extends Ar{constructor(e=1,n=1,i=1){super(e,n),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new xm(null,e,n,i),this.texture.isRenderTargetTexture=!0}}class l2 extends Xn{constructor(e=null,n=1,i=1,o=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:i,depth:o},this.magFilter=Qn,this.minFilter=Qn,this.wrapR=ki,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class _T extends Ar{constructor(e=1,n=1,i=1){super(e,n),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new l2(null,e,n,i),this.texture.isRenderTargetTexture=!0}}class UT extends Ar{constructor(e=1,n=1,i=1,o={}){super(e,n,o),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=r.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,n,i=1){if(this.width!==e||this.height!==n||this.depth!==i){this.width=e,this.height=n,this.depth=i;for(let o=0,r=this.texture.length;o<r;o++)this.texture[o].image.width=e,this.texture[o].image.height=n,this.texture[o].image.depth=i;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let n=0,i=e.texture.length;n<i;n++)this.texture[n]=e.texture[n].clone(),this.texture[n].isRenderTargetTexture=!0;return this}}let yi=class{constructor(e=0,n=0,i=0,o=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=i,this._w=o}static slerpFlat(e,n,i,o,r,s,a){let l=i[o+0],g=i[o+1],c=i[o+2],C=i[o+3];const d=r[s+0],h=r[s+1],p=r[s+2],v=r[s+3];if(a===0){e[n+0]=l,e[n+1]=g,e[n+2]=c,e[n+3]=C;return}if(a===1){e[n+0]=d,e[n+1]=h,e[n+2]=p,e[n+3]=v;return}if(C!==v||l!==d||g!==h||c!==p){let f=1-a;const A=l*d+g*h+c*p+C*v,b=A>=0?1:-1,m=1-A*A;if(m>Number.EPSILON){const Z=Math.sqrt(m),w=Math.atan2(Z,A*b);f=Math.sin(f*w)/Z,a=Math.sin(a*w)/Z}const B=a*b;if(l=l*f+d*B,g=g*f+h*B,c=c*f+p*B,C=C*f+v*B,f===1-a){const Z=1/Math.sqrt(l*l+g*g+c*c+C*C);l*=Z,g*=Z,c*=Z,C*=Z}}e[n]=l,e[n+1]=g,e[n+2]=c,e[n+3]=C}static multiplyQuaternionsFlat(e,n,i,o,r,s){const a=i[o],l=i[o+1],g=i[o+2],c=i[o+3],C=r[s],d=r[s+1],h=r[s+2],p=r[s+3];return e[n]=a*p+c*C+l*h-g*d,e[n+1]=l*p+c*d+g*C-a*h,e[n+2]=g*p+c*h+a*d-l*C,e[n+3]=c*p-a*C-l*d-g*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,i,o){return this._x=e,this._y=n,this._z=i,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n){const i=e._x,o=e._y,r=e._z,s=e._order,a=Math.cos,l=Math.sin,g=a(i/2),c=a(o/2),C=a(r/2),d=l(i/2),h=l(o/2),p=l(r/2);switch(s){case"XYZ":this._x=d*c*C+g*h*p,this._y=g*h*C-d*c*p,this._z=g*c*p+d*h*C,this._w=g*c*C-d*h*p;break;case"YXZ":this._x=d*c*C+g*h*p,this._y=g*h*C-d*c*p,this._z=g*c*p-d*h*C,this._w=g*c*C+d*h*p;break;case"ZXY":this._x=d*c*C-g*h*p,this._y=g*h*C+d*c*p,this._z=g*c*p+d*h*C,this._w=g*c*C-d*h*p;break;case"ZYX":this._x=d*c*C-g*h*p,this._y=g*h*C+d*c*p,this._z=g*c*p-d*h*C,this._w=g*c*C+d*h*p;break;case"YZX":this._x=d*c*C+g*h*p,this._y=g*h*C+d*c*p,this._z=g*c*p-d*h*C,this._w=g*c*C-d*h*p;break;case"XZY":this._x=d*c*C-g*h*p,this._y=g*h*C-d*c*p,this._z=g*c*p+d*h*C,this._w=g*c*C+d*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return n!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const i=n/2,o=Math.sin(i);return this._x=e.x*o,this._y=e.y*o,this._z=e.z*o,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,i=n[0],o=n[4],r=n[8],s=n[1],a=n[5],l=n[9],g=n[2],c=n[6],C=n[10],d=i+a+C;if(d>0){const h=.5/Math.sqrt(d+1);this._w=.25/h,this._x=(c-l)*h,this._y=(r-g)*h,this._z=(s-o)*h}else if(i>a&&i>C){const h=2*Math.sqrt(1+i-a-C);this._w=(c-l)/h,this._x=.25*h,this._y=(o+s)/h,this._z=(r+g)/h}else if(a>C){const h=2*Math.sqrt(1+a-i-C);this._w=(r-g)/h,this._x=(o+s)/h,this._y=.25*h,this._z=(l+c)/h}else{const h=2*Math.sqrt(1+C-i-a);this._w=(s-o)/h,this._x=(r+g)/h,this._y=(l+c)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let i=e.dot(n)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Un(this.dot(e),-1,1)))}rotateTowards(e,n){const i=this.angleTo(e);if(i===0)return this;const o=Math.min(1,n/i);return this.slerp(e,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const i=e._x,o=e._y,r=e._z,s=e._w,a=n._x,l=n._y,g=n._z,c=n._w;return this._x=i*c+s*a+o*g-r*l,this._y=o*c+s*l+r*a-i*g,this._z=r*c+s*g+i*l-o*a,this._w=s*c-i*a-o*l-r*g,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const i=this._x,o=this._y,r=this._z,s=this._w;let a=s*e._w+i*e._x+o*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=o,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const h=1-n;return this._w=h*s+n*this._w,this._x=h*i+n*this._x,this._y=h*o+n*this._y,this._z=h*r+n*this._z,this.normalize(),this._onChangeCallback(),this}const g=Math.sqrt(l),c=Math.atan2(g,a),C=Math.sin((1-n)*c)/g,d=Math.sin(n*c)/g;return this._w=s*C+this._w*d,this._x=i*C+this._x*d,this._y=o*C+this._y*d,this._z=r*C+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,n,i){return this.copy(e).slerp(n,i)}random(){const e=Math.random(),n=Math.sqrt(1-e),i=Math.sqrt(e),o=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(n*Math.cos(o),i*Math.sin(r),i*Math.cos(r),n*Math.sin(o))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class E{constructor(e=0,n=0,i=0){E.prototype.isVector3=!0,this.x=e,this.y=n,this.z=i}set(e,n,i){return i===void 0&&(i=this.z),this.x=e,this.y=n,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(z1.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(z1.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,i=this.y,o=this.z,r=e.elements;return this.x=r[0]*n+r[3]*i+r[6]*o,this.y=r[1]*n+r[4]*i+r[7]*o,this.z=r[2]*n+r[5]*i+r[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,i=this.y,o=this.z,r=e.elements,s=1/(r[3]*n+r[7]*i+r[11]*o+r[15]);return this.x=(r[0]*n+r[4]*i+r[8]*o+r[12])*s,this.y=(r[1]*n+r[5]*i+r[9]*o+r[13])*s,this.z=(r[2]*n+r[6]*i+r[10]*o+r[14])*s,this}applyQuaternion(e){const n=this.x,i=this.y,o=this.z,r=e.x,s=e.y,a=e.z,l=e.w,g=l*n+s*o-a*i,c=l*i+a*n-r*o,C=l*o+r*i-s*n,d=-r*n-s*i-a*o;return this.x=g*l+d*-r+c*-a-C*-s,this.y=c*l+d*-s+C*-r-g*-a,this.z=C*l+d*-a+g*-s-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,i=this.y,o=this.z,r=e.elements;return this.x=r[0]*n+r[4]*i+r[8]*o,this.y=r[1]*n+r[5]*i+r[9]*o,this.z=r[2]*n+r[6]*i+r[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const i=e.x,o=e.y,r=e.z,s=n.x,a=n.y,l=n.z;return this.x=o*l-r*a,this.y=r*s-i*l,this.z=i*a-o*s,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const i=e.dot(this)/n;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return oy.copy(this).projectOnVector(e),this.sub(oy)}reflect(e){return this.sub(oy.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos(Un(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y,o=this.z-e.z;return n*n+i*i+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,i){const o=Math.sin(n)*e;return this.x=o*Math.sin(i),this.y=Math.cos(n)*e,this.z=o*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,i){return this.x=e*Math.sin(n),this.y=i,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),o=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=i,this.z=o,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,n=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(n),this.y=i*Math.sin(n),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const oy=new E,z1=new yi;class Ws{constructor(e=new E(1/0,1/0,1/0),n=new E(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n+=3)this.expandByPoint(Ls.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,i=e.count;n<i;n++)this.expandByPoint(Ls.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const i=Ls.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),Ic.copy(e.boundingBox),Ic.applyMatrix4(e.matrixWorld),this.union(Ic);else{const o=e.geometry;if(o!==void 0)if(n&&o.attributes!==void 0&&o.attributes.position!==void 0){const r=o.attributes.position;for(let s=0,a=r.count;s<a;s++)Ls.fromBufferAttribute(r,s).applyMatrix4(e.matrixWorld),this.expandByPoint(Ls)}else o.boundingBox===null&&o.computeBoundingBox(),Ic.copy(o.boundingBox),Ic.applyMatrix4(e.matrixWorld),this.union(Ic)}const i=e.children;for(let o=0,r=i.length;o<r;o++)this.expandByObject(i[o],n);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ls),Ls.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,i;return e.normal.x>0?(n=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),n<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Yu),GA.subVectors(this.max,Yu),uc.subVectors(e.a,Yu),Cc.subVectors(e.b,Yu),dc.subVectors(e.c,Yu),Va.subVectors(Cc,uc),Xa.subVectors(dc,Cc),Kl.subVectors(uc,dc);let n=[0,-Va.z,Va.y,0,-Xa.z,Xa.y,0,-Kl.z,Kl.y,Va.z,0,-Va.x,Xa.z,0,-Xa.x,Kl.z,0,-Kl.x,-Va.y,Va.x,0,-Xa.y,Xa.x,0,-Kl.y,Kl.x,0];return!ry(n,uc,Cc,dc,GA)||(n=[1,0,0,0,1,0,0,0,1],!ry(n,uc,Cc,dc,GA))?!1:(BA.crossVectors(Va,Xa),n=[BA.x,BA.y,BA.z],ry(n,uc,Cc,dc,GA))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ls).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ls).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(zs[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),zs[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),zs[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),zs[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),zs[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),zs[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),zs[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),zs[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(zs),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const zs=[new E,new E,new E,new E,new E,new E,new E,new E],Ls=new E,Ic=new Ws,uc=new E,Cc=new E,dc=new E,Va=new E,Xa=new E,Kl=new E,Yu=new E,GA=new E,BA=new E,zl=new E;function ry(t,e,n,i,o){for(let r=0,s=t.length-3;r<=s;r+=3){zl.fromArray(t,r);const a=o.x*Math.abs(zl.x)+o.y*Math.abs(zl.y)+o.z*Math.abs(zl.z),l=e.dot(zl),g=n.dot(zl),c=i.dot(zl);if(Math.max(-Math.max(l,g,c),Math.min(l,g,c))>a)return!1}return!0}const PT=new Ws,Mu=new E,sy=new E;class Dr{constructor(e=new E,n=-1){this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const i=this.center;n!==void 0?i.copy(n):PT.setFromPoints(e).getCenter(i);let o=0;for(let r=0,s=e.length;r<s;r++)o=Math.max(o,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(o),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const i=this.center.distanceToSquared(e);return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Mu.subVectors(e,this.center);const n=Mu.lengthSq();if(n>this.radius*this.radius){const i=Math.sqrt(n),o=(i-this.radius)*.5;this.center.addScaledVector(Mu,o/i),this.radius+=o}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(sy.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Mu.copy(e.center).add(sy)),this.expandByPoint(Mu.copy(e.center).sub(sy))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Es=new E,ay=new E,ZA=new E,Na=new E,ly=new E,wA=new E,gy=new E;let PI=class{constructor(e=new E,n=new E(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Es)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=Es.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(Es.copy(this.origin).addScaledVector(this.direction,n),Es.distanceToSquared(e))}distanceSqToSegment(e,n,i,o){ay.copy(e).add(n).multiplyScalar(.5),ZA.copy(n).sub(e).normalize(),Na.copy(this.origin).sub(ay);const r=e.distanceTo(n)*.5,s=-this.direction.dot(ZA),a=Na.dot(this.direction),l=-Na.dot(ZA),g=Na.lengthSq(),c=Math.abs(1-s*s);let C,d,h,p;if(c>0)if(C=s*l-a,d=s*a-l,p=r*c,C>=0)if(d>=-p)if(d<=p){const v=1/c;C*=v,d*=v,h=C*(C+s*d+2*a)+d*(s*C+d+2*l)+g}else d=r,C=Math.max(0,-(s*d+a)),h=-C*C+d*(d+2*l)+g;else d=-r,C=Math.max(0,-(s*d+a)),h=-C*C+d*(d+2*l)+g;else d<=-p?(C=Math.max(0,-(-s*r+a)),d=C>0?-r:Math.min(Math.max(-r,-l),r),h=-C*C+d*(d+2*l)+g):d<=p?(C=0,d=Math.min(Math.max(-r,-l),r),h=d*(d+2*l)+g):(C=Math.max(0,-(s*r+a)),d=C>0?r:Math.min(Math.max(-r,-l),r),h=-C*C+d*(d+2*l)+g);else d=s>0?-r:r,C=Math.max(0,-(s*d+a)),h=-C*C+d*(d+2*l)+g;return i&&i.copy(this.origin).addScaledVector(this.direction,C),o&&o.copy(ay).addScaledVector(ZA,d),h}intersectSphere(e,n){Es.subVectors(e.center,this.origin);const i=Es.dot(this.direction),o=Es.dot(Es)-i*i,r=e.radius*e.radius;if(o>r)return null;const s=Math.sqrt(r-o),a=i-s,l=i+s;return l<0?null:a<0?this.at(l,n):this.at(a,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/n;return i>=0?i:null}intersectPlane(e,n){const i=this.distanceToPlane(e);return i===null?null:this.at(i,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let i,o,r,s,a,l;const g=1/this.direction.x,c=1/this.direction.y,C=1/this.direction.z,d=this.origin;return g>=0?(i=(e.min.x-d.x)*g,o=(e.max.x-d.x)*g):(i=(e.max.x-d.x)*g,o=(e.min.x-d.x)*g),c>=0?(r=(e.min.y-d.y)*c,s=(e.max.y-d.y)*c):(r=(e.max.y-d.y)*c,s=(e.min.y-d.y)*c),i>s||r>o||((r>i||isNaN(i))&&(i=r),(s<o||isNaN(o))&&(o=s),C>=0?(a=(e.min.z-d.z)*C,l=(e.max.z-d.z)*C):(a=(e.max.z-d.z)*C,l=(e.min.z-d.z)*C),i>l||a>o)||((a>i||i!==i)&&(i=a),(l<o||o!==o)&&(o=l),o<0)?null:this.at(i>=0?i:o,n)}intersectsBox(e){return this.intersectBox(e,Es)!==null}intersectTriangle(e,n,i,o,r){ly.subVectors(n,e),wA.subVectors(i,e),gy.crossVectors(ly,wA);let s=this.direction.dot(gy),a;if(s>0){if(o)return null;a=1}else if(s<0)a=-1,s=-s;else return null;Na.subVectors(this.origin,e);const l=a*this.direction.dot(wA.crossVectors(Na,wA));if(l<0)return null;const g=a*this.direction.dot(ly.cross(Na));if(g<0||l+g>s)return null;const c=-a*Na.dot(gy);return c<0?null:this.at(c/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Wt{constructor(e,n,i,o,r,s,a,l,g,c,C,d,h,p,v,f){Wt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,i,o,r,s,a,l,g,c,C,d,h,p,v,f)}set(e,n,i,o,r,s,a,l,g,c,C,d,h,p,v,f){const A=this.elements;return A[0]=e,A[4]=n,A[8]=i,A[12]=o,A[1]=r,A[5]=s,A[9]=a,A[13]=l,A[2]=g,A[6]=c,A[10]=C,A[14]=d,A[3]=h,A[7]=p,A[11]=v,A[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Wt().fromArray(this.elements)}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this}copyPosition(e){const n=this.elements,i=e.elements;return n[12]=i[12],n[13]=i[13],n[14]=i[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,i){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,n,i){return this.set(e.x,n.x,i.x,0,e.y,n.y,i.y,0,e.z,n.z,i.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,i=e.elements,o=1/hc.setFromMatrixColumn(e,0).length(),r=1/hc.setFromMatrixColumn(e,1).length(),s=1/hc.setFromMatrixColumn(e,2).length();return n[0]=i[0]*o,n[1]=i[1]*o,n[2]=i[2]*o,n[3]=0,n[4]=i[4]*r,n[5]=i[5]*r,n[6]=i[6]*r,n[7]=0,n[8]=i[8]*s,n[9]=i[9]*s,n[10]=i[10]*s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,i=e.x,o=e.y,r=e.z,s=Math.cos(i),a=Math.sin(i),l=Math.cos(o),g=Math.sin(o),c=Math.cos(r),C=Math.sin(r);if(e.order==="XYZ"){const d=s*c,h=s*C,p=a*c,v=a*C;n[0]=l*c,n[4]=-l*C,n[8]=g,n[1]=h+p*g,n[5]=d-v*g,n[9]=-a*l,n[2]=v-d*g,n[6]=p+h*g,n[10]=s*l}else if(e.order==="YXZ"){const d=l*c,h=l*C,p=g*c,v=g*C;n[0]=d+v*a,n[4]=p*a-h,n[8]=s*g,n[1]=s*C,n[5]=s*c,n[9]=-a,n[2]=h*a-p,n[6]=v+d*a,n[10]=s*l}else if(e.order==="ZXY"){const d=l*c,h=l*C,p=g*c,v=g*C;n[0]=d-v*a,n[4]=-s*C,n[8]=p+h*a,n[1]=h+p*a,n[5]=s*c,n[9]=v-d*a,n[2]=-s*g,n[6]=a,n[10]=s*l}else if(e.order==="ZYX"){const d=s*c,h=s*C,p=a*c,v=a*C;n[0]=l*c,n[4]=p*g-h,n[8]=d*g+v,n[1]=l*C,n[5]=v*g+d,n[9]=h*g-p,n[2]=-g,n[6]=a*l,n[10]=s*l}else if(e.order==="YZX"){const d=s*l,h=s*g,p=a*l,v=a*g;n[0]=l*c,n[4]=v-d*C,n[8]=p*C+h,n[1]=C,n[5]=s*c,n[9]=-a*c,n[2]=-g*c,n[6]=h*C+p,n[10]=d-v*C}else if(e.order==="XZY"){const d=s*l,h=s*g,p=a*l,v=a*g;n[0]=l*c,n[4]=-C,n[8]=g*c,n[1]=d*C+v,n[5]=s*c,n[9]=h*C-p,n[2]=p*C-h,n[6]=a*c,n[10]=v*C+d}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(DT,e,JT)}lookAt(e,n,i){const o=this.elements;return Ho.subVectors(e,n),Ho.lengthSq()===0&&(Ho.z=1),Ho.normalize(),Ya.crossVectors(i,Ho),Ya.lengthSq()===0&&(Math.abs(i.z)===1?Ho.x+=1e-4:Ho.z+=1e-4,Ho.normalize(),Ya.crossVectors(i,Ho)),Ya.normalize(),SA.crossVectors(Ho,Ya),o[0]=Ya.x,o[4]=SA.x,o[8]=Ho.x,o[1]=Ya.y,o[5]=SA.y,o[9]=Ho.y,o[2]=Ya.z,o[6]=SA.z,o[10]=Ho.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,o=n.elements,r=this.elements,s=i[0],a=i[4],l=i[8],g=i[12],c=i[1],C=i[5],d=i[9],h=i[13],p=i[2],v=i[6],f=i[10],A=i[14],b=i[3],m=i[7],B=i[11],Z=i[15],w=o[0],W=o[4],X=o[8],V=o[12],Y=o[1],z=o[5],q=o[9],O=o[13],te=o[2],oe=o[6],re=o[10],se=o[14],H=o[3],D=o[7],T=o[11],J=o[15];return r[0]=s*w+a*Y+l*te+g*H,r[4]=s*W+a*z+l*oe+g*D,r[8]=s*X+a*q+l*re+g*T,r[12]=s*V+a*O+l*se+g*J,r[1]=c*w+C*Y+d*te+h*H,r[5]=c*W+C*z+d*oe+h*D,r[9]=c*X+C*q+d*re+h*T,r[13]=c*V+C*O+d*se+h*J,r[2]=p*w+v*Y+f*te+A*H,r[6]=p*W+v*z+f*oe+A*D,r[10]=p*X+v*q+f*re+A*T,r[14]=p*V+v*O+f*se+A*J,r[3]=b*w+m*Y+B*te+Z*H,r[7]=b*W+m*z+B*oe+Z*D,r[11]=b*X+m*q+B*re+Z*T,r[15]=b*V+m*O+B*se+Z*J,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[4],o=e[8],r=e[12],s=e[1],a=e[5],l=e[9],g=e[13],c=e[2],C=e[6],d=e[10],h=e[14],p=e[3],v=e[7],f=e[11],A=e[15];return p*(+r*l*C-o*g*C-r*a*d+i*g*d+o*a*h-i*l*h)+v*(+n*l*h-n*g*d+r*s*d-o*s*h+o*g*c-r*l*c)+f*(+n*g*C-n*a*h-r*s*C+i*s*h+r*a*c-i*g*c)+A*(-o*a*c-n*l*C+n*a*d+o*s*C-i*s*d+i*l*c)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,i){const o=this.elements;return e.isVector3?(o[12]=e.x,o[13]=e.y,o[14]=e.z):(o[12]=e,o[13]=n,o[14]=i),this}invert(){const e=this.elements,n=e[0],i=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=e[6],g=e[7],c=e[8],C=e[9],d=e[10],h=e[11],p=e[12],v=e[13],f=e[14],A=e[15],b=C*f*g-v*d*g+v*l*h-a*f*h-C*l*A+a*d*A,m=p*d*g-c*f*g-p*l*h+s*f*h+c*l*A-s*d*A,B=c*v*g-p*C*g+p*a*h-s*v*h-c*a*A+s*C*A,Z=p*C*l-c*v*l-p*a*d+s*v*d+c*a*f-s*C*f,w=n*b+i*m+o*B+r*Z;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const W=1/w;return e[0]=b*W,e[1]=(v*d*r-C*f*r-v*o*h+i*f*h+C*o*A-i*d*A)*W,e[2]=(a*f*r-v*l*r+v*o*g-i*f*g-a*o*A+i*l*A)*W,e[3]=(C*l*r-a*d*r-C*o*g+i*d*g+a*o*h-i*l*h)*W,e[4]=m*W,e[5]=(c*f*r-p*d*r+p*o*h-n*f*h-c*o*A+n*d*A)*W,e[6]=(p*l*r-s*f*r-p*o*g+n*f*g+s*o*A-n*l*A)*W,e[7]=(s*d*r-c*l*r+c*o*g-n*d*g-s*o*h+n*l*h)*W,e[8]=B*W,e[9]=(p*C*r-c*v*r-p*i*h+n*v*h+c*i*A-n*C*A)*W,e[10]=(s*v*r-p*a*r+p*i*g-n*v*g-s*i*A+n*a*A)*W,e[11]=(c*a*r-s*C*r-c*i*g+n*C*g+s*i*h-n*a*h)*W,e[12]=Z*W,e[13]=(c*v*o-p*C*o+p*i*d-n*v*d-c*i*f+n*C*f)*W,e[14]=(p*a*o-s*v*o-p*i*l+n*v*l+s*i*f-n*a*f)*W,e[15]=(s*C*o-c*a*o+c*i*l-n*C*l-s*i*d+n*a*d)*W,this}scale(e){const n=this.elements,i=e.x,o=e.y,r=e.z;return n[0]*=i,n[4]*=o,n[8]*=r,n[1]*=i,n[5]*=o,n[9]*=r,n[2]*=i,n[6]*=o,n[10]*=r,n[3]*=i,n[7]*=o,n[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],o=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,i,o))}makeTranslation(e,n,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,i,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,n,-i,0,0,i,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,0,i,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const i=Math.cos(n),o=Math.sin(n),r=1-i,s=e.x,a=e.y,l=e.z,g=r*s,c=r*a;return this.set(g*s+i,g*a-o*l,g*l+o*a,0,g*a+o*l,c*a+i,c*l-o*s,0,g*l-o*a,c*l+o*s,r*l*l+i,0,0,0,0,1),this}makeScale(e,n,i){return this.set(e,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,n,i,o,r,s){return this.set(1,i,r,0,e,1,s,0,n,o,1,0,0,0,0,1),this}compose(e,n,i){const o=this.elements,r=n._x,s=n._y,a=n._z,l=n._w,g=r+r,c=s+s,C=a+a,d=r*g,h=r*c,p=r*C,v=s*c,f=s*C,A=a*C,b=l*g,m=l*c,B=l*C,Z=i.x,w=i.y,W=i.z;return o[0]=(1-(v+A))*Z,o[1]=(h+B)*Z,o[2]=(p-m)*Z,o[3]=0,o[4]=(h-B)*w,o[5]=(1-(d+A))*w,o[6]=(f+b)*w,o[7]=0,o[8]=(p+m)*W,o[9]=(f-b)*W,o[10]=(1-(d+v))*W,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decompose(e,n,i){const o=this.elements;let r=hc.set(o[0],o[1],o[2]).length();const s=hc.set(o[4],o[5],o[6]).length(),a=hc.set(o[8],o[9],o[10]).length();this.determinant()<0&&(r=-r),e.x=o[12],e.y=o[13],e.z=o[14],Zr.copy(this);const g=1/r,c=1/s,C=1/a;return Zr.elements[0]*=g,Zr.elements[1]*=g,Zr.elements[2]*=g,Zr.elements[4]*=c,Zr.elements[5]*=c,Zr.elements[6]*=c,Zr.elements[8]*=C,Zr.elements[9]*=C,Zr.elements[10]*=C,n.setFromRotationMatrix(Zr),i.x=r,i.y=s,i.z=a,this}makePerspective(e,n,i,o,r,s,a=fs){const l=this.elements,g=2*r/(n-e),c=2*r/(i-o),C=(n+e)/(n-e),d=(i+o)/(i-o);let h,p;if(a===fs)h=-(s+r)/(s-r),p=-2*s*r/(s-r);else if(a===cd)h=-s/(s-r),p=-s*r/(s-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=g,l[4]=0,l[8]=C,l[12]=0,l[1]=0,l[5]=c,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=h,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,n,i,o,r,s,a=fs){const l=this.elements,g=1/(n-e),c=1/(i-o),C=1/(s-r),d=(n+e)*g,h=(i+o)*c;let p,v;if(a===fs)p=(s+r)*C,v=-2*C;else if(a===cd)p=r*C,v=-1*C;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*g,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*c,l[9]=0,l[13]=-h,l[2]=0,l[6]=0,l[10]=v,l[14]=-p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const n=this.elements,i=e.elements;for(let o=0;o<16;o++)if(n[o]!==i[o])return!1;return!0}fromArray(e,n=0){for(let i=0;i<16;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e[n+9]=i[9],e[n+10]=i[10],e[n+11]=i[11],e[n+12]=i[12],e[n+13]=i[13],e[n+14]=i[14],e[n+15]=i[15],e}}const hc=new E,Zr=new Wt,DT=new E(0,0,0),JT=new E(1,1,1),Ya=new E,SA=new E,Ho=new E,L1=new Wt,E1=new yi;class kg{constructor(e=0,n=0,i=0,o=kg.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=i,this._order=o}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,i,o=this._order){return this._x=e,this._y=n,this._z=i,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,i=!0){const o=e.elements,r=o[0],s=o[4],a=o[8],l=o[1],g=o[5],c=o[9],C=o[2],d=o[6],h=o[10];switch(n){case"XYZ":this._y=Math.asin(Un(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(d,g),this._z=0);break;case"YXZ":this._x=Math.asin(-Un(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(l,g)):(this._y=Math.atan2(-C,r),this._z=0);break;case"ZXY":this._x=Math.asin(Un(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-C,h),this._z=Math.atan2(-s,g)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Un(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-s,g));break;case"YZX":this._z=Math.asin(Un(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,g),this._y=Math.atan2(-C,r)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-Un(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,g),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,i){return L1.makeRotationFromQuaternion(e),this.setFromRotationMatrix(L1,n,i)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return E1.setFromEuler(this),this.setFromQuaternion(E1,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}kg.DEFAULT_ORDER="XYZ";class mg{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let OT=0;const k1=new E,Ac=new yi,ks=new Wt,RA=new E,Hu=new E,QT=new E,jT=new yi,T1=new E(1,0,0),_1=new E(0,1,0),U1=new E(0,0,1),qT={type:"added"},P1={type:"removed"};class Ot extends Rs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:OT++}),this.uuid=ko(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ot.DEFAULT_UP.clone();const e=new E,n=new kg,i=new yi,o=new E(1,1,1);function r(){i.setFromEuler(n,!1)}function s(){n.setFromQuaternion(i,void 0,!1)}n._onChange(r),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Wt},normalMatrix:{value:new Tt}}),this.matrix=new Wt,this.matrixWorld=new Wt,this.matrixAutoUpdate=Ot.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Ot.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new mg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return Ac.setFromAxisAngle(e,n),this.quaternion.multiply(Ac),this}rotateOnWorldAxis(e,n){return Ac.setFromAxisAngle(e,n),this.quaternion.premultiply(Ac),this}rotateX(e){return this.rotateOnAxis(T1,e)}rotateY(e){return this.rotateOnAxis(_1,e)}rotateZ(e){return this.rotateOnAxis(U1,e)}translateOnAxis(e,n){return k1.copy(e).applyQuaternion(this.quaternion),this.position.add(k1.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(T1,e)}translateY(e){return this.translateOnAxis(_1,e)}translateZ(e){return this.translateOnAxis(U1,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ks.copy(this.matrixWorld).invert())}lookAt(e,n,i){e.isVector3?RA.copy(e):RA.set(e,n,i);const o=this.parent;this.updateWorldMatrix(!0,!1),Hu.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ks.lookAt(Hu,RA,this.up):ks.lookAt(RA,Hu,this.up),this.quaternion.setFromRotationMatrix(ks),o&&(ks.extractRotation(o.matrixWorld),Ac.setFromRotationMatrix(ks),this.quaternion.premultiply(Ac.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(qT)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(P1)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const n=this.children[e];n.parent=null,n.dispatchEvent(P1)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ks.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ks.multiply(e.parent.matrixWorld)),e.applyMatrix4(ks),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let i=0,o=this.children.length;i<o;i++){const s=this.children[i].getObjectByProperty(e,n);if(s!==void 0)return s}}getObjectsByProperty(e,n){let i=[];this[e]===n&&i.push(this);for(let o=0,r=this.children.length;o<r;o++){const s=this.children[o].getObjectsByProperty(e,n);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Hu,e,QT),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Hu,jT,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let i=0,o=n.length;i<o;i++)n[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let i=0,o=n.length;i<o;i++)n[i].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let i=0,o=n.length;i<o;i++){const r=n[i];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,n){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n===!0){const o=this.children;for(let r=0,s=o.length;r<s;r++){const a=o[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const n=e===void 0||typeof e=="string",i={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const o={};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),o.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON()));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(o.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let g=0,c=l.length;g<c;g++){const C=l[g];r(e.shapes,C)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,g=this.material.length;l<g;l++)a.push(r(e.materials,this.material[l]));o.material=a}else o.material=r(e.materials,this.material);if(this.children.length>0){o.children=[];for(let a=0;a<this.children.length;a++)o.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){o.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];o.animations.push(r(e.animations,l))}}if(n){const a=s(e.geometries),l=s(e.materials),g=s(e.textures),c=s(e.images),C=s(e.shapes),d=s(e.skeletons),h=s(e.animations),p=s(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),g.length>0&&(i.textures=g),c.length>0&&(i.images=c),C.length>0&&(i.shapes=C),d.length>0&&(i.skeletons=d),h.length>0&&(i.animations=h),p.length>0&&(i.nodes=p)}return i.object=o,i;function s(a){const l=[];for(const g in a){const c=a[g];delete c.metadata,l.push(c)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let i=0;i<e.children.length;i++){const o=e.children[i];this.add(o.clone())}return this}}Ot.DEFAULT_UP=new E(0,1,0);Ot.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ot.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const wr=new E,Ts=new E,cy=new E,_s=new E,pc=new E,fc=new E,D1=new E,Iy=new E,uy=new E,Cy=new E;let WA=!1;class Go{constructor(e=new E,n=new E,i=new E){this.a=e,this.b=n,this.c=i}static getNormal(e,n,i,o){o.subVectors(i,n),wr.subVectors(e,n),o.cross(wr);const r=o.lengthSq();return r>0?o.multiplyScalar(1/Math.sqrt(r)):o.set(0,0,0)}static getBarycoord(e,n,i,o,r){wr.subVectors(o,n),Ts.subVectors(i,n),cy.subVectors(e,n);const s=wr.dot(wr),a=wr.dot(Ts),l=wr.dot(cy),g=Ts.dot(Ts),c=Ts.dot(cy),C=s*g-a*a;if(C===0)return r.set(-2,-1,-1);const d=1/C,h=(g*l-a*c)*d,p=(s*c-a*l)*d;return r.set(1-h-p,p,h)}static containsPoint(e,n,i,o){return this.getBarycoord(e,n,i,o,_s),_s.x>=0&&_s.y>=0&&_s.x+_s.y<=1}static getUV(e,n,i,o,r,s,a,l){return WA===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),WA=!0),this.getInterpolation(e,n,i,o,r,s,a,l)}static getInterpolation(e,n,i,o,r,s,a,l){return this.getBarycoord(e,n,i,o,_s),l.setScalar(0),l.addScaledVector(r,_s.x),l.addScaledVector(s,_s.y),l.addScaledVector(a,_s.z),l}static isFrontFacing(e,n,i,o){return wr.subVectors(i,n),Ts.subVectors(e,n),wr.cross(Ts).dot(o)<0}set(e,n,i){return this.a.copy(e),this.b.copy(n),this.c.copy(i),this}setFromPointsAndIndices(e,n,i,o){return this.a.copy(e[n]),this.b.copy(e[i]),this.c.copy(e[o]),this}setFromAttributeAndIndices(e,n,i,o){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,o),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return wr.subVectors(this.c,this.b),Ts.subVectors(this.a,this.b),wr.cross(Ts).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Go.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return Go.getBarycoord(e,this.a,this.b,this.c,n)}getUV(e,n,i,o,r){return WA===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),WA=!0),Go.getInterpolation(e,this.a,this.b,this.c,n,i,o,r)}getInterpolation(e,n,i,o,r){return Go.getInterpolation(e,this.a,this.b,this.c,n,i,o,r)}containsPoint(e){return Go.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Go.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const i=this.a,o=this.b,r=this.c;let s,a;pc.subVectors(o,i),fc.subVectors(r,i),Iy.subVectors(e,i);const l=pc.dot(Iy),g=fc.dot(Iy);if(l<=0&&g<=0)return n.copy(i);uy.subVectors(e,o);const c=pc.dot(uy),C=fc.dot(uy);if(c>=0&&C<=c)return n.copy(o);const d=l*C-c*g;if(d<=0&&l>=0&&c<=0)return s=l/(l-c),n.copy(i).addScaledVector(pc,s);Cy.subVectors(e,r);const h=pc.dot(Cy),p=fc.dot(Cy);if(p>=0&&h<=p)return n.copy(r);const v=h*g-l*p;if(v<=0&&g>=0&&p<=0)return a=g/(g-p),n.copy(i).addScaledVector(fc,a);const f=c*p-h*C;if(f<=0&&C-c>=0&&h-p>=0)return D1.subVectors(r,o),a=(C-c)/(C-c+(h-p)),n.copy(o).addScaledVector(D1,a);const A=1/(f+v+d);return s=v*A,a=d*A,n.copy(i).addScaledVector(pc,s).addScaledVector(fc,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let $T=0;class Wi extends Rs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:$T++}),this.uuid=ko(),this.name="",this.type="Material",this.blending=pg,this.side=Ca,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=PZ,this.blendDst=DZ,this.blendEquation=$l,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Xf,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AM,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Dp,this.stencilZFail=Dp,this.stencilZPass=Dp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const i=e[n];if(i===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const o=this[n];if(o===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}o&&o.isColor?o.set(i):o&&o.isVector3&&i&&i.isVector3?o.copy(i):this[n]=i}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==pg&&(i.blending=this.blending),this.side!==Ca&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=this.alphaHash),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function o(r){const s=[];for(const a in r){const l=r[a];delete l.metadata,s.push(l)}return s}if(n){const r=o(e.textures),s=o(e.images);r.length>0&&(i.textures=r),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let i=null;if(n!==null){const o=n.length;i=new Array(o);for(let r=0;r!==o;++r)i[r]=n[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}const xM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Sr={h:0,s:0,l:0},xA={h:0,s:0,l:0};function dy(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}let je=class{constructor(e,n,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,i)}set(e,n,i){if(n===void 0&&i===void 0){const o=e;o&&o.isColor?this.copy(o):typeof o=="number"?this.setHex(o):typeof o=="string"&&this.setStyle(o)}else this.setRGB(e,n,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Kt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,nr.toWorkingColorSpace(this,n),this}setRGB(e,n,i,o=nr.workingColorSpace){return this.r=e,this.g=n,this.b=i,nr.toWorkingColorSpace(this,o),this}setHSL(e,n,i,o=nr.workingColorSpace){if(e=s2(e,1),n=Un(n,0,1),i=Un(i,0,1),n===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+n):i+n-i*n,s=2*i-r;this.r=dy(s,r,e+1/3),this.g=dy(s,r,e),this.b=dy(s,r,e-1/3)}return nr.toWorkingColorSpace(this,o),this}setStyle(e,n=Kt){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let o;if(o=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const s=o[1],a=o[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,n);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,n);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=o[1],s=r.length;if(s===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,n);if(s===6)return this.setHex(parseInt(r,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Kt){const i=xM[e.toLowerCase()];return i!==void 0?this.setHex(i,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=II(e.r),this.g=II(e.g),this.b=II(e.b),this}copyLinearToSRGB(e){return this.r=ny(e.r),this.g=ny(e.g),this.b=ny(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Kt){return nr.fromWorkingColorSpace(Ki.copy(this),e),Math.round(Un(Ki.r*255,0,255))*65536+Math.round(Un(Ki.g*255,0,255))*256+Math.round(Un(Ki.b*255,0,255))}getHexString(e=Kt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=nr.workingColorSpace){nr.fromWorkingColorSpace(Ki.copy(this),n);const i=Ki.r,o=Ki.g,r=Ki.b,s=Math.max(i,o,r),a=Math.min(i,o,r);let l,g;const c=(a+s)/2;if(a===s)l=0,g=0;else{const C=s-a;switch(g=c<=.5?C/(s+a):C/(2-s-a),s){case i:l=(o-r)/C+(o<r?6:0);break;case o:l=(r-i)/C+2;break;case r:l=(i-o)/C+4;break}l/=6}return e.h=l,e.s=g,e.l=c,e}getRGB(e,n=nr.workingColorSpace){return nr.fromWorkingColorSpace(Ki.copy(this),n),e.r=Ki.r,e.g=Ki.g,e.b=Ki.b,e}getStyle(e=Kt){nr.fromWorkingColorSpace(Ki.copy(this),e);const n=Ki.r,i=Ki.g,o=Ki.b;return e!==Kt?`color(${e} ${n.toFixed(3)} ${i.toFixed(3)} ${o.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(i*255)},${Math.round(o*255)})`}offsetHSL(e,n,i){return this.getHSL(Sr),Sr.h+=e,Sr.s+=n,Sr.l+=i,this.setHSL(Sr.h,Sr.s,Sr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,i){return this.r=e.r+(n.r-e.r)*i,this.g=e.g+(n.g-e.g)*i,this.b=e.b+(n.b-e.b)*i,this}lerpHSL(e,n){this.getHSL(Sr),e.getHSL(xA);const i=wC(Sr.h,xA.h,n),o=wC(Sr.s,xA.s,n),r=wC(Sr.l,xA.l,n);return this.setHSL(i,o,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,i=this.g,o=this.b,r=e.elements;return this.r=r[0]*n+r[3]*i+r[6]*o,this.g=r[1]*n+r[4]*i+r[7]*o,this.b=r[2]*n+r[5]*i+r[8]*o,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Ki=new je;je.NAMES=xM;class Bl extends Wi{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new je(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Td,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const $s=e_();function e_(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),i=new Uint32Array(512),o=new Uint32Array(512);for(let l=0;l<256;++l){const g=l-127;g<-27?(i[l]=0,i[l|256]=32768,o[l]=24,o[l|256]=24):g<-14?(i[l]=1024>>-g-14,i[l|256]=1024>>-g-14|32768,o[l]=-g-1,o[l|256]=-g-1):g<=15?(i[l]=g+15<<10,i[l|256]=g+15<<10|32768,o[l]=13,o[l|256]=13):g<128?(i[l]=31744,i[l|256]=64512,o[l]=24,o[l|256]=24):(i[l]=31744,i[l|256]=64512,o[l]=13,o[l|256]=13)}const r=new Uint32Array(2048),s=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let g=l<<13,c=0;for(;!(g&8388608);)g<<=1,c-=8388608;g&=-8388609,c+=947912704,r[l]=g|c}for(let l=1024;l<2048;++l)r[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)s[l]=l<<23;s[31]=1199570944,s[32]=2147483648;for(let l=33;l<63;++l)s[l]=2147483648+(l-32<<23);s[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:n,baseTable:i,shiftTable:o,mantissaTable:r,exponentTable:s,offsetTable:a}}function fo(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Un(t,-65504,65504),$s.floatView[0]=t;const e=$s.uint32View[0],n=e>>23&511;return $s.baseTable[n]+((e&8388607)>>$s.shiftTable[n])}function gC(t){const e=t>>10;return $s.uint32View[0]=$s.mantissaTable[$s.offsetTable[e]+(t&1023)]+$s.exponentTable[e],$s.floatView[0]}const cg={toHalfFloat:fo,fromHalfFloat:gC},ti=new E,VA=new We;class un{constructor(e,n,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=i,this.usage=gd,this.updateRange={offset:0,count:-1},this.gpuType=Zi,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,i){e*=this.itemSize,i*=n.itemSize;for(let o=0,r=this.itemSize;o<r;o++)this.array[e+o]=n.array[i+o];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,i=this.count;n<i;n++)VA.fromBufferAttribute(this,n),VA.applyMatrix3(e),this.setXY(n,VA.x,VA.y);else if(this.itemSize===3)for(let n=0,i=this.count;n<i;n++)ti.fromBufferAttribute(this,n),ti.applyMatrix3(e),this.setXYZ(n,ti.x,ti.y,ti.z);return this}applyMatrix4(e){for(let n=0,i=this.count;n<i;n++)ti.fromBufferAttribute(this,n),ti.applyMatrix4(e),this.setXYZ(n,ti.x,ti.y,ti.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)ti.fromBufferAttribute(this,n),ti.applyNormalMatrix(e),this.setXYZ(n,ti.x,ti.y,ti.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)ti.fromBufferAttribute(this,n),ti.transformDirection(e),this.setXYZ(n,ti.x,ti.y,ti.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let i=this.array[e*this.itemSize+n];return this.normalized&&(i=Bo(i,this.array)),i}setComponent(e,n,i){return this.normalized&&(i=zt(i,this.array)),this.array[e*this.itemSize+n]=i,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=Bo(n,this.array)),n}setX(e,n){return this.normalized&&(n=zt(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=Bo(n,this.array)),n}setY(e,n){return this.normalized&&(n=zt(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=Bo(n,this.array)),n}setZ(e,n){return this.normalized&&(n=zt(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=Bo(n,this.array)),n}setW(e,n){return this.normalized&&(n=zt(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,i){return e*=this.itemSize,this.normalized&&(n=zt(n,this.array),i=zt(i,this.array)),this.array[e+0]=n,this.array[e+1]=i,this}setXYZ(e,n,i,o){return e*=this.itemSize,this.normalized&&(n=zt(n,this.array),i=zt(i,this.array),o=zt(o,this.array)),this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=o,this}setXYZW(e,n,i,o,r){return e*=this.itemSize,this.normalized&&(n=zt(n,this.array),i=zt(i,this.array),o=zt(o,this.array),r=zt(r,this.array)),this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=o,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==gd&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}class t_ extends un{constructor(e,n,i){super(new Int8Array(e),n,i)}}class n_ extends un{constructor(e,n,i){super(new Uint8Array(e),n,i)}}class i_ extends un{constructor(e,n,i){super(new Uint8ClampedArray(e),n,i)}}class o_ extends un{constructor(e,n,i){super(new Int16Array(e),n,i)}}class g2 extends un{constructor(e,n,i){super(new Uint16Array(e),n,i)}}class r_ extends un{constructor(e,n,i){super(new Int32Array(e),n,i)}}class c2 extends un{constructor(e,n,i){super(new Uint32Array(e),n,i)}}class s_ extends un{constructor(e,n,i){super(new Uint16Array(e),n,i),this.isFloat16BufferAttribute=!0}getX(e){let n=gC(this.array[e*this.itemSize]);return this.normalized&&(n=Bo(n,this.array)),n}setX(e,n){return this.normalized&&(n=zt(n,this.array)),this.array[e*this.itemSize]=fo(n),this}getY(e){let n=gC(this.array[e*this.itemSize+1]);return this.normalized&&(n=Bo(n,this.array)),n}setY(e,n){return this.normalized&&(n=zt(n,this.array)),this.array[e*this.itemSize+1]=fo(n),this}getZ(e){let n=gC(this.array[e*this.itemSize+2]);return this.normalized&&(n=Bo(n,this.array)),n}setZ(e,n){return this.normalized&&(n=zt(n,this.array)),this.array[e*this.itemSize+2]=fo(n),this}getW(e){let n=gC(this.array[e*this.itemSize+3]);return this.normalized&&(n=Bo(n,this.array)),n}setW(e,n){return this.normalized&&(n=zt(n,this.array)),this.array[e*this.itemSize+3]=fo(n),this}setXY(e,n,i){return e*=this.itemSize,this.normalized&&(n=zt(n,this.array),i=zt(i,this.array)),this.array[e+0]=fo(n),this.array[e+1]=fo(i),this}setXYZ(e,n,i,o){return e*=this.itemSize,this.normalized&&(n=zt(n,this.array),i=zt(i,this.array),o=zt(o,this.array)),this.array[e+0]=fo(n),this.array[e+1]=fo(i),this.array[e+2]=fo(o),this}setXYZW(e,n,i,o,r){return e*=this.itemSize,this.normalized&&(n=zt(n,this.array),i=zt(i,this.array),o=zt(o,this.array),r=zt(r,this.array)),this.array[e+0]=fo(n),this.array[e+1]=fo(i),this.array[e+2]=fo(o),this.array[e+3]=fo(r),this}}class Ct extends un{constructor(e,n,i){super(new Float32Array(e),n,i)}}class a_ extends un{constructor(e,n,i){super(new Float64Array(e),n,i)}}let l_=0;const tr=new Wt,hy=new Ot,mc=new E,Fo=new Ws,Fu=new Ws,Ai=new E;class _t extends Rs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:l_++}),this.uuid=ko(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(RM(e)?c2:g2)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,i=0){this.groups.push({start:e,count:n,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new Tt().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const o=this.attributes.tangent;return o!==void 0&&(o.transformDirection(e),o.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return tr.makeRotationFromQuaternion(e),this.applyMatrix4(tr),this}rotateX(e){return tr.makeRotationX(e),this.applyMatrix4(tr),this}rotateY(e){return tr.makeRotationY(e),this.applyMatrix4(tr),this}rotateZ(e){return tr.makeRotationZ(e),this.applyMatrix4(tr),this}translate(e,n,i){return tr.makeTranslation(e,n,i),this.applyMatrix4(tr),this}scale(e,n,i){return tr.makeScale(e,n,i),this.applyMatrix4(tr),this}lookAt(e){return hy.lookAt(e),hy.updateMatrix(),this.applyMatrix4(hy.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(mc).negate(),this.translate(mc.x,mc.y,mc.z),this}setFromPoints(e){const n=[];for(let i=0,o=e.length;i<o;i++){const r=e[i];n.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Ct(n,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ws);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new E(-1/0,-1/0,-1/0),new E(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let i=0,o=n.length;i<o;i++){const r=n[i];Fo.setFromBufferAttribute(r),this.morphTargetsRelative?(Ai.addVectors(this.boundingBox.min,Fo.min),this.boundingBox.expandByPoint(Ai),Ai.addVectors(this.boundingBox.max,Fo.max),this.boundingBox.expandByPoint(Ai)):(this.boundingBox.expandByPoint(Fo.min),this.boundingBox.expandByPoint(Fo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Dr);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new E,1/0);return}if(e){const i=this.boundingSphere.center;if(Fo.setFromBufferAttribute(e),n)for(let r=0,s=n.length;r<s;r++){const a=n[r];Fu.setFromBufferAttribute(a),this.morphTargetsRelative?(Ai.addVectors(Fo.min,Fu.min),Fo.expandByPoint(Ai),Ai.addVectors(Fo.max,Fu.max),Fo.expandByPoint(Ai)):(Fo.expandByPoint(Fu.min),Fo.expandByPoint(Fu.max))}Fo.getCenter(i);let o=0;for(let r=0,s=e.count;r<s;r++)Ai.fromBufferAttribute(e,r),o=Math.max(o,i.distanceToSquared(Ai));if(n)for(let r=0,s=n.length;r<s;r++){const a=n[r],l=this.morphTargetsRelative;for(let g=0,c=a.count;g<c;g++)Ai.fromBufferAttribute(a,g),l&&(mc.fromBufferAttribute(e,g),Ai.add(mc)),o=Math.max(o,i.distanceToSquared(Ai))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,o=n.position.array,r=n.normal.array,s=n.uv.array,a=o.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new un(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,g=[],c=[];for(let Y=0;Y<a;Y++)g[Y]=new E,c[Y]=new E;const C=new E,d=new E,h=new E,p=new We,v=new We,f=new We,A=new E,b=new E;function m(Y,z,q){C.fromArray(o,Y*3),d.fromArray(o,z*3),h.fromArray(o,q*3),p.fromArray(s,Y*2),v.fromArray(s,z*2),f.fromArray(s,q*2),d.sub(C),h.sub(C),v.sub(p),f.sub(p);const O=1/(v.x*f.y-f.x*v.y);isFinite(O)&&(A.copy(d).multiplyScalar(f.y).addScaledVector(h,-v.y).multiplyScalar(O),b.copy(h).multiplyScalar(v.x).addScaledVector(d,-f.x).multiplyScalar(O),g[Y].add(A),g[z].add(A),g[q].add(A),c[Y].add(b),c[z].add(b),c[q].add(b))}let B=this.groups;B.length===0&&(B=[{start:0,count:i.length}]);for(let Y=0,z=B.length;Y<z;++Y){const q=B[Y],O=q.start,te=q.count;for(let oe=O,re=O+te;oe<re;oe+=3)m(i[oe+0],i[oe+1],i[oe+2])}const Z=new E,w=new E,W=new E,X=new E;function V(Y){W.fromArray(r,Y*3),X.copy(W);const z=g[Y];Z.copy(z),Z.sub(W.multiplyScalar(W.dot(z))).normalize(),w.crossVectors(X,z);const O=w.dot(c[Y])<0?-1:1;l[Y*4]=Z.x,l[Y*4+1]=Z.y,l[Y*4+2]=Z.z,l[Y*4+3]=O}for(let Y=0,z=B.length;Y<z;++Y){const q=B[Y],O=q.start,te=q.count;for(let oe=O,re=O+te;oe<re;oe+=3)V(i[oe+0]),V(i[oe+1]),V(i[oe+2])}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new un(new Float32Array(n.count*3),3),this.setAttribute("normal",i);else for(let d=0,h=i.count;d<h;d++)i.setXYZ(d,0,0,0);const o=new E,r=new E,s=new E,a=new E,l=new E,g=new E,c=new E,C=new E;if(e)for(let d=0,h=e.count;d<h;d+=3){const p=e.getX(d+0),v=e.getX(d+1),f=e.getX(d+2);o.fromBufferAttribute(n,p),r.fromBufferAttribute(n,v),s.fromBufferAttribute(n,f),c.subVectors(s,r),C.subVectors(o,r),c.cross(C),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,v),g.fromBufferAttribute(i,f),a.add(c),l.add(c),g.add(c),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(v,l.x,l.y,l.z),i.setXYZ(f,g.x,g.y,g.z)}else for(let d=0,h=n.count;d<h;d+=3)o.fromBufferAttribute(n,d+0),r.fromBufferAttribute(n,d+1),s.fromBufferAttribute(n,d+2),c.subVectors(s,r),C.subVectors(o,r),c.cross(C),i.setXYZ(d+0,c.x,c.y,c.z),i.setXYZ(d+1,c.x,c.y,c.z),i.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,i=e.count;n<i;n++)Ai.fromBufferAttribute(e,n),Ai.normalize(),e.setXYZ(n,Ai.x,Ai.y,Ai.z)}toNonIndexed(){function e(a,l){const g=a.array,c=a.itemSize,C=a.normalized,d=new g.constructor(l.length*c);let h=0,p=0;for(let v=0,f=l.length;v<f;v++){a.isInterleavedBufferAttribute?h=l[v]*a.data.stride+a.offset:h=l[v]*c;for(let A=0;A<c;A++)d[p++]=g[h++]}return new un(d,c,C)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new _t,i=this.index.array,o=this.attributes;for(const a in o){const l=o[a],g=e(l,i);n.setAttribute(a,g)}const r=this.morphAttributes;for(const a in r){const l=[],g=r[a];for(let c=0,C=g.length;c<C;c++){const d=g[c],h=e(d,i);l.push(h)}n.morphAttributes[a]=l}n.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let a=0,l=s.length;a<l;a++){const g=s[a];n.addGroup(g.start,g.count,g.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const g in l)l[g]!==void 0&&(e[g]=l[g]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const i=this.attributes;for(const l in i){const g=i[l];e.data.attributes[l]=g.toJSON(e.data)}const o={};let r=!1;for(const l in this.morphAttributes){const g=this.morphAttributes[l],c=[];for(let C=0,d=g.length;C<d;C++){const h=g[C];c.push(h.toJSON(e.data))}c.length>0&&(o[l]=c,r=!0)}r&&(e.data.morphAttributes=o,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(n));const o=e.attributes;for(const g in o){const c=o[g];this.setAttribute(g,c.clone(n))}const r=e.morphAttributes;for(const g in r){const c=[],C=r[g];for(let d=0,h=C.length;d<h;d++)c.push(C[d].clone(n));this.morphAttributes[g]=c}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let g=0,c=s.length;g<c;g++){const C=s[g];this.addGroup(C.start,C.count,C.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const J1=new Wt,Ll=new PI,XA=new Dr,O1=new E,bc=new E,yc=new E,vc=new E,Ay=new E,NA=new E,YA=new We,MA=new We,HA=new We,Q1=new E,j1=new E,q1=new E,FA=new E,KA=new E;class ci extends Ot{constructor(e=new _t,n=new Bl){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const o=n[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=o.length;r<s;r++){const a=o[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,n){const i=this.geometry,o=i.attributes.position,r=i.morphAttributes.position,s=i.morphTargetsRelative;n.fromBufferAttribute(o,e);const a=this.morphTargetInfluences;if(r&&a){NA.set(0,0,0);for(let l=0,g=r.length;l<g;l++){const c=a[l],C=r[l];c!==0&&(Ay.fromBufferAttribute(C,e),s?NA.addScaledVector(Ay,c):NA.addScaledVector(Ay.sub(n),c))}n.add(NA)}return n}raycast(e,n){const i=this.geometry,o=this.material,r=this.matrixWorld;o!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),XA.copy(i.boundingSphere),XA.applyMatrix4(r),Ll.copy(e.ray).recast(e.near),!(XA.containsPoint(Ll.origin)===!1&&(Ll.intersectSphere(XA,O1)===null||Ll.origin.distanceToSquared(O1)>(e.far-e.near)**2))&&(J1.copy(r).invert(),Ll.copy(e.ray).applyMatrix4(J1),!(i.boundingBox!==null&&Ll.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,n,Ll)))}_computeIntersections(e,n,i){let o;const r=this.geometry,s=this.material,a=r.index,l=r.attributes.position,g=r.attributes.uv,c=r.attributes.uv1,C=r.attributes.normal,d=r.groups,h=r.drawRange;if(a!==null)if(Array.isArray(s))for(let p=0,v=d.length;p<v;p++){const f=d[p],A=s[f.materialIndex],b=Math.max(f.start,h.start),m=Math.min(a.count,Math.min(f.start+f.count,h.start+h.count));for(let B=b,Z=m;B<Z;B+=3){const w=a.getX(B),W=a.getX(B+1),X=a.getX(B+2);o=zA(this,A,e,i,g,c,C,w,W,X),o&&(o.faceIndex=Math.floor(B/3),o.face.materialIndex=f.materialIndex,n.push(o))}}else{const p=Math.max(0,h.start),v=Math.min(a.count,h.start+h.count);for(let f=p,A=v;f<A;f+=3){const b=a.getX(f),m=a.getX(f+1),B=a.getX(f+2);o=zA(this,s,e,i,g,c,C,b,m,B),o&&(o.faceIndex=Math.floor(f/3),n.push(o))}}else if(l!==void 0)if(Array.isArray(s))for(let p=0,v=d.length;p<v;p++){const f=d[p],A=s[f.materialIndex],b=Math.max(f.start,h.start),m=Math.min(l.count,Math.min(f.start+f.count,h.start+h.count));for(let B=b,Z=m;B<Z;B+=3){const w=B,W=B+1,X=B+2;o=zA(this,A,e,i,g,c,C,w,W,X),o&&(o.faceIndex=Math.floor(B/3),o.face.materialIndex=f.materialIndex,n.push(o))}}else{const p=Math.max(0,h.start),v=Math.min(l.count,h.start+h.count);for(let f=p,A=v;f<A;f+=3){const b=f,m=f+1,B=f+2;o=zA(this,s,e,i,g,c,C,b,m,B),o&&(o.faceIndex=Math.floor(f/3),n.push(o))}}}}function g_(t,e,n,i,o,r,s,a){let l;if(e.side===Si?l=i.intersectTriangle(s,r,o,!0,a):l=i.intersectTriangle(o,r,s,e.side===Ca,a),l===null)return null;KA.copy(a),KA.applyMatrix4(t.matrixWorld);const g=n.ray.origin.distanceTo(KA);return g<n.near||g>n.far?null:{distance:g,point:KA.clone(),object:t}}function zA(t,e,n,i,o,r,s,a,l,g){t.getVertexPosition(a,bc),t.getVertexPosition(l,yc),t.getVertexPosition(g,vc);const c=g_(t,e,n,i,bc,yc,vc,FA);if(c){o&&(YA.fromBufferAttribute(o,a),MA.fromBufferAttribute(o,l),HA.fromBufferAttribute(o,g),c.uv=Go.getInterpolation(FA,bc,yc,vc,YA,MA,HA,new We)),r&&(YA.fromBufferAttribute(r,a),MA.fromBufferAttribute(r,l),HA.fromBufferAttribute(r,g),c.uv1=Go.getInterpolation(FA,bc,yc,vc,YA,MA,HA,new We),c.uv2=c.uv1),s&&(Q1.fromBufferAttribute(s,a),j1.fromBufferAttribute(s,l),q1.fromBufferAttribute(s,g),c.normal=Go.getInterpolation(FA,bc,yc,vc,Q1,j1,q1,new E),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const C={a,b:l,c:g,normal:new E,materialIndex:0};Go.getNormal(bc,yc,vc,C.normal),c.face=C}return c}class Zl extends _t{constructor(e=1,n=1,i=1,o=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:i,widthSegments:o,heightSegments:r,depthSegments:s};const a=this;o=Math.floor(o),r=Math.floor(r),s=Math.floor(s);const l=[],g=[],c=[],C=[];let d=0,h=0;p("z","y","x",-1,-1,i,n,e,s,r,0),p("z","y","x",1,-1,i,n,-e,s,r,1),p("x","z","y",1,1,e,i,n,o,s,2),p("x","z","y",1,-1,e,i,-n,o,s,3),p("x","y","z",1,-1,e,n,i,o,r,4),p("x","y","z",-1,-1,e,n,-i,o,r,5),this.setIndex(l),this.setAttribute("position",new Ct(g,3)),this.setAttribute("normal",new Ct(c,3)),this.setAttribute("uv",new Ct(C,2));function p(v,f,A,b,m,B,Z,w,W,X,V){const Y=B/W,z=Z/X,q=B/2,O=Z/2,te=w/2,oe=W+1,re=X+1;let se=0,H=0;const D=new E;for(let T=0;T<re;T++){const J=T*z-O;for(let $=0;$<oe;$++){const Ie=$*Y-q;D[v]=Ie*b,D[f]=J*m,D[A]=te,g.push(D.x,D.y,D.z),D[v]=0,D[f]=0,D[A]=w>0?1:-1,c.push(D.x,D.y,D.z),C.push($/W),C.push(1-T/X),se+=1}}for(let T=0;T<X;T++)for(let J=0;J<W;J++){const $=d+J+oe*T,Ie=d+J+oe*(T+1),fe=d+(J+1)+oe*(T+1),ve=d+(J+1)+oe*T;l.push($,Ie,ve),l.push(Ie,fe,ve),H+=6}a.addGroup(h,H,V),h+=H,d+=se}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Zl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function RI(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const o=t[n][i];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?o.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=o.clone():Array.isArray(o)?e[n][i]=o.slice():e[n][i]=o}}return e}function $i(t){const e={};for(let n=0;n<t.length;n++){const i=RI(t[n]);for(const o in i)e[o]=i[o]}return e}function c_(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function VM(t){return t.getRenderTarget()===null?t.outputColorSpace:_r}const Vm={clone:RI,merge:$i};var I_=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,u_=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ao extends Wi{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=I_,this.fragmentShader=u_,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=RI(e.uniforms),this.uniformsGroups=c_(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const o in this.uniforms){const s=this.uniforms[o].value;s&&s.isTexture?n.uniforms[o]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?n.uniforms[o]={type:"c",value:s.getHex()}:s&&s.isVector2?n.uniforms[o]={type:"v2",value:s.toArray()}:s&&s.isVector3?n.uniforms[o]={type:"v3",value:s.toArray()}:s&&s.isVector4?n.uniforms[o]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?n.uniforms[o]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?n.uniforms[o]={type:"m4",value:s.toArray()}:n.uniforms[o]={value:s}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const i={};for(const o in this.extensions)this.extensions[o]===!0&&(i[o]=!0);return Object.keys(i).length>0&&(n.extensions=i),n}}class _d extends Ot{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Wt,this.projectionMatrix=new Wt,this.projectionMatrixInverse=new Wt,this.coordinateSystem=fs}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(-n[8],-n[9],-n[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}let qn=class extends _d{constructor(e=50,n=1,i=.1,o=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=o,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=SI*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(fg*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return SI*2*Math.atan(Math.tan(fg*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,n,i,o,r,s){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=o,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(fg*.5*this.fov)/this.zoom,i=2*n,o=this.aspect*i,r=-.5*o;const s=this.view;if(this.view!==null&&this.view.enabled){const l=s.fullWidth,g=s.fullHeight;r+=s.offsetX*o/l,n-=s.offsetY*i/g,o*=s.width/l,i*=s.height/g}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+o,n,n-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}};const Gc=-90,Bc=1;class XM extends Ot{constructor(e,n,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null;const o=new qn(Gc,Bc,e,n);o.layers=this.layers,this.add(o);const r=new qn(Gc,Bc,e,n);r.layers=this.layers,this.add(r);const s=new qn(Gc,Bc,e,n);s.layers=this.layers,this.add(s);const a=new qn(Gc,Bc,e,n);a.layers=this.layers,this.add(a);const l=new qn(Gc,Bc,e,n);l.layers=this.layers,this.add(l);const g=new qn(Gc,Bc,e,n);g.layers=this.layers,this.add(g)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[i,o,r,s,a,l]=n;for(const g of n)this.remove(g);if(e===fs)i.up.set(0,1,0),i.lookAt(1,0,0),o.up.set(0,1,0),o.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===cd)i.up.set(0,-1,0),i.lookAt(-1,0,0),o.up.set(0,-1,0),o.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const g of n)this.add(g),g.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,r,s,a,l,g]=this.children,c=e.getRenderTarget(),C=e.xr.enabled;e.xr.enabled=!1;const d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(n,o),e.setRenderTarget(i,1),e.render(n,r),e.setRenderTarget(i,2),e.render(n,s),e.setRenderTarget(i,3),e.render(n,a),e.setRenderTarget(i,4),e.render(n,l),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(n,g),e.setRenderTarget(c),e.xr.enabled=C,i.texture.needsPMREMUpdate=!0}}class Ud extends Xn{constructor(e,n,i,o,r,s,a,l,g,c){e=e!==void 0?e:[],n=n!==void 0?n:Bs,super(e,n,i,o,r,s,a,l,g,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class I2 extends Ar{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},o=[i,i,i,i,i,i];n.encoding!==void 0&&(SC("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===al?Kt:ll),this.texture=new Ud(o,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:bn}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},o=new Zl(5,5,5),r=new ao({name:"CubemapFromEquirect",uniforms:RI(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Si,blending:aa});r.uniforms.tEquirect.value=n;const s=new ci(o,r),a=n.minFilter;return n.minFilter===dl&&(n.minFilter=bn),new XM(1,10,this).update(e,s),n.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,n,i,o){const r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(n,i,o);e.setRenderTarget(r)}}const py=new E,C_=new E,d_=new Tt;class js{constructor(e=new E(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,i,o){return this.normal.set(e,n,i),this.constant=o,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,i){const o=py.subVectors(i,n).cross(C_.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const i=e.delta(py),o=this.normal.dot(i);if(o===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/o;return r<0||r>1?null:n.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const n=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return n<0&&i>0||i<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const i=n||d_.getNormalMatrix(e),o=this.coplanarPoint(py).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const El=new Dr,LA=new E;class Xm{constructor(e=new js,n=new js,i=new js,o=new js,r=new js,s=new js){this.planes=[e,n,i,o,r,s]}set(e,n,i,o,r,s){const a=this.planes;return a[0].copy(e),a[1].copy(n),a[2].copy(i),a[3].copy(o),a[4].copy(r),a[5].copy(s),this}copy(e){const n=this.planes;for(let i=0;i<6;i++)n[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,n=fs){const i=this.planes,o=e.elements,r=o[0],s=o[1],a=o[2],l=o[3],g=o[4],c=o[5],C=o[6],d=o[7],h=o[8],p=o[9],v=o[10],f=o[11],A=o[12],b=o[13],m=o[14],B=o[15];if(i[0].setComponents(l-r,d-g,f-h,B-A).normalize(),i[1].setComponents(l+r,d+g,f+h,B+A).normalize(),i[2].setComponents(l+s,d+c,f+p,B+b).normalize(),i[3].setComponents(l-s,d-c,f-p,B-b).normalize(),i[4].setComponents(l-a,d-C,f-v,B-m).normalize(),n===fs)i[5].setComponents(l+a,d+C,f+v,B+m).normalize();else if(n===cd)i[5].setComponents(a,C,v,m).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),El.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),El.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(El)}intersectsSprite(e){return El.center.set(0,0,0),El.radius=.7071067811865476,El.applyMatrix4(e.matrixWorld),this.intersectsSphere(El)}intersectsSphere(e){const n=this.planes,i=e.center,o=-e.radius;for(let r=0;r<6;r++)if(n[r].distanceToPoint(i)<o)return!1;return!0}intersectsBox(e){const n=this.planes;for(let i=0;i<6;i++){const o=n[i];if(LA.x=o.normal.x>0?e.max.x:e.min.x,LA.y=o.normal.y>0?e.max.y:e.min.y,LA.z=o.normal.z>0?e.max.z:e.min.z,o.distanceToPoint(LA)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let i=0;i<6;i++)if(n[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function NM(){let t=null,e=!1,n=null,i=null;function o(r,s){n(r,s),i=t.requestAnimationFrame(o)}return{start:function(){e!==!0&&n!==null&&(i=t.requestAnimationFrame(o),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){n=r},setContext:function(r){t=r}}}function h_(t,e){const n=e.isWebGL2,i=new WeakMap;function o(g,c){const C=g.array,d=g.usage,h=t.createBuffer();t.bindBuffer(c,h),t.bufferData(c,C,d),g.onUploadCallback();let p;if(C instanceof Float32Array)p=t.FLOAT;else if(C instanceof Uint16Array)if(g.isFloat16BufferAttribute)if(n)p=t.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else p=t.UNSIGNED_SHORT;else if(C instanceof Int16Array)p=t.SHORT;else if(C instanceof Uint32Array)p=t.UNSIGNED_INT;else if(C instanceof Int32Array)p=t.INT;else if(C instanceof Int8Array)p=t.BYTE;else if(C instanceof Uint8Array)p=t.UNSIGNED_BYTE;else if(C instanceof Uint8ClampedArray)p=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+C);return{buffer:h,type:p,bytesPerElement:C.BYTES_PER_ELEMENT,version:g.version}}function r(g,c,C){const d=c.array,h=c.updateRange;t.bindBuffer(C,g),h.count===-1?t.bufferSubData(C,0,d):(n?t.bufferSubData(C,h.offset*d.BYTES_PER_ELEMENT,d,h.offset,h.count):t.bufferSubData(C,h.offset*d.BYTES_PER_ELEMENT,d.subarray(h.offset,h.offset+h.count)),h.count=-1),c.onUploadCallback()}function s(g){return g.isInterleavedBufferAttribute&&(g=g.data),i.get(g)}function a(g){g.isInterleavedBufferAttribute&&(g=g.data);const c=i.get(g);c&&(t.deleteBuffer(c.buffer),i.delete(g))}function l(g,c){if(g.isGLBufferAttribute){const d=i.get(g);(!d||d.version<g.version)&&i.set(g,{buffer:g.buffer,type:g.type,bytesPerElement:g.elementSize,version:g.version});return}g.isInterleavedBufferAttribute&&(g=g.data);const C=i.get(g);C===void 0?i.set(g,o(g,c)):C.version<g.version&&(r(C.buffer,g,c),C.version=g.version)}return{get:s,remove:a,update:l}}class Pd extends _t{constructor(e=1,n=1,i=1,o=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:i,heightSegments:o};const r=e/2,s=n/2,a=Math.floor(i),l=Math.floor(o),g=a+1,c=l+1,C=e/a,d=n/l,h=[],p=[],v=[],f=[];for(let A=0;A<c;A++){const b=A*d-s;for(let m=0;m<g;m++){const B=m*C-r;p.push(B,-b,0),v.push(0,0,1),f.push(m/a),f.push(1-A/l)}}for(let A=0;A<l;A++)for(let b=0;b<a;b++){const m=b+g*A,B=b+g*(A+1),Z=b+1+g*(A+1),w=b+1+g*A;h.push(m,B,w),h.push(B,Z,w)}this.setIndex(h),this.setAttribute("position",new Ct(p,3)),this.setAttribute("normal",new Ct(v,3)),this.setAttribute("uv",new Ct(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pd(e.width,e.height,e.widthSegments,e.heightSegments)}}var A_=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,p_=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,f_=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,m_=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,b_=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,y_=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,v_=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,G_=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,B_=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Z_=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,w_=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,S_=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,R_=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,W_=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,x_=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,V_=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,X_=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,N_=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Y_=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,M_=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,H_=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,F_=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,K_=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,z_=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,L_=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,E_=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,k_=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,T_=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,__="gl_FragColor = linearToOutputTexel( gl_FragColor );",U_=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,P_=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,D_=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,J_=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,O_=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Q_=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,j_=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,q_=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,$_=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,eU=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,tU=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,nU=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,iU=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,oU=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,rU=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,sU=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,aU=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lU=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,gU=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,cU=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,IU=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,uU=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,CU=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,dU=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,hU=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,AU=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,pU=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,fU=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,mU=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,bU=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,yU=`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,vU=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,GU=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,BU=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,ZU=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,wU=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,SU=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,RU=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,WU=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,xU=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,VU=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,XU=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,NU=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,YU=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,MU=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,HU=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,FU=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,KU=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,zU=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,LU=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,EU=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,kU=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,TU=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,_U=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,UU=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,PU=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,DU=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,JU=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,OU=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,QU=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,jU=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,qU=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,$U=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,eP=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,tP=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,nP=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,iP=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,oP=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,rP=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,sP=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,aP=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,lP=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,gP=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,cP=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,IP=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,uP=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const CP=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,dP=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,hP=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,AP=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,pP=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fP=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,mP=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,bP=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,yP=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,vP=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,GP=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,BP=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ZP=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,wP=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,SP=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,RP=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,WP=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xP=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,VP=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,XP=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,NP=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,YP=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,MP=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,HP=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,FP=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,KP=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zP=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,LP=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,EP=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,kP=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,TP=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_P=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,UP=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,PP=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ft={alphahash_fragment:A_,alphahash_pars_fragment:p_,alphamap_fragment:f_,alphamap_pars_fragment:m_,alphatest_fragment:b_,alphatest_pars_fragment:y_,aomap_fragment:v_,aomap_pars_fragment:G_,begin_vertex:B_,beginnormal_vertex:Z_,bsdfs:w_,iridescence_fragment:S_,bumpmap_pars_fragment:R_,clipping_planes_fragment:W_,clipping_planes_pars_fragment:x_,clipping_planes_pars_vertex:V_,clipping_planes_vertex:X_,color_fragment:N_,color_pars_fragment:Y_,color_pars_vertex:M_,color_vertex:H_,common:F_,cube_uv_reflection_fragment:K_,defaultnormal_vertex:z_,displacementmap_pars_vertex:L_,displacementmap_vertex:E_,emissivemap_fragment:k_,emissivemap_pars_fragment:T_,colorspace_fragment:__,colorspace_pars_fragment:U_,envmap_fragment:P_,envmap_common_pars_fragment:D_,envmap_pars_fragment:J_,envmap_pars_vertex:O_,envmap_physical_pars_fragment:aU,envmap_vertex:Q_,fog_vertex:j_,fog_pars_vertex:q_,fog_fragment:$_,fog_pars_fragment:eU,gradientmap_pars_fragment:tU,lightmap_fragment:nU,lightmap_pars_fragment:iU,lights_lambert_fragment:oU,lights_lambert_pars_fragment:rU,lights_pars_begin:sU,lights_toon_fragment:lU,lights_toon_pars_fragment:gU,lights_phong_fragment:cU,lights_phong_pars_fragment:IU,lights_physical_fragment:uU,lights_physical_pars_fragment:CU,lights_fragment_begin:dU,lights_fragment_maps:hU,lights_fragment_end:AU,logdepthbuf_fragment:pU,logdepthbuf_pars_fragment:fU,logdepthbuf_pars_vertex:mU,logdepthbuf_vertex:bU,map_fragment:yU,map_pars_fragment:vU,map_particle_fragment:GU,map_particle_pars_fragment:BU,metalnessmap_fragment:ZU,metalnessmap_pars_fragment:wU,morphcolor_vertex:SU,morphnormal_vertex:RU,morphtarget_pars_vertex:WU,morphtarget_vertex:xU,normal_fragment_begin:VU,normal_fragment_maps:XU,normal_pars_fragment:NU,normal_pars_vertex:YU,normal_vertex:MU,normalmap_pars_fragment:HU,clearcoat_normal_fragment_begin:FU,clearcoat_normal_fragment_maps:KU,clearcoat_pars_fragment:zU,iridescence_pars_fragment:LU,opaque_fragment:EU,packing:kU,premultiplied_alpha_fragment:TU,project_vertex:_U,dithering_fragment:UU,dithering_pars_fragment:PU,roughnessmap_fragment:DU,roughnessmap_pars_fragment:JU,shadowmap_pars_fragment:OU,shadowmap_pars_vertex:QU,shadowmap_vertex:jU,shadowmask_pars_fragment:qU,skinbase_vertex:$U,skinning_pars_vertex:eP,skinning_vertex:tP,skinnormal_vertex:nP,specularmap_fragment:iP,specularmap_pars_fragment:oP,tonemapping_fragment:rP,tonemapping_pars_fragment:sP,transmission_fragment:aP,transmission_pars_fragment:lP,uv_pars_fragment:gP,uv_pars_vertex:cP,uv_vertex:IP,worldpos_vertex:uP,background_vert:CP,background_frag:dP,backgroundCube_vert:hP,backgroundCube_frag:AP,cube_vert:pP,cube_frag:fP,depth_vert:mP,depth_frag:bP,distanceRGBA_vert:yP,distanceRGBA_frag:vP,equirect_vert:GP,equirect_frag:BP,linedashed_vert:ZP,linedashed_frag:wP,meshbasic_vert:SP,meshbasic_frag:RP,meshlambert_vert:WP,meshlambert_frag:xP,meshmatcap_vert:VP,meshmatcap_frag:XP,meshnormal_vert:NP,meshnormal_frag:YP,meshphong_vert:MP,meshphong_frag:HP,meshphysical_vert:FP,meshphysical_frag:KP,meshtoon_vert:zP,meshtoon_frag:LP,points_vert:EP,points_frag:kP,shadow_vert:TP,shadow_frag:_P,sprite_vert:UP,sprite_frag:PP},Oe={common:{diffuse:{value:new je(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Tt},alphaMap:{value:null},alphaMapTransform:{value:new Tt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Tt}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Tt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Tt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Tt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Tt},normalScale:{value:new We(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Tt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Tt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Tt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Tt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new je(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new je(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Tt},alphaTest:{value:0},uvTransform:{value:new Tt}},sprite:{diffuse:{value:new je(16777215)},opacity:{value:1},center:{value:new We(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Tt},alphaMap:{value:null},alphaMapTransform:{value:new Tt},alphaTest:{value:0}}},Mr={basic:{uniforms:$i([Oe.common,Oe.specularmap,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.fog]),vertexShader:Ft.meshbasic_vert,fragmentShader:Ft.meshbasic_frag},lambert:{uniforms:$i([Oe.common,Oe.specularmap,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.fog,Oe.lights,{emissive:{value:new je(0)}}]),vertexShader:Ft.meshlambert_vert,fragmentShader:Ft.meshlambert_frag},phong:{uniforms:$i([Oe.common,Oe.specularmap,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.fog,Oe.lights,{emissive:{value:new je(0)},specular:{value:new je(1118481)},shininess:{value:30}}]),vertexShader:Ft.meshphong_vert,fragmentShader:Ft.meshphong_frag},standard:{uniforms:$i([Oe.common,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.roughnessmap,Oe.metalnessmap,Oe.fog,Oe.lights,{emissive:{value:new je(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ft.meshphysical_vert,fragmentShader:Ft.meshphysical_frag},toon:{uniforms:$i([Oe.common,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.gradientmap,Oe.fog,Oe.lights,{emissive:{value:new je(0)}}]),vertexShader:Ft.meshtoon_vert,fragmentShader:Ft.meshtoon_frag},matcap:{uniforms:$i([Oe.common,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.fog,{matcap:{value:null}}]),vertexShader:Ft.meshmatcap_vert,fragmentShader:Ft.meshmatcap_frag},points:{uniforms:$i([Oe.points,Oe.fog]),vertexShader:Ft.points_vert,fragmentShader:Ft.points_frag},dashed:{uniforms:$i([Oe.common,Oe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ft.linedashed_vert,fragmentShader:Ft.linedashed_frag},depth:{uniforms:$i([Oe.common,Oe.displacementmap]),vertexShader:Ft.depth_vert,fragmentShader:Ft.depth_frag},normal:{uniforms:$i([Oe.common,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,{opacity:{value:1}}]),vertexShader:Ft.meshnormal_vert,fragmentShader:Ft.meshnormal_frag},sprite:{uniforms:$i([Oe.sprite,Oe.fog]),vertexShader:Ft.sprite_vert,fragmentShader:Ft.sprite_frag},background:{uniforms:{uvTransform:{value:new Tt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ft.background_vert,fragmentShader:Ft.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Ft.backgroundCube_vert,fragmentShader:Ft.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ft.cube_vert,fragmentShader:Ft.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ft.equirect_vert,fragmentShader:Ft.equirect_frag},distanceRGBA:{uniforms:$i([Oe.common,Oe.displacementmap,{referencePosition:{value:new E},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ft.distanceRGBA_vert,fragmentShader:Ft.distanceRGBA_frag},shadow:{uniforms:$i([Oe.lights,Oe.fog,{color:{value:new je(0)},opacity:{value:1}}]),vertexShader:Ft.shadow_vert,fragmentShader:Ft.shadow_frag}};Mr.physical={uniforms:$i([Mr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Tt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Tt},clearcoatNormalScale:{value:new We(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Tt},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Tt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Tt},sheen:{value:0},sheenColor:{value:new je(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Tt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Tt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Tt},transmissionSamplerSize:{value:new We},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Tt},attenuationDistance:{value:0},attenuationColor:{value:new je(0)},specularColor:{value:new je(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Tt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Tt},anisotropyVector:{value:new We},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Tt}}]),vertexShader:Ft.meshphysical_vert,fragmentShader:Ft.meshphysical_frag};const EA={r:0,b:0,g:0};function DP(t,e,n,i,o,r,s){const a=new je(0);let l=r===!0?0:1,g,c,C=null,d=0,h=null;function p(f,A){let b=!1,m=A.isScene===!0?A.background:null;switch(m&&m.isTexture&&(m=(A.backgroundBlurriness>0?n:e).get(m)),m===null?v(a,l):m&&m.isColor&&(v(m,1),b=!0),t.xr.getEnvironmentBlendMode()){case"opaque":b=!0;break;case"additive":i.buffers.color.setClear(0,0,0,1,s),b=!0;break;case"alpha-blend":i.buffers.color.setClear(0,0,0,0,s),b=!0;break}(t.autoClear||b)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.mapping===UI)?(c===void 0&&(c=new ci(new Zl(1,1,1),new ao({name:"BackgroundCubeMaterial",uniforms:RI(Mr.backgroundCube.uniforms),vertexShader:Mr.backgroundCube.vertexShader,fragmentShader:Mr.backgroundCube.fragmentShader,side:Si,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(w,W,X){this.matrixWorld.copyPosition(X.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(c)),c.material.uniforms.envMap.value=m,c.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=A.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,c.material.toneMapped=m.colorSpace!==Kt,(C!==m||d!==m.version||h!==t.toneMapping)&&(c.material.needsUpdate=!0,C=m,d=m.version,h=t.toneMapping),c.layers.enableAll(),f.unshift(c,c.geometry,c.material,0,0,null)):m&&m.isTexture&&(g===void 0&&(g=new ci(new Pd(2,2),new ao({name:"BackgroundMaterial",uniforms:RI(Mr.background.uniforms),vertexShader:Mr.background.vertexShader,fragmentShader:Mr.background.fragmentShader,side:Ca,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),Object.defineProperty(g.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(g)),g.material.uniforms.t2D.value=m,g.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,g.material.toneMapped=m.colorSpace!==Kt,m.matrixAutoUpdate===!0&&m.updateMatrix(),g.material.uniforms.uvTransform.value.copy(m.matrix),(C!==m||d!==m.version||h!==t.toneMapping)&&(g.material.needsUpdate=!0,C=m,d=m.version,h=t.toneMapping),g.layers.enableAll(),f.unshift(g,g.geometry,g.material,0,0,null))}function v(f,A){f.getRGB(EA,VM(t)),i.buffers.color.setClear(EA.r,EA.g,EA.b,A,s)}return{getClearColor:function(){return a},setClearColor:function(f,A=1){a.set(f),l=A,v(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(f){l=f,v(a,l)},render:p}}function JP(t,e,n,i){const o=t.getParameter(t.MAX_VERTEX_ATTRIBS),r=i.isWebGL2?null:e.get("OES_vertex_array_object"),s=i.isWebGL2||r!==null,a={},l=f(null);let g=l,c=!1;function C(te,oe,re,se,H){let D=!1;if(s){const T=v(se,re,oe);g!==T&&(g=T,h(g.object)),D=A(te,se,re,H),D&&b(te,se,re,H)}else{const T=oe.wireframe===!0;(g.geometry!==se.id||g.program!==re.id||g.wireframe!==T)&&(g.geometry=se.id,g.program=re.id,g.wireframe=T,D=!0)}H!==null&&n.update(H,t.ELEMENT_ARRAY_BUFFER),(D||c)&&(c=!1,X(te,oe,re,se),H!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.get(H).buffer))}function d(){return i.isWebGL2?t.createVertexArray():r.createVertexArrayOES()}function h(te){return i.isWebGL2?t.bindVertexArray(te):r.bindVertexArrayOES(te)}function p(te){return i.isWebGL2?t.deleteVertexArray(te):r.deleteVertexArrayOES(te)}function v(te,oe,re){const se=re.wireframe===!0;let H=a[te.id];H===void 0&&(H={},a[te.id]=H);let D=H[oe.id];D===void 0&&(D={},H[oe.id]=D);let T=D[se];return T===void 0&&(T=f(d()),D[se]=T),T}function f(te){const oe=[],re=[],se=[];for(let H=0;H<o;H++)oe[H]=0,re[H]=0,se[H]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:oe,enabledAttributes:re,attributeDivisors:se,object:te,attributes:{},index:null}}function A(te,oe,re,se){const H=g.attributes,D=oe.attributes;let T=0;const J=re.getAttributes();for(const $ in J)if(J[$].location>=0){const fe=H[$];let ve=D[$];if(ve===void 0&&($==="instanceMatrix"&&te.instanceMatrix&&(ve=te.instanceMatrix),$==="instanceColor"&&te.instanceColor&&(ve=te.instanceColor)),fe===void 0||fe.attribute!==ve||ve&&fe.data!==ve.data)return!0;T++}return g.attributesNum!==T||g.index!==se}function b(te,oe,re,se){const H={},D=oe.attributes;let T=0;const J=re.getAttributes();for(const $ in J)if(J[$].location>=0){let fe=D[$];fe===void 0&&($==="instanceMatrix"&&te.instanceMatrix&&(fe=te.instanceMatrix),$==="instanceColor"&&te.instanceColor&&(fe=te.instanceColor));const ve={};ve.attribute=fe,fe&&fe.data&&(ve.data=fe.data),H[$]=ve,T++}g.attributes=H,g.attributesNum=T,g.index=se}function m(){const te=g.newAttributes;for(let oe=0,re=te.length;oe<re;oe++)te[oe]=0}function B(te){Z(te,0)}function Z(te,oe){const re=g.newAttributes,se=g.enabledAttributes,H=g.attributeDivisors;re[te]=1,se[te]===0&&(t.enableVertexAttribArray(te),se[te]=1),H[te]!==oe&&((i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](te,oe),H[te]=oe)}function w(){const te=g.newAttributes,oe=g.enabledAttributes;for(let re=0,se=oe.length;re<se;re++)oe[re]!==te[re]&&(t.disableVertexAttribArray(re),oe[re]=0)}function W(te,oe,re,se,H,D,T){T===!0?t.vertexAttribIPointer(te,oe,re,H,D):t.vertexAttribPointer(te,oe,re,se,H,D)}function X(te,oe,re,se){if(i.isWebGL2===!1&&(te.isInstancedMesh||se.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;m();const H=se.attributes,D=re.getAttributes(),T=oe.defaultAttributeValues;for(const J in D){const $=D[J];if($.location>=0){let Ie=H[J];if(Ie===void 0&&(J==="instanceMatrix"&&te.instanceMatrix&&(Ie=te.instanceMatrix),J==="instanceColor"&&te.instanceColor&&(Ie=te.instanceColor)),Ie!==void 0){const fe=Ie.normalized,ve=Ie.itemSize,Ge=n.get(Ie);if(Ge===void 0)continue;const Me=Ge.buffer,_e=Ge.type,Bt=Ge.bytesPerElement,St=i.isWebGL2===!0&&(_e===t.INT||_e===t.UNSIGNED_INT||Ie.gpuType===QZ);if(Ie.isInterleavedBufferAttribute){const ot=Ie.data,ee=ot.stride,Ne=Ie.offset;if(ot.isInstancedInterleavedBuffer){for(let Se=0;Se<$.locationSize;Se++)Z($.location+Se,ot.meshPerAttribute);te.isInstancedMesh!==!0&&se._maxInstanceCount===void 0&&(se._maxInstanceCount=ot.meshPerAttribute*ot.count)}else for(let Se=0;Se<$.locationSize;Se++)B($.location+Se);t.bindBuffer(t.ARRAY_BUFFER,Me);for(let Se=0;Se<$.locationSize;Se++)W($.location+Se,ve/$.locationSize,_e,fe,ee*Bt,(Ne+ve/$.locationSize*Se)*Bt,St)}else{if(Ie.isInstancedBufferAttribute){for(let ot=0;ot<$.locationSize;ot++)Z($.location+ot,Ie.meshPerAttribute);te.isInstancedMesh!==!0&&se._maxInstanceCount===void 0&&(se._maxInstanceCount=Ie.meshPerAttribute*Ie.count)}else for(let ot=0;ot<$.locationSize;ot++)B($.location+ot);t.bindBuffer(t.ARRAY_BUFFER,Me);for(let ot=0;ot<$.locationSize;ot++)W($.location+ot,ve/$.locationSize,_e,fe,ve*Bt,ve/$.locationSize*ot*Bt,St)}}else if(T!==void 0){const fe=T[J];if(fe!==void 0)switch(fe.length){case 2:t.vertexAttrib2fv($.location,fe);break;case 3:t.vertexAttrib3fv($.location,fe);break;case 4:t.vertexAttrib4fv($.location,fe);break;default:t.vertexAttrib1fv($.location,fe)}}}}w()}function V(){q();for(const te in a){const oe=a[te];for(const re in oe){const se=oe[re];for(const H in se)p(se[H].object),delete se[H];delete oe[re]}delete a[te]}}function Y(te){if(a[te.id]===void 0)return;const oe=a[te.id];for(const re in oe){const se=oe[re];for(const H in se)p(se[H].object),delete se[H];delete oe[re]}delete a[te.id]}function z(te){for(const oe in a){const re=a[oe];if(re[te.id]===void 0)continue;const se=re[te.id];for(const H in se)p(se[H].object),delete se[H];delete re[te.id]}}function q(){O(),c=!0,g!==l&&(g=l,h(g.object))}function O(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:C,reset:q,resetDefaultState:O,dispose:V,releaseStatesOfGeometry:Y,releaseStatesOfProgram:z,initAttributes:m,enableAttribute:B,disableUnusedAttributes:w}}function OP(t,e,n,i){const o=i.isWebGL2;let r;function s(g){r=g}function a(g,c){t.drawArrays(r,g,c),n.update(c,r,1)}function l(g,c,C){if(C===0)return;let d,h;if(o)d=t,h="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[h](r,g,c,C),n.update(c,r,C)}this.setMode=s,this.render=a,this.renderInstances=l}function QP(t,e,n){let i;function o(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const W=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(W.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function r(W){if(W==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";W="mediump"}return W==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s=typeof WebGL2RenderingContext<"u"&&t.constructor.name==="WebGL2RenderingContext";let a=n.precision!==void 0?n.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const g=s||e.has("WEBGL_draw_buffers"),c=n.logarithmicDepthBuffer===!0,C=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_TEXTURE_SIZE),p=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),v=t.getParameter(t.MAX_VERTEX_ATTRIBS),f=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),A=t.getParameter(t.MAX_VARYING_VECTORS),b=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),m=d>0,B=s||e.has("OES_texture_float"),Z=m&&B,w=s?t.getParameter(t.MAX_SAMPLES):0;return{isWebGL2:s,drawBuffers:g,getMaxAnisotropy:o,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:C,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:p,maxAttributes:v,maxVertexUniforms:f,maxVaryings:A,maxFragmentUniforms:b,vertexTextures:m,floatFragmentTextures:B,floatVertexTextures:Z,maxSamples:w}}function jP(t){const e=this;let n=null,i=0,o=!1,r=!1;const s=new js,a=new Tt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(C,d){const h=C.length!==0||d||i!==0||o;return o=d,i=C.length,h},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(C,d){n=c(C,d,0)},this.setState=function(C,d,h){const p=C.clippingPlanes,v=C.clipIntersection,f=C.clipShadows,A=t.get(C);if(!o||p===null||p.length===0||r&&!f)r?c(null):g();else{const b=r?0:i,m=b*4;let B=A.clippingState||null;l.value=B,B=c(p,d,m,h);for(let Z=0;Z!==m;++Z)B[Z]=n[Z];A.clippingState=B,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=b}};function g(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function c(C,d,h,p){const v=C!==null?C.length:0;let f=null;if(v!==0){if(f=l.value,p!==!0||f===null){const A=h+v*4,b=d.matrixWorldInverse;a.getNormalMatrix(b),(f===null||f.length<A)&&(f=new Float32Array(A));for(let m=0,B=h;m!==v;++m,B+=4)s.copy(C[m]).applyMatrix4(b,a),s.normal.toArray(f,B),f[B+3]=s.constant}l.value=f,l.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,f}}function qP(t){let e=new WeakMap;function n(s,a){return a===wI?s.mapping=Bs:a===id&&(s.mapping=Cl),s}function i(s){if(s&&s.isTexture&&s.isRenderTargetTexture===!1){const a=s.mapping;if(a===wI||a===id)if(e.has(s)){const l=e.get(s).texture;return n(l,s.mapping)}else{const l=s.image;if(l&&l.height>0){const g=new I2(l.height/2);return g.fromEquirectangularTexture(t,s),e.set(s,g),s.addEventListener("dispose",o),n(g.texture,s.mapping)}else return null}}return s}function o(s){const a=s.target;a.removeEventListener("dispose",o);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:i,dispose:r}}class gl extends _d{constructor(e=-1,n=1,i=1,o=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=i,this.bottom=o,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,i,o,r,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=o,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,o=(this.top+this.bottom)/2;let r=i-e,s=i+e,a=o+n,l=o-n;if(this.view!==null&&this.view.enabled){const g=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=g*this.view.offsetX,s=r+g*this.view.width,a-=c*this.view.offsetY,l=a-c*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}const $c=4,$1=[.125,.215,.35,.446,.526,.582],eg=20,fy=new gl,eW=new je;let my=null;const jl=(1+Math.sqrt(5))/2,Zc=1/jl,tW=[new E(1,1,1),new E(-1,1,1),new E(1,1,-1),new E(-1,1,-1),new E(0,jl,Zc),new E(0,jl,-Zc),new E(Zc,0,jl),new E(-Zc,0,jl),new E(jl,Zc,0),new E(-jl,Zc,0)];class PG{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,i=.1,o=100){my=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,o,r),n>0&&this._blur(r,0,0,n),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=oW(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=iW(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(my),e.scissorTest=!1,kA(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===Bs||e.mapping===Cl?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),my=this._renderer.getRenderTarget();const i=n||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,i={magFilter:bn,minFilter:bn,generateMipmaps:!1,type:Ti,format:oo,colorSpace:_r,depthBuffer:!1},o=nW(e,n,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=nW(e,n,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=$P(r)),this._blurMaterial=eD(r,e,n)}return o}_compileMaterial(e){const n=new ci(this._lodPlanes[0],e);this._renderer.compile(n,fy)}_sceneToCubeUV(e,n,i,o){const a=new qn(90,1,n,i),l=[1,-1,1,1,1,1],g=[1,1,1,-1,-1,-1],c=this._renderer,C=c.autoClear,d=c.toneMapping;c.getClearColor(eW),c.toneMapping=ys,c.autoClear=!1;const h=new Bl({name:"PMREM.Background",side:Si,depthWrite:!1,depthTest:!1}),p=new ci(new Zl,h);let v=!1;const f=e.background;f?f.isColor&&(h.color.copy(f),e.background=null,v=!0):(h.color.copy(eW),v=!0);for(let A=0;A<6;A++){const b=A%3;b===0?(a.up.set(0,l[A],0),a.lookAt(g[A],0,0)):b===1?(a.up.set(0,0,l[A]),a.lookAt(0,g[A],0)):(a.up.set(0,l[A],0),a.lookAt(0,0,g[A]));const m=this._cubeSize;kA(o,b*m,A>2?m:0,m,m),c.setRenderTarget(o),v&&c.render(p,a),c.render(e,a)}p.geometry.dispose(),p.material.dispose(),c.toneMapping=d,c.autoClear=C,e.background=f}_textureToCubeUV(e,n){const i=this._renderer,o=e.mapping===Bs||e.mapping===Cl;o?(this._cubemapMaterial===null&&(this._cubemapMaterial=oW()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=iW());const r=o?this._cubemapMaterial:this._equirectMaterial,s=new ci(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;kA(n,0,0,3*l,2*l),i.setRenderTarget(n),i.render(s,fy)}_applyPMREM(e){const n=this._renderer,i=n.autoClear;n.autoClear=!1;for(let o=1;o<this._lodPlanes.length;o++){const r=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),s=tW[(o-1)%tW.length];this._blur(e,o-1,o,r,s)}n.autoClear=i}_blur(e,n,i,o,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,n,i,o,"latitudinal",r),this._halfBlur(s,e,i,i,o,"longitudinal",r)}_halfBlur(e,n,i,o,r,s,a){const l=this._renderer,g=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,C=new ci(this._lodPlanes[o],g),d=g.uniforms,h=this._sizeLods[i]-1,p=isFinite(r)?Math.PI/(2*h):2*Math.PI/(2*eg-1),v=r/p,f=isFinite(r)?1+Math.floor(c*v):eg;f>eg&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${eg}`);const A=[];let b=0;for(let W=0;W<eg;++W){const X=W/v,V=Math.exp(-X*X/2);A.push(V),W===0?b+=V:W<f&&(b+=2*V)}for(let W=0;W<A.length;W++)A[W]=A[W]/b;d.envMap.value=e.texture,d.samples.value=f,d.weights.value=A,d.latitudinal.value=s==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:m}=this;d.dTheta.value=p,d.mipInt.value=m-i;const B=this._sizeLods[o],Z=3*B*(o>m-$c?o-m+$c:0),w=4*(this._cubeSize-B);kA(n,Z,w,3*B,2*B),l.setRenderTarget(n),l.render(C,fy)}}function $P(t){const e=[],n=[],i=[];let o=t;const r=t-$c+1+$1.length;for(let s=0;s<r;s++){const a=Math.pow(2,o);n.push(a);let l=1/a;s>t-$c?l=$1[s-t+$c-1]:s===0&&(l=0),i.push(l);const g=1/(a-2),c=-g,C=1+g,d=[c,c,C,c,C,C,c,c,C,C,c,C],h=6,p=6,v=3,f=2,A=1,b=new Float32Array(v*p*h),m=new Float32Array(f*p*h),B=new Float32Array(A*p*h);for(let w=0;w<h;w++){const W=w%3*2/3-1,X=w>2?0:-1,V=[W,X,0,W+2/3,X,0,W+2/3,X+1,0,W,X,0,W+2/3,X+1,0,W,X+1,0];b.set(V,v*p*w),m.set(d,f*p*w);const Y=[w,w,w,w,w,w];B.set(Y,A*p*w)}const Z=new _t;Z.setAttribute("position",new un(b,v)),Z.setAttribute("uv",new un(m,f)),Z.setAttribute("faceIndex",new un(B,A)),e.push(Z),o>$c&&o--}return{lodPlanes:e,sizeLods:n,sigmas:i}}function nW(t,e,n){const i=new Ar(t,e,n);return i.texture.mapping=UI,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function kA(t,e,n,i,o){t.viewport.set(e,n,i,o),t.scissor.set(e,n,i,o)}function eD(t,e,n){const i=new Float32Array(eg),o=new E(0,1,0);return new ao({name:"SphericalGaussianBlur",defines:{n:eg,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:o}},vertexShader:u2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:aa,depthTest:!1,depthWrite:!1})}function iW(){return new ao({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:u2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:aa,depthTest:!1,depthWrite:!1})}function oW(){return new ao({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:u2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:aa,depthTest:!1,depthWrite:!1})}function u2(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function tD(t){let e=new WeakMap,n=null;function i(a){if(a&&a.isTexture){const l=a.mapping,g=l===wI||l===id,c=l===Bs||l===Cl;if(g||c)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let C=e.get(a);return n===null&&(n=new PG(t)),C=g?n.fromEquirectangular(a,C):n.fromCubemap(a,C),e.set(a,C),C.texture}else{if(e.has(a))return e.get(a).texture;{const C=a.image;if(g&&C&&C.height>0||c&&C&&o(C)){n===null&&(n=new PG(t));const d=g?n.fromEquirectangular(a):n.fromCubemap(a);return e.set(a,d),a.addEventListener("dispose",r),d.texture}else return null}}}return a}function o(a){let l=0;const g=6;for(let c=0;c<g;c++)a[c]!==void 0&&l++;return l===g}function r(a){const l=a.target;l.removeEventListener("dispose",r);const g=e.get(l);g!==void 0&&(e.delete(l),g.dispose())}function s(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:i,dispose:s}}function nD(t){const e={};function n(i){if(e[i]!==void 0)return e[i];let o;switch(i){case"WEBGL_depth_texture":o=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=t.getExtension(i)}return e[i]=o,o}return{has:function(i){return n(i)!==null},init:function(i){i.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(i){const o=n(i);return o===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),o}}}function iD(t,e,n,i){const o={},r=new WeakMap;function s(C){const d=C.target;d.index!==null&&e.remove(d.index);for(const p in d.attributes)e.remove(d.attributes[p]);for(const p in d.morphAttributes){const v=d.morphAttributes[p];for(let f=0,A=v.length;f<A;f++)e.remove(v[f])}d.removeEventListener("dispose",s),delete o[d.id];const h=r.get(d);h&&(e.remove(h),r.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,n.memory.geometries--}function a(C,d){return o[d.id]===!0||(d.addEventListener("dispose",s),o[d.id]=!0,n.memory.geometries++),d}function l(C){const d=C.attributes;for(const p in d)e.update(d[p],t.ARRAY_BUFFER);const h=C.morphAttributes;for(const p in h){const v=h[p];for(let f=0,A=v.length;f<A;f++)e.update(v[f],t.ARRAY_BUFFER)}}function g(C){const d=[],h=C.index,p=C.attributes.position;let v=0;if(h!==null){const b=h.array;v=h.version;for(let m=0,B=b.length;m<B;m+=3){const Z=b[m+0],w=b[m+1],W=b[m+2];d.push(Z,w,w,W,W,Z)}}else if(p!==void 0){const b=p.array;v=p.version;for(let m=0,B=b.length/3-1;m<B;m+=3){const Z=m+0,w=m+1,W=m+2;d.push(Z,w,w,W,W,Z)}}else return;const f=new(RM(d)?c2:g2)(d,1);f.version=v;const A=r.get(C);A&&e.remove(A),r.set(C,f)}function c(C){const d=r.get(C);if(d){const h=C.index;h!==null&&d.version<h.version&&g(C)}else g(C);return r.get(C)}return{get:a,update:l,getWireframeAttribute:c}}function oD(t,e,n,i){const o=i.isWebGL2;let r;function s(d){r=d}let a,l;function g(d){a=d.type,l=d.bytesPerElement}function c(d,h){t.drawElements(r,h,a,d*l),n.update(h,r,1)}function C(d,h,p){if(p===0)return;let v,f;if(o)v=t,f="drawElementsInstanced";else if(v=e.get("ANGLE_instanced_arrays"),f="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[f](r,h,a,d*l,p),n.update(h,r,p)}this.setMode=s,this.setIndex=g,this.render=c,this.renderInstances=C}function rD(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,s,a){switch(n.calls++,s){case t.TRIANGLES:n.triangles+=a*(r/3);break;case t.LINES:n.lines+=a*(r/2);break;case t.LINE_STRIP:n.lines+=a*(r-1);break;case t.LINE_LOOP:n.lines+=a*r;break;case t.POINTS:n.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function o(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:o,update:i}}function sD(t,e){return t[0]-e[0]}function aD(t,e){return Math.abs(e[1])-Math.abs(t[1])}function lD(t,e,n){const i={},o=new Float32Array(8),r=new WeakMap,s=new cn,a=[];for(let g=0;g<8;g++)a[g]=[g,0];function l(g,c,C){const d=g.morphTargetInfluences;if(e.isWebGL2===!0){const p=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,v=p!==void 0?p.length:0;let f=r.get(c);if(f===void 0||f.count!==v){let oe=function(){O.dispose(),r.delete(c),c.removeEventListener("dispose",oe)};var h=oe;f!==void 0&&f.texture.dispose();const m=c.morphAttributes.position!==void 0,B=c.morphAttributes.normal!==void 0,Z=c.morphAttributes.color!==void 0,w=c.morphAttributes.position||[],W=c.morphAttributes.normal||[],X=c.morphAttributes.color||[];let V=0;m===!0&&(V=1),B===!0&&(V=2),Z===!0&&(V=3);let Y=c.attributes.position.count*V,z=1;Y>e.maxTextureSize&&(z=Math.ceil(Y/e.maxTextureSize),Y=e.maxTextureSize);const q=new Float32Array(Y*z*4*v),O=new xm(q,Y,z,v);O.type=Zi,O.needsUpdate=!0;const te=V*4;for(let re=0;re<v;re++){const se=w[re],H=W[re],D=X[re],T=Y*z*4*re;for(let J=0;J<se.count;J++){const $=J*te;m===!0&&(s.fromBufferAttribute(se,J),q[T+$+0]=s.x,q[T+$+1]=s.y,q[T+$+2]=s.z,q[T+$+3]=0),B===!0&&(s.fromBufferAttribute(H,J),q[T+$+4]=s.x,q[T+$+5]=s.y,q[T+$+6]=s.z,q[T+$+7]=0),Z===!0&&(s.fromBufferAttribute(D,J),q[T+$+8]=s.x,q[T+$+9]=s.y,q[T+$+10]=s.z,q[T+$+11]=D.itemSize===4?s.w:1)}}f={count:v,texture:O,size:new We(Y,z)},r.set(c,f),c.addEventListener("dispose",oe)}let A=0;for(let m=0;m<d.length;m++)A+=d[m];const b=c.morphTargetsRelative?1:1-A;C.getUniforms().setValue(t,"morphTargetBaseInfluence",b),C.getUniforms().setValue(t,"morphTargetInfluences",d),C.getUniforms().setValue(t,"morphTargetsTexture",f.texture,n),C.getUniforms().setValue(t,"morphTargetsTextureSize",f.size)}else{const p=d===void 0?0:d.length;let v=i[c.id];if(v===void 0||v.length!==p){v=[];for(let B=0;B<p;B++)v[B]=[B,0];i[c.id]=v}for(let B=0;B<p;B++){const Z=v[B];Z[0]=B,Z[1]=d[B]}v.sort(aD);for(let B=0;B<8;B++)B<p&&v[B][1]?(a[B][0]=v[B][0],a[B][1]=v[B][1]):(a[B][0]=Number.MAX_SAFE_INTEGER,a[B][1]=0);a.sort(sD);const f=c.morphAttributes.position,A=c.morphAttributes.normal;let b=0;for(let B=0;B<8;B++){const Z=a[B],w=Z[0],W=Z[1];w!==Number.MAX_SAFE_INTEGER&&W?(f&&c.getAttribute("morphTarget"+B)!==f[w]&&c.setAttribute("morphTarget"+B,f[w]),A&&c.getAttribute("morphNormal"+B)!==A[w]&&c.setAttribute("morphNormal"+B,A[w]),o[B]=W,b+=W):(f&&c.hasAttribute("morphTarget"+B)===!0&&c.deleteAttribute("morphTarget"+B),A&&c.hasAttribute("morphNormal"+B)===!0&&c.deleteAttribute("morphNormal"+B),o[B]=0)}const m=c.morphTargetsRelative?1:1-b;C.getUniforms().setValue(t,"morphTargetBaseInfluence",m),C.getUniforms().setValue(t,"morphTargetInfluences",o)}}return{update:l}}function gD(t,e,n,i){let o=new WeakMap;function r(l){const g=i.render.frame,c=l.geometry,C=e.get(l,c);if(o.get(C)!==g&&(e.update(C),o.set(C,g)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),o.get(l)!==g&&(n.update(l.instanceMatrix,t.ARRAY_BUFFER),l.instanceColor!==null&&n.update(l.instanceColor,t.ARRAY_BUFFER),o.set(l,g))),l.isSkinnedMesh){const d=l.skeleton;o.get(d)!==g&&(d.update(),o.set(d,g))}return C}function s(){o=new WeakMap}function a(l){const g=l.target;g.removeEventListener("dispose",a),n.remove(g.instanceMatrix),g.instanceColor!==null&&n.remove(g.instanceColor)}return{update:r,dispose:s}}const YM=new Xn,MM=new xm,HM=new l2,FM=new Ud,rW=[],sW=[],aW=new Float32Array(16),lW=new Float32Array(9),gW=new Float32Array(4);function DI(t,e,n){const i=t[0];if(i<=0||i>0)return t;const o=e*n;let r=rW[o];if(r===void 0&&(r=new Float32Array(o),rW[o]=r),e!==0){i.toArray(r,0);for(let s=1,a=0;s!==e;++s)a+=n,t[s].toArray(r,a)}return r}function Ii(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function ui(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Nm(t,e){let n=sW[e];n===void 0&&(n=new Int32Array(e),sW[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function cD(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function ID(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ii(n,e))return;t.uniform2fv(this.addr,e),ui(n,e)}}function uD(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Ii(n,e))return;t.uniform3fv(this.addr,e),ui(n,e)}}function CD(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ii(n,e))return;t.uniform4fv(this.addr,e),ui(n,e)}}function dD(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Ii(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),ui(n,e)}else{if(Ii(n,i))return;gW.set(i),t.uniformMatrix2fv(this.addr,!1,gW),ui(n,i)}}function hD(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Ii(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),ui(n,e)}else{if(Ii(n,i))return;lW.set(i),t.uniformMatrix3fv(this.addr,!1,lW),ui(n,i)}}function AD(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Ii(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),ui(n,e)}else{if(Ii(n,i))return;aW.set(i),t.uniformMatrix4fv(this.addr,!1,aW),ui(n,i)}}function pD(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function fD(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ii(n,e))return;t.uniform2iv(this.addr,e),ui(n,e)}}function mD(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Ii(n,e))return;t.uniform3iv(this.addr,e),ui(n,e)}}function bD(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ii(n,e))return;t.uniform4iv(this.addr,e),ui(n,e)}}function yD(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function vD(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ii(n,e))return;t.uniform2uiv(this.addr,e),ui(n,e)}}function GD(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Ii(n,e))return;t.uniform3uiv(this.addr,e),ui(n,e)}}function BD(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ii(n,e))return;t.uniform4uiv(this.addr,e),ui(n,e)}}function ZD(t,e,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(t.uniform1i(this.addr,o),i[0]=o),n.setTexture2D(e||YM,o)}function wD(t,e,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(t.uniform1i(this.addr,o),i[0]=o),n.setTexture3D(e||HM,o)}function SD(t,e,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(t.uniform1i(this.addr,o),i[0]=o),n.setTextureCube(e||FM,o)}function RD(t,e,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(t.uniform1i(this.addr,o),i[0]=o),n.setTexture2DArray(e||MM,o)}function WD(t){switch(t){case 5126:return cD;case 35664:return ID;case 35665:return uD;case 35666:return CD;case 35674:return dD;case 35675:return hD;case 35676:return AD;case 5124:case 35670:return pD;case 35667:case 35671:return fD;case 35668:case 35672:return mD;case 35669:case 35673:return bD;case 5125:return yD;case 36294:return vD;case 36295:return GD;case 36296:return BD;case 35678:case 36198:case 36298:case 36306:case 35682:return ZD;case 35679:case 36299:case 36307:return wD;case 35680:case 36300:case 36308:case 36293:return SD;case 36289:case 36303:case 36311:case 36292:return RD}}function xD(t,e){t.uniform1fv(this.addr,e)}function VD(t,e){const n=DI(e,this.size,2);t.uniform2fv(this.addr,n)}function XD(t,e){const n=DI(e,this.size,3);t.uniform3fv(this.addr,n)}function ND(t,e){const n=DI(e,this.size,4);t.uniform4fv(this.addr,n)}function YD(t,e){const n=DI(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function MD(t,e){const n=DI(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function HD(t,e){const n=DI(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function FD(t,e){t.uniform1iv(this.addr,e)}function KD(t,e){t.uniform2iv(this.addr,e)}function zD(t,e){t.uniform3iv(this.addr,e)}function LD(t,e){t.uniform4iv(this.addr,e)}function ED(t,e){t.uniform1uiv(this.addr,e)}function kD(t,e){t.uniform2uiv(this.addr,e)}function TD(t,e){t.uniform3uiv(this.addr,e)}function _D(t,e){t.uniform4uiv(this.addr,e)}function UD(t,e,n){const i=this.cache,o=e.length,r=Nm(n,o);Ii(i,r)||(t.uniform1iv(this.addr,r),ui(i,r));for(let s=0;s!==o;++s)n.setTexture2D(e[s]||YM,r[s])}function PD(t,e,n){const i=this.cache,o=e.length,r=Nm(n,o);Ii(i,r)||(t.uniform1iv(this.addr,r),ui(i,r));for(let s=0;s!==o;++s)n.setTexture3D(e[s]||HM,r[s])}function DD(t,e,n){const i=this.cache,o=e.length,r=Nm(n,o);Ii(i,r)||(t.uniform1iv(this.addr,r),ui(i,r));for(let s=0;s!==o;++s)n.setTextureCube(e[s]||FM,r[s])}function JD(t,e,n){const i=this.cache,o=e.length,r=Nm(n,o);Ii(i,r)||(t.uniform1iv(this.addr,r),ui(i,r));for(let s=0;s!==o;++s)n.setTexture2DArray(e[s]||MM,r[s])}function OD(t){switch(t){case 5126:return xD;case 35664:return VD;case 35665:return XD;case 35666:return ND;case 35674:return YD;case 35675:return MD;case 35676:return HD;case 5124:case 35670:return FD;case 35667:case 35671:return KD;case 35668:case 35672:return zD;case 35669:case 35673:return LD;case 5125:return ED;case 36294:return kD;case 36295:return TD;case 36296:return _D;case 35678:case 36198:case 36298:case 36306:case 35682:return UD;case 35679:case 36299:case 36307:return PD;case 35680:case 36300:case 36308:case 36293:return DD;case 36289:case 36303:case 36311:case 36292:return JD}}class QD{constructor(e,n,i){this.id=e,this.addr=i,this.cache=[],this.setValue=WD(n.type)}}class jD{constructor(e,n,i){this.id=e,this.addr=i,this.cache=[],this.size=n.size,this.setValue=OD(n.type)}}class qD{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,i){const o=this.seq;for(let r=0,s=o.length;r!==s;++r){const a=o[r];a.setValue(e,n[a.id],i)}}}const by=/(\w+)(\])?(\[|\.)?/g;function cW(t,e){t.seq.push(e),t.map[e.id]=e}function $D(t,e,n){const i=t.name,o=i.length;for(by.lastIndex=0;;){const r=by.exec(i),s=by.lastIndex;let a=r[1];const l=r[2]==="]",g=r[3];if(l&&(a=a|0),g===void 0||g==="["&&s+2===o){cW(n,g===void 0?new QD(a,t,e):new jD(a,t,e));break}else{let C=n.map[a];C===void 0&&(C=new qD(a),cW(n,C)),n=C}}}class Jp{constructor(e,n){this.seq=[],this.map={};const i=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let o=0;o<i;++o){const r=e.getActiveUniform(n,o),s=e.getUniformLocation(n,r.name);$D(r,s,this)}}setValue(e,n,i,o){const r=this.map[n];r!==void 0&&r.setValue(e,i,o)}setOptional(e,n,i){const o=n[i];o!==void 0&&this.setValue(e,i,o)}static upload(e,n,i,o){for(let r=0,s=n.length;r!==s;++r){const a=n[r],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,o)}}static seqWithValue(e,n){const i=[];for(let o=0,r=e.length;o!==r;++o){const s=e[o];s.id in n&&i.push(s)}return i}}function IW(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}let eJ=0;function tJ(t,e){const n=t.split(`
`),i=[],o=Math.max(e-6,0),r=Math.min(e+6,n.length);for(let s=o;s<r;s++){const a=s+1;i.push(`${a===e?">":" "} ${a}: ${n[s]}`)}return i.join(`
`)}function nJ(t){switch(t){case _r:return["Linear","( value )"];case Kt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),["Linear","( value )"]}}function uW(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),o=t.getShaderInfoLog(e).trim();if(i&&o==="")return"";const r=/ERROR: 0:(\d+)/.exec(o);if(r){const s=parseInt(r[1]);return n.toUpperCase()+`

`+o+`

`+tJ(t.getShaderSource(e),s)}else return o}function iJ(t,e){const n=nJ(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function oJ(t,e){let n;switch(e){case q5:n="Linear";break;case $5:n="Reinhard";break;case eM:n="OptimizedCineon";break;case JZ:n="ACESFilmic";break;case tM:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function rJ(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.normalMapTangentSpace||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(cC).join(`
`)}function sJ(t){const e=[];for(const n in t){const i=t[n];i!==!1&&e.push("#define "+n+" "+i)}return e.join(`
`)}function aJ(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let o=0;o<i;o++){const r=t.getActiveAttrib(e,o),s=r.name;let a=1;r.type===t.FLOAT_MAT2&&(a=2),r.type===t.FLOAT_MAT3&&(a=3),r.type===t.FLOAT_MAT4&&(a=4),n[s]={type:r.type,location:t.getAttribLocation(e,s),locationSize:a}}return n}function cC(t){return t!==""}function CW(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function dW(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const lJ=/^[ \t]*#include +<([\w\d./]+)>/gm;function DG(t){return t.replace(lJ,cJ)}const gJ=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function cJ(t,e){let n=Ft[e];if(n===void 0){const i=gJ.get(e);if(i!==void 0)n=Ft[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return DG(n)}const IJ=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function hW(t){return t.replace(IJ,uJ)}function uJ(t,e,n,i){let o="";for(let r=parseInt(e);r<parseInt(n);r++)o+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return o}function AW(t){let e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function CJ(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===wm?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===BC?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===Xr&&(e="SHADOWMAP_TYPE_VSM"),e}function dJ(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Bs:case Cl:e="ENVMAP_TYPE_CUBE";break;case UI:e="ENVMAP_TYPE_CUBE_UV";break}return e}function hJ(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Cl:e="ENVMAP_MODE_REFRACTION";break}return e}function AJ(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Td:e="ENVMAP_BLENDING_MULTIPLY";break;case Q5:e="ENVMAP_BLENDING_MIX";break;case j5:e="ENVMAP_BLENDING_ADD";break}return e}function pJ(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:i,maxMip:n}}function fJ(t,e,n,i){const o=t.getContext(),r=n.defines;let s=n.vertexShader,a=n.fragmentShader;const l=CJ(n),g=dJ(n),c=hJ(n),C=AJ(n),d=pJ(n),h=n.isWebGL2?"":rJ(n),p=sJ(r),v=o.createProgram();let f,A,b=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(f=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(cC).join(`
`),f.length>0&&(f+=`
`),A=[h,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(cC).join(`
`),A.length>0&&(A+=`
`)):(f=[AW(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(cC).join(`
`),A=[h,AW(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+g:"",n.envMap?"#define "+c:"",n.envMap?"#define "+C:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==ys?"#define TONE_MAPPING":"",n.toneMapping!==ys?Ft.tonemapping_pars_fragment:"",n.toneMapping!==ys?oJ("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Ft.colorspace_pars_fragment,iJ("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(cC).join(`
`)),s=DG(s),s=CW(s,n),s=dW(s,n),a=DG(a),a=CW(a,n),a=dW(a,n),s=hW(s),a=hW(a),n.isWebGL2&&n.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,f=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+f,A=["#define varying in",n.glslVersion===_G?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===_G?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+A);const m=b+f+s,B=b+A+a,Z=IW(o,o.VERTEX_SHADER,m),w=IW(o,o.FRAGMENT_SHADER,B);if(o.attachShader(v,Z),o.attachShader(v,w),n.index0AttributeName!==void 0?o.bindAttribLocation(v,0,n.index0AttributeName):n.morphTargets===!0&&o.bindAttribLocation(v,0,"position"),o.linkProgram(v),t.debug.checkShaderErrors){const V=o.getProgramInfoLog(v).trim(),Y=o.getShaderInfoLog(Z).trim(),z=o.getShaderInfoLog(w).trim();let q=!0,O=!0;if(o.getProgramParameter(v,o.LINK_STATUS)===!1)if(q=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(o,v,Z,w);else{const te=uW(o,Z,"vertex"),oe=uW(o,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(v,o.VALIDATE_STATUS)+`

Program Info Log: `+V+`
`+te+`
`+oe)}else V!==""?console.warn("THREE.WebGLProgram: Program Info Log:",V):(Y===""||z==="")&&(O=!1);O&&(this.diagnostics={runnable:q,programLog:V,vertexShader:{log:Y,prefix:f},fragmentShader:{log:z,prefix:A}})}o.deleteShader(Z),o.deleteShader(w);let W;this.getUniforms=function(){return W===void 0&&(W=new Jp(o,v)),W};let X;return this.getAttributes=function(){return X===void 0&&(X=aJ(o,v)),X},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(v),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=eJ++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=Z,this.fragmentShader=w,this}let mJ=0;class bJ{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,i=e.fragmentShader,o=this._getShaderStage(n),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(o)===!1&&(s.add(o),o.usedTimes++),s.has(r)===!1&&(s.add(r),r.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const i of n)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let i=n.get(e);return i===void 0&&(i=new Set,n.set(e,i)),i}_getShaderStage(e){const n=this.shaderCache;let i=n.get(e);return i===void 0&&(i=new yJ(e),n.set(e,i)),i}}class yJ{constructor(e){this.id=mJ++,this.code=e,this.usedTimes=0}}function vJ(t,e,n,i,o,r,s){const a=new mg,l=new bJ,g=[],c=o.isWebGL2,C=o.logarithmicDepthBuffer,d=o.vertexTextures;let h=o.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(V){return V===0?"uv":`uv${V}`}function f(V,Y,z,q,O){const te=q.fog,oe=O.geometry,re=V.isMeshStandardMaterial?q.environment:null,se=(V.isMeshStandardMaterial?n:e).get(V.envMap||re),H=se&&se.mapping===UI?se.image.height:null,D=p[V.type];V.precision!==null&&(h=o.getMaxPrecision(V.precision),h!==V.precision&&console.warn("THREE.WebGLProgram.getParameters:",V.precision,"not supported, using",h,"instead."));const T=oe.morphAttributes.position||oe.morphAttributes.normal||oe.morphAttributes.color,J=T!==void 0?T.length:0;let $=0;oe.morphAttributes.position!==void 0&&($=1),oe.morphAttributes.normal!==void 0&&($=2),oe.morphAttributes.color!==void 0&&($=3);let Ie,fe,ve,Ge;if(D){const rn=Mr[D];Ie=rn.vertexShader,fe=rn.fragmentShader}else Ie=V.vertexShader,fe=V.fragmentShader,l.update(V),ve=l.getVertexShaderID(V),Ge=l.getFragmentShaderID(V);const Me=t.getRenderTarget(),_e=O.isInstancedMesh===!0,Bt=!!V.map,St=!!V.matcap,ot=!!se,ee=!!V.aoMap,Ne=!!V.lightMap,Se=!!V.bumpMap,He=!!V.normalMap,Ve=!!V.displacementMap,at=!!V.emissiveMap,Qe=!!V.metalnessMap,et=!!V.roughnessMap,ut=V.anisotropy>0,xt=V.clearcoat>0,on=V.iridescence>0,L=V.sheen>0,F=V.transmission>0,ce=ut&&!!V.anisotropyMap,Ye=xt&&!!V.clearcoatMap,Xe=xt&&!!V.clearcoatNormalMap,Fe=xt&&!!V.clearcoatRoughnessMap,tt=on&&!!V.iridescenceMap,ze=on&&!!V.iridescenceThicknessMap,Ae=L&&!!V.sheenColorMap,ie=L&&!!V.sheenRoughnessMap,me=!!V.specularMap,xe=!!V.specularColorMap,Ke=!!V.specularIntensityMap,ke=F&&!!V.transmissionMap,lt=F&&!!V.thicknessMap,mt=!!V.gradientMap,ae=!!V.alphaMap,pe=V.alphaTest>0,Ce=!!V.alphaHash,Le=!!V.extensions,qe=!!oe.attributes.uv1,Pt=!!oe.attributes.uv2,Cn=!!oe.attributes.uv3;let Rn=ys;return V.toneMapped&&(Me===null||Me.isXRRenderTarget===!0)&&(Rn=t.toneMapping),{isWebGL2:c,shaderID:D,shaderType:V.type,shaderName:V.name,vertexShader:Ie,fragmentShader:fe,defines:V.defines,customVertexShaderID:ve,customFragmentShaderID:Ge,isRawShaderMaterial:V.isRawShaderMaterial===!0,glslVersion:V.glslVersion,precision:h,instancing:_e,instancingColor:_e&&O.instanceColor!==null,supportsVertexTextures:d,outputColorSpace:Me===null?t.outputColorSpace:Me.isXRRenderTarget===!0?Me.texture.colorSpace:_r,map:Bt,matcap:St,envMap:ot,envMapMode:ot&&se.mapping,envMapCubeUVHeight:H,aoMap:ee,lightMap:Ne,bumpMap:Se,normalMap:He,displacementMap:d&&Ve,emissiveMap:at,normalMapObjectSpace:He&&V.normalMapType===hM,normalMapTangentSpace:He&&V.normalMapType===Gl,metalnessMap:Qe,roughnessMap:et,anisotropy:ut,anisotropyMap:ce,clearcoat:xt,clearcoatMap:Ye,clearcoatNormalMap:Xe,clearcoatRoughnessMap:Fe,iridescence:on,iridescenceMap:tt,iridescenceThicknessMap:ze,sheen:L,sheenColorMap:Ae,sheenRoughnessMap:ie,specularMap:me,specularColorMap:xe,specularIntensityMap:Ke,transmission:F,transmissionMap:ke,thicknessMap:lt,gradientMap:mt,opaque:V.transparent===!1&&V.blending===pg,alphaMap:ae,alphaTest:pe,alphaHash:Ce,combine:V.combine,mapUv:Bt&&v(V.map.channel),aoMapUv:ee&&v(V.aoMap.channel),lightMapUv:Ne&&v(V.lightMap.channel),bumpMapUv:Se&&v(V.bumpMap.channel),normalMapUv:He&&v(V.normalMap.channel),displacementMapUv:Ve&&v(V.displacementMap.channel),emissiveMapUv:at&&v(V.emissiveMap.channel),metalnessMapUv:Qe&&v(V.metalnessMap.channel),roughnessMapUv:et&&v(V.roughnessMap.channel),anisotropyMapUv:ce&&v(V.anisotropyMap.channel),clearcoatMapUv:Ye&&v(V.clearcoatMap.channel),clearcoatNormalMapUv:Xe&&v(V.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Fe&&v(V.clearcoatRoughnessMap.channel),iridescenceMapUv:tt&&v(V.iridescenceMap.channel),iridescenceThicknessMapUv:ze&&v(V.iridescenceThicknessMap.channel),sheenColorMapUv:Ae&&v(V.sheenColorMap.channel),sheenRoughnessMapUv:ie&&v(V.sheenRoughnessMap.channel),specularMapUv:me&&v(V.specularMap.channel),specularColorMapUv:xe&&v(V.specularColorMap.channel),specularIntensityMapUv:Ke&&v(V.specularIntensityMap.channel),transmissionMapUv:ke&&v(V.transmissionMap.channel),thicknessMapUv:lt&&v(V.thicknessMap.channel),alphaMapUv:ae&&v(V.alphaMap.channel),vertexTangents:!!oe.attributes.tangent&&(He||ut),vertexColors:V.vertexColors,vertexAlphas:V.vertexColors===!0&&!!oe.attributes.color&&oe.attributes.color.itemSize===4,vertexUv1s:qe,vertexUv2s:Pt,vertexUv3s:Cn,pointsUvs:O.isPoints===!0&&!!oe.attributes.uv&&(Bt||ae),fog:!!te,useFog:V.fog===!0,fogExp2:te&&te.isFogExp2,flatShading:V.flatShading===!0,sizeAttenuation:V.sizeAttenuation===!0,logarithmicDepthBuffer:C,skinning:O.isSkinnedMesh===!0,morphTargets:oe.morphAttributes.position!==void 0,morphNormals:oe.morphAttributes.normal!==void 0,morphColors:oe.morphAttributes.color!==void 0,morphTargetsCount:J,morphTextureStride:$,numDirLights:Y.directional.length,numPointLights:Y.point.length,numSpotLights:Y.spot.length,numSpotLightMaps:Y.spotLightMap.length,numRectAreaLights:Y.rectArea.length,numHemiLights:Y.hemi.length,numDirLightShadows:Y.directionalShadowMap.length,numPointLightShadows:Y.pointShadowMap.length,numSpotLightShadows:Y.spotShadowMap.length,numSpotLightShadowsWithMaps:Y.numSpotLightShadowsWithMaps,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:V.dithering,shadowMapEnabled:t.shadowMap.enabled&&z.length>0,shadowMapType:t.shadowMap.type,toneMapping:Rn,useLegacyLights:t._useLegacyLights,premultipliedAlpha:V.premultipliedAlpha,doubleSided:V.side===Fr,flipSided:V.side===Si,useDepthPacking:V.depthPacking>=0,depthPacking:V.depthPacking||0,index0AttributeName:V.index0AttributeName,extensionDerivatives:Le&&V.extensions.derivatives===!0,extensionFragDepth:Le&&V.extensions.fragDepth===!0,extensionDrawBuffers:Le&&V.extensions.drawBuffers===!0,extensionShaderTextureLOD:Le&&V.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:c||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||i.has("EXT_shader_texture_lod"),customProgramCacheKey:V.customProgramCacheKey()}}function A(V){const Y=[];if(V.shaderID?Y.push(V.shaderID):(Y.push(V.customVertexShaderID),Y.push(V.customFragmentShaderID)),V.defines!==void 0)for(const z in V.defines)Y.push(z),Y.push(V.defines[z]);return V.isRawShaderMaterial===!1&&(b(Y,V),m(Y,V),Y.push(t.outputColorSpace)),Y.push(V.customProgramCacheKey),Y.join()}function b(V,Y){V.push(Y.precision),V.push(Y.outputColorSpace),V.push(Y.envMapMode),V.push(Y.envMapCubeUVHeight),V.push(Y.mapUv),V.push(Y.alphaMapUv),V.push(Y.lightMapUv),V.push(Y.aoMapUv),V.push(Y.bumpMapUv),V.push(Y.normalMapUv),V.push(Y.displacementMapUv),V.push(Y.emissiveMapUv),V.push(Y.metalnessMapUv),V.push(Y.roughnessMapUv),V.push(Y.anisotropyMapUv),V.push(Y.clearcoatMapUv),V.push(Y.clearcoatNormalMapUv),V.push(Y.clearcoatRoughnessMapUv),V.push(Y.iridescenceMapUv),V.push(Y.iridescenceThicknessMapUv),V.push(Y.sheenColorMapUv),V.push(Y.sheenRoughnessMapUv),V.push(Y.specularMapUv),V.push(Y.specularColorMapUv),V.push(Y.specularIntensityMapUv),V.push(Y.transmissionMapUv),V.push(Y.thicknessMapUv),V.push(Y.combine),V.push(Y.fogExp2),V.push(Y.sizeAttenuation),V.push(Y.morphTargetsCount),V.push(Y.morphAttributeCount),V.push(Y.numDirLights),V.push(Y.numPointLights),V.push(Y.numSpotLights),V.push(Y.numSpotLightMaps),V.push(Y.numHemiLights),V.push(Y.numRectAreaLights),V.push(Y.numDirLightShadows),V.push(Y.numPointLightShadows),V.push(Y.numSpotLightShadows),V.push(Y.numSpotLightShadowsWithMaps),V.push(Y.shadowMapType),V.push(Y.toneMapping),V.push(Y.numClippingPlanes),V.push(Y.numClipIntersection),V.push(Y.depthPacking)}function m(V,Y){a.disableAll(),Y.isWebGL2&&a.enable(0),Y.supportsVertexTextures&&a.enable(1),Y.instancing&&a.enable(2),Y.instancingColor&&a.enable(3),Y.matcap&&a.enable(4),Y.envMap&&a.enable(5),Y.normalMapObjectSpace&&a.enable(6),Y.normalMapTangentSpace&&a.enable(7),Y.clearcoat&&a.enable(8),Y.iridescence&&a.enable(9),Y.alphaTest&&a.enable(10),Y.vertexColors&&a.enable(11),Y.vertexAlphas&&a.enable(12),Y.vertexUv1s&&a.enable(13),Y.vertexUv2s&&a.enable(14),Y.vertexUv3s&&a.enable(15),Y.vertexTangents&&a.enable(16),Y.anisotropy&&a.enable(17),V.push(a.mask),a.disableAll(),Y.fog&&a.enable(0),Y.useFog&&a.enable(1),Y.flatShading&&a.enable(2),Y.logarithmicDepthBuffer&&a.enable(3),Y.skinning&&a.enable(4),Y.morphTargets&&a.enable(5),Y.morphNormals&&a.enable(6),Y.morphColors&&a.enable(7),Y.premultipliedAlpha&&a.enable(8),Y.shadowMapEnabled&&a.enable(9),Y.useLegacyLights&&a.enable(10),Y.doubleSided&&a.enable(11),Y.flipSided&&a.enable(12),Y.useDepthPacking&&a.enable(13),Y.dithering&&a.enable(14),Y.transmission&&a.enable(15),Y.sheen&&a.enable(16),Y.opaque&&a.enable(17),Y.pointsUvs&&a.enable(18),V.push(a.mask)}function B(V){const Y=p[V.type];let z;if(Y){const q=Mr[Y];z=Vm.clone(q.uniforms)}else z=V.uniforms;return z}function Z(V,Y){let z;for(let q=0,O=g.length;q<O;q++){const te=g[q];if(te.cacheKey===Y){z=te,++z.usedTimes;break}}return z===void 0&&(z=new fJ(t,Y,V,r),g.push(z)),z}function w(V){if(--V.usedTimes===0){const Y=g.indexOf(V);g[Y]=g[g.length-1],g.pop(),V.destroy()}}function W(V){l.remove(V)}function X(){l.dispose()}return{getParameters:f,getProgramCacheKey:A,getUniforms:B,acquireProgram:Z,releaseProgram:w,releaseShaderCache:W,programs:g,dispose:X}}function GJ(){let t=new WeakMap;function e(r){let s=t.get(r);return s===void 0&&(s={},t.set(r,s)),s}function n(r){t.delete(r)}function i(r,s,a){t.get(r)[s]=a}function o(){t=new WeakMap}return{get:e,remove:n,update:i,dispose:o}}function BJ(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function pW(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function fW(){const t=[];let e=0;const n=[],i=[],o=[];function r(){e=0,n.length=0,i.length=0,o.length=0}function s(C,d,h,p,v,f){let A=t[e];return A===void 0?(A={id:C.id,object:C,geometry:d,material:h,groupOrder:p,renderOrder:C.renderOrder,z:v,group:f},t[e]=A):(A.id=C.id,A.object=C,A.geometry=d,A.material=h,A.groupOrder=p,A.renderOrder=C.renderOrder,A.z=v,A.group=f),e++,A}function a(C,d,h,p,v,f){const A=s(C,d,h,p,v,f);h.transmission>0?i.push(A):h.transparent===!0?o.push(A):n.push(A)}function l(C,d,h,p,v,f){const A=s(C,d,h,p,v,f);h.transmission>0?i.unshift(A):h.transparent===!0?o.unshift(A):n.unshift(A)}function g(C,d){n.length>1&&n.sort(C||BJ),i.length>1&&i.sort(d||pW),o.length>1&&o.sort(d||pW)}function c(){for(let C=e,d=t.length;C<d;C++){const h=t[C];if(h.id===null)break;h.id=null,h.object=null,h.geometry=null,h.material=null,h.group=null}}return{opaque:n,transmissive:i,transparent:o,init:r,push:a,unshift:l,finish:c,sort:g}}function ZJ(){let t=new WeakMap;function e(i,o){const r=t.get(i);let s;return r===void 0?(s=new fW,t.set(i,[s])):o>=r.length?(s=new fW,r.push(s)):s=r[o],s}function n(){t=new WeakMap}return{get:e,dispose:n}}function wJ(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new E,color:new je};break;case"SpotLight":n={position:new E,direction:new E,color:new je,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new E,color:new je,distance:0,decay:0};break;case"HemisphereLight":n={direction:new E,skyColor:new je,groundColor:new je};break;case"RectAreaLight":n={color:new je,position:new E,halfWidth:new E,halfHeight:new E};break}return t[e.id]=n,n}}}function SJ(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new We};break;case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new We};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new We,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let RJ=0;function WJ(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function xJ(t,e){const n=new wJ,i=SJ(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let c=0;c<9;c++)o.probe.push(new E);const r=new E,s=new Wt,a=new Wt;function l(c,C){let d=0,h=0,p=0;for(let z=0;z<9;z++)o.probe[z].set(0,0,0);let v=0,f=0,A=0,b=0,m=0,B=0,Z=0,w=0,W=0,X=0;c.sort(WJ);const V=C===!0?Math.PI:1;for(let z=0,q=c.length;z<q;z++){const O=c[z],te=O.color,oe=O.intensity,re=O.distance,se=O.shadow&&O.shadow.map?O.shadow.map.texture:null;if(O.isAmbientLight)d+=te.r*oe*V,h+=te.g*oe*V,p+=te.b*oe*V;else if(O.isLightProbe)for(let H=0;H<9;H++)o.probe[H].addScaledVector(O.sh.coefficients[H],oe);else if(O.isDirectionalLight){const H=n.get(O);if(H.color.copy(O.color).multiplyScalar(O.intensity*V),O.castShadow){const D=O.shadow,T=i.get(O);T.shadowBias=D.bias,T.shadowNormalBias=D.normalBias,T.shadowRadius=D.radius,T.shadowMapSize=D.mapSize,o.directionalShadow[v]=T,o.directionalShadowMap[v]=se,o.directionalShadowMatrix[v]=O.shadow.matrix,B++}o.directional[v]=H,v++}else if(O.isSpotLight){const H=n.get(O);H.position.setFromMatrixPosition(O.matrixWorld),H.color.copy(te).multiplyScalar(oe*V),H.distance=re,H.coneCos=Math.cos(O.angle),H.penumbraCos=Math.cos(O.angle*(1-O.penumbra)),H.decay=O.decay,o.spot[A]=H;const D=O.shadow;if(O.map&&(o.spotLightMap[W]=O.map,W++,D.updateMatrices(O),O.castShadow&&X++),o.spotLightMatrix[A]=D.matrix,O.castShadow){const T=i.get(O);T.shadowBias=D.bias,T.shadowNormalBias=D.normalBias,T.shadowRadius=D.radius,T.shadowMapSize=D.mapSize,o.spotShadow[A]=T,o.spotShadowMap[A]=se,w++}A++}else if(O.isRectAreaLight){const H=n.get(O);H.color.copy(te).multiplyScalar(oe),H.halfWidth.set(O.width*.5,0,0),H.halfHeight.set(0,O.height*.5,0),o.rectArea[b]=H,b++}else if(O.isPointLight){const H=n.get(O);if(H.color.copy(O.color).multiplyScalar(O.intensity*V),H.distance=O.distance,H.decay=O.decay,O.castShadow){const D=O.shadow,T=i.get(O);T.shadowBias=D.bias,T.shadowNormalBias=D.normalBias,T.shadowRadius=D.radius,T.shadowMapSize=D.mapSize,T.shadowCameraNear=D.camera.near,T.shadowCameraFar=D.camera.far,o.pointShadow[f]=T,o.pointShadowMap[f]=se,o.pointShadowMatrix[f]=O.shadow.matrix,Z++}o.point[f]=H,f++}else if(O.isHemisphereLight){const H=n.get(O);H.skyColor.copy(O.color).multiplyScalar(oe*V),H.groundColor.copy(O.groundColor).multiplyScalar(oe*V),o.hemi[m]=H,m++}}b>0&&(e.isWebGL2||t.has("OES_texture_float_linear")===!0?(o.rectAreaLTC1=Oe.LTC_FLOAT_1,o.rectAreaLTC2=Oe.LTC_FLOAT_2):t.has("OES_texture_half_float_linear")===!0?(o.rectAreaLTC1=Oe.LTC_HALF_1,o.rectAreaLTC2=Oe.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=d,o.ambient[1]=h,o.ambient[2]=p;const Y=o.hash;(Y.directionalLength!==v||Y.pointLength!==f||Y.spotLength!==A||Y.rectAreaLength!==b||Y.hemiLength!==m||Y.numDirectionalShadows!==B||Y.numPointShadows!==Z||Y.numSpotShadows!==w||Y.numSpotMaps!==W)&&(o.directional.length=v,o.spot.length=A,o.rectArea.length=b,o.point.length=f,o.hemi.length=m,o.directionalShadow.length=B,o.directionalShadowMap.length=B,o.pointShadow.length=Z,o.pointShadowMap.length=Z,o.spotShadow.length=w,o.spotShadowMap.length=w,o.directionalShadowMatrix.length=B,o.pointShadowMatrix.length=Z,o.spotLightMatrix.length=w+W-X,o.spotLightMap.length=W,o.numSpotLightShadowsWithMaps=X,Y.directionalLength=v,Y.pointLength=f,Y.spotLength=A,Y.rectAreaLength=b,Y.hemiLength=m,Y.numDirectionalShadows=B,Y.numPointShadows=Z,Y.numSpotShadows=w,Y.numSpotMaps=W,o.version=RJ++)}function g(c,C){let d=0,h=0,p=0,v=0,f=0;const A=C.matrixWorldInverse;for(let b=0,m=c.length;b<m;b++){const B=c[b];if(B.isDirectionalLight){const Z=o.directional[d];Z.direction.setFromMatrixPosition(B.matrixWorld),r.setFromMatrixPosition(B.target.matrixWorld),Z.direction.sub(r),Z.direction.transformDirection(A),d++}else if(B.isSpotLight){const Z=o.spot[p];Z.position.setFromMatrixPosition(B.matrixWorld),Z.position.applyMatrix4(A),Z.direction.setFromMatrixPosition(B.matrixWorld),r.setFromMatrixPosition(B.target.matrixWorld),Z.direction.sub(r),Z.direction.transformDirection(A),p++}else if(B.isRectAreaLight){const Z=o.rectArea[v];Z.position.setFromMatrixPosition(B.matrixWorld),Z.position.applyMatrix4(A),a.identity(),s.copy(B.matrixWorld),s.premultiply(A),a.extractRotation(s),Z.halfWidth.set(B.width*.5,0,0),Z.halfHeight.set(0,B.height*.5,0),Z.halfWidth.applyMatrix4(a),Z.halfHeight.applyMatrix4(a),v++}else if(B.isPointLight){const Z=o.point[h];Z.position.setFromMatrixPosition(B.matrixWorld),Z.position.applyMatrix4(A),h++}else if(B.isHemisphereLight){const Z=o.hemi[f];Z.direction.setFromMatrixPosition(B.matrixWorld),Z.direction.transformDirection(A),f++}}}return{setup:l,setupView:g,state:o}}function mW(t,e){const n=new xJ(t,e),i=[],o=[];function r(){i.length=0,o.length=0}function s(C){i.push(C)}function a(C){o.push(C)}function l(C){n.setup(i,C)}function g(C){n.setupView(i,C)}return{init:r,state:{lightsArray:i,shadowsArray:o,lights:n},setupLights:l,setupLightsView:g,pushLight:s,pushShadow:a}}function VJ(t,e){let n=new WeakMap;function i(r,s=0){const a=n.get(r);let l;return a===void 0?(l=new mW(t,e),n.set(r,[l])):s>=a.length?(l=new mW(t,e),a.push(l)):l=a[s],l}function o(){n=new WeakMap}return{get:i,dispose:o}}class C2 extends Wi{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=CM,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class d2 extends Wi{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const XJ=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,NJ=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function YJ(t,e,n){let i=new Xm;const o=new We,r=new We,s=new cn,a=new C2({depthPacking:dM}),l=new d2,g={},c=n.maxTextureSize,C={[Ca]:Si,[Si]:Ca,[Fr]:Fr},d=new ao({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new We},radius:{value:4}},vertexShader:XJ,fragmentShader:NJ}),h=d.clone();h.defines.HORIZONTAL_PASS=1;const p=new _t;p.setAttribute("position",new un(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new ci(p,d),f=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=wm;let A=this.type;this.render=function(Z,w,W){if(f.enabled===!1||f.autoUpdate===!1&&f.needsUpdate===!1||Z.length===0)return;const X=t.getRenderTarget(),V=t.getActiveCubeFace(),Y=t.getActiveMipmapLevel(),z=t.state;z.setBlending(aa),z.buffers.color.setClear(1,1,1,1),z.buffers.depth.setTest(!0),z.setScissorTest(!1);const q=A!==Xr&&this.type===Xr,O=A===Xr&&this.type!==Xr;for(let te=0,oe=Z.length;te<oe;te++){const re=Z[te],se=re.shadow;if(se===void 0){console.warn("THREE.WebGLShadowMap:",re,"has no shadow.");continue}if(se.autoUpdate===!1&&se.needsUpdate===!1)continue;o.copy(se.mapSize);const H=se.getFrameExtents();if(o.multiply(H),r.copy(se.mapSize),(o.x>c||o.y>c)&&(o.x>c&&(r.x=Math.floor(c/H.x),o.x=r.x*H.x,se.mapSize.x=r.x),o.y>c&&(r.y=Math.floor(c/H.y),o.y=r.y*H.y,se.mapSize.y=r.y)),se.map===null||q===!0||O===!0){const T=this.type!==Xr?{minFilter:Qn,magFilter:Qn}:{};se.map!==null&&se.map.dispose(),se.map=new Ar(o.x,o.y,T),se.map.texture.name=re.name+".shadowMap",se.camera.updateProjectionMatrix()}t.setRenderTarget(se.map),t.clear();const D=se.getViewportCount();for(let T=0;T<D;T++){const J=se.getViewport(T);s.set(r.x*J.x,r.y*J.y,r.x*J.z,r.y*J.w),z.viewport(s),se.updateMatrices(re,T),i=se.getFrustum(),B(w,W,se.camera,re,this.type)}se.isPointLightShadow!==!0&&this.type===Xr&&b(se,W),se.needsUpdate=!1}A=this.type,f.needsUpdate=!1,t.setRenderTarget(X,V,Y)};function b(Z,w){const W=e.update(v);d.defines.VSM_SAMPLES!==Z.blurSamples&&(d.defines.VSM_SAMPLES=Z.blurSamples,h.defines.VSM_SAMPLES=Z.blurSamples,d.needsUpdate=!0,h.needsUpdate=!0),Z.mapPass===null&&(Z.mapPass=new Ar(o.x,o.y)),d.uniforms.shadow_pass.value=Z.map.texture,d.uniforms.resolution.value=Z.mapSize,d.uniforms.radius.value=Z.radius,t.setRenderTarget(Z.mapPass),t.clear(),t.renderBufferDirect(w,null,W,d,v,null),h.uniforms.shadow_pass.value=Z.mapPass.texture,h.uniforms.resolution.value=Z.mapSize,h.uniforms.radius.value=Z.radius,t.setRenderTarget(Z.map),t.clear(),t.renderBufferDirect(w,null,W,h,v,null)}function m(Z,w,W,X){let V=null;const Y=W.isPointLight===!0?Z.customDistanceMaterial:Z.customDepthMaterial;if(Y!==void 0)V=Y;else if(V=W.isPointLight===!0?l:a,t.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){const z=V.uuid,q=w.uuid;let O=g[z];O===void 0&&(O={},g[z]=O);let te=O[q];te===void 0&&(te=V.clone(),O[q]=te),V=te}if(V.visible=w.visible,V.wireframe=w.wireframe,X===Xr?V.side=w.shadowSide!==null?w.shadowSide:w.side:V.side=w.shadowSide!==null?w.shadowSide:C[w.side],V.alphaMap=w.alphaMap,V.alphaTest=w.alphaTest,V.map=w.map,V.clipShadows=w.clipShadows,V.clippingPlanes=w.clippingPlanes,V.clipIntersection=w.clipIntersection,V.displacementMap=w.displacementMap,V.displacementScale=w.displacementScale,V.displacementBias=w.displacementBias,V.wireframeLinewidth=w.wireframeLinewidth,V.linewidth=w.linewidth,W.isPointLight===!0&&V.isMeshDistanceMaterial===!0){const z=t.properties.get(V);z.light=W}return V}function B(Z,w,W,X,V){if(Z.visible===!1)return;if(Z.layers.test(w.layers)&&(Z.isMesh||Z.isLine||Z.isPoints)&&(Z.castShadow||Z.receiveShadow&&V===Xr)&&(!Z.frustumCulled||i.intersectsObject(Z))){Z.modelViewMatrix.multiplyMatrices(W.matrixWorldInverse,Z.matrixWorld);const q=e.update(Z),O=Z.material;if(Array.isArray(O)){const te=q.groups;for(let oe=0,re=te.length;oe<re;oe++){const se=te[oe],H=O[se.materialIndex];if(H&&H.visible){const D=m(Z,H,X,V);t.renderBufferDirect(W,null,q,D,Z,se)}}}else if(O.visible){const te=m(Z,O,X,V);t.renderBufferDirect(W,null,q,te,Z,null)}}const z=Z.children;for(let q=0,O=z.length;q<O;q++)B(z[q],w,W,X,V)}}function MJ(t,e,n){const i=n.isWebGL2;function o(){let ae=!1;const pe=new cn;let Ce=null;const Le=new cn(0,0,0,0);return{setMask:function(qe){Ce!==qe&&!ae&&(t.colorMask(qe,qe,qe,qe),Ce=qe)},setLocked:function(qe){ae=qe},setClear:function(qe,Pt,Cn,Rn,Vo){Vo===!0&&(qe*=Rn,Pt*=Rn,Cn*=Rn),pe.set(qe,Pt,Cn,Rn),Le.equals(pe)===!1&&(t.clearColor(qe,Pt,Cn,Rn),Le.copy(pe))},reset:function(){ae=!1,Ce=null,Le.set(-1,0,0,0)}}}function r(){let ae=!1,pe=null,Ce=null,Le=null;return{setTest:function(qe){qe?Me(t.DEPTH_TEST):_e(t.DEPTH_TEST)},setMask:function(qe){pe!==qe&&!ae&&(t.depthMask(qe),pe=qe)},setFunc:function(qe){if(Ce!==qe){switch(qe){case T5:t.depthFunc(t.NEVER);break;case _5:t.depthFunc(t.ALWAYS);break;case U5:t.depthFunc(t.LESS);break;case Xf:t.depthFunc(t.LEQUAL);break;case P5:t.depthFunc(t.EQUAL);break;case D5:t.depthFunc(t.GEQUAL);break;case J5:t.depthFunc(t.GREATER);break;case O5:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}Ce=qe}},setLocked:function(qe){ae=qe},setClear:function(qe){Le!==qe&&(t.clearDepth(qe),Le=qe)},reset:function(){ae=!1,pe=null,Ce=null,Le=null}}}function s(){let ae=!1,pe=null,Ce=null,Le=null,qe=null,Pt=null,Cn=null,Rn=null,Vo=null;return{setTest:function(rn){ae||(rn?Me(t.STENCIL_TEST):_e(t.STENCIL_TEST))},setMask:function(rn){pe!==rn&&!ae&&(t.stencilMask(rn),pe=rn)},setFunc:function(rn,Di,ri){(Ce!==rn||Le!==Di||qe!==ri)&&(t.stencilFunc(rn,Di,ri),Ce=rn,Le=Di,qe=ri)},setOp:function(rn,Di,ri){(Pt!==rn||Cn!==Di||Rn!==ri)&&(t.stencilOp(rn,Di,ri),Pt=rn,Cn=Di,Rn=ri)},setLocked:function(rn){ae=rn},setClear:function(rn){Vo!==rn&&(t.clearStencil(rn),Vo=rn)},reset:function(){ae=!1,pe=null,Ce=null,Le=null,qe=null,Pt=null,Cn=null,Rn=null,Vo=null}}}const a=new o,l=new r,g=new s,c=new WeakMap,C=new WeakMap;let d={},h={},p=new WeakMap,v=[],f=null,A=!1,b=null,m=null,B=null,Z=null,w=null,W=null,X=null,V=!1,Y=null,z=null,q=null,O=null,te=null;const oe=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let re=!1,se=0;const H=t.getParameter(t.VERSION);H.indexOf("WebGL")!==-1?(se=parseFloat(/^WebGL (\d)/.exec(H)[1]),re=se>=1):H.indexOf("OpenGL ES")!==-1&&(se=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),re=se>=2);let D=null,T={};const J=t.getParameter(t.SCISSOR_BOX),$=t.getParameter(t.VIEWPORT),Ie=new cn().fromArray(J),fe=new cn().fromArray($);function ve(ae,pe,Ce,Le){const qe=new Uint8Array(4),Pt=t.createTexture();t.bindTexture(ae,Pt),t.texParameteri(ae,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(ae,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Cn=0;Cn<Ce;Cn++)i&&(ae===t.TEXTURE_3D||ae===t.TEXTURE_2D_ARRAY)?t.texImage3D(pe,0,t.RGBA,1,1,Le,0,t.RGBA,t.UNSIGNED_BYTE,qe):t.texImage2D(pe+Cn,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,qe);return Pt}const Ge={};Ge[t.TEXTURE_2D]=ve(t.TEXTURE_2D,t.TEXTURE_2D,1),Ge[t.TEXTURE_CUBE_MAP]=ve(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(Ge[t.TEXTURE_2D_ARRAY]=ve(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),Ge[t.TEXTURE_3D]=ve(t.TEXTURE_3D,t.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),g.setClear(0),Me(t.DEPTH_TEST),l.setFunc(Xf),Ve(!1),at(hG),Me(t.CULL_FACE),Se(aa);function Me(ae){d[ae]!==!0&&(t.enable(ae),d[ae]=!0)}function _e(ae){d[ae]!==!1&&(t.disable(ae),d[ae]=!1)}function Bt(ae,pe){return h[ae]!==pe?(t.bindFramebuffer(ae,pe),h[ae]=pe,i&&(ae===t.DRAW_FRAMEBUFFER&&(h[t.FRAMEBUFFER]=pe),ae===t.FRAMEBUFFER&&(h[t.DRAW_FRAMEBUFFER]=pe)),!0):!1}function St(ae,pe){let Ce=v,Le=!1;if(ae)if(Ce=p.get(pe),Ce===void 0&&(Ce=[],p.set(pe,Ce)),ae.isWebGLMultipleRenderTargets){const qe=ae.texture;if(Ce.length!==qe.length||Ce[0]!==t.COLOR_ATTACHMENT0){for(let Pt=0,Cn=qe.length;Pt<Cn;Pt++)Ce[Pt]=t.COLOR_ATTACHMENT0+Pt;Ce.length=qe.length,Le=!0}}else Ce[0]!==t.COLOR_ATTACHMENT0&&(Ce[0]=t.COLOR_ATTACHMENT0,Le=!0);else Ce[0]!==t.BACK&&(Ce[0]=t.BACK,Le=!0);Le&&(n.isWebGL2?t.drawBuffers(Ce):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ce))}function ot(ae){return f!==ae?(t.useProgram(ae),f=ae,!0):!1}const ee={[$l]:t.FUNC_ADD,[X5]:t.FUNC_SUBTRACT,[N5]:t.FUNC_REVERSE_SUBTRACT};if(i)ee[mG]=t.MIN,ee[bG]=t.MAX;else{const ae=e.get("EXT_blend_minmax");ae!==null&&(ee[mG]=ae.MIN_EXT,ee[bG]=ae.MAX_EXT)}const Ne={[Y5]:t.ZERO,[M5]:t.ONE,[H5]:t.SRC_COLOR,[PZ]:t.SRC_ALPHA,[k5]:t.SRC_ALPHA_SATURATE,[L5]:t.DST_COLOR,[K5]:t.DST_ALPHA,[F5]:t.ONE_MINUS_SRC_COLOR,[DZ]:t.ONE_MINUS_SRC_ALPHA,[E5]:t.ONE_MINUS_DST_COLOR,[z5]:t.ONE_MINUS_DST_ALPHA};function Se(ae,pe,Ce,Le,qe,Pt,Cn,Rn){if(ae===aa){A===!0&&(_e(t.BLEND),A=!1);return}if(A===!1&&(Me(t.BLEND),A=!0),ae!==V5){if(ae!==b||Rn!==V){if((m!==$l||w!==$l)&&(t.blendEquation(t.FUNC_ADD),m=$l,w=$l),Rn)switch(ae){case pg:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case AG:t.blendFunc(t.ONE,t.ONE);break;case pG:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case fG:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ae);break}else switch(ae){case pg:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case AG:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case pG:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case fG:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ae);break}B=null,Z=null,W=null,X=null,b=ae,V=Rn}return}qe=qe||pe,Pt=Pt||Ce,Cn=Cn||Le,(pe!==m||qe!==w)&&(t.blendEquationSeparate(ee[pe],ee[qe]),m=pe,w=qe),(Ce!==B||Le!==Z||Pt!==W||Cn!==X)&&(t.blendFuncSeparate(Ne[Ce],Ne[Le],Ne[Pt],Ne[Cn]),B=Ce,Z=Le,W=Pt,X=Cn),b=ae,V=!1}function He(ae,pe){ae.side===Fr?_e(t.CULL_FACE):Me(t.CULL_FACE);let Ce=ae.side===Si;pe&&(Ce=!Ce),Ve(Ce),ae.blending===pg&&ae.transparent===!1?Se(aa):Se(ae.blending,ae.blendEquation,ae.blendSrc,ae.blendDst,ae.blendEquationAlpha,ae.blendSrcAlpha,ae.blendDstAlpha,ae.premultipliedAlpha),l.setFunc(ae.depthFunc),l.setTest(ae.depthTest),l.setMask(ae.depthWrite),a.setMask(ae.colorWrite);const Le=ae.stencilWrite;g.setTest(Le),Le&&(g.setMask(ae.stencilWriteMask),g.setFunc(ae.stencilFunc,ae.stencilRef,ae.stencilFuncMask),g.setOp(ae.stencilFail,ae.stencilZFail,ae.stencilZPass)),et(ae.polygonOffset,ae.polygonOffsetFactor,ae.polygonOffsetUnits),ae.alphaToCoverage===!0?Me(t.SAMPLE_ALPHA_TO_COVERAGE):_e(t.SAMPLE_ALPHA_TO_COVERAGE)}function Ve(ae){Y!==ae&&(ae?t.frontFace(t.CW):t.frontFace(t.CCW),Y=ae)}function at(ae){ae!==R5?(Me(t.CULL_FACE),ae!==z&&(ae===hG?t.cullFace(t.BACK):ae===W5?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):_e(t.CULL_FACE),z=ae}function Qe(ae){ae!==q&&(re&&t.lineWidth(ae),q=ae)}function et(ae,pe,Ce){ae?(Me(t.POLYGON_OFFSET_FILL),(O!==pe||te!==Ce)&&(t.polygonOffset(pe,Ce),O=pe,te=Ce)):_e(t.POLYGON_OFFSET_FILL)}function ut(ae){ae?Me(t.SCISSOR_TEST):_e(t.SCISSOR_TEST)}function xt(ae){ae===void 0&&(ae=t.TEXTURE0+oe-1),D!==ae&&(t.activeTexture(ae),D=ae)}function on(ae,pe,Ce){Ce===void 0&&(D===null?Ce=t.TEXTURE0+oe-1:Ce=D);let Le=T[Ce];Le===void 0&&(Le={type:void 0,texture:void 0},T[Ce]=Le),(Le.type!==ae||Le.texture!==pe)&&(D!==Ce&&(t.activeTexture(Ce),D=Ce),t.bindTexture(ae,pe||Ge[ae]),Le.type=ae,Le.texture=pe)}function L(){const ae=T[D];ae!==void 0&&ae.type!==void 0&&(t.bindTexture(ae.type,null),ae.type=void 0,ae.texture=void 0)}function F(){try{t.compressedTexImage2D.apply(t,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function ce(){try{t.compressedTexImage3D.apply(t,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function Ye(){try{t.texSubImage2D.apply(t,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function Xe(){try{t.texSubImage3D.apply(t,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function Fe(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function tt(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function ze(){try{t.texStorage2D.apply(t,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function Ae(){try{t.texStorage3D.apply(t,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function ie(){try{t.texImage2D.apply(t,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function me(){try{t.texImage3D.apply(t,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function xe(ae){Ie.equals(ae)===!1&&(t.scissor(ae.x,ae.y,ae.z,ae.w),Ie.copy(ae))}function Ke(ae){fe.equals(ae)===!1&&(t.viewport(ae.x,ae.y,ae.z,ae.w),fe.copy(ae))}function ke(ae,pe){let Ce=C.get(pe);Ce===void 0&&(Ce=new WeakMap,C.set(pe,Ce));let Le=Ce.get(ae);Le===void 0&&(Le=t.getUniformBlockIndex(pe,ae.name),Ce.set(ae,Le))}function lt(ae,pe){const Le=C.get(pe).get(ae);c.get(pe)!==Le&&(t.uniformBlockBinding(pe,Le,ae.__bindingPointIndex),c.set(pe,Le))}function mt(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),i===!0&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),d={},D=null,T={},h={},p=new WeakMap,v=[],f=null,A=!1,b=null,m=null,B=null,Z=null,w=null,W=null,X=null,V=!1,Y=null,z=null,q=null,O=null,te=null,Ie.set(0,0,t.canvas.width,t.canvas.height),fe.set(0,0,t.canvas.width,t.canvas.height),a.reset(),l.reset(),g.reset()}return{buffers:{color:a,depth:l,stencil:g},enable:Me,disable:_e,bindFramebuffer:Bt,drawBuffers:St,useProgram:ot,setBlending:Se,setMaterial:He,setFlipSided:Ve,setCullFace:at,setLineWidth:Qe,setPolygonOffset:et,setScissorTest:ut,activeTexture:xt,bindTexture:on,unbindTexture:L,compressedTexImage2D:F,compressedTexImage3D:ce,texImage2D:ie,texImage3D:me,updateUBOMapping:ke,uniformBlockBinding:lt,texStorage2D:ze,texStorage3D:Ae,texSubImage2D:Ye,texSubImage3D:Xe,compressedTexSubImage2D:Fe,compressedTexSubImage3D:tt,scissor:xe,viewport:Ke,reset:mt}}function HJ(t,e,n,i,o,r,s){const a=o.isWebGL2,l=o.maxTextures,g=o.maxCubemapSize,c=o.maxTextureSize,C=o.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,h=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let v;const f=new WeakMap;let A=!1;try{A=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(L,F){return A?new OffscreenCanvas(L,F):Id("canvas")}function m(L,F,ce,Ye){let Xe=1;if((L.width>Ye||L.height>Ye)&&(Xe=Ye/Math.max(L.width,L.height)),Xe<1||F===!0)if(typeof HTMLImageElement<"u"&&L instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&L instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&L instanceof ImageBitmap){const Fe=F?Mf:Math.floor,tt=Fe(Xe*L.width),ze=Fe(Xe*L.height);v===void 0&&(v=b(tt,ze));const Ae=ce?b(tt,ze):v;return Ae.width=tt,Ae.height=ze,Ae.getContext("2d").drawImage(L,0,0,tt,ze),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+L.width+"x"+L.height+") to ("+tt+"x"+ze+")."),Ae}else return"data"in L&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+L.width+"x"+L.height+")."),L;return L}function B(L){return UG(L.width)&&UG(L.height)}function Z(L){return a?!1:L.wrapS!==ki||L.wrapT!==ki||L.minFilter!==Qn&&L.minFilter!==bn}function w(L,F){return L.generateMipmaps&&F&&L.minFilter!==Qn&&L.minFilter!==bn}function W(L){t.generateMipmap(L)}function X(L,F,ce,Ye,Xe=!1){if(a===!1)return F;if(L!==null){if(t[L]!==void 0)return t[L];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+L+"'")}let Fe=F;return F===t.RED&&(ce===t.FLOAT&&(Fe=t.R32F),ce===t.HALF_FLOAT&&(Fe=t.R16F),ce===t.UNSIGNED_BYTE&&(Fe=t.R8)),F===t.RED_INTEGER&&(ce===t.UNSIGNED_BYTE&&(Fe=t.R8UI),ce===t.UNSIGNED_SHORT&&(Fe=t.R16UI),ce===t.UNSIGNED_INT&&(Fe=t.R32UI),ce===t.BYTE&&(Fe=t.R8I),ce===t.SHORT&&(Fe=t.R16I),ce===t.INT&&(Fe=t.R32I)),F===t.RG&&(ce===t.FLOAT&&(Fe=t.RG32F),ce===t.HALF_FLOAT&&(Fe=t.RG16F),ce===t.UNSIGNED_BYTE&&(Fe=t.RG8)),F===t.RGBA&&(ce===t.FLOAT&&(Fe=t.RGBA32F),ce===t.HALF_FLOAT&&(Fe=t.RGBA16F),ce===t.UNSIGNED_BYTE&&(Fe=Ye===Kt&&Xe===!1?t.SRGB8_ALPHA8:t.RGBA8),ce===t.UNSIGNED_SHORT_4_4_4_4&&(Fe=t.RGBA4),ce===t.UNSIGNED_SHORT_5_5_5_1&&(Fe=t.RGB5_A1)),(Fe===t.R16F||Fe===t.R32F||Fe===t.RG16F||Fe===t.RG32F||Fe===t.RGBA16F||Fe===t.RGBA32F)&&e.get("EXT_color_buffer_float"),Fe}function V(L,F,ce){return w(L,ce)===!0||L.isFramebufferTexture&&L.minFilter!==Qn&&L.minFilter!==bn?Math.log2(Math.max(F.width,F.height))+1:L.mipmaps!==void 0&&L.mipmaps.length>0?L.mipmaps.length:L.isCompressedTexture&&Array.isArray(L.image)?F.mipmaps.length:1}function Y(L){return L===Qn||L===Nf||L===ZC?t.NEAREST:t.LINEAR}function z(L){const F=L.target;F.removeEventListener("dispose",z),O(F),F.isVideoTexture&&p.delete(F)}function q(L){const F=L.target;F.removeEventListener("dispose",q),oe(F)}function O(L){const F=i.get(L);if(F.__webglInit===void 0)return;const ce=L.source,Ye=f.get(ce);if(Ye){const Xe=Ye[F.__cacheKey];Xe.usedTimes--,Xe.usedTimes===0&&te(L),Object.keys(Ye).length===0&&f.delete(ce)}i.remove(L)}function te(L){const F=i.get(L);t.deleteTexture(F.__webglTexture);const ce=L.source,Ye=f.get(ce);delete Ye[F.__cacheKey],s.memory.textures--}function oe(L){const F=L.texture,ce=i.get(L),Ye=i.get(F);if(Ye.__webglTexture!==void 0&&(t.deleteTexture(Ye.__webglTexture),s.memory.textures--),L.depthTexture&&L.depthTexture.dispose(),L.isWebGLCubeRenderTarget)for(let Xe=0;Xe<6;Xe++){if(Array.isArray(ce.__webglFramebuffer[Xe]))for(let Fe=0;Fe<ce.__webglFramebuffer[Xe].length;Fe++)t.deleteFramebuffer(ce.__webglFramebuffer[Xe][Fe]);else t.deleteFramebuffer(ce.__webglFramebuffer[Xe]);ce.__webglDepthbuffer&&t.deleteRenderbuffer(ce.__webglDepthbuffer[Xe])}else{if(Array.isArray(ce.__webglFramebuffer))for(let Xe=0;Xe<ce.__webglFramebuffer.length;Xe++)t.deleteFramebuffer(ce.__webglFramebuffer[Xe]);else t.deleteFramebuffer(ce.__webglFramebuffer);if(ce.__webglDepthbuffer&&t.deleteRenderbuffer(ce.__webglDepthbuffer),ce.__webglMultisampledFramebuffer&&t.deleteFramebuffer(ce.__webglMultisampledFramebuffer),ce.__webglColorRenderbuffer)for(let Xe=0;Xe<ce.__webglColorRenderbuffer.length;Xe++)ce.__webglColorRenderbuffer[Xe]&&t.deleteRenderbuffer(ce.__webglColorRenderbuffer[Xe]);ce.__webglDepthRenderbuffer&&t.deleteRenderbuffer(ce.__webglDepthRenderbuffer)}if(L.isWebGLMultipleRenderTargets)for(let Xe=0,Fe=F.length;Xe<Fe;Xe++){const tt=i.get(F[Xe]);tt.__webglTexture&&(t.deleteTexture(tt.__webglTexture),s.memory.textures--),i.remove(F[Xe])}i.remove(F),i.remove(L)}let re=0;function se(){re=0}function H(){const L=re;return L>=l&&console.warn("THREE.WebGLTextures: Trying to use "+L+" texture units while this GPU supports only "+l),re+=1,L}function D(L){const F=[];return F.push(L.wrapS),F.push(L.wrapT),F.push(L.wrapR||0),F.push(L.magFilter),F.push(L.minFilter),F.push(L.anisotropy),F.push(L.internalFormat),F.push(L.format),F.push(L.type),F.push(L.generateMipmaps),F.push(L.premultiplyAlpha),F.push(L.flipY),F.push(L.unpackAlignment),F.push(L.colorSpace),F.join()}function T(L,F){const ce=i.get(L);if(L.isVideoTexture&&xt(L),L.isRenderTargetTexture===!1&&L.version>0&&ce.__version!==L.version){const Ye=L.image;if(Ye===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ye.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Bt(ce,L,F);return}}n.bindTexture(t.TEXTURE_2D,ce.__webglTexture,t.TEXTURE0+F)}function J(L,F){const ce=i.get(L);if(L.version>0&&ce.__version!==L.version){Bt(ce,L,F);return}n.bindTexture(t.TEXTURE_2D_ARRAY,ce.__webglTexture,t.TEXTURE0+F)}function $(L,F){const ce=i.get(L);if(L.version>0&&ce.__version!==L.version){Bt(ce,L,F);return}n.bindTexture(t.TEXTURE_3D,ce.__webglTexture,t.TEXTURE0+F)}function Ie(L,F){const ce=i.get(L);if(L.version>0&&ce.__version!==L.version){St(ce,L,F);return}n.bindTexture(t.TEXTURE_CUBE_MAP,ce.__webglTexture,t.TEXTURE0+F)}const fe={[od]:t.REPEAT,[ki]:t.CLAMP_TO_EDGE,[rd]:t.MIRRORED_REPEAT},ve={[Qn]:t.NEAREST,[Nf]:t.NEAREST_MIPMAP_NEAREST,[ZC]:t.NEAREST_MIPMAP_LINEAR,[bn]:t.LINEAR,[OZ]:t.LINEAR_MIPMAP_NEAREST,[dl]:t.LINEAR_MIPMAP_LINEAR},Ge={[pM]:t.NEVER,[BM]:t.ALWAYS,[fM]:t.LESS,[bM]:t.LEQUAL,[mM]:t.EQUAL,[GM]:t.GEQUAL,[yM]:t.GREATER,[vM]:t.NOTEQUAL};function Me(L,F,ce){if(ce?(t.texParameteri(L,t.TEXTURE_WRAP_S,fe[F.wrapS]),t.texParameteri(L,t.TEXTURE_WRAP_T,fe[F.wrapT]),(L===t.TEXTURE_3D||L===t.TEXTURE_2D_ARRAY)&&t.texParameteri(L,t.TEXTURE_WRAP_R,fe[F.wrapR]),t.texParameteri(L,t.TEXTURE_MAG_FILTER,ve[F.magFilter]),t.texParameteri(L,t.TEXTURE_MIN_FILTER,ve[F.minFilter])):(t.texParameteri(L,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(L,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(L===t.TEXTURE_3D||L===t.TEXTURE_2D_ARRAY)&&t.texParameteri(L,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),(F.wrapS!==ki||F.wrapT!==ki)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(L,t.TEXTURE_MAG_FILTER,Y(F.magFilter)),t.texParameteri(L,t.TEXTURE_MIN_FILTER,Y(F.minFilter)),F.minFilter!==Qn&&F.minFilter!==bn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),F.compareFunction&&(t.texParameteri(L,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(L,t.TEXTURE_COMPARE_FUNC,Ge[F.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const Ye=e.get("EXT_texture_filter_anisotropic");if(F.magFilter===Qn||F.minFilter!==ZC&&F.minFilter!==dl||F.type===Zi&&e.has("OES_texture_float_linear")===!1||a===!1&&F.type===Ti&&e.has("OES_texture_half_float_linear")===!1)return;(F.anisotropy>1||i.get(F).__currentAnisotropy)&&(t.texParameterf(L,Ye.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(F.anisotropy,o.getMaxAnisotropy())),i.get(F).__currentAnisotropy=F.anisotropy)}}function _e(L,F){let ce=!1;L.__webglInit===void 0&&(L.__webglInit=!0,F.addEventListener("dispose",z));const Ye=F.source;let Xe=f.get(Ye);Xe===void 0&&(Xe={},f.set(Ye,Xe));const Fe=D(F);if(Fe!==L.__cacheKey){Xe[Fe]===void 0&&(Xe[Fe]={texture:t.createTexture(),usedTimes:0},s.memory.textures++,ce=!0),Xe[Fe].usedTimes++;const tt=Xe[L.__cacheKey];tt!==void 0&&(Xe[L.__cacheKey].usedTimes--,tt.usedTimes===0&&te(F)),L.__cacheKey=Fe,L.__webglTexture=Xe[Fe].texture}return ce}function Bt(L,F,ce){let Ye=t.TEXTURE_2D;(F.isDataArrayTexture||F.isCompressedArrayTexture)&&(Ye=t.TEXTURE_2D_ARRAY),F.isData3DTexture&&(Ye=t.TEXTURE_3D);const Xe=_e(L,F),Fe=F.source;n.bindTexture(Ye,L.__webglTexture,t.TEXTURE0+ce);const tt=i.get(Fe);if(Fe.version!==tt.__version||Xe===!0){n.activeTexture(t.TEXTURE0+ce),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,F.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,F.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const ze=Z(F)&&B(F.image)===!1;let Ae=m(F.image,ze,!1,c);Ae=on(F,Ae);const ie=B(Ae)||a,me=r.convert(F.format,F.colorSpace);let xe=r.convert(F.type),Ke=X(F.internalFormat,me,xe,F.colorSpace);Me(Ye,F,ie);let ke;const lt=F.mipmaps,mt=a&&F.isVideoTexture!==!0,ae=tt.__version===void 0||Xe===!0,pe=V(F,Ae,ie);if(F.isDepthTexture)Ke=t.DEPTH_COMPONENT,a?F.type===Zi?Ke=t.DEPTH_COMPONENT32F:F.type===ia?Ke=t.DEPTH_COMPONENT24:F.type===rl?Ke=t.DEPTH24_STENCIL8:Ke=t.DEPTH_COMPONENT16:F.type===Zi&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),F.format===sl&&Ke===t.DEPTH_COMPONENT&&F.type!==Rm&&F.type!==ia&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),F.type=ia,xe=r.convert(F.type)),F.format===xg&&Ke===t.DEPTH_COMPONENT&&(Ke=t.DEPTH_STENCIL,F.type!==rl&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),F.type=rl,xe=r.convert(F.type))),ae&&(mt?n.texStorage2D(t.TEXTURE_2D,1,Ke,Ae.width,Ae.height):n.texImage2D(t.TEXTURE_2D,0,Ke,Ae.width,Ae.height,0,me,xe,null));else if(F.isDataTexture)if(lt.length>0&&ie){mt&&ae&&n.texStorage2D(t.TEXTURE_2D,pe,Ke,lt[0].width,lt[0].height);for(let Ce=0,Le=lt.length;Ce<Le;Ce++)ke=lt[Ce],mt?n.texSubImage2D(t.TEXTURE_2D,Ce,0,0,ke.width,ke.height,me,xe,ke.data):n.texImage2D(t.TEXTURE_2D,Ce,Ke,ke.width,ke.height,0,me,xe,ke.data);F.generateMipmaps=!1}else mt?(ae&&n.texStorage2D(t.TEXTURE_2D,pe,Ke,Ae.width,Ae.height),n.texSubImage2D(t.TEXTURE_2D,0,0,0,Ae.width,Ae.height,me,xe,Ae.data)):n.texImage2D(t.TEXTURE_2D,0,Ke,Ae.width,Ae.height,0,me,xe,Ae.data);else if(F.isCompressedTexture)if(F.isCompressedArrayTexture){mt&&ae&&n.texStorage3D(t.TEXTURE_2D_ARRAY,pe,Ke,lt[0].width,lt[0].height,Ae.depth);for(let Ce=0,Le=lt.length;Ce<Le;Ce++)ke=lt[Ce],F.format!==oo?me!==null?mt?n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,Ce,0,0,0,ke.width,ke.height,Ae.depth,me,ke.data,0,0):n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,Ce,Ke,ke.width,ke.height,Ae.depth,0,ke.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):mt?n.texSubImage3D(t.TEXTURE_2D_ARRAY,Ce,0,0,0,ke.width,ke.height,Ae.depth,me,xe,ke.data):n.texImage3D(t.TEXTURE_2D_ARRAY,Ce,Ke,ke.width,ke.height,Ae.depth,0,me,xe,ke.data)}else{mt&&ae&&n.texStorage2D(t.TEXTURE_2D,pe,Ke,lt[0].width,lt[0].height);for(let Ce=0,Le=lt.length;Ce<Le;Ce++)ke=lt[Ce],F.format!==oo?me!==null?mt?n.compressedTexSubImage2D(t.TEXTURE_2D,Ce,0,0,ke.width,ke.height,me,ke.data):n.compressedTexImage2D(t.TEXTURE_2D,Ce,Ke,ke.width,ke.height,0,ke.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):mt?n.texSubImage2D(t.TEXTURE_2D,Ce,0,0,ke.width,ke.height,me,xe,ke.data):n.texImage2D(t.TEXTURE_2D,Ce,Ke,ke.width,ke.height,0,me,xe,ke.data)}else if(F.isDataArrayTexture)mt?(ae&&n.texStorage3D(t.TEXTURE_2D_ARRAY,pe,Ke,Ae.width,Ae.height,Ae.depth),n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,Ae.width,Ae.height,Ae.depth,me,xe,Ae.data)):n.texImage3D(t.TEXTURE_2D_ARRAY,0,Ke,Ae.width,Ae.height,Ae.depth,0,me,xe,Ae.data);else if(F.isData3DTexture)mt?(ae&&n.texStorage3D(t.TEXTURE_3D,pe,Ke,Ae.width,Ae.height,Ae.depth),n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,Ae.width,Ae.height,Ae.depth,me,xe,Ae.data)):n.texImage3D(t.TEXTURE_3D,0,Ke,Ae.width,Ae.height,Ae.depth,0,me,xe,Ae.data);else if(F.isFramebufferTexture){if(ae)if(mt)n.texStorage2D(t.TEXTURE_2D,pe,Ke,Ae.width,Ae.height);else{let Ce=Ae.width,Le=Ae.height;for(let qe=0;qe<pe;qe++)n.texImage2D(t.TEXTURE_2D,qe,Ke,Ce,Le,0,me,xe,null),Ce>>=1,Le>>=1}}else if(lt.length>0&&ie){mt&&ae&&n.texStorage2D(t.TEXTURE_2D,pe,Ke,lt[0].width,lt[0].height);for(let Ce=0,Le=lt.length;Ce<Le;Ce++)ke=lt[Ce],mt?n.texSubImage2D(t.TEXTURE_2D,Ce,0,0,me,xe,ke):n.texImage2D(t.TEXTURE_2D,Ce,Ke,me,xe,ke);F.generateMipmaps=!1}else mt?(ae&&n.texStorage2D(t.TEXTURE_2D,pe,Ke,Ae.width,Ae.height),n.texSubImage2D(t.TEXTURE_2D,0,0,0,me,xe,Ae)):n.texImage2D(t.TEXTURE_2D,0,Ke,me,xe,Ae);w(F,ie)&&W(Ye),tt.__version=Fe.version,F.onUpdate&&F.onUpdate(F)}L.__version=F.version}function St(L,F,ce){if(F.image.length!==6)return;const Ye=_e(L,F),Xe=F.source;n.bindTexture(t.TEXTURE_CUBE_MAP,L.__webglTexture,t.TEXTURE0+ce);const Fe=i.get(Xe);if(Xe.version!==Fe.__version||Ye===!0){n.activeTexture(t.TEXTURE0+ce),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,F.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,F.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const tt=F.isCompressedTexture||F.image[0].isCompressedTexture,ze=F.image[0]&&F.image[0].isDataTexture,Ae=[];for(let Ce=0;Ce<6;Ce++)!tt&&!ze?Ae[Ce]=m(F.image[Ce],!1,!0,g):Ae[Ce]=ze?F.image[Ce].image:F.image[Ce],Ae[Ce]=on(F,Ae[Ce]);const ie=Ae[0],me=B(ie)||a,xe=r.convert(F.format,F.colorSpace),Ke=r.convert(F.type),ke=X(F.internalFormat,xe,Ke,F.colorSpace),lt=a&&F.isVideoTexture!==!0,mt=Fe.__version===void 0||Ye===!0;let ae=V(F,ie,me);Me(t.TEXTURE_CUBE_MAP,F,me);let pe;if(tt){lt&&mt&&n.texStorage2D(t.TEXTURE_CUBE_MAP,ae,ke,ie.width,ie.height);for(let Ce=0;Ce<6;Ce++){pe=Ae[Ce].mipmaps;for(let Le=0;Le<pe.length;Le++){const qe=pe[Le];F.format!==oo?xe!==null?lt?n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Le,0,0,qe.width,qe.height,xe,qe.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Le,ke,qe.width,qe.height,0,qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):lt?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Le,0,0,qe.width,qe.height,xe,Ke,qe.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Le,ke,qe.width,qe.height,0,xe,Ke,qe.data)}}}else{pe=F.mipmaps,lt&&mt&&(pe.length>0&&ae++,n.texStorage2D(t.TEXTURE_CUBE_MAP,ae,ke,Ae[0].width,Ae[0].height));for(let Ce=0;Ce<6;Ce++)if(ze){lt?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0,0,0,Ae[Ce].width,Ae[Ce].height,xe,Ke,Ae[Ce].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0,ke,Ae[Ce].width,Ae[Ce].height,0,xe,Ke,Ae[Ce].data);for(let Le=0;Le<pe.length;Le++){const Pt=pe[Le].image[Ce].image;lt?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Le+1,0,0,Pt.width,Pt.height,xe,Ke,Pt.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Le+1,ke,Pt.width,Pt.height,0,xe,Ke,Pt.data)}}else{lt?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0,0,0,xe,Ke,Ae[Ce]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0,ke,xe,Ke,Ae[Ce]);for(let Le=0;Le<pe.length;Le++){const qe=pe[Le];lt?n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Le+1,0,0,xe,Ke,qe.image[Ce]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Le+1,ke,xe,Ke,qe.image[Ce])}}}w(F,me)&&W(t.TEXTURE_CUBE_MAP),Fe.__version=Xe.version,F.onUpdate&&F.onUpdate(F)}L.__version=F.version}function ot(L,F,ce,Ye,Xe,Fe){const tt=r.convert(ce.format,ce.colorSpace),ze=r.convert(ce.type),Ae=X(ce.internalFormat,tt,ze,ce.colorSpace);if(!i.get(F).__hasExternalTextures){const me=Math.max(1,F.width>>Fe),xe=Math.max(1,F.height>>Fe);Xe===t.TEXTURE_3D||Xe===t.TEXTURE_2D_ARRAY?n.texImage3D(Xe,Fe,Ae,me,xe,F.depth,0,tt,ze,null):n.texImage2D(Xe,Fe,Ae,me,xe,0,tt,ze,null)}n.bindFramebuffer(t.FRAMEBUFFER,L),ut(F)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Ye,Xe,i.get(ce).__webglTexture,0,et(F)):(Xe===t.TEXTURE_2D||Xe>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&Xe<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,Ye,Xe,i.get(ce).__webglTexture,Fe),n.bindFramebuffer(t.FRAMEBUFFER,null)}function ee(L,F,ce){if(t.bindRenderbuffer(t.RENDERBUFFER,L),F.depthBuffer&&!F.stencilBuffer){let Ye=t.DEPTH_COMPONENT16;if(ce||ut(F)){const Xe=F.depthTexture;Xe&&Xe.isDepthTexture&&(Xe.type===Zi?Ye=t.DEPTH_COMPONENT32F:Xe.type===ia&&(Ye=t.DEPTH_COMPONENT24));const Fe=et(F);ut(F)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Fe,Ye,F.width,F.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,Fe,Ye,F.width,F.height)}else t.renderbufferStorage(t.RENDERBUFFER,Ye,F.width,F.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,L)}else if(F.depthBuffer&&F.stencilBuffer){const Ye=et(F);ce&&ut(F)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,Ye,t.DEPTH24_STENCIL8,F.width,F.height):ut(F)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Ye,t.DEPTH24_STENCIL8,F.width,F.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,F.width,F.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,L)}else{const Ye=F.isWebGLMultipleRenderTargets===!0?F.texture:[F.texture];for(let Xe=0;Xe<Ye.length;Xe++){const Fe=Ye[Xe],tt=r.convert(Fe.format,Fe.colorSpace),ze=r.convert(Fe.type),Ae=X(Fe.internalFormat,tt,ze,Fe.colorSpace),ie=et(F);ce&&ut(F)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,ie,Ae,F.width,F.height):ut(F)?d.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,ie,Ae,F.width,F.height):t.renderbufferStorage(t.RENDERBUFFER,Ae,F.width,F.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function Ne(L,F){if(F&&F.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,L),!(F.depthTexture&&F.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(F.depthTexture).__webglTexture||F.depthTexture.image.width!==F.width||F.depthTexture.image.height!==F.height)&&(F.depthTexture.image.width=F.width,F.depthTexture.image.height=F.height,F.depthTexture.needsUpdate=!0),T(F.depthTexture,0);const Ye=i.get(F.depthTexture).__webglTexture,Xe=et(F);if(F.depthTexture.format===sl)ut(F)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Ye,0,Xe):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Ye,0);else if(F.depthTexture.format===xg)ut(F)?d.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Ye,0,Xe):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Ye,0);else throw new Error("Unknown depthTexture format")}function Se(L){const F=i.get(L),ce=L.isWebGLCubeRenderTarget===!0;if(L.depthTexture&&!F.__autoAllocateDepthBuffer){if(ce)throw new Error("target.depthTexture not supported in Cube render targets");Ne(F.__webglFramebuffer,L)}else if(ce){F.__webglDepthbuffer=[];for(let Ye=0;Ye<6;Ye++)n.bindFramebuffer(t.FRAMEBUFFER,F.__webglFramebuffer[Ye]),F.__webglDepthbuffer[Ye]=t.createRenderbuffer(),ee(F.__webglDepthbuffer[Ye],L,!1)}else n.bindFramebuffer(t.FRAMEBUFFER,F.__webglFramebuffer),F.__webglDepthbuffer=t.createRenderbuffer(),ee(F.__webglDepthbuffer,L,!1);n.bindFramebuffer(t.FRAMEBUFFER,null)}function He(L,F,ce){const Ye=i.get(L);F!==void 0&&ot(Ye.__webglFramebuffer,L,L.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),ce!==void 0&&Se(L)}function Ve(L){const F=L.texture,ce=i.get(L),Ye=i.get(F);L.addEventListener("dispose",q),L.isWebGLMultipleRenderTargets!==!0&&(Ye.__webglTexture===void 0&&(Ye.__webglTexture=t.createTexture()),Ye.__version=F.version,s.memory.textures++);const Xe=L.isWebGLCubeRenderTarget===!0,Fe=L.isWebGLMultipleRenderTargets===!0,tt=B(L)||a;if(Xe){ce.__webglFramebuffer=[];for(let ze=0;ze<6;ze++)if(a&&F.mipmaps&&F.mipmaps.length>0){ce.__webglFramebuffer[ze]=[];for(let Ae=0;Ae<F.mipmaps.length;Ae++)ce.__webglFramebuffer[ze][Ae]=t.createFramebuffer()}else ce.__webglFramebuffer[ze]=t.createFramebuffer()}else{if(a&&F.mipmaps&&F.mipmaps.length>0){ce.__webglFramebuffer=[];for(let ze=0;ze<F.mipmaps.length;ze++)ce.__webglFramebuffer[ze]=t.createFramebuffer()}else ce.__webglFramebuffer=t.createFramebuffer();if(Fe)if(o.drawBuffers){const ze=L.texture;for(let Ae=0,ie=ze.length;Ae<ie;Ae++){const me=i.get(ze[Ae]);me.__webglTexture===void 0&&(me.__webglTexture=t.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&L.samples>0&&ut(L)===!1){const ze=Fe?F:[F];ce.__webglMultisampledFramebuffer=t.createFramebuffer(),ce.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,ce.__webglMultisampledFramebuffer);for(let Ae=0;Ae<ze.length;Ae++){const ie=ze[Ae];ce.__webglColorRenderbuffer[Ae]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,ce.__webglColorRenderbuffer[Ae]);const me=r.convert(ie.format,ie.colorSpace),xe=r.convert(ie.type),Ke=X(ie.internalFormat,me,xe,ie.colorSpace,L.isXRRenderTarget===!0),ke=et(L);t.renderbufferStorageMultisample(t.RENDERBUFFER,ke,Ke,L.width,L.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ae,t.RENDERBUFFER,ce.__webglColorRenderbuffer[Ae])}t.bindRenderbuffer(t.RENDERBUFFER,null),L.depthBuffer&&(ce.__webglDepthRenderbuffer=t.createRenderbuffer(),ee(ce.__webglDepthRenderbuffer,L,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(Xe){n.bindTexture(t.TEXTURE_CUBE_MAP,Ye.__webglTexture),Me(t.TEXTURE_CUBE_MAP,F,tt);for(let ze=0;ze<6;ze++)if(a&&F.mipmaps&&F.mipmaps.length>0)for(let Ae=0;Ae<F.mipmaps.length;Ae++)ot(ce.__webglFramebuffer[ze][Ae],L,F,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+ze,Ae);else ot(ce.__webglFramebuffer[ze],L,F,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+ze,0);w(F,tt)&&W(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(Fe){const ze=L.texture;for(let Ae=0,ie=ze.length;Ae<ie;Ae++){const me=ze[Ae],xe=i.get(me);n.bindTexture(t.TEXTURE_2D,xe.__webglTexture),Me(t.TEXTURE_2D,me,tt),ot(ce.__webglFramebuffer,L,me,t.COLOR_ATTACHMENT0+Ae,t.TEXTURE_2D,0),w(me,tt)&&W(t.TEXTURE_2D)}n.unbindTexture()}else{let ze=t.TEXTURE_2D;if((L.isWebGL3DRenderTarget||L.isWebGLArrayRenderTarget)&&(a?ze=L.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(ze,Ye.__webglTexture),Me(ze,F,tt),a&&F.mipmaps&&F.mipmaps.length>0)for(let Ae=0;Ae<F.mipmaps.length;Ae++)ot(ce.__webglFramebuffer[Ae],L,F,t.COLOR_ATTACHMENT0,ze,Ae);else ot(ce.__webglFramebuffer,L,F,t.COLOR_ATTACHMENT0,ze,0);w(F,tt)&&W(ze),n.unbindTexture()}L.depthBuffer&&Se(L)}function at(L){const F=B(L)||a,ce=L.isWebGLMultipleRenderTargets===!0?L.texture:[L.texture];for(let Ye=0,Xe=ce.length;Ye<Xe;Ye++){const Fe=ce[Ye];if(w(Fe,F)){const tt=L.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,ze=i.get(Fe).__webglTexture;n.bindTexture(tt,ze),W(tt),n.unbindTexture()}}}function Qe(L){if(a&&L.samples>0&&ut(L)===!1){const F=L.isWebGLMultipleRenderTargets?L.texture:[L.texture],ce=L.width,Ye=L.height;let Xe=t.COLOR_BUFFER_BIT;const Fe=[],tt=L.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,ze=i.get(L),Ae=L.isWebGLMultipleRenderTargets===!0;if(Ae)for(let ie=0;ie<F.length;ie++)n.bindFramebuffer(t.FRAMEBUFFER,ze.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+ie,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,ze.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+ie,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,ze.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,ze.__webglFramebuffer);for(let ie=0;ie<F.length;ie++){Fe.push(t.COLOR_ATTACHMENT0+ie),L.depthBuffer&&Fe.push(tt);const me=ze.__ignoreDepthValues!==void 0?ze.__ignoreDepthValues:!1;if(me===!1&&(L.depthBuffer&&(Xe|=t.DEPTH_BUFFER_BIT),L.stencilBuffer&&(Xe|=t.STENCIL_BUFFER_BIT)),Ae&&t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,ze.__webglColorRenderbuffer[ie]),me===!0&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[tt]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[tt])),Ae){const xe=i.get(F[ie]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,xe,0)}t.blitFramebuffer(0,0,ce,Ye,0,0,ce,Ye,Xe,t.NEAREST),h&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,Fe)}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),Ae)for(let ie=0;ie<F.length;ie++){n.bindFramebuffer(t.FRAMEBUFFER,ze.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+ie,t.RENDERBUFFER,ze.__webglColorRenderbuffer[ie]);const me=i.get(F[ie]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,ze.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+ie,t.TEXTURE_2D,me,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,ze.__webglMultisampledFramebuffer)}}function et(L){return Math.min(C,L.samples)}function ut(L){const F=i.get(L);return a&&L.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&F.__useRenderToTexture!==!1}function xt(L){const F=s.render.frame;p.get(L)!==F&&(p.set(L,F),L.update())}function on(L,F){const ce=L.colorSpace,Ye=L.format,Xe=L.type;return L.isCompressedTexture===!0||L.format===Yf||ce!==_r&&ce!==ll&&(ce===Kt?a===!1?e.has("EXT_sRGB")===!0&&Ye===oo?(L.format=Yf,L.minFilter=bn,L.generateMipmaps=!1):F=a2.sRGBToLinear(F):(Ye!==oo||Xe!==vs)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ce)),F}this.allocateTextureUnit=H,this.resetTextureUnits=se,this.setTexture2D=T,this.setTexture2DArray=J,this.setTexture3D=$,this.setTextureCube=Ie,this.rebindTextures=He,this.setupRenderTarget=Ve,this.updateRenderTargetMipmap=at,this.updateMultisampleRenderTarget=Qe,this.setupDepthRenderbuffer=Se,this.setupFrameBufferTexture=ot,this.useMultisampledRTT=ut}function KM(t,e,n){const i=n.isWebGL2;function o(r,s=ll){let a;if(r===vs)return t.UNSIGNED_BYTE;if(r===jZ)return t.UNSIGNED_SHORT_4_4_4_4;if(r===qZ)return t.UNSIGNED_SHORT_5_5_5_1;if(r===nM)return t.BYTE;if(r===iM)return t.SHORT;if(r===Rm)return t.UNSIGNED_SHORT;if(r===QZ)return t.INT;if(r===ia)return t.UNSIGNED_INT;if(r===Zi)return t.FLOAT;if(r===Ti)return i?t.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===oM)return t.ALPHA;if(r===oo)return t.RGBA;if(r===rM)return t.LUMINANCE;if(r===sM)return t.LUMINANCE_ALPHA;if(r===sl)return t.DEPTH_COMPONENT;if(r===xg)return t.DEPTH_STENCIL;if(r===Yf)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(r===$Z)return t.RED;if(r===e2)return t.RED_INTEGER;if(r===aM)return t.RG;if(r===t2)return t.RG_INTEGER;if(r===n2)return t.RGBA_INTEGER;if(r===Ep||r===kp||r===Tp||r===_p)if(s===Kt)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===Ep)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===kp)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===Tp)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===_p)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===Ep)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===kp)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Tp)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===_p)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===yG||r===vG||r===GG||r===BG)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===yG)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===vG)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===GG)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===BG)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===lM)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===ZG||r===wG)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(r===ZG)return s===Kt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===wG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===SG||r===RG||r===WG||r===xG||r===VG||r===XG||r===NG||r===YG||r===MG||r===HG||r===FG||r===KG||r===zG||r===LG)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(r===SG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===RG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===WG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===xG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===VG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===XG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===NG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===YG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===MG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===HG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===FG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===KG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===zG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===LG)return s===Kt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===Up)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(r===Up)return s===Kt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(r===gM||r===EG||r===kG||r===TG)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(r===Up)return a.COMPRESSED_RED_RGTC1_EXT;if(r===EG)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===kG)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===TG)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===rl?i?t.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):t[r]!==void 0?t[r]:null}return{convert:o}}class zM extends qn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class eI extends Ot{constructor(){super(),this.isGroup=!0,this.type="Group"}}const FJ={type:"move"};class yy{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new eI,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new eI,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new E,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new E),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new eI,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new E,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new E),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const i of e.hand.values())this._getHandJoint(n,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,i){let o=null,r=null,s=null;const a=this._targetRay,l=this._grip,g=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(g&&e.hand){s=!0;for(const v of e.hand.values()){const f=n.getJointPose(v,i),A=this._getHandJoint(g,v);f!==null&&(A.matrix.fromArray(f.transform.matrix),A.matrix.decompose(A.position,A.rotation,A.scale),A.matrixWorldNeedsUpdate=!0,A.jointRadius=f.radius),A.visible=f!==null}const c=g.joints["index-finger-tip"],C=g.joints["thumb-tip"],d=c.position.distanceTo(C.position),h=.02,p=.005;g.inputState.pinching&&d>h+p?(g.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!g.inputState.pinching&&d<=h-p&&(g.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=n.getPose(e.gripSpace,i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(o=n.getPose(e.targetRaySpace,i),o===null&&r!==null&&(o=r),o!==null&&(a.matrix.fromArray(o.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,o.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(o.linearVelocity)):a.hasLinearVelocity=!1,o.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(o.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(FJ)))}return a!==null&&(a.visible=o!==null),l!==null&&(l.visible=r!==null),g!==null&&(g.visible=s!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const i=new eI;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[n.jointName]=i,e.add(i)}return e.joints[n.jointName]}}class h2 extends Xn{constructor(e,n,i,o,r,s,a,l,g,c){if(c=c!==void 0?c:sl,c!==sl&&c!==xg)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===sl&&(i=ia),i===void 0&&c===xg&&(i=rl),super(null,o,r,s,a,l,c,i,g),this.isDepthTexture=!0,this.image={width:e,height:n},this.magFilter=a!==void 0?a:Qn,this.minFilter=l!==void 0?l:Qn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}class KJ extends Rs{constructor(e,n){super();const i=this;let o=null,r=1,s=null,a="local-floor",l=1,g=null,c=null,C=null,d=null,h=null,p=null;const v=n.getContextAttributes();let f=null,A=null;const b=[],m=[],B=new qn;B.layers.enable(1),B.viewport=new cn;const Z=new qn;Z.layers.enable(2),Z.viewport=new cn;const w=[B,Z],W=new zM;W.layers.enable(1),W.layers.enable(2);let X=null,V=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(J){let $=b[J];return $===void 0&&($=new yy,b[J]=$),$.getTargetRaySpace()},this.getControllerGrip=function(J){let $=b[J];return $===void 0&&($=new yy,b[J]=$),$.getGripSpace()},this.getHand=function(J){let $=b[J];return $===void 0&&($=new yy,b[J]=$),$.getHandSpace()};function Y(J){const $=m.indexOf(J.inputSource);if($===-1)return;const Ie=b[$];Ie!==void 0&&(Ie.update(J.inputSource,J.frame,g||s),Ie.dispatchEvent({type:J.type,data:J.inputSource}))}function z(){o.removeEventListener("select",Y),o.removeEventListener("selectstart",Y),o.removeEventListener("selectend",Y),o.removeEventListener("squeeze",Y),o.removeEventListener("squeezestart",Y),o.removeEventListener("squeezeend",Y),o.removeEventListener("end",z),o.removeEventListener("inputsourceschange",q);for(let J=0;J<b.length;J++){const $=m[J];$!==null&&(m[J]=null,b[J].disconnect($))}X=null,V=null,e.setRenderTarget(f),h=null,d=null,C=null,o=null,A=null,T.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(J){r=J,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(J){a=J,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return g||s},this.setReferenceSpace=function(J){g=J},this.getBaseLayer=function(){return d!==null?d:h},this.getBinding=function(){return C},this.getFrame=function(){return p},this.getSession=function(){return o},this.setSession=async function(J){if(o=J,o!==null){if(f=e.getRenderTarget(),o.addEventListener("select",Y),o.addEventListener("selectstart",Y),o.addEventListener("selectend",Y),o.addEventListener("squeeze",Y),o.addEventListener("squeezestart",Y),o.addEventListener("squeezeend",Y),o.addEventListener("end",z),o.addEventListener("inputsourceschange",q),v.xrCompatible!==!0&&await n.makeXRCompatible(),o.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const $={antialias:o.renderState.layers===void 0?v.antialias:!0,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(o,n,$),o.updateRenderState({baseLayer:h}),A=new Ar(h.framebufferWidth,h.framebufferHeight,{format:oo,type:vs,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil})}else{let $=null,Ie=null,fe=null;v.depth&&(fe=v.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,$=v.stencil?xg:sl,Ie=v.stencil?rl:ia);const ve={colorFormat:n.RGBA8,depthFormat:fe,scaleFactor:r};C=new XRWebGLBinding(o,n),d=C.createProjectionLayer(ve),o.updateRenderState({layers:[d]}),A=new Ar(d.textureWidth,d.textureHeight,{format:oo,type:vs,depthTexture:new h2(d.textureWidth,d.textureHeight,Ie,void 0,void 0,void 0,void 0,void 0,void 0,$),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0});const Ge=e.properties.get(A);Ge.__ignoreDepthValues=d.ignoreDepthValues}A.isXRRenderTarget=!0,this.setFoveation(l),g=null,s=await o.requestReferenceSpace(a),T.setContext(o),T.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(o!==null)return o.environmentBlendMode};function q(J){for(let $=0;$<J.removed.length;$++){const Ie=J.removed[$],fe=m.indexOf(Ie);fe>=0&&(m[fe]=null,b[fe].disconnect(Ie))}for(let $=0;$<J.added.length;$++){const Ie=J.added[$];let fe=m.indexOf(Ie);if(fe===-1){for(let Ge=0;Ge<b.length;Ge++)if(Ge>=m.length){m.push(Ie),fe=Ge;break}else if(m[Ge]===null){m[Ge]=Ie,fe=Ge;break}if(fe===-1)break}const ve=b[fe];ve&&ve.connect(Ie)}}const O=new E,te=new E;function oe(J,$,Ie){O.setFromMatrixPosition($.matrixWorld),te.setFromMatrixPosition(Ie.matrixWorld);const fe=O.distanceTo(te),ve=$.projectionMatrix.elements,Ge=Ie.projectionMatrix.elements,Me=ve[14]/(ve[10]-1),_e=ve[14]/(ve[10]+1),Bt=(ve[9]+1)/ve[5],St=(ve[9]-1)/ve[5],ot=(ve[8]-1)/ve[0],ee=(Ge[8]+1)/Ge[0],Ne=Me*ot,Se=Me*ee,He=fe/(-ot+ee),Ve=He*-ot;$.matrixWorld.decompose(J.position,J.quaternion,J.scale),J.translateX(Ve),J.translateZ(He),J.matrixWorld.compose(J.position,J.quaternion,J.scale),J.matrixWorldInverse.copy(J.matrixWorld).invert();const at=Me+He,Qe=_e+He,et=Ne-Ve,ut=Se+(fe-Ve),xt=Bt*_e/Qe*at,on=St*_e/Qe*at;J.projectionMatrix.makePerspective(et,ut,xt,on,at,Qe),J.projectionMatrixInverse.copy(J.projectionMatrix).invert()}function re(J,$){$===null?J.matrixWorld.copy(J.matrix):J.matrixWorld.multiplyMatrices($.matrixWorld,J.matrix),J.matrixWorldInverse.copy(J.matrixWorld).invert()}this.updateCamera=function(J){if(o===null)return;W.near=Z.near=B.near=J.near,W.far=Z.far=B.far=J.far,(X!==W.near||V!==W.far)&&(o.updateRenderState({depthNear:W.near,depthFar:W.far}),X=W.near,V=W.far);const $=J.parent,Ie=W.cameras;re(W,$);for(let fe=0;fe<Ie.length;fe++)re(Ie[fe],$);Ie.length===2?oe(W,B,Z):W.projectionMatrix.copy(B.projectionMatrix),se(J,W,$)};function se(J,$,Ie){Ie===null?J.matrix.copy($.matrixWorld):(J.matrix.copy(Ie.matrixWorld),J.matrix.invert(),J.matrix.multiply($.matrixWorld)),J.matrix.decompose(J.position,J.quaternion,J.scale),J.updateMatrixWorld(!0);const fe=J.children;for(let ve=0,Ge=fe.length;ve<Ge;ve++)fe[ve].updateMatrixWorld(!0);J.projectionMatrix.copy($.projectionMatrix),J.projectionMatrixInverse.copy($.projectionMatrixInverse),J.isPerspectiveCamera&&(J.fov=SI*2*Math.atan(1/J.projectionMatrix.elements[5]),J.zoom=1)}this.getCamera=function(){return W},this.getFoveation=function(){if(!(d===null&&h===null))return l},this.setFoveation=function(J){l=J,d!==null&&(d.fixedFoveation=J),h!==null&&h.fixedFoveation!==void 0&&(h.fixedFoveation=J)};let H=null;function D(J,$){if(c=$.getViewerPose(g||s),p=$,c!==null){const Ie=c.views;h!==null&&(e.setRenderTargetFramebuffer(A,h.framebuffer),e.setRenderTarget(A));let fe=!1;Ie.length!==W.cameras.length&&(W.cameras.length=0,fe=!0);for(let ve=0;ve<Ie.length;ve++){const Ge=Ie[ve];let Me=null;if(h!==null)Me=h.getViewport(Ge);else{const Bt=C.getViewSubImage(d,Ge);Me=Bt.viewport,ve===0&&(e.setRenderTargetTextures(A,Bt.colorTexture,d.ignoreDepthValues?void 0:Bt.depthStencilTexture),e.setRenderTarget(A))}let _e=w[ve];_e===void 0&&(_e=new qn,_e.layers.enable(ve),_e.viewport=new cn,w[ve]=_e),_e.matrix.fromArray(Ge.transform.matrix),_e.matrix.decompose(_e.position,_e.quaternion,_e.scale),_e.projectionMatrix.fromArray(Ge.projectionMatrix),_e.projectionMatrixInverse.copy(_e.projectionMatrix).invert(),_e.viewport.set(Me.x,Me.y,Me.width,Me.height),ve===0&&(W.matrix.copy(_e.matrix),W.matrix.decompose(W.position,W.quaternion,W.scale)),fe===!0&&W.cameras.push(_e)}}for(let Ie=0;Ie<b.length;Ie++){const fe=m[Ie],ve=b[Ie];fe!==null&&ve!==void 0&&ve.update(fe,$,g||s)}H&&H(J,$),$.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:$}),p=null}const T=new NM;T.setAnimationLoop(D),this.setAnimationLoop=function(J){H=J},this.dispose=function(){}}}function zJ(t,e){function n(f,A){f.matrixAutoUpdate===!0&&f.updateMatrix(),A.value.copy(f.matrix)}function i(f,A){A.color.getRGB(f.fogColor.value,VM(t)),A.isFog?(f.fogNear.value=A.near,f.fogFar.value=A.far):A.isFogExp2&&(f.fogDensity.value=A.density)}function o(f,A,b,m,B){A.isMeshBasicMaterial||A.isMeshLambertMaterial?r(f,A):A.isMeshToonMaterial?(r(f,A),C(f,A)):A.isMeshPhongMaterial?(r(f,A),c(f,A)):A.isMeshStandardMaterial?(r(f,A),d(f,A),A.isMeshPhysicalMaterial&&h(f,A,B)):A.isMeshMatcapMaterial?(r(f,A),p(f,A)):A.isMeshDepthMaterial?r(f,A):A.isMeshDistanceMaterial?(r(f,A),v(f,A)):A.isMeshNormalMaterial?r(f,A):A.isLineBasicMaterial?(s(f,A),A.isLineDashedMaterial&&a(f,A)):A.isPointsMaterial?l(f,A,b,m):A.isSpriteMaterial?g(f,A):A.isShadowMaterial?(f.color.value.copy(A.color),f.opacity.value=A.opacity):A.isShaderMaterial&&(A.uniformsNeedUpdate=!1)}function r(f,A){f.opacity.value=A.opacity,A.color&&f.diffuse.value.copy(A.color),A.emissive&&f.emissive.value.copy(A.emissive).multiplyScalar(A.emissiveIntensity),A.map&&(f.map.value=A.map,n(A.map,f.mapTransform)),A.alphaMap&&(f.alphaMap.value=A.alphaMap,n(A.alphaMap,f.alphaMapTransform)),A.bumpMap&&(f.bumpMap.value=A.bumpMap,n(A.bumpMap,f.bumpMapTransform),f.bumpScale.value=A.bumpScale,A.side===Si&&(f.bumpScale.value*=-1)),A.normalMap&&(f.normalMap.value=A.normalMap,n(A.normalMap,f.normalMapTransform),f.normalScale.value.copy(A.normalScale),A.side===Si&&f.normalScale.value.negate()),A.displacementMap&&(f.displacementMap.value=A.displacementMap,n(A.displacementMap,f.displacementMapTransform),f.displacementScale.value=A.displacementScale,f.displacementBias.value=A.displacementBias),A.emissiveMap&&(f.emissiveMap.value=A.emissiveMap,n(A.emissiveMap,f.emissiveMapTransform)),A.specularMap&&(f.specularMap.value=A.specularMap,n(A.specularMap,f.specularMapTransform)),A.alphaTest>0&&(f.alphaTest.value=A.alphaTest);const b=e.get(A).envMap;if(b&&(f.envMap.value=b,f.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,f.reflectivity.value=A.reflectivity,f.ior.value=A.ior,f.refractionRatio.value=A.refractionRatio),A.lightMap){f.lightMap.value=A.lightMap;const m=t._useLegacyLights===!0?Math.PI:1;f.lightMapIntensity.value=A.lightMapIntensity*m,n(A.lightMap,f.lightMapTransform)}A.aoMap&&(f.aoMap.value=A.aoMap,f.aoMapIntensity.value=A.aoMapIntensity,n(A.aoMap,f.aoMapTransform))}function s(f,A){f.diffuse.value.copy(A.color),f.opacity.value=A.opacity,A.map&&(f.map.value=A.map,n(A.map,f.mapTransform))}function a(f,A){f.dashSize.value=A.dashSize,f.totalSize.value=A.dashSize+A.gapSize,f.scale.value=A.scale}function l(f,A,b,m){f.diffuse.value.copy(A.color),f.opacity.value=A.opacity,f.size.value=A.size*b,f.scale.value=m*.5,A.map&&(f.map.value=A.map,n(A.map,f.uvTransform)),A.alphaMap&&(f.alphaMap.value=A.alphaMap,n(A.alphaMap,f.alphaMapTransform)),A.alphaTest>0&&(f.alphaTest.value=A.alphaTest)}function g(f,A){f.diffuse.value.copy(A.color),f.opacity.value=A.opacity,f.rotation.value=A.rotation,A.map&&(f.map.value=A.map,n(A.map,f.mapTransform)),A.alphaMap&&(f.alphaMap.value=A.alphaMap,n(A.alphaMap,f.alphaMapTransform)),A.alphaTest>0&&(f.alphaTest.value=A.alphaTest)}function c(f,A){f.specular.value.copy(A.specular),f.shininess.value=Math.max(A.shininess,1e-4)}function C(f,A){A.gradientMap&&(f.gradientMap.value=A.gradientMap)}function d(f,A){f.metalness.value=A.metalness,A.metalnessMap&&(f.metalnessMap.value=A.metalnessMap,n(A.metalnessMap,f.metalnessMapTransform)),f.roughness.value=A.roughness,A.roughnessMap&&(f.roughnessMap.value=A.roughnessMap,n(A.roughnessMap,f.roughnessMapTransform)),e.get(A).envMap&&(f.envMapIntensity.value=A.envMapIntensity)}function h(f,A,b){f.ior.value=A.ior,A.sheen>0&&(f.sheenColor.value.copy(A.sheenColor).multiplyScalar(A.sheen),f.sheenRoughness.value=A.sheenRoughness,A.sheenColorMap&&(f.sheenColorMap.value=A.sheenColorMap,n(A.sheenColorMap,f.sheenColorMapTransform)),A.sheenRoughnessMap&&(f.sheenRoughnessMap.value=A.sheenRoughnessMap,n(A.sheenRoughnessMap,f.sheenRoughnessMapTransform))),A.clearcoat>0&&(f.clearcoat.value=A.clearcoat,f.clearcoatRoughness.value=A.clearcoatRoughness,A.clearcoatMap&&(f.clearcoatMap.value=A.clearcoatMap,n(A.clearcoatMap,f.clearcoatMapTransform)),A.clearcoatRoughnessMap&&(f.clearcoatRoughnessMap.value=A.clearcoatRoughnessMap,n(A.clearcoatRoughnessMap,f.clearcoatRoughnessMapTransform)),A.clearcoatNormalMap&&(f.clearcoatNormalMap.value=A.clearcoatNormalMap,n(A.clearcoatNormalMap,f.clearcoatNormalMapTransform),f.clearcoatNormalScale.value.copy(A.clearcoatNormalScale),A.side===Si&&f.clearcoatNormalScale.value.negate())),A.iridescence>0&&(f.iridescence.value=A.iridescence,f.iridescenceIOR.value=A.iridescenceIOR,f.iridescenceThicknessMinimum.value=A.iridescenceThicknessRange[0],f.iridescenceThicknessMaximum.value=A.iridescenceThicknessRange[1],A.iridescenceMap&&(f.iridescenceMap.value=A.iridescenceMap,n(A.iridescenceMap,f.iridescenceMapTransform)),A.iridescenceThicknessMap&&(f.iridescenceThicknessMap.value=A.iridescenceThicknessMap,n(A.iridescenceThicknessMap,f.iridescenceThicknessMapTransform))),A.transmission>0&&(f.transmission.value=A.transmission,f.transmissionSamplerMap.value=b.texture,f.transmissionSamplerSize.value.set(b.width,b.height),A.transmissionMap&&(f.transmissionMap.value=A.transmissionMap,n(A.transmissionMap,f.transmissionMapTransform)),f.thickness.value=A.thickness,A.thicknessMap&&(f.thicknessMap.value=A.thicknessMap,n(A.thicknessMap,f.thicknessMapTransform)),f.attenuationDistance.value=A.attenuationDistance,f.attenuationColor.value.copy(A.attenuationColor)),A.anisotropy>0&&(f.anisotropyVector.value.set(A.anisotropy*Math.cos(A.anisotropyRotation),A.anisotropy*Math.sin(A.anisotropyRotation)),A.anisotropyMap&&(f.anisotropyMap.value=A.anisotropyMap,n(A.anisotropyMap,f.anisotropyMapTransform))),f.specularIntensity.value=A.specularIntensity,f.specularColor.value.copy(A.specularColor),A.specularColorMap&&(f.specularColorMap.value=A.specularColorMap,n(A.specularColorMap,f.specularColorMapTransform)),A.specularIntensityMap&&(f.specularIntensityMap.value=A.specularIntensityMap,n(A.specularIntensityMap,f.specularIntensityMapTransform))}function p(f,A){A.matcap&&(f.matcap.value=A.matcap)}function v(f,A){const b=e.get(A).light;f.referencePosition.value.setFromMatrixPosition(b.matrixWorld),f.nearDistance.value=b.shadow.camera.near,f.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:o}}function LJ(t,e,n,i){let o={},r={},s=[];const a=n.isWebGL2?t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(b,m){const B=m.program;i.uniformBlockBinding(b,B)}function g(b,m){let B=o[b.id];B===void 0&&(p(b),B=c(b),o[b.id]=B,b.addEventListener("dispose",f));const Z=m.program;i.updateUBOMapping(b,Z);const w=e.render.frame;r[b.id]!==w&&(d(b),r[b.id]=w)}function c(b){const m=C();b.__bindingPointIndex=m;const B=t.createBuffer(),Z=b.__size,w=b.usage;return t.bindBuffer(t.UNIFORM_BUFFER,B),t.bufferData(t.UNIFORM_BUFFER,Z,w),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,m,B),B}function C(){for(let b=0;b<a;b++)if(s.indexOf(b)===-1)return s.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(b){const m=o[b.id],B=b.uniforms,Z=b.__cache;t.bindBuffer(t.UNIFORM_BUFFER,m);for(let w=0,W=B.length;w<W;w++){const X=B[w];if(h(X,w,Z)===!0){const V=X.__offset,Y=Array.isArray(X.value)?X.value:[X.value];let z=0;for(let q=0;q<Y.length;q++){const O=Y[q],te=v(O);typeof O=="number"?(X.__data[0]=O,t.bufferSubData(t.UNIFORM_BUFFER,V+z,X.__data)):O.isMatrix3?(X.__data[0]=O.elements[0],X.__data[1]=O.elements[1],X.__data[2]=O.elements[2],X.__data[3]=O.elements[0],X.__data[4]=O.elements[3],X.__data[5]=O.elements[4],X.__data[6]=O.elements[5],X.__data[7]=O.elements[0],X.__data[8]=O.elements[6],X.__data[9]=O.elements[7],X.__data[10]=O.elements[8],X.__data[11]=O.elements[0]):(O.toArray(X.__data,z),z+=te.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,V,X.__data)}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function h(b,m,B){const Z=b.value;if(B[m]===void 0){if(typeof Z=="number")B[m]=Z;else{const w=Array.isArray(Z)?Z:[Z],W=[];for(let X=0;X<w.length;X++)W.push(w[X].clone());B[m]=W}return!0}else if(typeof Z=="number"){if(B[m]!==Z)return B[m]=Z,!0}else{const w=Array.isArray(B[m])?B[m]:[B[m]],W=Array.isArray(Z)?Z:[Z];for(let X=0;X<w.length;X++){const V=w[X];if(V.equals(W[X])===!1)return V.copy(W[X]),!0}}return!1}function p(b){const m=b.uniforms;let B=0;const Z=16;let w=0;for(let W=0,X=m.length;W<X;W++){const V=m[W],Y={boundary:0,storage:0},z=Array.isArray(V.value)?V.value:[V.value];for(let q=0,O=z.length;q<O;q++){const te=z[q],oe=v(te);Y.boundary+=oe.boundary,Y.storage+=oe.storage}if(V.__data=new Float32Array(Y.storage/Float32Array.BYTES_PER_ELEMENT),V.__offset=B,W>0){w=B%Z;const q=Z-w;w!==0&&q-Y.boundary<0&&(B+=Z-w,V.__offset=B)}B+=Y.storage}return w=B%Z,w>0&&(B+=Z-w),b.__size=B,b.__cache={},this}function v(b){const m={boundary:0,storage:0};return typeof b=="number"?(m.boundary=4,m.storage=4):b.isVector2?(m.boundary=8,m.storage=8):b.isVector3||b.isColor?(m.boundary=16,m.storage=12):b.isVector4?(m.boundary=16,m.storage=16):b.isMatrix3?(m.boundary=48,m.storage=48):b.isMatrix4?(m.boundary=64,m.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),m}function f(b){const m=b.target;m.removeEventListener("dispose",f);const B=s.indexOf(m.__bindingPointIndex);s.splice(B,1),t.deleteBuffer(o[m.id]),delete o[m.id],delete r[m.id]}function A(){for(const b in o)t.deleteBuffer(o[b]);s=[],o={},r={}}return{bind:l,update:g,dispose:A}}function EJ(){const t=Id("canvas");return t.style.display="block",t}class A2{constructor(e={}){const{canvas:n=EJ(),context:i=null,depth:o=!0,stencil:r=!0,alpha:s=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:g=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:C=!1}=e;this.isWebGLRenderer=!0;let d;i!==null?d=i.getContextAttributes().alpha:d=s;const h=new Uint32Array(4),p=new Int32Array(4);let v=null,f=null;const A=[],b=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Kt,this._useLegacyLights=!1,this.toneMapping=ys,this.toneMappingExposure=1;const m=this;let B=!1,Z=0,w=0,W=null,X=-1,V=null;const Y=new cn,z=new cn;let q=null;const O=new je(0);let te=0,oe=n.width,re=n.height,se=1,H=null,D=null;const T=new cn(0,0,oe,re),J=new cn(0,0,oe,re);let $=!1;const Ie=new Xm;let fe=!1,ve=!1,Ge=null;const Me=new Wt,_e=new We,Bt=new E,St={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ot(){return W===null?se:1}let ee=i;function Ne(R,K){for(let _=0;_<R.length;_++){const k=R[_],j=n.getContext(k,K);if(j!==null)return j}return null}try{const R={alpha:!0,depth:o,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:g,powerPreference:c,failIfMajorPerformanceCaveat:C};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${Eg}`),n.addEventListener("webglcontextlost",pe,!1),n.addEventListener("webglcontextrestored",Ce,!1),n.addEventListener("webglcontextcreationerror",Le,!1),ee===null){const K=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&K.shift(),ee=Ne(K,R),ee===null)throw Ne(K)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&ee instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),ee.getShaderPrecisionFormat===void 0&&(ee.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(R){throw console.error("THREE.WebGLRenderer: "+R.message),R}let Se,He,Ve,at,Qe,et,ut,xt,on,L,F,ce,Ye,Xe,Fe,tt,ze,Ae,ie,me,xe,Ke,ke,lt;function mt(){Se=new nD(ee),He=new QP(ee,Se,e),Se.init(He),Ke=new KM(ee,Se,He),Ve=new MJ(ee,Se,He),at=new rD(ee),Qe=new GJ,et=new HJ(ee,Se,Ve,Qe,He,Ke,at),ut=new qP(m),xt=new tD(m),on=new h_(ee,He),ke=new JP(ee,Se,on,He),L=new iD(ee,on,at,ke),F=new gD(ee,L,on,at),ie=new lD(ee,He,et),tt=new jP(Qe),ce=new vJ(m,ut,xt,Se,He,ke,tt),Ye=new zJ(m,Qe),Xe=new ZJ,Fe=new VJ(Se,He),Ae=new DP(m,ut,xt,Ve,F,d,l),ze=new YJ(m,F,He),lt=new LJ(ee,at,He,Ve),me=new OP(ee,Se,at,He),xe=new oD(ee,Se,at,He),at.programs=ce.programs,m.capabilities=He,m.extensions=Se,m.properties=Qe,m.renderLists=Xe,m.shadowMap=ze,m.state=Ve,m.info=at}mt();const ae=new KJ(m,ee);this.xr=ae,this.getContext=function(){return ee},this.getContextAttributes=function(){return ee.getContextAttributes()},this.forceContextLoss=function(){const R=Se.get("WEBGL_lose_context");R&&R.loseContext()},this.forceContextRestore=function(){const R=Se.get("WEBGL_lose_context");R&&R.restoreContext()},this.getPixelRatio=function(){return se},this.setPixelRatio=function(R){R!==void 0&&(se=R,this.setSize(oe,re,!1))},this.getSize=function(R){return R.set(oe,re)},this.setSize=function(R,K,_=!0){if(ae.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}oe=R,re=K,n.width=Math.floor(R*se),n.height=Math.floor(K*se),_===!0&&(n.style.width=R+"px",n.style.height=K+"px"),this.setViewport(0,0,R,K)},this.getDrawingBufferSize=function(R){return R.set(oe*se,re*se).floor()},this.setDrawingBufferSize=function(R,K,_){oe=R,re=K,se=_,n.width=Math.floor(R*_),n.height=Math.floor(K*_),this.setViewport(0,0,R,K)},this.getCurrentViewport=function(R){return R.copy(Y)},this.getViewport=function(R){return R.copy(T)},this.setViewport=function(R,K,_,k){R.isVector4?T.set(R.x,R.y,R.z,R.w):T.set(R,K,_,k),Ve.viewport(Y.copy(T).multiplyScalar(se).floor())},this.getScissor=function(R){return R.copy(J)},this.setScissor=function(R,K,_,k){R.isVector4?J.set(R.x,R.y,R.z,R.w):J.set(R,K,_,k),Ve.scissor(z.copy(J).multiplyScalar(se).floor())},this.getScissorTest=function(){return $},this.setScissorTest=function(R){Ve.setScissorTest($=R)},this.setOpaqueSort=function(R){H=R},this.setTransparentSort=function(R){D=R},this.getClearColor=function(R){return R.copy(Ae.getClearColor())},this.setClearColor=function(){Ae.setClearColor.apply(Ae,arguments)},this.getClearAlpha=function(){return Ae.getClearAlpha()},this.setClearAlpha=function(){Ae.setClearAlpha.apply(Ae,arguments)},this.clear=function(R=!0,K=!0,_=!0){let k=0;if(R){let j=!1;if(W!==null){const ue=W.texture.format;j=ue===n2||ue===t2||ue===e2}if(j){const ue=W.texture.type,he=ue===vs||ue===ia||ue===Rm||ue===rl||ue===jZ||ue===qZ,we=Ae.getClearColor(),Be=Ae.getClearAlpha(),Re=we.r,ye=we.g,rt=we.b;he?(h[0]=Re,h[1]=ye,h[2]=rt,h[3]=Be,ee.clearBufferuiv(ee.COLOR,0,h)):(p[0]=Re,p[1]=ye,p[2]=rt,p[3]=Be,ee.clearBufferiv(ee.COLOR,0,p))}else k|=ee.COLOR_BUFFER_BIT}K&&(k|=ee.DEPTH_BUFFER_BIT),_&&(k|=ee.STENCIL_BUFFER_BIT),ee.clear(k)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",pe,!1),n.removeEventListener("webglcontextrestored",Ce,!1),n.removeEventListener("webglcontextcreationerror",Le,!1),Xe.dispose(),Fe.dispose(),Qe.dispose(),ut.dispose(),xt.dispose(),F.dispose(),ke.dispose(),lt.dispose(),ce.dispose(),ae.dispose(),ae.removeEventListener("sessionstart",rn),ae.removeEventListener("sessionend",Di),Ge&&(Ge.dispose(),Ge=null),ri.stop()};function pe(R){R.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),B=!0}function Ce(){console.log("THREE.WebGLRenderer: Context Restored."),B=!1;const R=at.autoReset,K=ze.enabled,_=ze.autoUpdate,k=ze.needsUpdate,j=ze.type;mt(),at.autoReset=R,ze.enabled=K,ze.autoUpdate=_,ze.needsUpdate=k,ze.type=j}function Le(R){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",R.statusMessage)}function qe(R){const K=R.target;K.removeEventListener("dispose",qe),Pt(K)}function Pt(R){Cn(R),Qe.remove(R)}function Cn(R){const K=Qe.get(R).programs;K!==void 0&&(K.forEach(function(_){ce.releaseProgram(_)}),R.isShaderMaterial&&ce.releaseShaderCache(R))}this.renderBufferDirect=function(R,K,_,k,j,ue){K===null&&(K=St);const he=j.isMesh&&j.matrixWorld.determinant()<0,we=Qg(R,K,_,k,j);Ve.setMaterial(k,he);let Be=_.index,Re=1;if(k.wireframe===!0){if(Be=L.getWireframeAttribute(_),Be===void 0)return;Re=2}const ye=_.drawRange,rt=_.attributes.position;let Ue=ye.start*Re,Je=(ye.start+ye.count)*Re;ue!==null&&(Ue=Math.max(Ue,ue.start*Re),Je=Math.min(Je,(ue.start+ue.count)*Re)),Be!==null?(Ue=Math.max(Ue,0),Je=Math.min(Je,Be.count)):rt!=null&&(Ue=Math.max(Ue,0),Je=Math.min(Je,rt.count));const pt=Je-Ue;if(pt<0||pt===1/0)return;ke.setup(j,k,we,_,Be);let yt,bt=me;if(Be!==null&&(yt=on.get(Be),bt=xe,bt.setIndex(yt)),j.isMesh)k.wireframe===!0?(Ve.setLineWidth(k.wireframeLinewidth*ot()),bt.setMode(ee.LINES)):bt.setMode(ee.TRIANGLES);else if(j.isLine){let nt=k.linewidth;nt===void 0&&(nt=1),Ve.setLineWidth(nt*ot()),j.isLineSegments?bt.setMode(ee.LINES):j.isLineLoop?bt.setMode(ee.LINE_LOOP):bt.setMode(ee.LINE_STRIP)}else j.isPoints?bt.setMode(ee.POINTS):j.isSprite&&bt.setMode(ee.TRIANGLES);if(j.isInstancedMesh)bt.renderInstances(Ue,pt,j.count);else if(_.isInstancedBufferGeometry){const nt=_._maxInstanceCount!==void 0?_._maxInstanceCount:1/0,Zt=Math.min(_.instanceCount,nt);bt.renderInstances(Ue,pt,Zt)}else bt.render(Ue,pt)},this.compile=function(R,K){function _(k,j,ue){k.transparent===!0&&k.side===Fr&&k.forceSinglePass===!1?(k.side=Si,k.needsUpdate=!0,xi(k,j,ue),k.side=Ca,k.needsUpdate=!0,xi(k,j,ue),k.side=Fr):xi(k,j,ue)}f=Fe.get(R),f.init(),b.push(f),R.traverseVisible(function(k){k.isLight&&k.layers.test(K.layers)&&(f.pushLight(k),k.castShadow&&f.pushShadow(k))}),f.setupLights(m._useLegacyLights),R.traverse(function(k){const j=k.material;if(j)if(Array.isArray(j))for(let ue=0;ue<j.length;ue++){const he=j[ue];_(he,R,k)}else _(j,R,k)}),b.pop(),f=null};let Rn=null;function Vo(R){Rn&&Rn(R)}function rn(){ri.stop()}function Di(){ri.start()}const ri=new NM;ri.setAnimationLoop(Vo),typeof self<"u"&&ri.setContext(self),this.setAnimationLoop=function(R){Rn=R,ae.setAnimationLoop(R),R===null?ri.stop():ri.start()},ae.addEventListener("sessionstart",rn),ae.addEventListener("sessionend",Di),this.render=function(R,K){if(K!==void 0&&K.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(B===!0)return;R.matrixWorldAutoUpdate===!0&&R.updateMatrixWorld(),K.parent===null&&K.matrixWorldAutoUpdate===!0&&K.updateMatrixWorld(),ae.enabled===!0&&ae.isPresenting===!0&&(ae.cameraAutoUpdate===!0&&ae.updateCamera(K),K=ae.getCamera()),R.isScene===!0&&R.onBeforeRender(m,R,K,W),f=Fe.get(R,b.length),f.init(),b.push(f),Me.multiplyMatrices(K.projectionMatrix,K.matrixWorldInverse),Ie.setFromProjectionMatrix(Me),ve=this.localClippingEnabled,fe=tt.init(this.clippingPlanes,ve),v=Xe.get(R,A.length),v.init(),A.push(v),Jg(R,K,0,m.sortObjects),v.finish(),m.sortObjects===!0&&v.sort(H,D),this.info.render.frame++,fe===!0&&tt.beginShadows();const _=f.state.shadowsArray;if(ze.render(_,R,K),fe===!0&&tt.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ae.render(v,R),f.setupLights(m._useLegacyLights),K.isArrayCamera){const k=K.cameras;for(let j=0,ue=k.length;j<ue;j++){const he=k[j];Og(v,R,he,he.viewport)}}else Og(v,R,K);W!==null&&(et.updateMultisampleRenderTarget(W),et.updateRenderTargetMipmap(W)),R.isScene===!0&&R.onAfterRender(m,R,K),ke.resetDefaultState(),X=-1,V=null,b.pop(),b.length>0?f=b[b.length-1]:f=null,A.pop(),A.length>0?v=A[A.length-1]:v=null};function Jg(R,K,_,k){if(R.visible===!1)return;if(R.layers.test(K.layers)){if(R.isGroup)_=R.renderOrder;else if(R.isLOD)R.autoUpdate===!0&&R.update(K);else if(R.isLight)f.pushLight(R),R.castShadow&&f.pushShadow(R);else if(R.isSprite){if(!R.frustumCulled||Ie.intersectsSprite(R)){k&&Bt.setFromMatrixPosition(R.matrixWorld).applyMatrix4(Me);const he=F.update(R),we=R.material;we.visible&&v.push(R,he,we,_,Bt.z,null)}}else if((R.isMesh||R.isLine||R.isPoints)&&(!R.frustumCulled||Ie.intersectsObject(R))){const he=F.update(R),we=R.material;if(k&&(R.boundingSphere!==void 0?(R.boundingSphere===null&&R.computeBoundingSphere(),Bt.copy(R.boundingSphere.center)):(he.boundingSphere===null&&he.computeBoundingSphere(),Bt.copy(he.boundingSphere.center)),Bt.applyMatrix4(R.matrixWorld).applyMatrix4(Me)),Array.isArray(we)){const Be=he.groups;for(let Re=0,ye=Be.length;Re<ye;Re++){const rt=Be[Re],Ue=we[rt.materialIndex];Ue&&Ue.visible&&v.push(R,he,Ue,_,Bt.z,rt)}}else we.visible&&v.push(R,he,we,_,Bt.z,null)}}const ue=R.children;for(let he=0,we=ue.length;he<we;he++)Jg(ue[he],K,_,k)}function Og(R,K,_,k){const j=R.opaque,ue=R.transmissive,he=R.transparent;f.setupLightsView(_),fe===!0&&tt.setGlobalState(m.clippingPlanes,_),ue.length>0&&Vs(j,ue,K,_),k&&Ve.viewport(Y.copy(k)),j.length>0&&jr(j,K,_),ue.length>0&&jr(ue,K,_),he.length>0&&jr(he,K,_),Ve.buffers.depth.setTest(!0),Ve.buffers.depth.setMask(!0),Ve.buffers.color.setMask(!0),Ve.setPolygonOffset(!1)}function Vs(R,K,_,k){const j=He.isWebGL2;Ge===null&&(Ge=new Ar(1,1,{generateMipmaps:!0,type:Se.has("EXT_color_buffer_half_float")?Ti:vs,minFilter:dl,samples:j?4:0})),m.getDrawingBufferSize(_e),j?Ge.setSize(_e.x,_e.y):Ge.setSize(Mf(_e.x),Mf(_e.y));const ue=m.getRenderTarget();m.setRenderTarget(Ge),m.getClearColor(O),te=m.getClearAlpha(),te<1&&m.setClearColor(16777215,.5),m.clear();const he=m.toneMapping;m.toneMapping=ys,jr(R,_,k),et.updateMultisampleRenderTarget(Ge),et.updateRenderTargetMipmap(Ge);let we=!1;for(let Be=0,Re=K.length;Be<Re;Be++){const ye=K[Be],rt=ye.object,Ue=ye.geometry,Je=ye.material,pt=ye.group;if(Je.side===Fr&&rt.layers.test(k.layers)){const yt=Je.side;Je.side=Si,Je.needsUpdate=!0,qr(rt,_,k,Ue,Je,pt),Je.side=yt,Je.needsUpdate=!0,we=!0}}we===!0&&(et.updateMultisampleRenderTarget(Ge),et.updateRenderTargetMipmap(Ge)),m.setRenderTarget(ue),m.setClearColor(O,te),m.toneMapping=he}function jr(R,K,_){const k=K.isScene===!0?K.overrideMaterial:null;for(let j=0,ue=R.length;j<ue;j++){const he=R[j],we=he.object,Be=he.geometry,Re=k===null?he.material:k,ye=he.group;we.layers.test(_.layers)&&qr(we,K,_,Be,Re,ye)}}function qr(R,K,_,k,j,ue){R.onBeforeRender(m,K,_,k,j,ue),R.modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,R.matrixWorld),R.normalMatrix.getNormalMatrix(R.modelViewMatrix),j.onBeforeRender(m,K,_,k,R,ue),j.transparent===!0&&j.side===Fr&&j.forceSinglePass===!1?(j.side=Si,j.needsUpdate=!0,m.renderBufferDirect(_,K,k,j,R,ue),j.side=Ca,j.needsUpdate=!0,m.renderBufferDirect(_,K,k,j,R,ue),j.side=Fr):m.renderBufferDirect(_,K,k,j,R,ue),R.onAfterRender(m,K,_,k,j,ue)}function xi(R,K,_){K.isScene!==!0&&(K=St);const k=Qe.get(R),j=f.state.lights,ue=f.state.shadowsArray,he=j.state.version,we=ce.getParameters(R,j.state,ue,K,_),Be=ce.getProgramCacheKey(we);let Re=k.programs;k.environment=R.isMeshStandardMaterial?K.environment:null,k.fog=K.fog,k.envMap=(R.isMeshStandardMaterial?xt:ut).get(R.envMap||k.environment),Re===void 0&&(R.addEventListener("dispose",qe),Re=new Map,k.programs=Re);let ye=Re.get(Be);if(ye!==void 0){if(k.currentProgram===ye&&k.lightsStateVersion===he)return Lt(R,we),ye}else we.uniforms=ce.getUniforms(R),R.onBuild(_,we,m),R.onBeforeCompile(we,m),ye=ce.acquireProgram(we,Be),Re.set(Be,ye),k.uniforms=we.uniforms;const rt=k.uniforms;(!R.isShaderMaterial&&!R.isRawShaderMaterial||R.clipping===!0)&&(rt.clippingPlanes=tt.uniform),Lt(R,we),k.needsLights=M(R),k.lightsStateVersion=he,k.needsLights&&(rt.ambientLightColor.value=j.state.ambient,rt.lightProbe.value=j.state.probe,rt.directionalLights.value=j.state.directional,rt.directionalLightShadows.value=j.state.directionalShadow,rt.spotLights.value=j.state.spot,rt.spotLightShadows.value=j.state.spotShadow,rt.rectAreaLights.value=j.state.rectArea,rt.ltc_1.value=j.state.rectAreaLTC1,rt.ltc_2.value=j.state.rectAreaLTC2,rt.pointLights.value=j.state.point,rt.pointLightShadows.value=j.state.pointShadow,rt.hemisphereLights.value=j.state.hemi,rt.directionalShadowMap.value=j.state.directionalShadowMap,rt.directionalShadowMatrix.value=j.state.directionalShadowMatrix,rt.spotShadowMap.value=j.state.spotShadowMap,rt.spotLightMatrix.value=j.state.spotLightMatrix,rt.spotLightMap.value=j.state.spotLightMap,rt.pointShadowMap.value=j.state.pointShadowMap,rt.pointShadowMatrix.value=j.state.pointShadowMatrix);const Ue=ye.getUniforms(),Je=Jp.seqWithValue(Ue.seq,rt);return k.currentProgram=ye,k.uniformsList=Je,ye}function Lt(R,K){const _=Qe.get(R);_.outputColorSpace=K.outputColorSpace,_.instancing=K.instancing,_.instancingColor=K.instancingColor,_.skinning=K.skinning,_.morphTargets=K.morphTargets,_.morphNormals=K.morphNormals,_.morphColors=K.morphColors,_.morphTargetsCount=K.morphTargetsCount,_.numClippingPlanes=K.numClippingPlanes,_.numIntersection=K.numClipIntersection,_.vertexAlphas=K.vertexAlphas,_.vertexTangents=K.vertexTangents,_.toneMapping=K.toneMapping}function Qg(R,K,_,k,j){K.isScene!==!0&&(K=St),et.resetTextureUnits();const ue=K.fog,he=k.isMeshStandardMaterial?K.environment:null,we=W===null?m.outputColorSpace:W.isXRRenderTarget===!0?W.texture.colorSpace:_r,Be=(k.isMeshStandardMaterial?xt:ut).get(k.envMap||he),Re=k.vertexColors===!0&&!!_.attributes.color&&_.attributes.color.itemSize===4,ye=!!_.attributes.tangent&&(!!k.normalMap||k.anisotropy>0),rt=!!_.morphAttributes.position,Ue=!!_.morphAttributes.normal,Je=!!_.morphAttributes.color;let pt=ys;k.toneMapped&&(W===null||W.isXRRenderTarget===!0)&&(pt=m.toneMapping);const yt=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,bt=yt!==void 0?yt.length:0,nt=Qe.get(k),Zt=f.state.lights;if(fe===!0&&(ve===!0||R!==V)){const Vt=R===V&&k.id===X;tt.setState(k,R,Vt)}let It=!1;k.version===nt.__version?(nt.needsLights&&nt.lightsStateVersion!==Zt.state.version||nt.outputColorSpace!==we||j.isInstancedMesh&&nt.instancing===!1||!j.isInstancedMesh&&nt.instancing===!0||j.isSkinnedMesh&&nt.skinning===!1||!j.isSkinnedMesh&&nt.skinning===!0||j.isInstancedMesh&&nt.instancingColor===!0&&j.instanceColor===null||j.isInstancedMesh&&nt.instancingColor===!1&&j.instanceColor!==null||nt.envMap!==Be||k.fog===!0&&nt.fog!==ue||nt.numClippingPlanes!==void 0&&(nt.numClippingPlanes!==tt.numPlanes||nt.numIntersection!==tt.numIntersection)||nt.vertexAlphas!==Re||nt.vertexTangents!==ye||nt.morphTargets!==rt||nt.morphNormals!==Ue||nt.morphColors!==Je||nt.toneMapping!==pt||He.isWebGL2===!0&&nt.morphTargetsCount!==bt)&&(It=!0):(It=!0,nt.__version=k.version);let Yt=nt.currentProgram;It===!0&&(Yt=xi(k,K,j));let sn=!1,Rt=!1,an=!1;const qt=Yt.getUniforms(),dn=nt.uniforms;if(Ve.useProgram(Yt.program)&&(sn=!0,Rt=!0,an=!0),k.id!==X&&(X=k.id,Rt=!0),sn||V!==R){if(qt.setValue(ee,"projectionMatrix",R.projectionMatrix),He.logarithmicDepthBuffer&&qt.setValue(ee,"logDepthBufFC",2/(Math.log(R.far+1)/Math.LN2)),V!==R&&(V=R,Rt=!0,an=!0),k.isShaderMaterial||k.isMeshPhongMaterial||k.isMeshToonMaterial||k.isMeshStandardMaterial||k.envMap){const Vt=qt.map.cameraPosition;Vt!==void 0&&Vt.setValue(ee,Bt.setFromMatrixPosition(R.matrixWorld))}(k.isMeshPhongMaterial||k.isMeshToonMaterial||k.isMeshLambertMaterial||k.isMeshBasicMaterial||k.isMeshStandardMaterial||k.isShaderMaterial)&&qt.setValue(ee,"isOrthographic",R.isOrthographicCamera===!0),(k.isMeshPhongMaterial||k.isMeshToonMaterial||k.isMeshLambertMaterial||k.isMeshBasicMaterial||k.isMeshStandardMaterial||k.isShaderMaterial||k.isShadowMaterial||j.isSkinnedMesh)&&qt.setValue(ee,"viewMatrix",R.matrixWorldInverse)}if(j.isSkinnedMesh){qt.setOptional(ee,j,"bindMatrix"),qt.setOptional(ee,j,"bindMatrixInverse");const Vt=j.skeleton;Vt&&(He.floatVertexTextures?(Vt.boneTexture===null&&Vt.computeBoneTexture(),qt.setValue(ee,"boneTexture",Vt.boneTexture,et),qt.setValue(ee,"boneTextureSize",Vt.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Dn=_.morphAttributes;if((Dn.position!==void 0||Dn.normal!==void 0||Dn.color!==void 0&&He.isWebGL2===!0)&&ie.update(j,_,Yt),(Rt||nt.receiveShadow!==j.receiveShadow)&&(nt.receiveShadow=j.receiveShadow,qt.setValue(ee,"receiveShadow",j.receiveShadow)),k.isMeshGouraudMaterial&&k.envMap!==null&&(dn.envMap.value=Be,dn.flipEnvMap.value=Be.isCubeTexture&&Be.isRenderTargetTexture===!1?-1:1),Rt&&(qt.setValue(ee,"toneMappingExposure",m.toneMappingExposure),nt.needsLights&&su(dn,an),ue&&k.fog===!0&&Ye.refreshFogUniforms(dn,ue),Ye.refreshMaterialUniforms(dn,k,se,re,Ge),Jp.upload(ee,nt.uniformsList,dn,et)),k.isShaderMaterial&&k.uniformsNeedUpdate===!0&&(Jp.upload(ee,nt.uniformsList,dn,et),k.uniformsNeedUpdate=!1),k.isSpriteMaterial&&qt.setValue(ee,"center",j.center),qt.setValue(ee,"modelViewMatrix",j.modelViewMatrix),qt.setValue(ee,"normalMatrix",j.normalMatrix),qt.setValue(ee,"modelMatrix",j.matrixWorld),k.isShaderMaterial||k.isRawShaderMaterial){const Vt=k.uniformsGroups;for(let Nn=0,nn=Vt.length;Nn<nn;Nn++)if(He.isWebGL2){const Jt=Vt[Nn];lt.update(Jt,Yt),lt.bind(Jt,Yt)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Yt}function su(R,K){R.ambientLightColor.needsUpdate=K,R.lightProbe.needsUpdate=K,R.directionalLights.needsUpdate=K,R.directionalLightShadows.needsUpdate=K,R.pointLights.needsUpdate=K,R.pointLightShadows.needsUpdate=K,R.spotLights.needsUpdate=K,R.spotLightShadows.needsUpdate=K,R.rectAreaLights.needsUpdate=K,R.hemisphereLights.needsUpdate=K}function M(R){return R.isMeshLambertMaterial||R.isMeshToonMaterial||R.isMeshPhongMaterial||R.isMeshStandardMaterial||R.isShadowMaterial||R.isShaderMaterial&&R.lights===!0}this.getActiveCubeFace=function(){return Z},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return W},this.setRenderTargetTextures=function(R,K,_){Qe.get(R.texture).__webglTexture=K,Qe.get(R.depthTexture).__webglTexture=_;const k=Qe.get(R);k.__hasExternalTextures=!0,k.__hasExternalTextures&&(k.__autoAllocateDepthBuffer=_===void 0,k.__autoAllocateDepthBuffer||Se.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),k.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(R,K){const _=Qe.get(R);_.__webglFramebuffer=K,_.__useDefaultFramebuffer=K===void 0},this.setRenderTarget=function(R,K=0,_=0){W=R,Z=K,w=_;let k=!0,j=null,ue=!1,he=!1;if(R){const Be=Qe.get(R);Be.__useDefaultFramebuffer!==void 0?(Ve.bindFramebuffer(ee.FRAMEBUFFER,null),k=!1):Be.__webglFramebuffer===void 0?et.setupRenderTarget(R):Be.__hasExternalTextures&&et.rebindTextures(R,Qe.get(R.texture).__webglTexture,Qe.get(R.depthTexture).__webglTexture);const Re=R.texture;(Re.isData3DTexture||Re.isDataArrayTexture||Re.isCompressedArrayTexture)&&(he=!0);const ye=Qe.get(R).__webglFramebuffer;R.isWebGLCubeRenderTarget?(Array.isArray(ye[K])?j=ye[K][_]:j=ye[K],ue=!0):He.isWebGL2&&R.samples>0&&et.useMultisampledRTT(R)===!1?j=Qe.get(R).__webglMultisampledFramebuffer:Array.isArray(ye)?j=ye[_]:j=ye,Y.copy(R.viewport),z.copy(R.scissor),q=R.scissorTest}else Y.copy(T).multiplyScalar(se).floor(),z.copy(J).multiplyScalar(se).floor(),q=$;if(Ve.bindFramebuffer(ee.FRAMEBUFFER,j)&&He.drawBuffers&&k&&Ve.drawBuffers(R,j),Ve.viewport(Y),Ve.scissor(z),Ve.setScissorTest(q),ue){const Be=Qe.get(R.texture);ee.framebufferTexture2D(ee.FRAMEBUFFER,ee.COLOR_ATTACHMENT0,ee.TEXTURE_CUBE_MAP_POSITIVE_X+K,Be.__webglTexture,_)}else if(he){const Be=Qe.get(R.texture),Re=K||0;ee.framebufferTextureLayer(ee.FRAMEBUFFER,ee.COLOR_ATTACHMENT0,Be.__webglTexture,_||0,Re)}X=-1},this.readRenderTargetPixels=function(R,K,_,k,j,ue,he){if(!(R&&R.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let we=Qe.get(R).__webglFramebuffer;if(R.isWebGLCubeRenderTarget&&he!==void 0&&(we=we[he]),we){Ve.bindFramebuffer(ee.FRAMEBUFFER,we);try{const Be=R.texture,Re=Be.format,ye=Be.type;if(Re!==oo&&Ke.convert(Re)!==ee.getParameter(ee.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const rt=ye===Ti&&(Se.has("EXT_color_buffer_half_float")||He.isWebGL2&&Se.has("EXT_color_buffer_float"));if(ye!==vs&&Ke.convert(ye)!==ee.getParameter(ee.IMPLEMENTATION_COLOR_READ_TYPE)&&!(ye===Zi&&(He.isWebGL2||Se.has("OES_texture_float")||Se.has("WEBGL_color_buffer_float")))&&!rt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}K>=0&&K<=R.width-k&&_>=0&&_<=R.height-j&&ee.readPixels(K,_,k,j,Ke.convert(Re),Ke.convert(ye),ue)}finally{const Be=W!==null?Qe.get(W).__webglFramebuffer:null;Ve.bindFramebuffer(ee.FRAMEBUFFER,Be)}}},this.copyFramebufferToTexture=function(R,K,_=0){const k=Math.pow(2,-_),j=Math.floor(K.image.width*k),ue=Math.floor(K.image.height*k);et.setTexture2D(K,0),ee.copyTexSubImage2D(ee.TEXTURE_2D,_,0,0,R.x,R.y,j,ue),Ve.unbindTexture()},this.copyTextureToTexture=function(R,K,_,k=0){const j=K.image.width,ue=K.image.height,he=Ke.convert(_.format),we=Ke.convert(_.type);et.setTexture2D(_,0),ee.pixelStorei(ee.UNPACK_FLIP_Y_WEBGL,_.flipY),ee.pixelStorei(ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_.premultiplyAlpha),ee.pixelStorei(ee.UNPACK_ALIGNMENT,_.unpackAlignment),K.isDataTexture?ee.texSubImage2D(ee.TEXTURE_2D,k,R.x,R.y,j,ue,he,we,K.image.data):K.isCompressedTexture?ee.compressedTexSubImage2D(ee.TEXTURE_2D,k,R.x,R.y,K.mipmaps[0].width,K.mipmaps[0].height,he,K.mipmaps[0].data):ee.texSubImage2D(ee.TEXTURE_2D,k,R.x,R.y,he,we,K.image),k===0&&_.generateMipmaps&&ee.generateMipmap(ee.TEXTURE_2D),Ve.unbindTexture()},this.copyTextureToTexture3D=function(R,K,_,k,j=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const ue=R.max.x-R.min.x+1,he=R.max.y-R.min.y+1,we=R.max.z-R.min.z+1,Be=Ke.convert(k.format),Re=Ke.convert(k.type);let ye;if(k.isData3DTexture)et.setTexture3D(k,0),ye=ee.TEXTURE_3D;else if(k.isDataArrayTexture)et.setTexture2DArray(k,0),ye=ee.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ee.pixelStorei(ee.UNPACK_FLIP_Y_WEBGL,k.flipY),ee.pixelStorei(ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),ee.pixelStorei(ee.UNPACK_ALIGNMENT,k.unpackAlignment);const rt=ee.getParameter(ee.UNPACK_ROW_LENGTH),Ue=ee.getParameter(ee.UNPACK_IMAGE_HEIGHT),Je=ee.getParameter(ee.UNPACK_SKIP_PIXELS),pt=ee.getParameter(ee.UNPACK_SKIP_ROWS),yt=ee.getParameter(ee.UNPACK_SKIP_IMAGES),bt=_.isCompressedTexture?_.mipmaps[0]:_.image;ee.pixelStorei(ee.UNPACK_ROW_LENGTH,bt.width),ee.pixelStorei(ee.UNPACK_IMAGE_HEIGHT,bt.height),ee.pixelStorei(ee.UNPACK_SKIP_PIXELS,R.min.x),ee.pixelStorei(ee.UNPACK_SKIP_ROWS,R.min.y),ee.pixelStorei(ee.UNPACK_SKIP_IMAGES,R.min.z),_.isDataTexture||_.isData3DTexture?ee.texSubImage3D(ye,j,K.x,K.y,K.z,ue,he,we,Be,Re,bt.data):_.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ee.compressedTexSubImage3D(ye,j,K.x,K.y,K.z,ue,he,we,Be,bt.data)):ee.texSubImage3D(ye,j,K.x,K.y,K.z,ue,he,we,Be,Re,bt),ee.pixelStorei(ee.UNPACK_ROW_LENGTH,rt),ee.pixelStorei(ee.UNPACK_IMAGE_HEIGHT,Ue),ee.pixelStorei(ee.UNPACK_SKIP_PIXELS,Je),ee.pixelStorei(ee.UNPACK_SKIP_ROWS,pt),ee.pixelStorei(ee.UNPACK_SKIP_IMAGES,yt),j===0&&k.generateMipmaps&&ee.generateMipmap(ye),Ve.unbindTexture()},this.initTexture=function(R){R.isCubeTexture?et.setTextureCube(R,0):R.isData3DTexture?et.setTexture3D(R,0):R.isDataArrayTexture||R.isCompressedArrayTexture?et.setTexture2DArray(R,0):et.setTexture2D(R,0),Ve.unbindTexture()},this.resetState=function(){Z=0,w=0,W=null,Ve.reset(),ke.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return fs}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Kt?al:o2}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===al?Kt:_r}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class LM extends A2{}LM.prototype.isWebGL1Renderer=!0;class Ym{constructor(e,n=25e-5){this.isFogExp2=!0,this.name="",this.color=new je(e),this.density=n}clone(){return new Ym(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Mm{constructor(e,n=1,i=1e3){this.isFog=!0,this.name="",this.color=new je(e),this.near=n,this.far=i}clone(){return new Mm(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class ud extends Ot{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n}}class Hm{constructor(e,n){this.isInterleavedBuffer=!0,this.array=e,this.stride=n,this.count=e!==void 0?e.length/n:0,this.usage=gd,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ko()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,n,i){e*=this.stride,i*=n.stride;for(let o=0,r=this.stride;o<r;o++)this.array[e+o]=n.array[i+o];return this}set(e,n=0){return this.array.set(e,n),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ko()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(n,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ko()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ji=new E;class Vg{constructor(e,n,i,o=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=n,this.offset=i,this.normalized=o}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let n=0,i=this.data.count;n<i;n++)ji.fromBufferAttribute(this,n),ji.applyMatrix4(e),this.setXYZ(n,ji.x,ji.y,ji.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)ji.fromBufferAttribute(this,n),ji.applyNormalMatrix(e),this.setXYZ(n,ji.x,ji.y,ji.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)ji.fromBufferAttribute(this,n),ji.transformDirection(e),this.setXYZ(n,ji.x,ji.y,ji.z);return this}setX(e,n){return this.normalized&&(n=zt(n,this.array)),this.data.array[e*this.data.stride+this.offset]=n,this}setY(e,n){return this.normalized&&(n=zt(n,this.array)),this.data.array[e*this.data.stride+this.offset+1]=n,this}setZ(e,n){return this.normalized&&(n=zt(n,this.array)),this.data.array[e*this.data.stride+this.offset+2]=n,this}setW(e,n){return this.normalized&&(n=zt(n,this.array)),this.data.array[e*this.data.stride+this.offset+3]=n,this}getX(e){let n=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(n=Bo(n,this.array)),n}getY(e){let n=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(n=Bo(n,this.array)),n}getZ(e){let n=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(n=Bo(n,this.array)),n}getW(e){let n=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(n=Bo(n,this.array)),n}setXY(e,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(n=zt(n,this.array),i=zt(i,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this}setXYZ(e,n,i,o){return e=e*this.data.stride+this.offset,this.normalized&&(n=zt(n,this.array),i=zt(i,this.array),o=zt(o,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this.data.array[e+2]=o,this}setXYZW(e,n,i,o,r){return e=e*this.data.stride+this.offset,this.normalized&&(n=zt(n,this.array),i=zt(i,this.array),o=zt(o,this.array),r=zt(r,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=i,this.data.array[e+2]=o,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let i=0;i<this.count;i++){const o=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)n.push(this.data.array[o+r])}return new un(new this.array.constructor(n),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Vg(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let i=0;i<this.count;i++){const o=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)n.push(this.data.array[o+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class p2 extends Wi{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new je(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let wc;const Ku=new E,Sc=new E,Rc=new E,Wc=new We,zu=new We,EM=new Wt,TA=new E,Lu=new E,_A=new E,bW=new We,vy=new We,yW=new We;class kM extends Ot{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",wc===void 0){wc=new _t;const n=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Hm(n,5);wc.setIndex([0,1,2,0,2,3]),wc.setAttribute("position",new Vg(i,3,0,!1)),wc.setAttribute("uv",new Vg(i,2,3,!1))}this.geometry=wc,this.material=e!==void 0?e:new p2,this.center=new We(.5,.5)}raycast(e,n){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Sc.setFromMatrixScale(this.matrixWorld),EM.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Rc.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Sc.multiplyScalar(-Rc.z);const i=this.material.rotation;let o,r;i!==0&&(r=Math.cos(i),o=Math.sin(i));const s=this.center;UA(TA.set(-.5,-.5,0),Rc,s,Sc,o,r),UA(Lu.set(.5,-.5,0),Rc,s,Sc,o,r),UA(_A.set(.5,.5,0),Rc,s,Sc,o,r),bW.set(0,0),vy.set(1,0),yW.set(1,1);let a=e.ray.intersectTriangle(TA,Lu,_A,!1,Ku);if(a===null&&(UA(Lu.set(-.5,.5,0),Rc,s,Sc,o,r),vy.set(0,1),a=e.ray.intersectTriangle(TA,_A,Lu,!1,Ku),a===null))return;const l=e.ray.origin.distanceTo(Ku);l<e.near||l>e.far||n.push({distance:l,point:Ku.clone(),uv:Go.getInterpolation(Ku,TA,Lu,_A,bW,vy,yW,new We),face:null,object:this})}copy(e,n){return super.copy(e,n),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function UA(t,e,n,i,o,r){Wc.subVectors(t,n).addScalar(.5).multiply(i),o!==void 0?(zu.x=r*Wc.x-o*Wc.y,zu.y=o*Wc.x+r*Wc.y):zu.copy(Wc),t.copy(e),t.x+=zu.x,t.y+=zu.y,t.applyMatrix4(EM)}const PA=new E,vW=new E;class TM extends Ot{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const n=e.levels;for(let i=0,o=n.length;i<o;i++){const r=n[i];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,n=0,i=0){n=Math.abs(n);const o=this.levels;let r;for(r=0;r<o.length&&!(n<o[r].distance);r++);return o.splice(r,0,{distance:n,hysteresis:i,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const n=this.levels;if(n.length>0){let i,o;for(i=1,o=n.length;i<o;i++){let r=n[i].distance;if(n[i].object.visible&&(r-=r*n[i].hysteresis),e<r)break}return n[i-1].object}return null}raycast(e,n){if(this.levels.length>0){PA.setFromMatrixPosition(this.matrixWorld);const o=e.ray.origin.distanceTo(PA);this.getObjectForDistance(o).raycast(e,n)}}update(e){const n=this.levels;if(n.length>1){PA.setFromMatrixPosition(e.matrixWorld),vW.setFromMatrixPosition(this.matrixWorld);const i=PA.distanceTo(vW)/e.zoom;n[0].object.visible=!0;let o,r;for(o=1,r=n.length;o<r;o++){let s=n[o].distance;if(n[o].object.visible&&(s-=s*n[o].hysteresis),i>=s)n[o-1].object.visible=!1,n[o].object.visible=!0;else break}for(this._currentLevel=o-1;o<r;o++)n[o].object.visible=!1}}toJSON(e){const n=super.toJSON(e);this.autoUpdate===!1&&(n.object.autoUpdate=!1),n.object.levels=[];const i=this.levels;for(let o=0,r=i.length;o<r;o++){const s=i[o];n.object.levels.push({object:s.object.uuid,distance:s.distance,hysteresis:s.hysteresis})}return n}}const GW=new E,BW=new cn,ZW=new cn,kJ=new E,wW=new Wt,xc=new E,Gy=new Dr,SW=new Wt,By=new PI;class _M extends ci{constructor(e,n){super(e,n),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Wt,this.bindMatrixInverse=new Wt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Ws),this.boundingBox.makeEmpty();const n=e.getAttribute("position");for(let i=0;i<n.count;i++)xc.fromBufferAttribute(n,i),this.applyBoneTransform(i,xc),this.boundingBox.expandByPoint(xc)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Dr),this.boundingSphere.makeEmpty();const n=e.getAttribute("position");for(let i=0;i<n.count;i++)xc.fromBufferAttribute(n,i),this.applyBoneTransform(i,xc),this.boundingSphere.expandByPoint(xc)}copy(e,n){return super.copy(e,n),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,n){const i=this.material,o=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Gy.copy(this.boundingSphere),Gy.applyMatrix4(o),e.ray.intersectsSphere(Gy)!==!1&&(SW.copy(o).invert(),By.copy(e.ray).applyMatrix4(SW),!(this.boundingBox!==null&&By.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,n,By)))}getVertexPosition(e,n){return super.getVertexPosition(e,n),this.applyBoneTransform(e,n),n}bind(e,n){this.skeleton=e,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new cn,n=this.geometry.attributes.skinWeight;for(let i=0,o=n.count;i<o;i++){e.fromBufferAttribute(n,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),n.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,n){const i=this.skeleton,o=this.geometry;BW.fromBufferAttribute(o.attributes.skinIndex,e),ZW.fromBufferAttribute(o.attributes.skinWeight,e),GW.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let r=0;r<4;r++){const s=ZW.getComponent(r);if(s!==0){const a=BW.getComponent(r);wW.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),n.addScaledVector(kJ.copy(GW).applyMatrix4(wW),s)}}return n.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,n){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,n)}}class f2 extends Ot{constructor(){super(),this.isBone=!0,this.type="Bone"}}class uI extends Xn{constructor(e=null,n=1,i=1,o,r,s,a,l,g=Qn,c=Qn,C,d){super(null,s,a,l,g,c,o,r,C,d),this.isDataTexture=!0,this.image={data:e,width:n,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const RW=new Wt,TJ=new Wt;class Fm{constructor(e=[],n=[]){this.uuid=ko(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const e=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),n.length===0)this.calculateInverses();else if(e.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,o=this.bones.length;i<o;i++)this.boneInverses.push(new Wt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){const i=new Wt;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,n=this.bones.length;e<n;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,n=this.boneInverses,i=this.boneMatrices,o=this.boneTexture;for(let r=0,s=e.length;r<s;r++){const a=e[r]?e[r].matrixWorld:TJ;RW.multiplyMatrices(a,n[r]),RW.toArray(i,r*16)}o!==null&&(o.needsUpdate=!0)}clone(){return new Fm(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=wM(e),e=Math.max(e,4);const n=new Float32Array(e*e*4);n.set(this.boneMatrices);const i=new uI(n,e,e,oo,Zi);return i.needsUpdate=!0,this.boneMatrices=n,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let n=0,i=this.bones.length;n<i;n++){const o=this.bones[n];if(o.name===e)return o}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,n){this.uuid=e.uuid;for(let i=0,o=e.bones.length;i<o;i++){const r=e.bones[i];let s=n[r];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),s=new f2),this.bones.push(s),this.boneInverses.push(new Wt().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const n=this.bones,i=this.boneInverses;for(let o=0,r=n.length;o<r;o++){const s=n[o];e.bones.push(s.uuid);const a=i[o];e.boneInverses.push(a.toArray())}return e}}class WI extends un{constructor(e,n,i,o=1){super(e,n,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=o}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Vc=new Wt,WW=new Wt,DA=[],xW=new Ws,_J=new Wt,Eu=new ci,ku=new Dr;class CI extends ci{constructor(e,n,i){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new WI(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let o=0;o<i;o++)this.setMatrixAt(o,_J)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new Ws),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<n;i++)this.getMatrixAt(i,Vc),xW.copy(e.boundingBox).applyMatrix4(Vc),this.boundingBox.union(xW)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new Dr),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<n;i++)this.getMatrixAt(i,Vc),ku.copy(e.boundingSphere).applyMatrix4(Vc),this.boundingSphere.union(ku)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,e*16)}raycast(e,n){const i=this.matrixWorld,o=this.count;if(Eu.geometry=this.geometry,Eu.material=this.material,Eu.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ku.copy(this.boundingSphere),ku.applyMatrix4(i),e.ray.intersectsSphere(ku)!==!1))for(let r=0;r<o;r++){this.getMatrixAt(r,Vc),WW.multiplyMatrices(i,Vc),Eu.matrixWorld=WW,Eu.raycast(e,DA);for(let s=0,a=DA.length;s<a;s++){const l=DA[s];l.instanceId=r,l.object=this,n.push(l)}DA.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new WI(new Float32Array(this.instanceMatrix.count*3),3)),n.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class co extends Wi{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new je(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const VW=new E,XW=new E,NW=new Wt,Zy=new PI,JA=new Dr;class hl extends Ot{constructor(e=new _t,n=new co){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,i=[0];for(let o=1,r=n.count;o<r;o++)VW.fromBufferAttribute(n,o-1),XW.fromBufferAttribute(n,o),i[o]=i[o-1],i[o]+=VW.distanceTo(XW);e.setAttribute("lineDistance",new Ct(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,n){const i=this.geometry,o=this.matrixWorld,r=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),JA.copy(i.boundingSphere),JA.applyMatrix4(o),JA.radius+=r,e.ray.intersectsSphere(JA)===!1)return;NW.copy(o).invert(),Zy.copy(e.ray).applyMatrix4(NW);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,g=new E,c=new E,C=new E,d=new E,h=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(p!==null){const A=Math.max(0,s.start),b=Math.min(p.count,s.start+s.count);for(let m=A,B=b-1;m<B;m+=h){const Z=p.getX(m),w=p.getX(m+1);if(g.fromBufferAttribute(f,Z),c.fromBufferAttribute(f,w),Zy.distanceSqToSegment(g,c,d,C)>l)continue;d.applyMatrix4(this.matrixWorld);const X=e.ray.origin.distanceTo(d);X<e.near||X>e.far||n.push({distance:X,point:C.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else{const A=Math.max(0,s.start),b=Math.min(f.count,s.start+s.count);for(let m=A,B=b-1;m<B;m+=h){if(g.fromBufferAttribute(f,m),c.fromBufferAttribute(f,m+1),Zy.distanceSqToSegment(g,c,d,C)>l)continue;d.applyMatrix4(this.matrixWorld);const w=e.ray.origin.distanceTo(d);w<e.near||w>e.far||n.push({distance:w,point:C.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const o=n[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=o.length;r<s;r++){const a=o[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}const YW=new E,MW=new E;class xs extends hl{constructor(e,n){super(e,n),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,i=[];for(let o=0,r=n.count;o<r;o+=2)YW.fromBufferAttribute(n,o),MW.fromBufferAttribute(n,o+1),i[o]=o===0?0:i[o-1],i[o+1]=i[o]+YW.distanceTo(MW);e.setAttribute("lineDistance",new Ct(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class UM extends hl{constructor(e,n){super(e,n),this.isLineLoop=!0,this.type="LineLoop"}}class m2 extends Wi{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new je(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const HW=new Wt,JG=new PI,OA=new Dr,QA=new E;class PM extends Ot{constructor(e=new _t,n=new m2){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=e.material,this.geometry=e.geometry,this}raycast(e,n){const i=this.geometry,o=this.matrixWorld,r=e.params.Points.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),OA.copy(i.boundingSphere),OA.applyMatrix4(o),OA.radius+=r,e.ray.intersectsSphere(OA)===!1)return;HW.copy(o).invert(),JG.copy(e.ray).applyMatrix4(HW);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,g=i.index,C=i.attributes.position;if(g!==null){const d=Math.max(0,s.start),h=Math.min(g.count,s.start+s.count);for(let p=d,v=h;p<v;p++){const f=g.getX(p);QA.fromBufferAttribute(C,f),FW(QA,f,l,o,e,n,this)}}else{const d=Math.max(0,s.start),h=Math.min(C.count,s.start+s.count);for(let p=d,v=h;p<v;p++)QA.fromBufferAttribute(C,p),FW(QA,p,l,o,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const o=n[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=o.length;r<s;r++){const a=o[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function FW(t,e,n,i,o,r,s){const a=JG.distanceSqToPoint(t);if(a<n){const l=new E;JG.closestPointToPoint(t,l),l.applyMatrix4(i);const g=o.ray.origin.distanceTo(l);if(g<o.near||g>o.far)return;r.push({distance:g,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:s})}}class UJ extends Xn{constructor(e,n,i,o,r,s,a,l,g){super(e,n,i,o,r,s,a,l,g),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:bn,this.magFilter=r!==void 0?r:bn,this.generateMipmaps=!1;const c=this;function C(){c.needsUpdate=!0,e.requestVideoFrameCallback(C)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(C)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class PJ extends Xn{constructor(e,n){super({width:e,height:n}),this.isFramebufferTexture=!0,this.magFilter=Qn,this.minFilter=Qn,this.generateMipmaps=!1,this.needsUpdate=!0}}class Km extends Xn{constructor(e,n,i,o,r,s,a,l,g,c,C,d){super(null,s,a,l,g,c,o,r,C,d),this.isCompressedTexture=!0,this.image={width:n,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class DJ extends Km{constructor(e,n,i,o,r,s){super(e,n,i,r,s),this.isCompressedArrayTexture=!0,this.image.depth=o,this.wrapR=ki}}class JJ extends Km{constructor(e,n,i){super(void 0,e[0].width,e[0].height,n,i,Bs),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class OJ extends Xn{constructor(e,n,i,o,r,s,a,l,g){super(e,n,i,o,r,s,a,l,g),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Jr{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,n){const i=this.getUtoTmapping(e);return this.getPoint(i,n)}getPoints(e=5){const n=[];for(let i=0;i<=e;i++)n.push(this.getPoint(i/e));return n}getSpacedPoints(e=5){const n=[];for(let i=0;i<=e;i++)n.push(this.getPointAt(i/e));return n}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let i,o=this.getPoint(0),r=0;n.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),r+=i.distanceTo(o),n.push(r),o=i;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,n){const i=this.getLengths();let o=0;const r=i.length;let s;n?s=n:s=e*i[r-1];let a=0,l=r-1,g;for(;a<=l;)if(o=Math.floor(a+(l-a)/2),g=i[o]-s,g<0)a=o+1;else if(g>0)l=o-1;else{l=o;break}if(o=l,i[o]===s)return o/(r-1);const c=i[o],d=i[o+1]-c,h=(s-c)/d;return(o+h)/(r-1)}getTangent(e,n){let o=e-1e-4,r=e+1e-4;o<0&&(o=0),r>1&&(r=1);const s=this.getPoint(o),a=this.getPoint(r),l=n||(s.isVector2?new We:new E);return l.copy(a).sub(s).normalize(),l}getTangentAt(e,n){const i=this.getUtoTmapping(e);return this.getTangent(i,n)}computeFrenetFrames(e,n){const i=new E,o=[],r=[],s=[],a=new E,l=new Wt;for(let h=0;h<=e;h++){const p=h/e;o[h]=this.getTangentAt(p,new E)}r[0]=new E,s[0]=new E;let g=Number.MAX_VALUE;const c=Math.abs(o[0].x),C=Math.abs(o[0].y),d=Math.abs(o[0].z);c<=g&&(g=c,i.set(1,0,0)),C<=g&&(g=C,i.set(0,1,0)),d<=g&&i.set(0,0,1),a.crossVectors(o[0],i).normalize(),r[0].crossVectors(o[0],a),s[0].crossVectors(o[0],r[0]);for(let h=1;h<=e;h++){if(r[h]=r[h-1].clone(),s[h]=s[h-1].clone(),a.crossVectors(o[h-1],o[h]),a.length()>Number.EPSILON){a.normalize();const p=Math.acos(Un(o[h-1].dot(o[h]),-1,1));r[h].applyMatrix4(l.makeRotationAxis(a,p))}s[h].crossVectors(o[h],r[h])}if(n===!0){let h=Math.acos(Un(r[0].dot(r[e]),-1,1));h/=e,o[0].dot(a.crossVectors(r[0],r[e]))>0&&(h=-h);for(let p=1;p<=e;p++)r[p].applyMatrix4(l.makeRotationAxis(o[p],h*p)),s[p].crossVectors(o[p],r[p])}return{tangents:o,normals:r,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class zm extends Jr{constructor(e=0,n=0,i=1,o=1,r=0,s=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=n,this.xRadius=i,this.yRadius=o,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=l}getPoint(e,n){const i=n||new We,o=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=o;for(;r>o;)r-=o;r<Number.EPSILON&&(s?r=0:r=o),this.aClockwise===!0&&!s&&(r===o?r=-o:r=r-o);const a=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(a),g=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const c=Math.cos(this.aRotation),C=Math.sin(this.aRotation),d=l-this.aX,h=g-this.aY;l=d*c-h*C+this.aX,g=d*C+h*c+this.aY}return i.set(l,g)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class DM extends zm{constructor(e,n,i,o,r,s){super(e,n,i,i,o,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function b2(){let t=0,e=0,n=0,i=0;function o(r,s,a,l){t=r,e=a,n=-3*r+3*s-2*a-l,i=2*r-2*s+a+l}return{initCatmullRom:function(r,s,a,l,g){o(s,a,g*(a-r),g*(l-s))},initNonuniformCatmullRom:function(r,s,a,l,g,c,C){let d=(s-r)/g-(a-r)/(g+c)+(a-s)/c,h=(a-s)/c-(l-s)/(c+C)+(l-a)/C;d*=c,h*=c,o(s,a,d,h)},calc:function(r){const s=r*r,a=s*r;return t+e*r+n*s+i*a}}}const jA=new E,wy=new b2,Sy=new b2,Ry=new b2;class JM extends Jr{constructor(e=[],n=!1,i="centripetal",o=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=n,this.curveType=i,this.tension=o}getPoint(e,n=new E){const i=n,o=this.points,r=o.length,s=(r-(this.closed?0:1))*e;let a=Math.floor(s),l=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let g,c;this.closed||a>0?g=o[(a-1)%r]:(jA.subVectors(o[0],o[1]).add(o[0]),g=jA);const C=o[a%r],d=o[(a+1)%r];if(this.closed||a+2<r?c=o[(a+2)%r]:(jA.subVectors(o[r-1],o[r-2]).add(o[r-1]),c=jA),this.curveType==="centripetal"||this.curveType==="chordal"){const h=this.curveType==="chordal"?.5:.25;let p=Math.pow(g.distanceToSquared(C),h),v=Math.pow(C.distanceToSquared(d),h),f=Math.pow(d.distanceToSquared(c),h);v<1e-4&&(v=1),p<1e-4&&(p=v),f<1e-4&&(f=v),wy.initNonuniformCatmullRom(g.x,C.x,d.x,c.x,p,v,f),Sy.initNonuniformCatmullRom(g.y,C.y,d.y,c.y,p,v,f),Ry.initNonuniformCatmullRom(g.z,C.z,d.z,c.z,p,v,f)}else this.curveType==="catmullrom"&&(wy.initCatmullRom(g.x,C.x,d.x,c.x,this.tension),Sy.initCatmullRom(g.y,C.y,d.y,c.y,this.tension),Ry.initCatmullRom(g.z,C.z,d.z,c.z,this.tension));return i.set(wy.calc(l),Sy.calc(l),Ry.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){const o=e.points[n];this.points.push(o.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,i=this.points.length;n<i;n++){const o=this.points[n];e.points.push(o.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){const o=e.points[n];this.points.push(new E().fromArray(o))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function KW(t,e,n,i,o){const r=(i-e)*.5,s=(o-n)*.5,a=t*t,l=t*a;return(2*n-2*i+r+s)*l+(-3*n+3*i-2*r-s)*a+r*t+n}function QJ(t,e){const n=1-t;return n*n*e}function jJ(t,e){return 2*(1-t)*t*e}function qJ(t,e){return t*t*e}function RC(t,e,n,i){return QJ(t,e)+jJ(t,n)+qJ(t,i)}function $J(t,e){const n=1-t;return n*n*n*e}function eO(t,e){const n=1-t;return 3*n*n*t*e}function tO(t,e){return 3*(1-t)*t*t*e}function nO(t,e){return t*t*t*e}function WC(t,e,n,i,o){return $J(t,e)+eO(t,n)+tO(t,i)+nO(t,o)}class y2 extends Jr{constructor(e=new We,n=new We,i=new We,o=new We){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=n,this.v2=i,this.v3=o}getPoint(e,n=new We){const i=n,o=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(WC(e,o.x,r.x,s.x,a.x),WC(e,o.y,r.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class OM extends Jr{constructor(e=new E,n=new E,i=new E,o=new E){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=n,this.v2=i,this.v3=o}getPoint(e,n=new E){const i=n,o=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(WC(e,o.x,r.x,s.x,a.x),WC(e,o.y,r.y,s.y,a.y),WC(e,o.z,r.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Lm extends Jr{constructor(e=new We,n=new We){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=n}getPoint(e,n=new We){const i=n;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new We){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class QM extends Jr{constructor(e=new E,n=new E){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=n}getPoint(e,n=new E){const i=n;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new E){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class v2 extends Jr{constructor(e=new We,n=new We,i=new We){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=n,this.v2=i}getPoint(e,n=new We){const i=n,o=this.v0,r=this.v1,s=this.v2;return i.set(RC(e,o.x,r.x,s.x),RC(e,o.y,r.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class G2 extends Jr{constructor(e=new E,n=new E,i=new E){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=n,this.v2=i}getPoint(e,n=new E){const i=n,o=this.v0,r=this.v1,s=this.v2;return i.set(RC(e,o.x,r.x,s.x),RC(e,o.y,r.y,s.y),RC(e,o.z,r.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class B2 extends Jr{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,n=new We){const i=n,o=this.points,r=(o.length-1)*e,s=Math.floor(r),a=r-s,l=o[s===0?s:s-1],g=o[s],c=o[s>o.length-2?o.length-1:s+1],C=o[s>o.length-3?o.length-1:s+2];return i.set(KW(a,l.x,g.x,c.x,C.x),KW(a,l.y,g.y,c.y,C.y)),i}copy(e){super.copy(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){const o=e.points[n];this.points.push(o.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,i=this.points.length;n<i;n++){const o=this.points[n];e.points.push(o.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,i=e.points.length;n<i;n++){const o=e.points[n];this.points.push(new We().fromArray(o))}return this}}var Z2=Object.freeze({__proto__:null,ArcCurve:DM,CatmullRomCurve3:JM,CubicBezierCurve:y2,CubicBezierCurve3:OM,EllipseCurve:zm,LineCurve:Lm,LineCurve3:QM,QuadraticBezierCurve:v2,QuadraticBezierCurve3:G2,SplineCurve:B2});class jM extends Jr{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);e.equals(n)||this.curves.push(new Lm(n,e))}getPoint(e,n){const i=e*this.getLength(),o=this.getCurveLengths();let r=0;for(;r<o.length;){if(o[r]>=i){const s=o[r]-i,a=this.curves[r],l=a.getLength(),g=l===0?0:1-s/l;return a.getPointAt(g,n)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let n=0;for(let i=0,o=this.curves.length;i<o;i++)n+=this.curves[i].getLength(),e.push(n);return this.cacheLengths=e,e}getSpacedPoints(e=40){const n=[];for(let i=0;i<=e;i++)n.push(this.getPoint(i/e));return this.autoClose&&n.push(n[0]),n}getPoints(e=12){const n=[];let i;for(let o=0,r=this.curves;o<r.length;o++){const s=r[o],a=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,l=s.getPoints(a);for(let g=0;g<l.length;g++){const c=l[g];i&&i.equals(c)||(n.push(c),i=c)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let n=0,i=e.curves.length;n<i;n++){const o=e.curves[n];this.curves.push(o.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let n=0,i=this.curves.length;n<i;n++){const o=this.curves[n];e.curves.push(o.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let n=0,i=e.curves.length;n<i;n++){const o=e.curves[n];this.curves.push(new Z2[o.type]().fromJSON(o))}return this}}class Cd extends jM{constructor(e){super(),this.type="Path",this.currentPoint=new We,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let n=1,i=e.length;n<i;n++)this.lineTo(e[n].x,e[n].y);return this}moveTo(e,n){return this.currentPoint.set(e,n),this}lineTo(e,n){const i=new Lm(this.currentPoint.clone(),new We(e,n));return this.curves.push(i),this.currentPoint.set(e,n),this}quadraticCurveTo(e,n,i,o){const r=new v2(this.currentPoint.clone(),new We(e,n),new We(i,o));return this.curves.push(r),this.currentPoint.set(i,o),this}bezierCurveTo(e,n,i,o,r,s){const a=new y2(this.currentPoint.clone(),new We(e,n),new We(i,o),new We(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(e){const n=[this.currentPoint.clone()].concat(e),i=new B2(n);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,n,i,o,r,s){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,n+l,i,o,r,s),this}absarc(e,n,i,o,r,s){return this.absellipse(e,n,i,i,o,r,s),this}ellipse(e,n,i,o,r,s,a,l){const g=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+g,n+c,i,o,r,s,a,l),this}absellipse(e,n,i,o,r,s,a,l){const g=new zm(e,n,i,o,r,s,a,l);if(this.curves.length>0){const C=g.getPoint(0);C.equals(this.currentPoint)||this.lineTo(C.x,C.y)}this.curves.push(g);const c=g.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Dd extends _t{constructor(e=[new We(0,-.5),new We(.5,0),new We(0,.5)],n=12,i=0,o=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:n,phiStart:i,phiLength:o},n=Math.floor(n),o=Un(o,0,Math.PI*2);const r=[],s=[],a=[],l=[],g=[],c=1/n,C=new E,d=new We,h=new E,p=new E,v=new E;let f=0,A=0;for(let b=0;b<=e.length-1;b++)switch(b){case 0:f=e[b+1].x-e[b].x,A=e[b+1].y-e[b].y,h.x=A*1,h.y=-f,h.z=A*0,v.copy(h),h.normalize(),l.push(h.x,h.y,h.z);break;case e.length-1:l.push(v.x,v.y,v.z);break;default:f=e[b+1].x-e[b].x,A=e[b+1].y-e[b].y,h.x=A*1,h.y=-f,h.z=A*0,p.copy(h),h.x+=v.x,h.y+=v.y,h.z+=v.z,h.normalize(),l.push(h.x,h.y,h.z),v.copy(p)}for(let b=0;b<=n;b++){const m=i+b*c*o,B=Math.sin(m),Z=Math.cos(m);for(let w=0;w<=e.length-1;w++){C.x=e[w].x*B,C.y=e[w].y,C.z=e[w].x*Z,s.push(C.x,C.y,C.z),d.x=b/n,d.y=w/(e.length-1),a.push(d.x,d.y);const W=l[3*w+0]*B,X=l[3*w+1],V=l[3*w+0]*Z;g.push(W,X,V)}}for(let b=0;b<n;b++)for(let m=0;m<e.length-1;m++){const B=m+b*e.length,Z=B,w=B+e.length,W=B+e.length+1,X=B+1;r.push(Z,w,X),r.push(W,X,w)}this.setIndex(r),this.setAttribute("position",new Ct(s,3)),this.setAttribute("uv",new Ct(a,2)),this.setAttribute("normal",new Ct(g,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Dd(e.points,e.segments,e.phiStart,e.phiLength)}}class Em extends Dd{constructor(e=1,n=1,i=4,o=8){const r=new Cd;r.absarc(0,-n/2,e,Math.PI*1.5,0),r.absarc(0,n/2,e,0,Math.PI*.5),super(r.getPoints(i),o),this.type="CapsuleGeometry",this.parameters={radius:e,length:n,capSegments:i,radialSegments:o}}static fromJSON(e){return new Em(e.radius,e.length,e.capSegments,e.radialSegments)}}class km extends _t{constructor(e=1,n=32,i=0,o=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:n,thetaStart:i,thetaLength:o},n=Math.max(3,n);const r=[],s=[],a=[],l=[],g=new E,c=new We;s.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let C=0,d=3;C<=n;C++,d+=3){const h=i+C/n*o;g.x=e*Math.cos(h),g.y=e*Math.sin(h),s.push(g.x,g.y,g.z),a.push(0,0,1),c.x=(s[d]/e+1)/2,c.y=(s[d+1]/e+1)/2,l.push(c.x,c.y)}for(let C=1;C<=n;C++)r.push(C,C+1,0);this.setIndex(r),this.setAttribute("position",new Ct(s,3)),this.setAttribute("normal",new Ct(a,3)),this.setAttribute("uv",new Ct(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new km(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class JI extends _t{constructor(e=1,n=1,i=1,o=32,r=1,s=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:n,height:i,radialSegments:o,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:l};const g=this;o=Math.floor(o),r=Math.floor(r);const c=[],C=[],d=[],h=[];let p=0;const v=[],f=i/2;let A=0;b(),s===!1&&(e>0&&m(!0),n>0&&m(!1)),this.setIndex(c),this.setAttribute("position",new Ct(C,3)),this.setAttribute("normal",new Ct(d,3)),this.setAttribute("uv",new Ct(h,2));function b(){const B=new E,Z=new E;let w=0;const W=(n-e)/i;for(let X=0;X<=r;X++){const V=[],Y=X/r,z=Y*(n-e)+e;for(let q=0;q<=o;q++){const O=q/o,te=O*l+a,oe=Math.sin(te),re=Math.cos(te);Z.x=z*oe,Z.y=-Y*i+f,Z.z=z*re,C.push(Z.x,Z.y,Z.z),B.set(oe,W,re).normalize(),d.push(B.x,B.y,B.z),h.push(O,1-Y),V.push(p++)}v.push(V)}for(let X=0;X<o;X++)for(let V=0;V<r;V++){const Y=v[V][X],z=v[V+1][X],q=v[V+1][X+1],O=v[V][X+1];c.push(Y,z,O),c.push(z,q,O),w+=6}g.addGroup(A,w,0),A+=w}function m(B){const Z=p,w=new We,W=new E;let X=0;const V=B===!0?e:n,Y=B===!0?1:-1;for(let q=1;q<=o;q++)C.push(0,f*Y,0),d.push(0,Y,0),h.push(.5,.5),p++;const z=p;for(let q=0;q<=o;q++){const te=q/o*l+a,oe=Math.cos(te),re=Math.sin(te);W.x=V*re,W.y=f*Y,W.z=V*oe,C.push(W.x,W.y,W.z),d.push(0,Y,0),w.x=oe*.5+.5,w.y=re*.5*Y+.5,h.push(w.x,w.y),p++}for(let q=0;q<o;q++){const O=Z+q,te=z+q;B===!0?c.push(te,te+1,O):c.push(te+1,te,O),X+=3}g.addGroup(A,X,B===!0?1:2),A+=X}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new JI(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Tm extends JI{constructor(e=1,n=1,i=32,o=1,r=!1,s=0,a=Math.PI*2){super(0,e,n,i,o,r,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:n,radialSegments:i,heightSegments:o,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(e){return new Tm(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class wl extends _t{constructor(e=[],n=[],i=1,o=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:n,radius:i,detail:o};const r=[],s=[];a(o),g(i),c(),this.setAttribute("position",new Ct(r,3)),this.setAttribute("normal",new Ct(r.slice(),3)),this.setAttribute("uv",new Ct(s,2)),o===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const m=new E,B=new E,Z=new E;for(let w=0;w<n.length;w+=3)h(n[w+0],m),h(n[w+1],B),h(n[w+2],Z),l(m,B,Z,b)}function l(b,m,B,Z){const w=Z+1,W=[];for(let X=0;X<=w;X++){W[X]=[];const V=b.clone().lerp(B,X/w),Y=m.clone().lerp(B,X/w),z=w-X;for(let q=0;q<=z;q++)q===0&&X===w?W[X][q]=V:W[X][q]=V.clone().lerp(Y,q/z)}for(let X=0;X<w;X++)for(let V=0;V<2*(w-X)-1;V++){const Y=Math.floor(V/2);V%2===0?(d(W[X][Y+1]),d(W[X+1][Y]),d(W[X][Y])):(d(W[X][Y+1]),d(W[X+1][Y+1]),d(W[X+1][Y]))}}function g(b){const m=new E;for(let B=0;B<r.length;B+=3)m.x=r[B+0],m.y=r[B+1],m.z=r[B+2],m.normalize().multiplyScalar(b),r[B+0]=m.x,r[B+1]=m.y,r[B+2]=m.z}function c(){const b=new E;for(let m=0;m<r.length;m+=3){b.x=r[m+0],b.y=r[m+1],b.z=r[m+2];const B=f(b)/2/Math.PI+.5,Z=A(b)/Math.PI+.5;s.push(B,1-Z)}p(),C()}function C(){for(let b=0;b<s.length;b+=6){const m=s[b+0],B=s[b+2],Z=s[b+4],w=Math.max(m,B,Z),W=Math.min(m,B,Z);w>.9&&W<.1&&(m<.2&&(s[b+0]+=1),B<.2&&(s[b+2]+=1),Z<.2&&(s[b+4]+=1))}}function d(b){r.push(b.x,b.y,b.z)}function h(b,m){const B=b*3;m.x=e[B+0],m.y=e[B+1],m.z=e[B+2]}function p(){const b=new E,m=new E,B=new E,Z=new E,w=new We,W=new We,X=new We;for(let V=0,Y=0;V<r.length;V+=9,Y+=6){b.set(r[V+0],r[V+1],r[V+2]),m.set(r[V+3],r[V+4],r[V+5]),B.set(r[V+6],r[V+7],r[V+8]),w.set(s[Y+0],s[Y+1]),W.set(s[Y+2],s[Y+3]),X.set(s[Y+4],s[Y+5]),Z.copy(b).add(m).add(B).divideScalar(3);const z=f(Z);v(w,Y+0,b,z),v(W,Y+2,m,z),v(X,Y+4,B,z)}}function v(b,m,B,Z){Z<0&&b.x===1&&(s[m]=b.x-1),B.x===0&&B.z===0&&(s[m]=Z/2/Math.PI+.5)}function f(b){return Math.atan2(b.z,-b.x)}function A(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wl(e.vertices,e.indices,e.radius,e.details)}}class _m extends wl{constructor(e=1,n=0){const i=(1+Math.sqrt(5))/2,o=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-i,0,-o,i,0,o,-i,0,o,i,-o,-i,0,-o,i,0,o,-i,0,o,i,0,-i,0,-o,i,0,-o,-i,0,o,i,0,o],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,s,e,n),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new _m(e.radius,e.detail)}}const qA=new E,$A=new E,Wy=new E,ep=new Go;class qM extends _t{constructor(e=null,n=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:n},e!==null){const o=Math.pow(10,4),r=Math.cos(fg*n),s=e.getIndex(),a=e.getAttribute("position"),l=s?s.count:a.count,g=[0,0,0],c=["a","b","c"],C=new Array(3),d={},h=[];for(let p=0;p<l;p+=3){s?(g[0]=s.getX(p),g[1]=s.getX(p+1),g[2]=s.getX(p+2)):(g[0]=p,g[1]=p+1,g[2]=p+2);const{a:v,b:f,c:A}=ep;if(v.fromBufferAttribute(a,g[0]),f.fromBufferAttribute(a,g[1]),A.fromBufferAttribute(a,g[2]),ep.getNormal(Wy),C[0]=`${Math.round(v.x*o)},${Math.round(v.y*o)},${Math.round(v.z*o)}`,C[1]=`${Math.round(f.x*o)},${Math.round(f.y*o)},${Math.round(f.z*o)}`,C[2]=`${Math.round(A.x*o)},${Math.round(A.y*o)},${Math.round(A.z*o)}`,!(C[0]===C[1]||C[1]===C[2]||C[2]===C[0]))for(let b=0;b<3;b++){const m=(b+1)%3,B=C[b],Z=C[m],w=ep[c[b]],W=ep[c[m]],X=`${B}_${Z}`,V=`${Z}_${B}`;V in d&&d[V]?(Wy.dot(d[V].normal)<=r&&(h.push(w.x,w.y,w.z),h.push(W.x,W.y,W.z)),d[V]=null):X in d||(d[X]={index0:g[b],index1:g[m],normal:Wy.clone()})}}for(const p in d)if(d[p]){const{index0:v,index1:f}=d[p];qA.fromBufferAttribute(a,v),$A.fromBufferAttribute(a,f),h.push(qA.x,qA.y,qA.z),h.push($A.x,$A.y,$A.z)}this.setAttribute("position",new Ct(h,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}let bg=class extends Cd{constructor(e){super(e),this.uuid=ko(),this.type="Shape",this.holes=[]}getPointsHoles(e){const n=[];for(let i=0,o=this.holes.length;i<o;i++)n[i]=this.holes[i].getPoints(e);return n}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let n=0,i=e.holes.length;n<i;n++){const o=e.holes[n];this.holes.push(o.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let n=0,i=this.holes.length;n<i;n++){const o=this.holes[n];e.holes.push(o.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let n=0,i=e.holes.length;n<i;n++){const o=e.holes[n];this.holes.push(new Cd().fromJSON(o))}return this}};const iO={triangulate:function(t,e,n=2){const i=e&&e.length,o=i?e[0]*n:t.length;let r=$M(t,0,o,n,!0);const s=[];if(!r||r.next===r.prev)return s;let a,l,g,c,C,d,h;if(i&&(r=lO(t,e,r,n)),t.length>80*n){a=g=t[0],l=c=t[1];for(let p=n;p<o;p+=n)C=t[p],d=t[p+1],C<a&&(a=C),d<l&&(l=d),C>g&&(g=C),d>c&&(c=d);h=Math.max(g-a,c-l),h=h!==0?32767/h:0}return dd(r,s,n,a,l,h,0),s}};function $M(t,e,n,i,o){let r,s;if(o===mO(t,e,n,i)>0)for(r=e;r<n;r+=i)s=zW(r,t[r],t[r+1],s);else for(r=n-i;r>=e;r-=i)s=zW(r,t[r],t[r+1],s);return s&&Um(s,s.next)&&(Ad(s),s=s.next),s}function Xg(t,e){if(!t)return t;e||(e=t);let n=t,i;do if(i=!1,!n.steiner&&(Um(n,n.next)||Kn(n.prev,n,n.next)===0)){if(Ad(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function dd(t,e,n,i,o,r,s){if(!t)return;!s&&r&&CO(t,i,o,r);let a=t,l,g;for(;t.prev!==t.next;){if(l=t.prev,g=t.next,r?rO(t,i,o,r):oO(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(g.i/n|0),Ad(t),t=g.next,a=g.next;continue}if(t=g,t===a){s?s===1?(t=sO(Xg(t),e,n),dd(t,e,n,i,o,r,2)):s===2&&aO(t,e,n,i,o,r):dd(Xg(t),e,n,i,o,r,1);break}}}function oO(t){const e=t.prev,n=t,i=t.next;if(Kn(e,n,i)>=0)return!1;const o=e.x,r=n.x,s=i.x,a=e.y,l=n.y,g=i.y,c=o<r?o<s?o:s:r<s?r:s,C=a<l?a<g?a:g:l<g?l:g,d=o>r?o>s?o:s:r>s?r:s,h=a>l?a>g?a:g:l>g?l:g;let p=i.next;for(;p!==e;){if(p.x>=c&&p.x<=d&&p.y>=C&&p.y<=h&&tI(o,a,r,l,s,g,p.x,p.y)&&Kn(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function rO(t,e,n,i){const o=t.prev,r=t,s=t.next;if(Kn(o,r,s)>=0)return!1;const a=o.x,l=r.x,g=s.x,c=o.y,C=r.y,d=s.y,h=a<l?a<g?a:g:l<g?l:g,p=c<C?c<d?c:d:C<d?C:d,v=a>l?a>g?a:g:l>g?l:g,f=c>C?c>d?c:d:C>d?C:d,A=OG(h,p,e,n,i),b=OG(v,f,e,n,i);let m=t.prevZ,B=t.nextZ;for(;m&&m.z>=A&&B&&B.z<=b;){if(m.x>=h&&m.x<=v&&m.y>=p&&m.y<=f&&m!==o&&m!==s&&tI(a,c,l,C,g,d,m.x,m.y)&&Kn(m.prev,m,m.next)>=0||(m=m.prevZ,B.x>=h&&B.x<=v&&B.y>=p&&B.y<=f&&B!==o&&B!==s&&tI(a,c,l,C,g,d,B.x,B.y)&&Kn(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;m&&m.z>=A;){if(m.x>=h&&m.x<=v&&m.y>=p&&m.y<=f&&m!==o&&m!==s&&tI(a,c,l,C,g,d,m.x,m.y)&&Kn(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;B&&B.z<=b;){if(B.x>=h&&B.x<=v&&B.y>=p&&B.y<=f&&B!==o&&B!==s&&tI(a,c,l,C,g,d,B.x,B.y)&&Kn(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function sO(t,e,n){let i=t;do{const o=i.prev,r=i.next.next;!Um(o,r)&&e3(o,i,i.next,r)&&hd(o,r)&&hd(r,o)&&(e.push(o.i/n|0),e.push(i.i/n|0),e.push(r.i/n|0),Ad(i),Ad(i.next),i=t=r),i=i.next}while(i!==t);return Xg(i)}function aO(t,e,n,i,o,r){let s=t;do{let a=s.next.next;for(;a!==s.prev;){if(s.i!==a.i&&AO(s,a)){let l=t3(s,a);s=Xg(s,s.next),l=Xg(l,l.next),dd(s,e,n,i,o,r,0),dd(l,e,n,i,o,r,0);return}a=a.next}s=s.next}while(s!==t)}function lO(t,e,n,i){const o=[];let r,s,a,l,g;for(r=0,s=e.length;r<s;r++)a=e[r]*i,l=r<s-1?e[r+1]*i:t.length,g=$M(t,a,l,i,!1),g===g.next&&(g.steiner=!0),o.push(hO(g));for(o.sort(gO),r=0;r<o.length;r++)n=cO(o[r],n);return n}function gO(t,e){return t.x-e.x}function cO(t,e){const n=IO(t,e);if(!n)return e;const i=t3(n,t);return Xg(i,i.next),Xg(n,n.next)}function IO(t,e){let n=e,i=-1/0,o;const r=t.x,s=t.y;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){const d=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(d<=r&&d>i&&(i=d,o=n.x<n.next.x?n:n.next,d===r))return o}n=n.next}while(n!==e);if(!o)return null;const a=o,l=o.x,g=o.y;let c=1/0,C;n=o;do r>=n.x&&n.x>=l&&r!==n.x&&tI(s<g?r:i,s,l,g,s<g?i:r,s,n.x,n.y)&&(C=Math.abs(s-n.y)/(r-n.x),hd(n,t)&&(C<c||C===c&&(n.x>o.x||n.x===o.x&&uO(o,n)))&&(o=n,c=C)),n=n.next;while(n!==a);return o}function uO(t,e){return Kn(t.prev,t,e.prev)<0&&Kn(e.next,t,t.next)<0}function CO(t,e,n,i){let o=t;do o.z===0&&(o.z=OG(o.x,o.y,e,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,dO(o)}function dO(t){let e,n,i,o,r,s,a,l,g=1;do{for(n=t,t=null,r=null,s=0;n;){for(s++,i=n,a=0,e=0;e<g&&(a++,i=i.nextZ,!!i);e++);for(l=g;a>0||l>0&&i;)a!==0&&(l===0||!i||n.z<=i.z)?(o=n,n=n.nextZ,a--):(o=i,i=i.nextZ,l--),r?r.nextZ=o:t=o,o.prevZ=r,r=o;n=i}r.nextZ=null,g*=2}while(s>1);return t}function OG(t,e,n,i,o){return t=(t-n)*o|0,e=(e-i)*o|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function hO(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function tI(t,e,n,i,o,r,s,a){return(o-s)*(e-a)>=(t-s)*(r-a)&&(t-s)*(i-a)>=(n-s)*(e-a)&&(n-s)*(r-a)>=(o-s)*(i-a)}function AO(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!pO(t,e)&&(hd(t,e)&&hd(e,t)&&fO(t,e)&&(Kn(t.prev,t,e.prev)||Kn(t,e.prev,e))||Um(t,e)&&Kn(t.prev,t,t.next)>0&&Kn(e.prev,e,e.next)>0)}function Kn(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Um(t,e){return t.x===e.x&&t.y===e.y}function e3(t,e,n,i){const o=np(Kn(t,e,n)),r=np(Kn(t,e,i)),s=np(Kn(n,i,t)),a=np(Kn(n,i,e));return!!(o!==r&&s!==a||o===0&&tp(t,n,e)||r===0&&tp(t,i,e)||s===0&&tp(n,t,i)||a===0&&tp(n,e,i))}function tp(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function np(t){return t>0?1:t<0?-1:0}function pO(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&e3(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function hd(t,e){return Kn(t.prev,t,t.next)<0?Kn(t,e,t.next)>=0&&Kn(t,t.prev,e)>=0:Kn(t,e,t.prev)<0||Kn(t,t.next,e)<0}function fO(t,e){let n=t,i=!1;const o=(t.x+e.x)/2,r=(t.y+e.y)/2;do n.y>r!=n.next.y>r&&n.next.y!==n.y&&o<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function t3(t,e){const n=new QG(t.i,t.x,t.y),i=new QG(e.i,e.x,e.y),o=t.next,r=e.prev;return t.next=e,e.prev=t,n.next=o,o.prev=n,i.next=n,n.prev=i,r.next=i,i.prev=r,i}function zW(t,e,n,i){const o=new QG(t,e,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function Ad(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function QG(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function mO(t,e,n,i){let o=0;for(let r=e,s=n-i;r<n;r+=i)o+=(t[s]-t[r])*(t[r+1]+t[s+1]),s=r;return o}class Gs{static area(e){const n=e.length;let i=0;for(let o=n-1,r=0;r<n;o=r++)i+=e[o].x*e[r].y-e[r].x*e[o].y;return i*.5}static isClockWise(e){return Gs.area(e)<0}static triangulateShape(e,n){const i=[],o=[],r=[];LW(e),EW(i,e);let s=e.length;n.forEach(LW);for(let l=0;l<n.length;l++)o.push(s),s+=n[l].length,EW(i,n[l]);const a=iO.triangulate(i,o);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}}function LW(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function EW(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class Jd extends _t{constructor(e=new bg([new We(.5,.5),new We(-.5,.5),new We(-.5,-.5),new We(.5,-.5)]),n={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:n},e=Array.isArray(e)?e:[e];const i=this,o=[],r=[];for(let a=0,l=e.length;a<l;a++){const g=e[a];s(g)}this.setAttribute("position",new Ct(o,3)),this.setAttribute("uv",new Ct(r,2)),this.computeVertexNormals();function s(a){const l=[],g=n.curveSegments!==void 0?n.curveSegments:12,c=n.steps!==void 0?n.steps:1,C=n.depth!==void 0?n.depth:1;let d=n.bevelEnabled!==void 0?n.bevelEnabled:!0,h=n.bevelThickness!==void 0?n.bevelThickness:.2,p=n.bevelSize!==void 0?n.bevelSize:h-.1,v=n.bevelOffset!==void 0?n.bevelOffset:0,f=n.bevelSegments!==void 0?n.bevelSegments:3;const A=n.extrudePath,b=n.UVGenerator!==void 0?n.UVGenerator:bO;let m,B=!1,Z,w,W,X;A&&(m=A.getSpacedPoints(c),B=!0,d=!1,Z=A.computeFrenetFrames(c,!1),w=new E,W=new E,X=new E),d||(f=0,h=0,p=0,v=0);const V=a.extractPoints(g);let Y=V.shape;const z=V.holes;if(!Gs.isClockWise(Y)){Y=Y.reverse();for(let ee=0,Ne=z.length;ee<Ne;ee++){const Se=z[ee];Gs.isClockWise(Se)&&(z[ee]=Se.reverse())}}const O=Gs.triangulateShape(Y,z),te=Y;for(let ee=0,Ne=z.length;ee<Ne;ee++){const Se=z[ee];Y=Y.concat(Se)}function oe(ee,Ne,Se){return Ne||console.error("THREE.ExtrudeGeometry: vec does not exist"),ee.clone().addScaledVector(Ne,Se)}const re=Y.length,se=O.length;function H(ee,Ne,Se){let He,Ve,at;const Qe=ee.x-Ne.x,et=ee.y-Ne.y,ut=Se.x-ee.x,xt=Se.y-ee.y,on=Qe*Qe+et*et,L=Qe*xt-et*ut;if(Math.abs(L)>Number.EPSILON){const F=Math.sqrt(on),ce=Math.sqrt(ut*ut+xt*xt),Ye=Ne.x-et/F,Xe=Ne.y+Qe/F,Fe=Se.x-xt/ce,tt=Se.y+ut/ce,ze=((Fe-Ye)*xt-(tt-Xe)*ut)/(Qe*xt-et*ut);He=Ye+Qe*ze-ee.x,Ve=Xe+et*ze-ee.y;const Ae=He*He+Ve*Ve;if(Ae<=2)return new We(He,Ve);at=Math.sqrt(Ae/2)}else{let F=!1;Qe>Number.EPSILON?ut>Number.EPSILON&&(F=!0):Qe<-Number.EPSILON?ut<-Number.EPSILON&&(F=!0):Math.sign(et)===Math.sign(xt)&&(F=!0),F?(He=-et,Ve=Qe,at=Math.sqrt(on)):(He=Qe,Ve=et,at=Math.sqrt(on/2))}return new We(He/at,Ve/at)}const D=[];for(let ee=0,Ne=te.length,Se=Ne-1,He=ee+1;ee<Ne;ee++,Se++,He++)Se===Ne&&(Se=0),He===Ne&&(He=0),D[ee]=H(te[ee],te[Se],te[He]);const T=[];let J,$=D.concat();for(let ee=0,Ne=z.length;ee<Ne;ee++){const Se=z[ee];J=[];for(let He=0,Ve=Se.length,at=Ve-1,Qe=He+1;He<Ve;He++,at++,Qe++)at===Ve&&(at=0),Qe===Ve&&(Qe=0),J[He]=H(Se[He],Se[at],Se[Qe]);T.push(J),$=$.concat(J)}for(let ee=0;ee<f;ee++){const Ne=ee/f,Se=h*Math.cos(Ne*Math.PI/2),He=p*Math.sin(Ne*Math.PI/2)+v;for(let Ve=0,at=te.length;Ve<at;Ve++){const Qe=oe(te[Ve],D[Ve],He);Me(Qe.x,Qe.y,-Se)}for(let Ve=0,at=z.length;Ve<at;Ve++){const Qe=z[Ve];J=T[Ve];for(let et=0,ut=Qe.length;et<ut;et++){const xt=oe(Qe[et],J[et],He);Me(xt.x,xt.y,-Se)}}}const Ie=p+v;for(let ee=0;ee<re;ee++){const Ne=d?oe(Y[ee],$[ee],Ie):Y[ee];B?(W.copy(Z.normals[0]).multiplyScalar(Ne.x),w.copy(Z.binormals[0]).multiplyScalar(Ne.y),X.copy(m[0]).add(W).add(w),Me(X.x,X.y,X.z)):Me(Ne.x,Ne.y,0)}for(let ee=1;ee<=c;ee++)for(let Ne=0;Ne<re;Ne++){const Se=d?oe(Y[Ne],$[Ne],Ie):Y[Ne];B?(W.copy(Z.normals[ee]).multiplyScalar(Se.x),w.copy(Z.binormals[ee]).multiplyScalar(Se.y),X.copy(m[ee]).add(W).add(w),Me(X.x,X.y,X.z)):Me(Se.x,Se.y,C/c*ee)}for(let ee=f-1;ee>=0;ee--){const Ne=ee/f,Se=h*Math.cos(Ne*Math.PI/2),He=p*Math.sin(Ne*Math.PI/2)+v;for(let Ve=0,at=te.length;Ve<at;Ve++){const Qe=oe(te[Ve],D[Ve],He);Me(Qe.x,Qe.y,C+Se)}for(let Ve=0,at=z.length;Ve<at;Ve++){const Qe=z[Ve];J=T[Ve];for(let et=0,ut=Qe.length;et<ut;et++){const xt=oe(Qe[et],J[et],He);B?Me(xt.x,xt.y+m[c-1].y,m[c-1].x+Se):Me(xt.x,xt.y,C+Se)}}}fe(),ve();function fe(){const ee=o.length/3;if(d){let Ne=0,Se=re*Ne;for(let He=0;He<se;He++){const Ve=O[He];_e(Ve[2]+Se,Ve[1]+Se,Ve[0]+Se)}Ne=c+f*2,Se=re*Ne;for(let He=0;He<se;He++){const Ve=O[He];_e(Ve[0]+Se,Ve[1]+Se,Ve[2]+Se)}}else{for(let Ne=0;Ne<se;Ne++){const Se=O[Ne];_e(Se[2],Se[1],Se[0])}for(let Ne=0;Ne<se;Ne++){const Se=O[Ne];_e(Se[0]+re*c,Se[1]+re*c,Se[2]+re*c)}}i.addGroup(ee,o.length/3-ee,0)}function ve(){const ee=o.length/3;let Ne=0;Ge(te,Ne),Ne+=te.length;for(let Se=0,He=z.length;Se<He;Se++){const Ve=z[Se];Ge(Ve,Ne),Ne+=Ve.length}i.addGroup(ee,o.length/3-ee,1)}function Ge(ee,Ne){let Se=ee.length;for(;--Se>=0;){const He=Se;let Ve=Se-1;Ve<0&&(Ve=ee.length-1);for(let at=0,Qe=c+f*2;at<Qe;at++){const et=re*at,ut=re*(at+1),xt=Ne+He+et,on=Ne+Ve+et,L=Ne+Ve+ut,F=Ne+He+ut;Bt(xt,on,L,F)}}}function Me(ee,Ne,Se){l.push(ee),l.push(Ne),l.push(Se)}function _e(ee,Ne,Se){St(ee),St(Ne),St(Se);const He=o.length/3,Ve=b.generateTopUV(i,o,He-3,He-2,He-1);ot(Ve[0]),ot(Ve[1]),ot(Ve[2])}function Bt(ee,Ne,Se,He){St(ee),St(Ne),St(He),St(Ne),St(Se),St(He);const Ve=o.length/3,at=b.generateSideWallUV(i,o,Ve-6,Ve-3,Ve-2,Ve-1);ot(at[0]),ot(at[1]),ot(at[3]),ot(at[1]),ot(at[2]),ot(at[3])}function St(ee){o.push(l[ee*3+0]),o.push(l[ee*3+1]),o.push(l[ee*3+2])}function ot(ee){r.push(ee.x),r.push(ee.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),n=this.parameters.shapes,i=this.parameters.options;return yO(n,i,e)}static fromJSON(e,n){const i=[];for(let r=0,s=e.shapes.length;r<s;r++){const a=n[e.shapes[r]];i.push(a)}const o=e.options.extrudePath;return o!==void 0&&(e.options.extrudePath=new Z2[o.type]().fromJSON(o)),new Jd(i,e.options)}}const bO={generateTopUV:function(t,e,n,i,o){const r=e[n*3],s=e[n*3+1],a=e[i*3],l=e[i*3+1],g=e[o*3],c=e[o*3+1];return[new We(r,s),new We(a,l),new We(g,c)]},generateSideWallUV:function(t,e,n,i,o,r){const s=e[n*3],a=e[n*3+1],l=e[n*3+2],g=e[i*3],c=e[i*3+1],C=e[i*3+2],d=e[o*3],h=e[o*3+1],p=e[o*3+2],v=e[r*3],f=e[r*3+1],A=e[r*3+2];return Math.abs(a-c)<Math.abs(s-g)?[new We(s,1-l),new We(g,1-C),new We(d,1-p),new We(v,1-A)]:[new We(a,1-l),new We(c,1-C),new We(h,1-p),new We(f,1-A)]}};function yO(t,e,n){if(n.shapes=[],Array.isArray(t))for(let i=0,o=t.length;i<o;i++){const r=t[i];n.shapes.push(r.uuid)}else n.shapes.push(t.uuid);return n.options=Object.assign({},e),e.extrudePath!==void 0&&(n.options.extrudePath=e.extrudePath.toJSON()),n}class Od extends wl{constructor(e=1,n=0){const i=(1+Math.sqrt(5))/2,o=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(o,r,e,n),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new Od(e.radius,e.detail)}}class Qd extends wl{constructor(e=1,n=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],o=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,o,e,n),this.type="OctahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new Qd(e.radius,e.detail)}}class Pm extends _t{constructor(e=.5,n=1,i=32,o=1,r=0,s=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:n,thetaSegments:i,phiSegments:o,thetaStart:r,thetaLength:s},i=Math.max(3,i),o=Math.max(1,o);const a=[],l=[],g=[],c=[];let C=e;const d=(n-e)/o,h=new E,p=new We;for(let v=0;v<=o;v++){for(let f=0;f<=i;f++){const A=r+f/i*s;h.x=C*Math.cos(A),h.y=C*Math.sin(A),l.push(h.x,h.y,h.z),g.push(0,0,1),p.x=(h.x/n+1)/2,p.y=(h.y/n+1)/2,c.push(p.x,p.y)}C+=d}for(let v=0;v<o;v++){const f=v*(i+1);for(let A=0;A<i;A++){const b=A+f,m=b,B=b+i+1,Z=b+i+2,w=b+1;a.push(m,B,w),a.push(B,Z,w)}}this.setIndex(a),this.setAttribute("position",new Ct(l,3)),this.setAttribute("normal",new Ct(g,3)),this.setAttribute("uv",new Ct(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pm(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Dm extends _t{constructor(e=new bg([new We(0,.5),new We(-.5,-.5),new We(.5,-.5)]),n=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:n};const i=[],o=[],r=[],s=[];let a=0,l=0;if(Array.isArray(e)===!1)g(e);else for(let c=0;c<e.length;c++)g(e[c]),this.addGroup(a,l,c),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new Ct(o,3)),this.setAttribute("normal",new Ct(r,3)),this.setAttribute("uv",new Ct(s,2));function g(c){const C=o.length/3,d=c.extractPoints(n);let h=d.shape;const p=d.holes;Gs.isClockWise(h)===!1&&(h=h.reverse());for(let f=0,A=p.length;f<A;f++){const b=p[f];Gs.isClockWise(b)===!0&&(p[f]=b.reverse())}const v=Gs.triangulateShape(h,p);for(let f=0,A=p.length;f<A;f++){const b=p[f];h=h.concat(b)}for(let f=0,A=h.length;f<A;f++){const b=h[f];o.push(b.x,b.y,0),r.push(0,0,1),s.push(b.x,b.y)}for(let f=0,A=v.length;f<A;f++){const b=v[f],m=b[0]+C,B=b[1]+C,Z=b[2]+C;i.push(m,B,Z),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),n=this.parameters.shapes;return vO(n,e)}static fromJSON(e,n){const i=[];for(let o=0,r=e.shapes.length;o<r;o++){const s=n[e.shapes[o]];i.push(s)}return new Dm(i,e.curveSegments)}}function vO(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const o=t[n];e.shapes.push(o.uuid)}else e.shapes.push(t.uuid);return e}class jd extends _t{constructor(e=1,n=32,i=16,o=0,r=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:n,heightSegments:i,phiStart:o,phiLength:r,thetaStart:s,thetaLength:a},n=Math.max(3,Math.floor(n)),i=Math.max(2,Math.floor(i));const l=Math.min(s+a,Math.PI);let g=0;const c=[],C=new E,d=new E,h=[],p=[],v=[],f=[];for(let A=0;A<=i;A++){const b=[],m=A/i;let B=0;A===0&&s===0?B=.5/n:A===i&&l===Math.PI&&(B=-.5/n);for(let Z=0;Z<=n;Z++){const w=Z/n;C.x=-e*Math.cos(o+w*r)*Math.sin(s+m*a),C.y=e*Math.cos(s+m*a),C.z=e*Math.sin(o+w*r)*Math.sin(s+m*a),p.push(C.x,C.y,C.z),d.copy(C).normalize(),v.push(d.x,d.y,d.z),f.push(w+B,1-m),b.push(g++)}c.push(b)}for(let A=0;A<i;A++)for(let b=0;b<n;b++){const m=c[A][b+1],B=c[A][b],Z=c[A+1][b],w=c[A+1][b+1];(A!==0||s>0)&&h.push(m,B,w),(A!==i-1||l<Math.PI)&&h.push(B,Z,w)}this.setIndex(h),this.setAttribute("position",new Ct(p,3)),this.setAttribute("normal",new Ct(v,3)),this.setAttribute("uv",new Ct(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jd(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Jm extends wl{constructor(e=1,n=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],o=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,o,e,n),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new Jm(e.radius,e.detail)}}class Om extends _t{constructor(e=1,n=.4,i=12,o=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:n,radialSegments:i,tubularSegments:o,arc:r},i=Math.floor(i),o=Math.floor(o);const s=[],a=[],l=[],g=[],c=new E,C=new E,d=new E;for(let h=0;h<=i;h++)for(let p=0;p<=o;p++){const v=p/o*r,f=h/i*Math.PI*2;C.x=(e+n*Math.cos(f))*Math.cos(v),C.y=(e+n*Math.cos(f))*Math.sin(v),C.z=n*Math.sin(f),a.push(C.x,C.y,C.z),c.x=e*Math.cos(v),c.y=e*Math.sin(v),d.subVectors(C,c).normalize(),l.push(d.x,d.y,d.z),g.push(p/o),g.push(h/i)}for(let h=1;h<=i;h++)for(let p=1;p<=o;p++){const v=(o+1)*h+p-1,f=(o+1)*(h-1)+p-1,A=(o+1)*(h-1)+p,b=(o+1)*h+p;s.push(v,f,b),s.push(f,A,b)}this.setIndex(s),this.setAttribute("position",new Ct(a,3)),this.setAttribute("normal",new Ct(l,3)),this.setAttribute("uv",new Ct(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Om(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Qm extends _t{constructor(e=1,n=.4,i=64,o=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:n,tubularSegments:i,radialSegments:o,p:r,q:s},i=Math.floor(i),o=Math.floor(o);const a=[],l=[],g=[],c=[],C=new E,d=new E,h=new E,p=new E,v=new E,f=new E,A=new E;for(let m=0;m<=i;++m){const B=m/i*r*Math.PI*2;b(B,r,s,e,h),b(B+.01,r,s,e,p),f.subVectors(p,h),A.addVectors(p,h),v.crossVectors(f,A),A.crossVectors(v,f),v.normalize(),A.normalize();for(let Z=0;Z<=o;++Z){const w=Z/o*Math.PI*2,W=-n*Math.cos(w),X=n*Math.sin(w);C.x=h.x+(W*A.x+X*v.x),C.y=h.y+(W*A.y+X*v.y),C.z=h.z+(W*A.z+X*v.z),l.push(C.x,C.y,C.z),d.subVectors(C,h).normalize(),g.push(d.x,d.y,d.z),c.push(m/i),c.push(Z/o)}}for(let m=1;m<=i;m++)for(let B=1;B<=o;B++){const Z=(o+1)*(m-1)+(B-1),w=(o+1)*m+(B-1),W=(o+1)*m+B,X=(o+1)*(m-1)+B;a.push(Z,w,X),a.push(w,W,X)}this.setIndex(a),this.setAttribute("position",new Ct(l,3)),this.setAttribute("normal",new Ct(g,3)),this.setAttribute("uv",new Ct(c,2));function b(m,B,Z,w,W){const X=Math.cos(m),V=Math.sin(m),Y=Z/B*m,z=Math.cos(Y);W.x=w*(2+z)*.5*X,W.y=w*(2+z)*V*.5,W.z=w*Math.sin(Y)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Qm(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class jm extends _t{constructor(e=new G2(new E(-1,-1,0),new E(-1,1,0),new E(1,1,0)),n=64,i=1,o=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:n,radius:i,radialSegments:o,closed:r};const s=e.computeFrenetFrames(n,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new E,l=new E,g=new We;let c=new E;const C=[],d=[],h=[],p=[];v(),this.setIndex(p),this.setAttribute("position",new Ct(C,3)),this.setAttribute("normal",new Ct(d,3)),this.setAttribute("uv",new Ct(h,2));function v(){for(let m=0;m<n;m++)f(m);f(r===!1?n:0),b(),A()}function f(m){c=e.getPointAt(m/n,c);const B=s.normals[m],Z=s.binormals[m];for(let w=0;w<=o;w++){const W=w/o*Math.PI*2,X=Math.sin(W),V=-Math.cos(W);l.x=V*B.x+X*Z.x,l.y=V*B.y+X*Z.y,l.z=V*B.z+X*Z.z,l.normalize(),d.push(l.x,l.y,l.z),a.x=c.x+i*l.x,a.y=c.y+i*l.y,a.z=c.z+i*l.z,C.push(a.x,a.y,a.z)}}function A(){for(let m=1;m<=n;m++)for(let B=1;B<=o;B++){const Z=(o+1)*(m-1)+(B-1),w=(o+1)*m+(B-1),W=(o+1)*m+B,X=(o+1)*(m-1)+B;p.push(Z,w,X),p.push(w,W,X)}}function b(){for(let m=0;m<=n;m++)for(let B=0;B<=o;B++)g.x=m/n,g.y=B/o,h.push(g.x,g.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new jm(new Z2[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class n3 extends _t{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const n=[],i=new Set,o=new E,r=new E;if(e.index!==null){const s=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let g=0,c=l.length;g<c;++g){const C=l[g],d=C.start,h=C.count;for(let p=d,v=d+h;p<v;p+=3)for(let f=0;f<3;f++){const A=a.getX(p+f),b=a.getX(p+(f+1)%3);o.fromBufferAttribute(s,A),r.fromBufferAttribute(s,b),kW(o,r,i)===!0&&(n.push(o.x,o.y,o.z),n.push(r.x,r.y,r.z))}}}else{const s=e.attributes.position;for(let a=0,l=s.count/3;a<l;a++)for(let g=0;g<3;g++){const c=3*a+g,C=3*a+(g+1)%3;o.fromBufferAttribute(s,c),r.fromBufferAttribute(s,C),kW(o,r,i)===!0&&(n.push(o.x,o.y,o.z),n.push(r.x,r.y,r.z))}}this.setAttribute("position",new Ct(n,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function kW(t,e,n){const i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,o=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return n.has(i)===!0||n.has(o)===!0?!1:(n.add(i),n.add(o),!0)}var TW=Object.freeze({__proto__:null,BoxGeometry:Zl,CapsuleGeometry:Em,CircleGeometry:km,ConeGeometry:Tm,CylinderGeometry:JI,DodecahedronGeometry:_m,EdgesGeometry:qM,ExtrudeGeometry:Jd,IcosahedronGeometry:Od,LatheGeometry:Dd,OctahedronGeometry:Qd,PlaneGeometry:Pd,PolyhedronGeometry:wl,RingGeometry:Pm,ShapeGeometry:Dm,SphereGeometry:jd,TetrahedronGeometry:Jm,TorusGeometry:Om,TorusKnotGeometry:Qm,TubeGeometry:jm,WireframeGeometry:n3});class i3 extends Wi{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new je(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class o3 extends ao{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class w2 extends Wi{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new je(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gl,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class r3 extends w2{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new We(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Un(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new je(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new je(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new je(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class s3 extends Wi{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new je(16777215),this.specular=new je(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gl,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Td,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class a3 extends Wi{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new je(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gl,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class l3 extends Wi{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gl,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class S2 extends Wi{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new je(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new je(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gl,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Td,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class g3 extends Wi{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new je(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gl,this.normalScale=new We(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class c3 extends co{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function ir(t,e,n){return R2(t)?new t.constructor(t.subarray(e,n!==void 0?n:t.length)):t.slice(e,n)}function Ig(t,e,n){return!t||!n&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function R2(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function I3(t){function e(o,r){return t[o]-t[r]}const n=t.length,i=new Array(n);for(let o=0;o!==n;++o)i[o]=o;return i.sort(e),i}function jG(t,e,n){const i=t.length,o=new t.constructor(i);for(let r=0,s=0;s!==i;++r){const a=n[r]*e;for(let l=0;l!==e;++l)o[s++]=t[a+l]}return o}function W2(t,e,n,i){let o=1,r=t[0];for(;r!==void 0&&r[i]===void 0;)r=t[o++];if(r===void 0)return;let s=r[i];if(s!==void 0)if(Array.isArray(s))do s=r[i],s!==void 0&&(e.push(r.time),n.push.apply(n,s)),r=t[o++];while(r!==void 0);else if(s.toArray!==void 0)do s=r[i],s!==void 0&&(e.push(r.time),s.toArray(n,n.length)),r=t[o++];while(r!==void 0);else do s=r[i],s!==void 0&&(e.push(r.time),n.push(s)),r=t[o++];while(r!==void 0)}function GO(t,e,n,i,o=30){const r=t.clone();r.name=e;const s=[];for(let l=0;l<r.tracks.length;++l){const g=r.tracks[l],c=g.getValueSize(),C=[],d=[];for(let h=0;h<g.times.length;++h){const p=g.times[h]*o;if(!(p<n||p>=i)){C.push(g.times[h]);for(let v=0;v<c;++v)d.push(g.values[h*c+v])}}C.length!==0&&(g.times=Ig(C,g.times.constructor),g.values=Ig(d,g.values.constructor),s.push(g))}r.tracks=s;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r}function BO(t,e=0,n=t,i=30){i<=0&&(i=30);const o=n.tracks.length,r=e/i;for(let s=0;s<o;++s){const a=n.tracks[s],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const g=t.tracks.find(function(A){return A.name===a.name&&A.ValueTypeName===l});if(g===void 0)continue;let c=0;const C=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=C/3);let d=0;const h=g.getValueSize();g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=h/3);const p=a.times.length-1;let v;if(r<=a.times[0]){const A=c,b=C-c;v=ir(a.values,A,b)}else if(r>=a.times[p]){const A=p*C+c,b=A+C-c;v=ir(a.values,A,b)}else{const A=a.createInterpolant(),b=c,m=C-c;A.evaluate(r),v=ir(A.resultBuffer,b,m)}l==="quaternion"&&new yi().fromArray(v).normalize().conjugate().toArray(v);const f=g.times.length;for(let A=0;A<f;++A){const b=A*h+d;if(l==="quaternion")yi.multiplyQuaternionsFlat(g.values,b,v,0,g.values,b);else{const m=h-d*2;for(let B=0;B<m;++B)g.values[b+B]-=v[B]}}}return t.blendMode=i2,t}const ZO={arraySlice:ir,convertArray:Ig,isTypedArray:R2,getKeyframeOrder:I3,sortedArray:jG,flattenJSON:W2,subclip:GO,makeClipAdditive:BO};class qd{constructor(e,n,i,o){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=o!==void 0?o:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const n=this.parameterPositions;let i=this._cachedIndex,o=n[i],r=n[i-1];e:{t:{let s;n:{i:if(!(e<o)){for(let a=i+2;;){if(o===void 0){if(e<r)break i;return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=o,o=n[++i],e<o)break t}s=n.length;break n}if(!(e>=r)){const a=n[1];e<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(o=r,r=n[--i-1],e>=r)break t}s=i,i=0;break n}break e}for(;i<s;){const a=i+s>>>1;e<n[a]?s=a:i=a+1}if(o=n[i],r=n[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(o===void 0)return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,o)}return this.interpolate_(i,r,e,o)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const n=this.resultBuffer,i=this.sampleValues,o=this.valueSize,r=e*o;for(let s=0;s!==o;++s)n[s]=i[r+s];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class u3 extends qd{constructor(e,n,i,o){super(e,n,i,o),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ag,endingEnd:ag}}intervalChanged_(e,n,i){const o=this.parameterPositions;let r=e-2,s=e+1,a=o[r],l=o[s];if(a===void 0)switch(this.getSettings_().endingStart){case lg:r=e,a=2*n-i;break;case ld:r=o.length-2,a=n+o[r]-o[r+1];break;default:r=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case lg:s=e,l=2*i-n;break;case ld:s=1,l=i+o[1]-o[0];break;default:s=e-1,l=n}const g=(i-n)*.5,c=this.valueSize;this._weightPrev=g/(n-a),this._weightNext=g/(l-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(e,n,i,o){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=e*a,g=l-a,c=this._offsetPrev,C=this._offsetNext,d=this._weightPrev,h=this._weightNext,p=(i-n)/(o-n),v=p*p,f=v*p,A=-d*f+2*d*v-d*p,b=(1+d)*f+(-1.5-2*d)*v+(-.5+d)*p+1,m=(-1-h)*f+(1.5+h)*v+.5*p,B=h*f-h*v;for(let Z=0;Z!==a;++Z)r[Z]=A*s[c+Z]+b*s[g+Z]+m*s[l+Z]+B*s[C+Z];return r}}class x2 extends qd{constructor(e,n,i,o){super(e,n,i,o)}interpolate_(e,n,i,o){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=e*a,g=l-a,c=(i-n)/(o-n),C=1-c;for(let d=0;d!==a;++d)r[d]=s[g+d]*C+s[l+d]*c;return r}}class C3 extends qd{constructor(e,n,i,o){super(e,n,i,o)}interpolate_(e){return this.copySampleValue_(e-1)}}class Or{constructor(e,n,i,o){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ig(n,this.TimeBufferType),this.values=Ig(i,this.ValueBufferType),this.setInterpolation(o||this.DefaultInterpolation)}static toJSON(e){const n=e.constructor;let i;if(n.toJSON!==this.toJSON)i=n.toJSON(e);else{i={name:e.name,times:Ig(e.times,Array),values:Ig(e.values,Array)};const o=e.getInterpolation();o!==e.DefaultInterpolation&&(i.interpolation=o)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new C3(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new x2(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new u3(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let n;switch(e){case sd:n=this.InterpolantFactoryMethodDiscrete;break;case ad:n=this.InterpolantFactoryMethodLinear;break;case Pp:n=this.InterpolantFactoryMethodSmooth;break}if(n===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return sd;case this.InterpolantFactoryMethodLinear:return ad;case this.InterpolantFactoryMethodSmooth:return Pp}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const n=this.times;for(let i=0,o=n.length;i!==o;++i)n[i]+=e}return this}scale(e){if(e!==1){const n=this.times;for(let i=0,o=n.length;i!==o;++i)n[i]*=e}return this}trim(e,n){const i=this.times,o=i.length;let r=0,s=o-1;for(;r!==o&&i[r]<e;)++r;for(;s!==-1&&i[s]>n;)--s;if(++s,r!==0||s!==o){r>=s&&(s=Math.max(s,1),r=s-1);const a=this.getValueSize();this.times=ir(i,r,s),this.values=ir(this.values,r*a,s*a)}return this}validate(){let e=!0;const n=this.getValueSize();n-Math.floor(n)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,o=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(s!==null&&s>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,s),e=!1;break}s=l}if(o!==void 0&&R2(o))for(let a=0,l=o.length;a!==l;++a){const g=o[a];if(isNaN(g)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,g),e=!1;break}}return e}optimize(){const e=ir(this.times),n=ir(this.values),i=this.getValueSize(),o=this.getInterpolation()===Pp,r=e.length-1;let s=1;for(let a=1;a<r;++a){let l=!1;const g=e[a],c=e[a+1];if(g!==c&&(a!==1||g!==e[0]))if(o)l=!0;else{const C=a*i,d=C-i,h=C+i;for(let p=0;p!==i;++p){const v=n[C+p];if(v!==n[d+p]||v!==n[h+p]){l=!0;break}}}if(l){if(a!==s){e[s]=e[a];const C=a*i,d=s*i;for(let h=0;h!==i;++h)n[d+h]=n[C+h]}++s}}if(r>0){e[s]=e[r];for(let a=r*i,l=s*i,g=0;g!==i;++g)n[l+g]=n[a+g];++s}return s!==e.length?(this.times=ir(e,0,s),this.values=ir(n,0,s*i)):(this.times=e,this.values=n),this}clone(){const e=ir(this.times,0),n=ir(this.values,0),i=this.constructor,o=new i(this.name,e,n);return o.createInterpolant=this.createInterpolant,o}}Or.prototype.TimeBufferType=Float32Array;Or.prototype.ValueBufferType=Float32Array;Or.prototype.DefaultInterpolation=ad;class Tg extends Or{}Tg.prototype.ValueTypeName="bool";Tg.prototype.ValueBufferType=Array;Tg.prototype.DefaultInterpolation=sd;Tg.prototype.InterpolantFactoryMethodLinear=void 0;Tg.prototype.InterpolantFactoryMethodSmooth=void 0;class V2 extends Or{}V2.prototype.ValueTypeName="color";class pd extends Or{}pd.prototype.ValueTypeName="number";class d3 extends qd{constructor(e,n,i,o){super(e,n,i,o)}interpolate_(e,n,i,o){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=(i-n)/(o-n);let g=e*a;for(let c=g+a;g!==c;g+=4)yi.slerpFlat(r,0,s,g-a,s,g,l);return r}}class OI extends Or{InterpolantFactoryMethodLinear(e){return new d3(this.times,this.values,this.getValueSize(),e)}}OI.prototype.ValueTypeName="quaternion";OI.prototype.DefaultInterpolation=ad;OI.prototype.InterpolantFactoryMethodSmooth=void 0;class _g extends Or{}_g.prototype.ValueTypeName="string";_g.prototype.ValueBufferType=Array;_g.prototype.DefaultInterpolation=sd;_g.prototype.InterpolantFactoryMethodLinear=void 0;_g.prototype.InterpolantFactoryMethodSmooth=void 0;class fd extends Or{}fd.prototype.ValueTypeName="vector";class md{constructor(e,n=-1,i,o=Wm){this.name=e,this.tracks=i,this.duration=n,this.blendMode=o,this.uuid=ko(),this.duration<0&&this.resetDuration()}static parse(e){const n=[],i=e.tracks,o=1/(e.fps||1);for(let s=0,a=i.length;s!==a;++s)n.push(SO(i[s]).scale(o));const r=new this(e.name,e.duration,n,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const n=[],i=e.tracks,o={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=i.length;r!==s;++r)n.push(Or.toJSON(i[r]));return o}static CreateFromMorphTargetSequence(e,n,i,o){const r=n.length,s=[];for(let a=0;a<r;a++){let l=[],g=[];l.push((a+r-1)%r,a,(a+1)%r),g.push(0,1,0);const c=I3(l);l=jG(l,1,c),g=jG(g,1,c),!o&&l[0]===0&&(l.push(r),g.push(g[0])),s.push(new pd(".morphTargetInfluences["+n[a].name+"]",l,g).scale(1/i))}return new this(e,-1,s)}static findByName(e,n){let i=e;if(!Array.isArray(e)){const o=e;i=o.geometry&&o.geometry.animations||o.animations}for(let o=0;o<i.length;o++)if(i[o].name===n)return i[o];return null}static CreateClipsFromMorphTargetSequences(e,n,i){const o={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const g=e[a],c=g.name.match(r);if(c&&c.length>1){const C=c[1];let d=o[C];d||(o[C]=d=[]),d.push(g)}}const s=[];for(const a in o)s.push(this.CreateFromMorphTargetSequence(a,o[a],n,i));return s}static parseAnimation(e,n){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(C,d,h,p,v){if(h.length!==0){const f=[],A=[];W2(h,f,A,p),f.length!==0&&v.push(new C(d,f,A))}},o=[],r=e.name||"default",s=e.fps||30,a=e.blendMode;let l=e.length||-1;const g=e.hierarchy||[];for(let C=0;C<g.length;C++){const d=g[C].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const h={};let p;for(p=0;p<d.length;p++)if(d[p].morphTargets)for(let v=0;v<d[p].morphTargets.length;v++)h[d[p].morphTargets[v]]=-1;for(const v in h){const f=[],A=[];for(let b=0;b!==d[p].morphTargets.length;++b){const m=d[p];f.push(m.time),A.push(m.morphTarget===v?1:0)}o.push(new pd(".morphTargetInfluence["+v+"]",f,A))}l=h.length*s}else{const h=".bones["+n[C].name+"]";i(fd,h+".position",d,"pos",o),i(OI,h+".quaternion",d,"rot",o),i(fd,h+".scale",d,"scl",o)}}return o.length===0?null:new this(r,l,o,a)}resetDuration(){const e=this.tracks;let n=0;for(let i=0,o=e.length;i!==o;++i){const r=this.tracks[i];n=Math.max(n,r.times[r.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let n=0;n<this.tracks.length;n++)e=e&&this.tracks[n].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function wO(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return pd;case"vector":case"vector2":case"vector3":case"vector4":return fd;case"color":return V2;case"quaternion":return OI;case"bool":case"boolean":return Tg;case"string":return _g}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function SO(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=wO(t.type);if(t.times===void 0){const n=[],i=[];W2(t.keys,n,i,"value"),t.times=n,t.values=i}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Ng={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class X2{constructor(e,n,i){const o=this;let r=!1,s=0,a=0,l;const g=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=i,this.itemStart=function(c){a++,r===!1&&o.onStart!==void 0&&o.onStart(c,s,a),r=!0},this.itemEnd=function(c){s++,o.onProgress!==void 0&&o.onProgress(c,s,a),s===a&&(r=!1,o.onLoad!==void 0&&o.onLoad())},this.itemError=function(c){o.onError!==void 0&&o.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,C){return g.push(c,C),this},this.removeHandler=function(c){const C=g.indexOf(c);return C!==-1&&g.splice(C,2),this},this.getHandler=function(c){for(let C=0,d=g.length;C<d;C+=2){const h=g[C],p=g[C+1];if(h.global&&(h.lastIndex=0),h.test(c))return p}return null}}}const h3=new X2;class Io{constructor(e){this.manager=e!==void 0?e:h3,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const i=this;return new Promise(function(o,r){i.load(e,o,n,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Io.DEFAULT_MATERIAL_NAME="__DEFAULT";const Us={};class RO extends Error{constructor(e,n){super(e),this.response=n}}class Zs extends Io{constructor(e){super(e)}load(e,n,i,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Ng.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{n&&n(r),this.manager.itemEnd(e)},0),r;if(Us[e]!==void 0){Us[e].push({onLoad:n,onProgress:i,onError:o});return}Us[e]=[],Us[e].push({onLoad:n,onProgress:i,onError:o});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(s).then(g=>{if(g.status===200||g.status===0){if(g.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||g.body===void 0||g.body.getReader===void 0)return g;const c=Us[e],C=g.body.getReader(),d=g.headers.get("Content-Length")||g.headers.get("X-File-Size"),h=d?parseInt(d):0,p=h!==0;let v=0;const f=new ReadableStream({start(A){b();function b(){C.read().then(({done:m,value:B})=>{if(m)A.close();else{v+=B.byteLength;const Z=new ProgressEvent("progress",{lengthComputable:p,loaded:v,total:h});for(let w=0,W=c.length;w<W;w++){const X=c[w];X.onProgress&&X.onProgress(Z)}A.enqueue(B),b()}})}}});return new Response(f)}else throw new RO(`fetch for "${g.url}" responded with ${g.status}: ${g.statusText}`,g)}).then(g=>{switch(l){case"arraybuffer":return g.arrayBuffer();case"blob":return g.blob();case"document":return g.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return g.json();default:if(a===void 0)return g.text();{const C=/charset="?([^;"\s]*)"?/i.exec(a),d=C&&C[1]?C[1].toLowerCase():void 0,h=new TextDecoder(d);return g.arrayBuffer().then(p=>h.decode(p))}}}).then(g=>{Ng.add(e,g);const c=Us[e];delete Us[e];for(let C=0,d=c.length;C<d;C++){const h=c[C];h.onLoad&&h.onLoad(g)}}).catch(g=>{const c=Us[e];if(c===void 0)throw this.manager.itemError(e),g;delete Us[e];for(let C=0,d=c.length;C<d;C++){const h=c[C];h.onError&&h.onError(g)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class WO extends Io{constructor(e){super(e)}load(e,n,i,o){const r=this,s=new Zs(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(a){try{n(r.parse(JSON.parse(a)))}catch(l){o?o(l):console.error(l),r.manager.itemError(e)}},i,o)}parse(e){const n=[];for(let i=0;i<e.length;i++){const o=md.parse(e[i]);n.push(o)}return n}}class xO extends Io{constructor(e){super(e)}load(e,n,i,o){const r=this,s=[],a=new Km,l=new Zs(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let g=0;function c(C){l.load(e[C],function(d){const h=r.parse(d,!0);s[C]={width:h.width,height:h.height,format:h.format,mipmaps:h.mipmaps},g+=1,g===6&&(h.mipmapCount===1&&(a.minFilter=bn),a.image=s,a.format=h.format,a.needsUpdate=!0,n&&n(a))},i,o)}if(Array.isArray(e))for(let C=0,d=e.length;C<d;++C)c(C);else l.load(e,function(C){const d=r.parse(C,!0);if(d.isCubemap){const h=d.mipmaps.length/d.mipmapCount;for(let p=0;p<h;p++){s[p]={mipmaps:[]};for(let v=0;v<d.mipmapCount;v++)s[p].mipmaps.push(d.mipmaps[p*d.mipmapCount+v]),s[p].format=d.format,s[p].width=d.width,s[p].height=d.height}a.image=s}else a.image.width=d.width,a.image.height=d.height,a.mipmaps=d.mipmaps;d.mipmapCount===1&&(a.minFilter=bn),a.format=d.format,a.needsUpdate=!0,n&&n(a)},i,o);return a}}class bd extends Io{constructor(e){super(e)}load(e,n,i,o){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Ng.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){n&&n(s),r.manager.itemEnd(e)},0),s;const a=Id("img");function l(){c(),Ng.add(e,this),n&&n(this),r.manager.itemEnd(e)}function g(C){c(),o&&o(C),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){a.removeEventListener("load",l,!1),a.removeEventListener("error",g,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",g,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class A3 extends Io{constructor(e){super(e)}load(e,n,i,o){const r=new Ud;r.colorSpace=Kt;const s=new bd(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function l(g){s.load(e[g],function(c){r.images[g]=c,a++,a===6&&(r.needsUpdate=!0,n&&n(r))},void 0,o)}for(let g=0;g<e.length;++g)l(g);return r}}class N2 extends Io{constructor(e){super(e)}load(e,n,i,o){const r=this,s=new uI,a=new Zs(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,function(l){let g;try{g=r.parse(l)}catch(c){if(o!==void 0)o(c);else{console.error(c);return}}if(!g)return o();g.image!==void 0?s.image=g.image:g.data!==void 0&&(s.image.width=g.width,s.image.height=g.height,s.image.data=g.data),s.wrapS=g.wrapS!==void 0?g.wrapS:ki,s.wrapT=g.wrapT!==void 0?g.wrapT:ki,s.magFilter=g.magFilter!==void 0?g.magFilter:bn,s.minFilter=g.minFilter!==void 0?g.minFilter:bn,s.anisotropy=g.anisotropy!==void 0?g.anisotropy:1,g.colorSpace!==void 0?s.colorSpace=g.colorSpace:g.encoding!==void 0&&(s.encoding=g.encoding),g.flipY!==void 0&&(s.flipY=g.flipY),g.format!==void 0&&(s.format=g.format),g.type!==void 0&&(s.type=g.type),g.mipmaps!==void 0&&(s.mipmaps=g.mipmaps,s.minFilter=dl),g.mipmapCount===1&&(s.minFilter=bn),g.generateMipmaps!==void 0&&(s.generateMipmaps=g.generateMipmaps),s.needsUpdate=!0,n&&n(s,g)},i,o),s}}class p3 extends Io{constructor(e){super(e)}load(e,n,i,o){const r=new Xn,s=new bd(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){r.image=a,r.needsUpdate=!0,n!==void 0&&n(r)},i,o),r}}class Sl extends Ot{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new je(e),this.intensity=n}dispose(){}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),n}}class f3 extends Sl{constructor(e,n,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ot.DEFAULT_UP),this.updateMatrix(),this.groundColor=new je(n)}copy(e,n){return super.copy(e,n),this.groundColor.copy(e.groundColor),this}}const xy=new Wt,_W=new E,UW=new E;class Y2{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new We(512,512),this.map=null,this.mapPass=null,this.matrix=new Wt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Xm,this._frameExtents=new We(1,1),this._viewportCount=1,this._viewports=[new cn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,i=this.matrix;_W.setFromMatrixPosition(e.matrixWorld),n.position.copy(_W),UW.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(UW),n.updateMatrixWorld(),xy.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(xy),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(xy)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class VO extends Y2{constructor(){super(new qn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const n=this.camera,i=SI*2*e.angle*this.focus,o=this.mapSize.width/this.mapSize.height,r=e.distance||n.far;(i!==n.fov||o!==n.aspect||r!==n.far)&&(n.fov=i,n.aspect=o,n.far=r,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class m3 extends Sl{constructor(e,n,i=0,o=Math.PI/3,r=0,s=2){super(e,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ot.DEFAULT_UP),this.updateMatrix(),this.target=new Ot,this.distance=i,this.angle=o,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new VO}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const PW=new Wt,Tu=new E,Vy=new E;class XO extends Y2{constructor(){super(new qn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new We(4,2),this._viewportCount=6,this._viewports=[new cn(2,1,1,1),new cn(0,1,1,1),new cn(3,1,1,1),new cn(1,1,1,1),new cn(3,0,1,1),new cn(1,0,1,1)],this._cubeDirections=[new E(1,0,0),new E(-1,0,0),new E(0,0,1),new E(0,0,-1),new E(0,1,0),new E(0,-1,0)],this._cubeUps=[new E(0,1,0),new E(0,1,0),new E(0,1,0),new E(0,1,0),new E(0,0,1),new E(0,0,-1)]}updateMatrices(e,n=0){const i=this.camera,o=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Tu.setFromMatrixPosition(e.matrixWorld),i.position.copy(Tu),Vy.copy(i.position),Vy.add(this._cubeDirections[n]),i.up.copy(this._cubeUps[n]),i.lookAt(Vy),i.updateMatrixWorld(),o.makeTranslation(-Tu.x,-Tu.y,-Tu.z),PW.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(PW)}}class b3 extends Sl{constructor(e,n,i=0,o=2){super(e,n),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=o,this.shadow=new XO}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class NO extends Y2{constructor(){super(new gl(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class y3 extends Sl{constructor(e,n){super(e,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ot.DEFAULT_UP),this.updateMatrix(),this.target=new Ot,this.shadow=new NO}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class v3 extends Sl{constructor(e,n){super(e,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class G3 extends Sl{constructor(e,n,i=10,o=10){super(e,n),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=o}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const n=super.toJSON(e);return n.object.width=this.width,n.object.height=this.height,n}}class B3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new E)}set(e){for(let n=0;n<9;n++)this.coefficients[n].copy(e[n]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,n){const i=e.x,o=e.y,r=e.z,s=this.coefficients;return n.copy(s[0]).multiplyScalar(.282095),n.addScaledVector(s[1],.488603*o),n.addScaledVector(s[2],.488603*r),n.addScaledVector(s[3],.488603*i),n.addScaledVector(s[4],1.092548*(i*o)),n.addScaledVector(s[5],1.092548*(o*r)),n.addScaledVector(s[6],.315392*(3*r*r-1)),n.addScaledVector(s[7],1.092548*(i*r)),n.addScaledVector(s[8],.546274*(i*i-o*o)),n}getIrradianceAt(e,n){const i=e.x,o=e.y,r=e.z,s=this.coefficients;return n.copy(s[0]).multiplyScalar(.886227),n.addScaledVector(s[1],2*.511664*o),n.addScaledVector(s[2],2*.511664*r),n.addScaledVector(s[3],2*.511664*i),n.addScaledVector(s[4],2*.429043*i*o),n.addScaledVector(s[5],2*.429043*o*r),n.addScaledVector(s[6],.743125*r*r-.247708),n.addScaledVector(s[7],2*.429043*i*r),n.addScaledVector(s[8],.429043*(i*i-o*o)),n}add(e){for(let n=0;n<9;n++)this.coefficients[n].add(e.coefficients[n]);return this}addScaledSH(e,n){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],n);return this}scale(e){for(let n=0;n<9;n++)this.coefficients[n].multiplyScalar(e);return this}lerp(e,n){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],n);return this}equals(e){for(let n=0;n<9;n++)if(!this.coefficients[n].equals(e.coefficients[n]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,n=0){const i=this.coefficients;for(let o=0;o<9;o++)i[o].fromArray(e,n+o*3);return this}toArray(e=[],n=0){const i=this.coefficients;for(let o=0;o<9;o++)i[o].toArray(e,n+o*3);return e}static getBasisAt(e,n){const i=e.x,o=e.y,r=e.z;n[0]=.282095,n[1]=.488603*o,n[2]=.488603*r,n[3]=.488603*i,n[4]=1.092548*i*o,n[5]=1.092548*o*r,n[6]=.315392*(3*r*r-1),n[7]=1.092548*i*r,n[8]=.546274*(i*i-o*o)}}class qm extends Sl{constructor(e=new B3,n=1){super(void 0,n),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const n=super.toJSON(e);return n.object.sh=this.sh.toArray(),n}}class $m extends Io{constructor(e){super(e),this.textures={}}load(e,n,i,o){const r=this,s=new Zs(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(a){try{n(r.parse(JSON.parse(a)))}catch(l){o?o(l):console.error(l),r.manager.itemError(e)}},i,o)}parse(e){const n=this.textures;function i(r){return n[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),n[r]}const o=$m.createMaterialFromType(e.type);if(e.uuid!==void 0&&(o.uuid=e.uuid),e.name!==void 0&&(o.name=e.name),e.color!==void 0&&o.color!==void 0&&o.color.setHex(e.color),e.roughness!==void 0&&(o.roughness=e.roughness),e.metalness!==void 0&&(o.metalness=e.metalness),e.sheen!==void 0&&(o.sheen=e.sheen),e.sheenColor!==void 0&&(o.sheenColor=new je().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(o.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&o.emissive!==void 0&&o.emissive.setHex(e.emissive),e.specular!==void 0&&o.specular!==void 0&&o.specular.setHex(e.specular),e.specularIntensity!==void 0&&(o.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&o.specularColor!==void 0&&o.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(o.shininess=e.shininess),e.clearcoat!==void 0&&(o.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(o.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(o.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(o.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(o.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(o.transmission=e.transmission),e.thickness!==void 0&&(o.thickness=e.thickness),e.attenuationDistance!==void 0&&(o.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&o.attenuationColor!==void 0&&o.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(o.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(o.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(o.fog=e.fog),e.flatShading!==void 0&&(o.flatShading=e.flatShading),e.blending!==void 0&&(o.blending=e.blending),e.combine!==void 0&&(o.combine=e.combine),e.side!==void 0&&(o.side=e.side),e.shadowSide!==void 0&&(o.shadowSide=e.shadowSide),e.opacity!==void 0&&(o.opacity=e.opacity),e.transparent!==void 0&&(o.transparent=e.transparent),e.alphaTest!==void 0&&(o.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(o.alphaHash=e.alphaHash),e.depthTest!==void 0&&(o.depthTest=e.depthTest),e.depthWrite!==void 0&&(o.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(o.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(o.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(o.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(o.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(o.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(o.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(o.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(o.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(o.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(o.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(o.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(o.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(o.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(o.rotation=e.rotation),e.linewidth!==1&&(o.linewidth=e.linewidth),e.dashSize!==void 0&&(o.dashSize=e.dashSize),e.gapSize!==void 0&&(o.gapSize=e.gapSize),e.scale!==void 0&&(o.scale=e.scale),e.polygonOffset!==void 0&&(o.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(o.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(o.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(o.dithering=e.dithering),e.alphaToCoverage!==void 0&&(o.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(o.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(o.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(o.visible=e.visible),e.toneMapped!==void 0&&(o.toneMapped=e.toneMapped),e.userData!==void 0&&(o.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?o.vertexColors=e.vertexColors>0:o.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const s=e.uniforms[r];switch(o.uniforms[r]={},s.type){case"t":o.uniforms[r].value=i(s.value);break;case"c":o.uniforms[r].value=new je().setHex(s.value);break;case"v2":o.uniforms[r].value=new We().fromArray(s.value);break;case"v3":o.uniforms[r].value=new E().fromArray(s.value);break;case"v4":o.uniforms[r].value=new cn().fromArray(s.value);break;case"m3":o.uniforms[r].value=new Tt().fromArray(s.value);break;case"m4":o.uniforms[r].value=new Wt().fromArray(s.value);break;default:o.uniforms[r].value=s.value}}if(e.defines!==void 0&&(o.defines=e.defines),e.vertexShader!==void 0&&(o.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(o.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(o.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)o.extensions[r]=e.extensions[r];if(e.lights!==void 0&&(o.lights=e.lights),e.clipping!==void 0&&(o.clipping=e.clipping),e.size!==void 0&&(o.size=e.size),e.sizeAttenuation!==void 0&&(o.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(o.map=i(e.map)),e.matcap!==void 0&&(o.matcap=i(e.matcap)),e.alphaMap!==void 0&&(o.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(o.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(o.bumpScale=e.bumpScale),e.normalMap!==void 0&&(o.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(o.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),o.normalScale=new We().fromArray(r)}return e.displacementMap!==void 0&&(o.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(o.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(o.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(o.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(o.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(o.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(o.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(o.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(o.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(o.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(o.envMap=i(e.envMap)),e.envMapIntensity!==void 0&&(o.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(o.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(o.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(o.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(o.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(o.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(o.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(o.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(o.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(o.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(o.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(o.clearcoatNormalScale=new We().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(o.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(o.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(o.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(o.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(o.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(o.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(o.sheenRoughnessMap=i(e.sheenRoughnessMap)),o}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const n={ShadowMaterial:i3,SpriteMaterial:p2,RawShaderMaterial:o3,ShaderMaterial:ao,PointsMaterial:m2,MeshPhysicalMaterial:r3,MeshStandardMaterial:w2,MeshPhongMaterial:s3,MeshToonMaterial:a3,MeshNormalMaterial:l3,MeshLambertMaterial:S2,MeshDepthMaterial:C2,MeshDistanceMaterial:d2,MeshBasicMaterial:Bl,MeshMatcapMaterial:g3,LineDashedMaterial:c3,LineBasicMaterial:co,Material:Wi};return new n[e]}}class qG{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let n="";for(let i=0,o=e.length;i<o;i++)n+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(n))}catch{return n}}static extractUrlBase(e){const n=e.lastIndexOf("/");return n===-1?"./":e.slice(0,n+1)}static resolveURL(e,n){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}}class Z3 extends _t{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class w3 extends Io{constructor(e){super(e)}load(e,n,i,o){const r=this,s=new Zs(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(a){try{n(r.parse(JSON.parse(a)))}catch(l){o?o(l):console.error(l),r.manager.itemError(e)}},i,o)}parse(e){const n={},i={};function o(h,p){if(n[p]!==void 0)return n[p];const f=h.interleavedBuffers[p],A=r(h,f.buffer),b=qc(f.type,A),m=new Hm(b,f.stride);return m.uuid=f.uuid,n[p]=m,m}function r(h,p){if(i[p]!==void 0)return i[p];const f=h.arrayBuffers[p],A=new Uint32Array(f).buffer;return i[p]=A,A}const s=e.isInstancedBufferGeometry?new Z3:new _t,a=e.data.index;if(a!==void 0){const h=qc(a.type,a.array);s.setIndex(new un(h,1))}const l=e.data.attributes;for(const h in l){const p=l[h];let v;if(p.isInterleavedBufferAttribute){const f=o(e.data,p.data);v=new Vg(f,p.itemSize,p.offset,p.normalized)}else{const f=qc(p.type,p.array),A=p.isInstancedBufferAttribute?WI:un;v=new A(f,p.itemSize,p.normalized)}p.name!==void 0&&(v.name=p.name),p.usage!==void 0&&v.setUsage(p.usage),p.updateRange!==void 0&&(v.updateRange.offset=p.updateRange.offset,v.updateRange.count=p.updateRange.count),s.setAttribute(h,v)}const g=e.data.morphAttributes;if(g)for(const h in g){const p=g[h],v=[];for(let f=0,A=p.length;f<A;f++){const b=p[f];let m;if(b.isInterleavedBufferAttribute){const B=o(e.data,b.data);m=new Vg(B,b.itemSize,b.offset,b.normalized)}else{const B=qc(b.type,b.array);m=new un(B,b.itemSize,b.normalized)}b.name!==void 0&&(m.name=b.name),v.push(m)}s.morphAttributes[h]=v}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);const C=e.data.groups||e.data.drawcalls||e.data.offsets;if(C!==void 0)for(let h=0,p=C.length;h!==p;++h){const v=C[h];s.addGroup(v.start,v.count,v.materialIndex)}const d=e.data.boundingSphere;if(d!==void 0){const h=new E;d.center!==void 0&&h.fromArray(d.center),s.boundingSphere=new Dr(h,d.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}}class YO extends Io{constructor(e){super(e)}load(e,n,i,o){const r=this,s=this.path===""?qG.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const a=new Zs(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let g=null;try{g=JSON.parse(l)}catch(C){o!==void 0&&o(C),console.error("THREE:ObjectLoader: Can't parse "+e+".",C.message);return}const c=g.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry"){o!==void 0&&o(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(g,n)},i,o)}async loadAsync(e,n){const i=this,o=this.path===""?qG.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const r=new Zs(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const s=await r.loadAsync(e,n),a=JSON.parse(s),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,n){const i=this.parseAnimations(e.animations),o=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,o),s=this.parseImages(e.images,function(){n!==void 0&&n(g)}),a=this.parseTextures(e.textures,s),l=this.parseMaterials(e.materials,a),g=this.parseObject(e.object,r,l,a,i),c=this.parseSkeletons(e.skeletons,g);if(this.bindSkeletons(g,c),n!==void 0){let C=!1;for(const d in s)if(s[d].data instanceof HTMLImageElement){C=!0;break}C===!1&&n(g)}return g}async parseAsync(e){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,i),r=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,o,a,s,n),g=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,g),l}parseShapes(e){const n={};if(e!==void 0)for(let i=0,o=e.length;i<o;i++){const r=new bg().fromJSON(e[i]);n[r.uuid]=r}return n}parseSkeletons(e,n){const i={},o={};if(n.traverse(function(r){r.isBone&&(o[r.uuid]=r)}),e!==void 0)for(let r=0,s=e.length;r<s;r++){const a=new Fm().fromJSON(e[r],o);i[a.uuid]=a}return i}parseGeometries(e,n){const i={};if(e!==void 0){const o=new w3;for(let r=0,s=e.length;r<s;r++){let a;const l=e[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=o.parse(l);break;default:l.type in TW?a=TW[l.type].fromJSON(l,n):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),i[l.uuid]=a}}return i}parseMaterials(e,n){const i={},o={};if(e!==void 0){const r=new $m;r.setTextures(n);for(let s=0,a=e.length;s<a;s++){const l=e[s];i[l.uuid]===void 0&&(i[l.uuid]=r.parse(l)),o[l.uuid]=i[l.uuid]}}return o}parseAnimations(e){const n={};if(e!==void 0)for(let i=0;i<e.length;i++){const o=e[i],r=md.parse(o);n[r.uuid]=r}return n}parseImages(e,n){const i=this,o={};let r;function s(l){return i.manager.itemStart(l),r.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const g=l,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(g)?g:i.resourcePath+g;return s(c)}else return l.data?{data:qc(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new X2(n);r=new bd(l),r.setCrossOrigin(this.crossOrigin);for(let g=0,c=e.length;g<c;g++){const C=e[g],d=C.url;if(Array.isArray(d)){const h=[];for(let p=0,v=d.length;p<v;p++){const f=d[p],A=a(f);A!==null&&(A instanceof HTMLImageElement?h.push(A):h.push(new uI(A.data,A.width,A.height)))}o[C.uuid]=new gg(h)}else{const h=a(C.url);o[C.uuid]=new gg(h)}}}return o}async parseImagesAsync(e){const n=this,i={};let o;async function r(s){if(typeof s=="string"){const a=s,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:n.resourcePath+a;return await o.loadAsync(l)}else return s.data?{data:qc(s.type,s.data),width:s.width,height:s.height}:null}if(e!==void 0&&e.length>0){o=new bd(this.manager),o.setCrossOrigin(this.crossOrigin);for(let s=0,a=e.length;s<a;s++){const l=e[s],g=l.url;if(Array.isArray(g)){const c=[];for(let C=0,d=g.length;C<d;C++){const h=g[C],p=await r(h);p!==null&&(p instanceof HTMLImageElement?c.push(p):c.push(new uI(p.data,p.width,p.height)))}i[l.uuid]=new gg(c)}else{const c=await r(l.url);i[l.uuid]=new gg(c)}}}return i}parseTextures(e,n){function i(r,s){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),s[r])}const o={};if(e!==void 0)for(let r=0,s=e.length;r<s;r++){const a=e[r];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),n[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=n[a.image],g=l.data;let c;Array.isArray(g)?(c=new Ud,g.length===6&&(c.needsUpdate=!0)):(g&&g.data?c=new uI:c=new Xn,g&&(c.needsUpdate=!0)),c.source=l,c.uuid=a.uuid,a.name!==void 0&&(c.name=a.name),a.mapping!==void 0&&(c.mapping=i(a.mapping,MO)),a.channel!==void 0&&(c.channel=a.channel),a.offset!==void 0&&c.offset.fromArray(a.offset),a.repeat!==void 0&&c.repeat.fromArray(a.repeat),a.center!==void 0&&c.center.fromArray(a.center),a.rotation!==void 0&&(c.rotation=a.rotation),a.wrap!==void 0&&(c.wrapS=i(a.wrap[0],DW),c.wrapT=i(a.wrap[1],DW)),a.format!==void 0&&(c.format=a.format),a.internalFormat!==void 0&&(c.internalFormat=a.internalFormat),a.type!==void 0&&(c.type=a.type),a.colorSpace!==void 0&&(c.colorSpace=a.colorSpace),a.encoding!==void 0&&(c.encoding=a.encoding),a.minFilter!==void 0&&(c.minFilter=i(a.minFilter,JW)),a.magFilter!==void 0&&(c.magFilter=i(a.magFilter,JW)),a.anisotropy!==void 0&&(c.anisotropy=a.anisotropy),a.flipY!==void 0&&(c.flipY=a.flipY),a.generateMipmaps!==void 0&&(c.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(c.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(c.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(c.compareFunction=a.compareFunction),a.userData!==void 0&&(c.userData=a.userData),o[a.uuid]=c}return o}parseObject(e,n,i,o,r){let s;function a(d){return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),n[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const h=[];for(let p=0,v=d.length;p<v;p++){const f=d[p];i[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",f),h.push(i[f])}return h}return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),i[d]}}function g(d){return o[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),o[d]}let c,C;switch(e.type){case"Scene":s=new ud,e.background!==void 0&&(Number.isInteger(e.background)?s.background=new je(e.background):s.background=g(e.background)),e.environment!==void 0&&(s.environment=g(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?s.fog=new Mm(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(s.fog=new Ym(e.fog.color,e.fog.density))),e.backgroundBlurriness!==void 0&&(s.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(s.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":s=new qn(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(s.focus=e.focus),e.zoom!==void 0&&(s.zoom=e.zoom),e.filmGauge!==void 0&&(s.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(s.filmOffset=e.filmOffset),e.view!==void 0&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new gl(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(s.zoom=e.zoom),e.view!==void 0&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new v3(e.color,e.intensity);break;case"DirectionalLight":s=new y3(e.color,e.intensity);break;case"PointLight":s=new b3(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new G3(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new m3(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new f3(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=new qm().fromJSON(e);break;case"SkinnedMesh":c=a(e.geometry),C=l(e.material),s=new _M(c,C),e.bindMode!==void 0&&(s.bindMode=e.bindMode),e.bindMatrix!==void 0&&s.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(s.skeleton=e.skeleton);break;case"Mesh":c=a(e.geometry),C=l(e.material),s=new ci(c,C);break;case"InstancedMesh":c=a(e.geometry),C=l(e.material);const d=e.count,h=e.instanceMatrix,p=e.instanceColor;s=new CI(c,C,d),s.instanceMatrix=new WI(new Float32Array(h.array),16),p!==void 0&&(s.instanceColor=new WI(new Float32Array(p.array),p.itemSize));break;case"LOD":s=new TM;break;case"Line":s=new hl(a(e.geometry),l(e.material));break;case"LineLoop":s=new UM(a(e.geometry),l(e.material));break;case"LineSegments":s=new xs(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":s=new PM(a(e.geometry),l(e.material));break;case"Sprite":s=new kM(l(e.material));break;case"Group":s=new eI;break;case"Bone":s=new f2;break;default:s=new Ot}if(s.uuid=e.uuid,e.name!==void 0&&(s.name=e.name),e.matrix!==void 0?(s.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(e.position!==void 0&&s.position.fromArray(e.position),e.rotation!==void 0&&s.rotation.fromArray(e.rotation),e.quaternion!==void 0&&s.quaternion.fromArray(e.quaternion),e.scale!==void 0&&s.scale.fromArray(e.scale)),e.up!==void 0&&s.up.fromArray(e.up),e.castShadow!==void 0&&(s.castShadow=e.castShadow),e.receiveShadow!==void 0&&(s.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(s.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(s.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(s.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&s.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(s.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(s.visible=e.visible),e.frustumCulled!==void 0&&(s.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(s.renderOrder=e.renderOrder),e.userData!==void 0&&(s.userData=e.userData),e.layers!==void 0&&(s.layers.mask=e.layers),e.children!==void 0){const d=e.children;for(let h=0;h<d.length;h++)s.add(this.parseObject(d[h],n,i,o,r))}if(e.animations!==void 0){const d=e.animations;for(let h=0;h<d.length;h++){const p=d[h];s.animations.push(r[p])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(s.autoUpdate=e.autoUpdate);const d=e.levels;for(let h=0;h<d.length;h++){const p=d[h],v=s.getObjectByProperty("uuid",p.object);v!==void 0&&s.addLevel(v,p.distance,p.hysteresis)}}return s}bindSkeletons(e,n){Object.keys(n).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const o=n[i.skeleton];o===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(o,i.bindMatrix)}})}}const MO={UVMapping:Sm,CubeReflectionMapping:Bs,CubeRefractionMapping:Cl,EquirectangularReflectionMapping:wI,EquirectangularRefractionMapping:id,CubeUVReflectionMapping:UI},DW={RepeatWrapping:od,ClampToEdgeWrapping:ki,MirroredRepeatWrapping:rd},JW={NearestFilter:Qn,NearestMipmapNearestFilter:Nf,NearestMipmapLinearFilter:ZC,LinearFilter:bn,LinearMipmapNearestFilter:OZ,LinearMipmapLinearFilter:dl};class HO extends Io{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,n,i,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Ng.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){n&&n(s),r.manager.itemEnd(e)},0),s;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){Ng.add(e,l),n&&n(l),r.manager.itemEnd(e)}).catch(function(l){o&&o(l),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}let ip;class M2{static getContext(){return ip===void 0&&(ip=new(window.AudioContext||window.webkitAudioContext)),ip}static setContext(e){ip=e}}class FO extends Io{constructor(e){super(e)}load(e,n,i,o){const r=this,s=new Zs(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(l){try{const g=l.slice(0);M2.getContext().decodeAudioData(g,function(C){n(C)},a)}catch(g){a(g)}},i,o);function a(l){o?o(l):console.error(l),r.manager.itemError(e)}}}class KO extends qm{constructor(e,n,i=1){super(void 0,i),this.isHemisphereLightProbe=!0;const o=new je().set(e),r=new je().set(n),s=new E(o.r,o.g,o.b),a=new E(r.r,r.g,r.b),l=Math.sqrt(Math.PI),g=l*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(g)}}class zO extends qm{constructor(e,n=1){super(void 0,n),this.isAmbientLightProbe=!0;const i=new je().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const OW=new Wt,QW=new Wt,kl=new Wt;class LO{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new qn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new qn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const n=this._cache;if(n.focus!==e.focus||n.fov!==e.fov||n.aspect!==e.aspect*this.aspect||n.near!==e.near||n.far!==e.far||n.zoom!==e.zoom||n.eyeSep!==this.eyeSep){n.focus=e.focus,n.fov=e.fov,n.aspect=e.aspect*this.aspect,n.near=e.near,n.far=e.far,n.zoom=e.zoom,n.eyeSep=this.eyeSep,kl.copy(e.projectionMatrix);const o=n.eyeSep/2,r=o*n.near/n.focus,s=n.near*Math.tan(fg*n.fov*.5)/n.zoom;let a,l;QW.elements[12]=-o,OW.elements[12]=o,a=-s*n.aspect+r,l=s*n.aspect+r,kl.elements[0]=2*n.near/(l-a),kl.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(kl),a=-s*n.aspect-r,l=s*n.aspect-r,kl.elements[0]=2*n.near/(l-a),kl.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(kl)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(QW),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(OW)}}class H2{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=jW(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=jW();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}}function jW(){return(typeof performance>"u"?Date:performance).now()}const Tl=new E,qW=new yi,EO=new E,_l=new E;class kO extends Ot{constructor(){super(),this.type="AudioListener",this.context=M2.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new H2}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const n=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Tl,qW,EO),_l.set(0,0,-1).applyQuaternion(qW),n.positionX){const o=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(Tl.x,o),n.positionY.linearRampToValueAtTime(Tl.y,o),n.positionZ.linearRampToValueAtTime(Tl.z,o),n.forwardX.linearRampToValueAtTime(_l.x,o),n.forwardY.linearRampToValueAtTime(_l.y,o),n.forwardZ.linearRampToValueAtTime(_l.z,o),n.upX.linearRampToValueAtTime(i.x,o),n.upY.linearRampToValueAtTime(i.y,o),n.upZ.linearRampToValueAtTime(i.z,o)}else n.setPosition(Tl.x,Tl.y,Tl.z),n.setOrientation(_l.x,_l.y,_l.z,i.x,i.y,i.z)}}class S3 extends Ot{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const n=this.context.createBufferSource();return n.buffer=this.buffer,n.loop=this.loop,n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.onended=this.onEnded.bind(this),n.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=n,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Ul=new E,$W=new yi,TO=new E,Pl=new E;class _O extends S3{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,n,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=n,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Ul,$W,TO),Pl.set(0,0,1).applyQuaternion($W);const n=this.panner;if(n.positionX){const i=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(Ul.x,i),n.positionY.linearRampToValueAtTime(Ul.y,i),n.positionZ.linearRampToValueAtTime(Ul.z,i),n.orientationX.linearRampToValueAtTime(Pl.x,i),n.orientationY.linearRampToValueAtTime(Pl.y,i),n.orientationZ.linearRampToValueAtTime(Pl.z,i)}else n.setPosition(Ul.x,Ul.y,Ul.z),n.setOrientation(Pl.x,Pl.y,Pl.z)}}class UO{constructor(e,n=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const n=this.getFrequencyData();for(let i=0;i<n.length;i++)e+=n[i];return e/n.length}}class R3{constructor(e,n,i){this.binding=e,this.valueSize=i;let o,r,s;switch(n){case"quaternion":o=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":o=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:o=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=o,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,n){const i=this.buffer,o=this.valueSize,r=e*o+o;let s=this.cumulativeWeight;if(s===0){for(let a=0;a!==o;++a)i[r+a]=i[a];s=n}else{s+=n;const a=n/s;this._mixBufferRegion(i,r,0,a,o)}this.cumulativeWeight=s}accumulateAdditive(e){const n=this.buffer,i=this.valueSize,o=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(n,o,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const n=this.valueSize,i=this.buffer,o=e*n+n,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const l=n*this._origIndex;this._mixBufferRegion(i,o,l,1-r,n)}s>0&&this._mixBufferRegionAdditive(i,o,this._addIndex*n,1,n);for(let l=n,g=n+n;l!==g;++l)if(i[l]!==i[l+n]){a.setValue(i,o);break}}saveOriginalState(){const e=this.binding,n=this.buffer,i=this.valueSize,o=i*this._origIndex;e.getValue(n,o);for(let r=i,s=o;r!==s;++r)n[r]=n[o+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,n=e+this.valueSize;for(let i=e;i<n;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[n+i]=this.buffer[e+i]}_select(e,n,i,o,r){if(o>=.5)for(let s=0;s!==r;++s)e[n+s]=e[i+s]}_slerp(e,n,i,o){yi.slerpFlat(e,n,e,n,e,i,o)}_slerpAdditive(e,n,i,o,r){const s=this._workIndex*r;yi.multiplyQuaternionsFlat(e,s,e,n,e,i),yi.slerpFlat(e,n,e,n,e,s,o)}_lerp(e,n,i,o,r){const s=1-o;for(let a=0;a!==r;++a){const l=n+a;e[l]=e[l]*s+e[i+a]*o}}_lerpAdditive(e,n,i,o,r){for(let s=0;s!==r;++s){const a=n+s;e[a]=e[a]+e[i+s]*o}}}const F2="\\[\\]\\.:\\/",PO=new RegExp("["+F2+"]","g"),K2="[^"+F2+"]",DO="[^"+F2.replace("\\.","")+"]",JO=/((?:WC+[\/:])*)/.source.replace("WC",K2),OO=/(WCOD+)?/.source.replace("WCOD",DO),QO=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",K2),jO=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",K2),qO=new RegExp("^"+JO+OO+QO+jO+"$"),$O=["material","materials","bones","map"];class eQ{constructor(e,n,i){const o=i||Qt.parseTrackName(n);this._targetGroup=e,this._bindings=e.subscribe_(n,o)}getValue(e,n){this.bind();const i=this._targetGroup.nCachedObjects_,o=this._bindings[i];o!==void 0&&o.getValue(e,n)}setValue(e,n){const i=this._bindings;for(let o=this._targetGroup.nCachedObjects_,r=i.length;o!==r;++o)i[o].setValue(e,n)}bind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=e.length;n!==i;++n)e[n].bind()}unbind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=e.length;n!==i;++n)e[n].unbind()}}class Qt{constructor(e,n,i){this.path=n,this.parsedPath=i||Qt.parseTrackName(n),this.node=Qt.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,i){return e&&e.isAnimationObjectGroup?new Qt.Composite(e,n,i):new Qt(e,n,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(PO,"")}static parseTrackName(e){const n=qO.exec(e);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},o=i.nodeName&&i.nodeName.lastIndexOf(".");if(o!==void 0&&o!==-1){const r=i.nodeName.substring(o+1);$O.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,o),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,n){if(n===void 0||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(n);if(i!==void 0)return i}if(e.children){const i=function(r){for(let s=0;s<r.length;s++){const a=r[s];if(a.name===n||a.uuid===n)return a;const l=i(a.children);if(l)return l}return null},o=i(e.children);if(o)return o}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){const i=this.resolvedProperty;for(let o=0,r=i.length;o!==r;++o)e[n++]=i[o]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){const i=this.resolvedProperty;for(let o=0,r=i.length;o!==r;++o)i[o]=e[n++]}_setValue_array_setNeedsUpdate(e,n){const i=this.resolvedProperty;for(let o=0,r=i.length;o!==r;++o)i[o]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){const i=this.resolvedProperty;for(let o=0,r=i.length;o!==r;++o)i[o]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node;const n=this.parsedPath,i=n.objectName,o=n.propertyName;let r=n.propertyIndex;if(e||(e=Qt.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let g=n.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===g){g=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(g!==void 0){if(e[g]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[g]}}const s=e[o];if(s===void 0){const g=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+g+"."+o+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(o==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else s.fromArray!==void 0&&s.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=o;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Qt.Composite=eQ;Qt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Qt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Qt.prototype.GetterByBindingType=[Qt.prototype._getValue_direct,Qt.prototype._getValue_array,Qt.prototype._getValue_arrayElement,Qt.prototype._getValue_toArray];Qt.prototype.SetterByBindingTypeAndVersioning=[[Qt.prototype._setValue_direct,Qt.prototype._setValue_direct_setNeedsUpdate,Qt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Qt.prototype._setValue_array,Qt.prototype._setValue_array_setNeedsUpdate,Qt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Qt.prototype._setValue_arrayElement,Qt.prototype._setValue_arrayElement_setNeedsUpdate,Qt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Qt.prototype._setValue_fromArray,Qt.prototype._setValue_fromArray_setNeedsUpdate,Qt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class tQ{constructor(){this.isAnimationObjectGroup=!0,this.uuid=ko(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,o=arguments.length;i!==o;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}add(){const e=this._objects,n=this._indicesByUUID,i=this._paths,o=this._parsedPaths,r=this._bindings,s=r.length;let a,l=e.length,g=this.nCachedObjects_;for(let c=0,C=arguments.length;c!==C;++c){const d=arguments[c],h=d.uuid;let p=n[h];if(p===void 0){p=l++,n[h]=p,e.push(d);for(let v=0,f=s;v!==f;++v)r[v].push(new Qt(d,i[v],o[v]))}else if(p<g){a=e[p];const v=--g,f=e[v];n[f.uuid]=p,e[p]=f,n[h]=v,e[v]=d;for(let A=0,b=s;A!==b;++A){const m=r[A],B=m[v];let Z=m[p];m[p]=B,Z===void 0&&(Z=new Qt(d,i[A],o[A])),m[v]=Z}}else e[p]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=g}remove(){const e=this._objects,n=this._indicesByUUID,i=this._bindings,o=i.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const l=arguments[s],g=l.uuid,c=n[g];if(c!==void 0&&c>=r){const C=r++,d=e[C];n[d.uuid]=c,e[c]=d,n[g]=C,e[C]=l;for(let h=0,p=o;h!==p;++h){const v=i[h],f=v[C],A=v[c];v[c]=f,v[C]=A}}}this.nCachedObjects_=r}uncache(){const e=this._objects,n=this._indicesByUUID,i=this._bindings,o=i.length;let r=this.nCachedObjects_,s=e.length;for(let a=0,l=arguments.length;a!==l;++a){const g=arguments[a],c=g.uuid,C=n[c];if(C!==void 0)if(delete n[c],C<r){const d=--r,h=e[d],p=--s,v=e[p];n[h.uuid]=C,e[C]=h,n[v.uuid]=d,e[d]=v,e.pop();for(let f=0,A=o;f!==A;++f){const b=i[f],m=b[d],B=b[p];b[C]=m,b[d]=B,b.pop()}}else{const d=--s,h=e[d];d>0&&(n[h.uuid]=C),e[C]=h,e.pop();for(let p=0,v=o;p!==v;++p){const f=i[p];f[C]=f[d],f.pop()}}}this.nCachedObjects_=r}subscribe_(e,n){const i=this._bindingsIndicesByPath;let o=i[e];const r=this._bindings;if(o!==void 0)return r[o];const s=this._paths,a=this._parsedPaths,l=this._objects,g=l.length,c=this.nCachedObjects_,C=new Array(g);o=r.length,i[e]=o,s.push(e),a.push(n),r.push(C);for(let d=c,h=l.length;d!==h;++d){const p=l[d];C[d]=new Qt(p,e,n)}return C}unsubscribe_(e){const n=this._bindingsIndicesByPath,i=n[e];if(i!==void 0){const o=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,l=s[a],g=e[a];n[g]=i,s[i]=l,s.pop(),r[i]=r[a],r.pop(),o[i]=o[a],o.pop()}}}class W3{constructor(e,n,i=null,o=n.blendMode){this._mixer=e,this._clip=n,this._localRoot=i,this.blendMode=o;const r=n.tracks,s=r.length,a=new Array(s),l={endingStart:ag,endingEnd:ag};for(let g=0;g!==s;++g){const c=r[g].createInterpolant(null);a[g]=c,c.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=IM,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,n){return this.loop=e,this.repetitions=n,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,n,i){if(e.fadeOut(n),this.fadeIn(n),i){const o=this._clip.duration,r=e._clip.duration,s=r/o,a=o/r;e.warp(1,s,n),this.warp(a,1,n)}return this}crossFadeTo(e,n,i){return e.crossFadeFrom(this,n,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,n,i){const o=this._mixer,r=o.time,s=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=o._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,g=a.sampleValues;return l[0]=r,l[1]=r+i,g[0]=e/s,g[1]=n/s,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,n,i,o){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const l=(e-r)*i;l<0||i===0?n=0:(this._startTime=null,n=i*l)}n*=this._updateTimeScale(e);const s=this._updateTime(n),a=this._updateWeight(e);if(a>0){const l=this._interpolants,g=this._propertyBindings;switch(this.blendMode){case i2:for(let c=0,C=l.length;c!==C;++c)l[c].evaluate(s),g[c].accumulateAdditive(a);break;case Wm:default:for(let c=0,C=l.length;c!==C;++c)l[c].evaluate(s),g[c].accumulate(o,a)}}}_updateWeight(e){let n=0;if(this.enabled){n=this.weight;const i=this._weightInterpolant;if(i!==null){const o=i.evaluate(e)[0];n*=o,e>i.parameterPositions[1]&&(this.stopFading(),o===0&&(this.enabled=!1))}}return this._effectiveWeight=n,n}_updateTimeScale(e){let n=0;if(!this.paused){n=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const o=i.evaluate(e)[0];n*=o,e>i.parameterPositions[1]&&(this.stopWarping(),n===0?this.paused=!0:this.timeScale=n)}}return this._effectiveTimeScale=n,n}_updateTime(e){const n=this._clip.duration,i=this.loop;let o=this.time+e,r=this._loopCount;const s=i===uM;if(e===0)return r===-1?o:s&&(r&1)===1?n-o:o;if(i===cM){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(o>=n)o=n;else if(o<0)o=0;else{this.time=o;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),o>=n||o<0){const a=Math.floor(o/n);o-=n*a,r+=Math.abs(a);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,o=e>0?n:0,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const g=e<0;this._setEndings(g,!g,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=o,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=o;if(s&&(r&1)===1)return n-o}return o}_setEndings(e,n,i){const o=this._interpolantSettings;i?(o.endingStart=lg,o.endingEnd=lg):(e?o.endingStart=this.zeroSlopeAtStart?lg:ag:o.endingStart=ld,n?o.endingEnd=this.zeroSlopeAtEnd?lg:ag:o.endingEnd=ld)}_scheduleFading(e,n,i){const o=this._mixer,r=o.time;let s=this._weightInterpolant;s===null&&(s=o._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,l=s.sampleValues;return a[0]=r,l[0]=n,a[1]=r+e,l[1]=i,this}}const nQ=new Float32Array(1);class iQ extends Rs{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,n){const i=e._localRoot||this._root,o=e._clip.tracks,r=o.length,s=e._propertyBindings,a=e._interpolants,l=i.uuid,g=this._bindingsByRootAndName;let c=g[l];c===void 0&&(c={},g[l]=c);for(let C=0;C!==r;++C){const d=o[C],h=d.name;let p=c[h];if(p!==void 0)++p.referenceCount,s[C]=p;else{if(p=s[C],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,h));continue}const v=n&&n._propertyBindings[C].binding.parsedPath;p=new R3(Qt.create(i,h,v),d.ValueTypeName,d.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,h),s[C]=p}a[C].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,o=e._clip.uuid,r=this._actionsByClip[o];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,o,i)}const n=e._propertyBindings;for(let i=0,o=n.length;i!==o;++i){const r=n[i];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const n=e._propertyBindings;for(let i=0,o=n.length;i!==o;++i){const r=n[i];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const n=e._cacheIndex;return n!==null&&n<this._nActiveActions}_addInactiveAction(e,n,i){const o=this._actions,r=this._actionsByClip;let s=r[n];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[n]=s;else{const a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=o.length,o.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){const n=this._actions,i=n[n.length-1],o=e._cacheIndex;i._cacheIndex=o,n[o]=i,n.pop(),e._cacheIndex=null;const r=e._clip.uuid,s=this._actionsByClip,a=s[r],l=a.knownActions,g=l[l.length-1],c=e._byClipCacheIndex;g._byClipCacheIndex=c,l[c]=g,l.pop(),e._byClipCacheIndex=null;const C=a.actionByRoot,d=(e._localRoot||this._root).uuid;delete C[d],l.length===0&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const n=e._propertyBindings;for(let i=0,o=n.length;i!==o;++i){const r=n[i];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const n=this._actions,i=e._cacheIndex,o=this._nActiveActions++,r=n[o];e._cacheIndex=o,n[o]=e,r._cacheIndex=i,n[i]=r}_takeBackAction(e){const n=this._actions,i=e._cacheIndex,o=--this._nActiveActions,r=n[o];e._cacheIndex=o,n[o]=e,r._cacheIndex=i,n[i]=r}_addInactiveBinding(e,n,i){const o=this._bindingsByRootAndName,r=this._bindings;let s=o[n];s===void 0&&(s={},o[n]=s),s[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const n=this._bindings,i=e.binding,o=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,a=s[o],l=n[n.length-1],g=e._cacheIndex;l._cacheIndex=g,n[g]=l,n.pop(),delete a[r],Object.keys(a).length===0&&delete s[o]}_lendBinding(e){const n=this._bindings,i=e._cacheIndex,o=this._nActiveBindings++,r=n[o];e._cacheIndex=o,n[o]=e,r._cacheIndex=i,n[i]=r}_takeBackBinding(e){const n=this._bindings,i=e._cacheIndex,o=--this._nActiveBindings,r=n[o];e._cacheIndex=o,n[o]=e,r._cacheIndex=i,n[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,n=this._nActiveControlInterpolants++;let i=e[n];return i===void 0&&(i=new x2(new Float32Array(2),new Float32Array(2),1,nQ),i.__cacheIndex=n,e[n]=i),i}_takeBackControlInterpolant(e){const n=this._controlInterpolants,i=e.__cacheIndex,o=--this._nActiveControlInterpolants,r=n[o];e.__cacheIndex=o,n[o]=e,r.__cacheIndex=i,n[i]=r}clipAction(e,n,i){const o=n||this._root,r=o.uuid;let s=typeof e=="string"?md.findByName(o,e):e;const a=s!==null?s.uuid:e,l=this._actionsByClip[a];let g=null;if(i===void 0&&(s!==null?i=s.blendMode:i=Wm),l!==void 0){const C=l.actionByRoot[r];if(C!==void 0&&C.blendMode===i)return C;g=l.knownActions[0],s===null&&(s=g._clip)}if(s===null)return null;const c=new W3(this,s,n,i);return this._bindAction(c,g),this._addInactiveAction(c,a,r),c}existingAction(e,n){const i=n||this._root,o=i.uuid,r=typeof e=="string"?md.findByName(i,e):e,s=r?r.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[o]||null}stopAllAction(){const e=this._actions,n=this._nActiveActions;for(let i=n-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const n=this._actions,i=this._nActiveActions,o=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let g=0;g!==i;++g)n[g]._update(o,e,r,s);const a=this._bindings,l=this._nActiveBindings;for(let g=0;g!==l;++g)a[g].apply(s);return this}setTime(e){this.time=0;for(let n=0;n<this._actions.length;n++)this._actions[n].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const n=this._actions,i=e.uuid,o=this._actionsByClip,r=o[i];if(r!==void 0){const s=r.knownActions;for(let a=0,l=s.length;a!==l;++a){const g=s[a];this._deactivateAction(g);const c=g._cacheIndex,C=n[n.length-1];g._cacheIndex=null,g._byClipCacheIndex=null,C._cacheIndex=c,n[c]=C,n.pop(),this._removeInactiveBindingsForAction(g)}delete o[i]}}uncacheRoot(e){const n=e.uuid,i=this._actionsByClip;for(const s in i){const a=i[s].actionByRoot,l=a[n];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const o=this._bindingsByRootAndName,r=o[n];if(r!==void 0)for(const s in r){const a=r[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,n){const i=this.existingAction(e,n);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class z2{constructor(e){this.value=e}clone(){return new z2(this.value.clone===void 0?this.value:this.value.clone())}}let oQ=0;class rQ extends Rs{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:oQ++}),this.name="",this.usage=gd,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const n=this.uniforms.indexOf(e);return n!==-1&&this.uniforms.splice(n,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const n=e.uniforms;this.uniforms.length=0;for(let i=0,o=n.length;i<o;i++)this.uniforms.push(n[i].clone());return this}clone(){return new this.constructor().copy(this)}}class sQ extends Hm{constructor(e,n,i=1){super(e,n),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const n=super.clone(e);return n.meshPerAttribute=this.meshPerAttribute,n}toJSON(e){const n=super.toJSON(e);return n.isInstancedInterleavedBuffer=!0,n.meshPerAttribute=this.meshPerAttribute,n}}class aQ{constructor(e,n,i,o,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=n,this.itemSize=i,this.elementSize=o,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,n){return this.type=e,this.elementSize=n,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class L2{constructor(e,n,i=0,o=1/0){this.ray=new PI(e,n),this.near=i,this.far=o,this.camera=null,this.layers=new mg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)}intersectObject(e,n=!0,i=[]){return $G(e,this,i,n),i.sort(ex),i}intersectObjects(e,n=!0,i=[]){for(let o=0,r=e.length;o<r;o++)$G(e[o],this,i,n);return i.sort(ex),i}}function ex(t,e){return t.distance-e.distance}function $G(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),i===!0){const o=t.children;for(let r=0,s=o.length;r<s;r++)$G(o[r],e,n,!0)}}class eB{constructor(e=1,n=0,i=0){return this.radius=e,this.phi=n,this.theta=i,this}set(e,n,i){return this.radius=e,this.phi=n,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,i){return this.radius=Math.sqrt(e*e+n*n+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Un(n/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class lQ{constructor(e=1,n=0,i=0){return this.radius=e,this.theta=n,this.y=i,this}set(e,n,i){return this.radius=e,this.theta=n,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=n,this}clone(){return new this.constructor().copy(this)}}const tx=new We;class gQ{constructor(e=new We(1/0,1/0),n=new We(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromPoints(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const i=tx.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,tx).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const nx=new E,op=new E;class cQ{constructor(e=new E,n=new E){this.start=e,this.end=n}set(e,n){return this.start.copy(e),this.end.copy(n),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,n){return this.delta(n).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,n){nx.subVectors(e,this.start),op.subVectors(this.end,this.start);const i=op.dot(op);let r=op.dot(nx)/i;return n&&(r=Un(r,0,1)),r}closestPointToPoint(e,n,i){const o=this.closestPointToPointParameter(e,n);return this.delta(i).multiplyScalar(o).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const ix=new E;class IQ extends Ot{constructor(e,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="SpotLightHelper";const i=new _t,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,l=32;s<l;s++,a++){const g=s/l*Math.PI*2,c=a/l*Math.PI*2;o.push(Math.cos(g),Math.sin(g),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new Ct(o,3));const r=new co({fog:!1,toneMapped:!1});this.cone=new xs(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,n=e*Math.tan(this.light.angle);this.cone.scale.set(n,n,e),ix.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ix),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Ma=new E,rp=new Wt,Xy=new Wt;class uQ extends xs{constructor(e){const n=x3(e),i=new _t,o=[],r=[],s=new je(0,0,1),a=new je(0,1,0);for(let g=0;g<n.length;g++){const c=n[g];c.parent&&c.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new Ct(o,3)),i.setAttribute("color",new Ct(r,3));const l=new co({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=n,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const n=this.bones,i=this.geometry,o=i.getAttribute("position");Xy.copy(this.root.matrixWorld).invert();for(let r=0,s=0;r<n.length;r++){const a=n[r];a.parent&&a.parent.isBone&&(rp.multiplyMatrices(Xy,a.matrixWorld),Ma.setFromMatrixPosition(rp),o.setXYZ(s,Ma.x,Ma.y,Ma.z),rp.multiplyMatrices(Xy,a.parent.matrixWorld),Ma.setFromMatrixPosition(rp),o.setXYZ(s+1,Ma.x,Ma.y,Ma.z),s+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function x3(t){const e=[];t.isBone===!0&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,x3(t.children[n]));return e}class CQ extends ci{constructor(e,n,i){const o=new jd(n,4,2),r=new Bl({wireframe:!0,fog:!1,toneMapped:!1});super(o,r),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const dQ=new E,ox=new je,rx=new je;class hQ extends Ot{constructor(e,n,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const o=new Qd(n);o.rotateY(Math.PI*.5),this.material=new Bl({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=o.getAttribute("position"),s=new Float32Array(r.count*3);o.setAttribute("color",new un(s,3)),this.add(new ci(o,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const n=e.geometry.getAttribute("color");ox.copy(this.light.color),rx.copy(this.light.groundColor);for(let i=0,o=n.count;i<o;i++){const r=i<o/2?ox:rx;n.setXYZ(i,r.r,r.g,r.b)}n.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(dQ.setFromMatrixPosition(this.light.matrixWorld).negate())}}class AQ extends xs{constructor(e=10,n=10,i=4473924,o=8947848){i=new je(i),o=new je(o);const r=n/2,s=e/n,a=e/2,l=[],g=[];for(let d=0,h=0,p=-a;d<=n;d++,p+=s){l.push(-a,0,p,a,0,p),l.push(p,0,-a,p,0,a);const v=d===r?i:o;v.toArray(g,h),h+=3,v.toArray(g,h),h+=3,v.toArray(g,h),h+=3,v.toArray(g,h),h+=3}const c=new _t;c.setAttribute("position",new Ct(l,3)),c.setAttribute("color",new Ct(g,3));const C=new co({vertexColors:!0,toneMapped:!1});super(c,C),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class pQ extends xs{constructor(e=10,n=16,i=8,o=64,r=4473924,s=8947848){r=new je(r),s=new je(s);const a=[],l=[];if(n>1)for(let C=0;C<n;C++){const d=C/n*(Math.PI*2),h=Math.sin(d)*e,p=Math.cos(d)*e;a.push(0,0,0),a.push(h,0,p);const v=C&1?r:s;l.push(v.r,v.g,v.b),l.push(v.r,v.g,v.b)}for(let C=0;C<i;C++){const d=C&1?r:s,h=e-e/i*C;for(let p=0;p<o;p++){let v=p/o*(Math.PI*2),f=Math.sin(v)*h,A=Math.cos(v)*h;a.push(f,0,A),l.push(d.r,d.g,d.b),v=(p+1)/o*(Math.PI*2),f=Math.sin(v)*h,A=Math.cos(v)*h,a.push(f,0,A),l.push(d.r,d.g,d.b)}}const g=new _t;g.setAttribute("position",new Ct(a,3)),g.setAttribute("color",new Ct(l,3));const c=new co({vertexColors:!0,toneMapped:!1});super(g,c),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const sx=new E,sp=new E,ax=new E;class fQ extends Ot{constructor(e,n,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",n===void 0&&(n=1);let o=new _t;o.setAttribute("position",new Ct([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));const r=new co({fog:!1,toneMapped:!1});this.lightPlane=new hl(o,r),this.add(this.lightPlane),o=new _t,o.setAttribute("position",new Ct([0,0,0,0,0,1],3)),this.targetLine=new hl(o,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),sx.setFromMatrixPosition(this.light.matrixWorld),sp.setFromMatrixPosition(this.light.target.matrixWorld),ax.subVectors(sp,sx),this.lightPlane.lookAt(sp),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(sp),this.targetLine.scale.z=ax.length()}}const ap=new E,Tn=new _d;class mQ extends xs{constructor(e){const n=new _t,i=new co({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],r=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(p,v){l(p),l(v)}function l(p){o.push(0,0,0),r.push(0,0,0),s[p]===void 0&&(s[p]=[]),s[p].push(o.length/3-1)}n.setAttribute("position",new Ct(o,3)),n.setAttribute("color",new Ct(r,3)),super(n,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const g=new je(16755200),c=new je(16711680),C=new je(43775),d=new je(16777215),h=new je(3355443);this.setColors(g,c,C,d,h)}setColors(e,n,i,o,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,n.r,n.g,n.b),a.setXYZ(25,n.r,n.g,n.b),a.setXYZ(26,n.r,n.g,n.b),a.setXYZ(27,n.r,n.g,n.b),a.setXYZ(28,n.r,n.g,n.b),a.setXYZ(29,n.r,n.g,n.b),a.setXYZ(30,n.r,n.g,n.b),a.setXYZ(31,n.r,n.g,n.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,o.r,o.g,o.b),a.setXYZ(39,o.r,o.g,o.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,n=this.pointMap,i=1,o=1;Tn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),On("c",n,e,Tn,0,0,-1),On("t",n,e,Tn,0,0,1),On("n1",n,e,Tn,-i,-o,-1),On("n2",n,e,Tn,i,-o,-1),On("n3",n,e,Tn,-i,o,-1),On("n4",n,e,Tn,i,o,-1),On("f1",n,e,Tn,-i,-o,1),On("f2",n,e,Tn,i,-o,1),On("f3",n,e,Tn,-i,o,1),On("f4",n,e,Tn,i,o,1),On("u1",n,e,Tn,i*.7,o*1.1,-1),On("u2",n,e,Tn,-i*.7,o*1.1,-1),On("u3",n,e,Tn,0,o*2,-1),On("cf1",n,e,Tn,-i,0,1),On("cf2",n,e,Tn,i,0,1),On("cf3",n,e,Tn,0,-o,1),On("cf4",n,e,Tn,0,o,1),On("cn1",n,e,Tn,-i,0,-1),On("cn2",n,e,Tn,i,0,-1),On("cn3",n,e,Tn,0,-o,-1),On("cn4",n,e,Tn,0,o,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function On(t,e,n,i,o,r,s){ap.set(o,r,s).unproject(i);const a=e[t];if(a!==void 0){const l=n.getAttribute("position");for(let g=0,c=a.length;g<c;g++)l.setXYZ(a[g],ap.x,ap.y,ap.z)}}const lp=new Ws;class bQ extends xs{constructor(e,n=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(8*3),r=new _t;r.setIndex(new un(i,1)),r.setAttribute("position",new un(o,3)),super(r,new co({color:n,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&lp.setFromObject(this.object),lp.isEmpty())return;const n=lp.min,i=lp.max,o=this.geometry.attributes.position,r=o.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=n.x,r[4]=i.y,r[5]=i.z,r[6]=n.x,r[7]=n.y,r[8]=i.z,r[9]=i.x,r[10]=n.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=n.z,r[15]=n.x,r[16]=i.y,r[17]=n.z,r[18]=n.x,r[19]=n.y,r[20]=n.z,r[21]=i.x,r[22]=n.y,r[23]=n.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,n){return super.copy(e,n),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class yQ extends xs{constructor(e,n=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new _t;r.setIndex(new un(i,1)),r.setAttribute("position",new Ct(o,3)),super(r,new co({color:n,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const n=this.box;n.isEmpty()||(n.getCenter(this.position),n.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class vQ extends hl{constructor(e,n=1,i=16776960){const o=i,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],s=new _t;s.setAttribute("position",new Ct(r,3)),s.computeBoundingSphere(),super(s,new co({color:o,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=n;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new _t;l.setAttribute("position",new Ct(a,3)),l.computeBoundingSphere(),this.add(new ci(l,new Bl({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const lx=new E;let gp,Ny;class GQ extends Ot{constructor(e=new E(0,0,1),n=new E(0,0,0),i=1,o=16776960,r=i*.2,s=r*.2){super(),this.type="ArrowHelper",gp===void 0&&(gp=new _t,gp.setAttribute("position",new Ct([0,0,0,0,1,0],3)),Ny=new JI(0,.5,1,5,1),Ny.translate(0,-.5,0)),this.position.copy(n),this.line=new hl(gp,new co({color:o,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ci(Ny,new Bl({color:o,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{lx.set(e.z,0,-e.x).normalize();const n=Math.acos(e.y);this.quaternion.setFromAxisAngle(lx,n)}}setLength(e,n=e*.2,i=n*.2){this.line.scale.set(1,Math.max(1e-4,e-n),1),this.line.updateMatrix(),this.cone.scale.set(i,n,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class BQ extends xs{constructor(e=1){const n=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],o=new _t;o.setAttribute("position",new Ct(n,3)),o.setAttribute("color",new Ct(i,3));const r=new co({vertexColors:!0,toneMapped:!1});super(o,r),this.type="AxesHelper"}setColors(e,n,i){const o=new je,r=this.geometry.attributes.color.array;return o.set(e),o.toArray(r,0),o.toArray(r,3),o.set(n),o.toArray(r,6),o.toArray(r,9),o.set(i),o.toArray(r,12),o.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class V3{constructor(){this.type="ShapePath",this.color=new je,this.subPaths=[],this.currentPath=null}moveTo(e,n){return this.currentPath=new Cd,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,n),this}lineTo(e,n){return this.currentPath.lineTo(e,n),this}quadraticCurveTo(e,n,i,o){return this.currentPath.quadraticCurveTo(e,n,i,o),this}bezierCurveTo(e,n,i,o,r,s){return this.currentPath.bezierCurveTo(e,n,i,o,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function n(A){const b=[];for(let m=0,B=A.length;m<B;m++){const Z=A[m],w=new bg;w.curves=Z.curves,b.push(w)}return b}function i(A,b){const m=b.length;let B=!1;for(let Z=m-1,w=0;w<m;Z=w++){let W=b[Z],X=b[w],V=X.x-W.x,Y=X.y-W.y;if(Math.abs(Y)>Number.EPSILON){if(Y<0&&(W=b[w],V=-V,X=b[Z],Y=-Y),A.y<W.y||A.y>X.y)continue;if(A.y===W.y){if(A.x===W.x)return!0}else{const z=Y*(A.x-W.x)-V*(A.y-W.y);if(z===0)return!0;if(z<0)continue;B=!B}}else{if(A.y!==W.y)continue;if(X.x<=A.x&&A.x<=W.x||W.x<=A.x&&A.x<=X.x)return!0}}return B}const o=Gs.isClockWise,r=this.subPaths;if(r.length===0)return[];let s,a,l;const g=[];if(r.length===1)return a=r[0],l=new bg,l.curves=a.curves,g.push(l),g;let c=!o(r[0].getPoints());c=e?!c:c;const C=[],d=[];let h=[],p=0,v;d[p]=void 0,h[p]=[];for(let A=0,b=r.length;A<b;A++)a=r[A],v=a.getPoints(),s=o(v),s=e?!s:s,s?(!c&&d[p]&&p++,d[p]={s:new bg,p:v},d[p].s.curves=a.curves,c&&p++,h[p]=[]):h[p].push({h:a,p:v[0]});if(!d[0])return n(r);if(d.length>1){let A=!1,b=0;for(let m=0,B=d.length;m<B;m++)C[m]=[];for(let m=0,B=d.length;m<B;m++){const Z=h[m];for(let w=0;w<Z.length;w++){const W=Z[w];let X=!0;for(let V=0;V<d.length;V++)i(W.p,d[V].p)&&(m!==V&&b++,X?(X=!1,C[V].push(W)):A=!0);X&&C[m].push(W)}}b>0&&A===!1&&(h=C)}let f;for(let A=0,b=d.length;A<b;A++){l=d[A].s,g.push(l),f=h[A];for(let m=0,B=f.length;m<B;m++)l.holes.push(f[m].h)}return g}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Eg}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Eg);const X3=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:JZ,AddEquation:$l,AddOperation:j5,AdditiveAnimationBlendMode:i2,AdditiveBlending:AG,AlphaFormat:oM,AlwaysCompare:BM,AlwaysDepth:_5,AlwaysStencilFunc:AM,AmbientLight:v3,AmbientLightProbe:zO,AnimationAction:W3,AnimationClip:md,AnimationLoader:WO,AnimationMixer:iQ,AnimationObjectGroup:tQ,AnimationUtils:ZO,ArcCurve:DM,ArrayCamera:zM,ArrowHelper:GQ,Audio:S3,AudioAnalyser:UO,AudioContext:M2,AudioListener:kO,AudioLoader:FO,AxesHelper:BQ,BackSide:Si,BasicDepthPacking:CM,BasicShadowMap:x5,Bone:f2,BooleanKeyframeTrack:Tg,Box2:gQ,Box3:Ws,Box3Helper:yQ,BoxGeometry:Zl,BoxHelper:bQ,BufferAttribute:un,BufferGeometry:_t,BufferGeometryLoader:w3,ByteType:nM,Cache:Ng,Camera:_d,CameraHelper:mQ,CanvasTexture:OJ,CapsuleGeometry:Em,CatmullRomCurve3:JM,CineonToneMapping:eM,CircleGeometry:km,ClampToEdgeWrapping:ki,Clock:H2,Color:je,ColorKeyframeTrack:V2,ColorManagement:nr,CompressedArrayTexture:DJ,CompressedCubeTexture:JJ,CompressedTexture:Km,CompressedTextureLoader:xO,ConeGeometry:Tm,CubeCamera:XM,CubeReflectionMapping:Bs,CubeRefractionMapping:Cl,CubeTexture:Ud,CubeTextureLoader:A3,CubeUVReflectionMapping:UI,CubicBezierCurve:y2,CubicBezierCurve3:OM,CubicInterpolant:u3,CullFaceBack:hG,CullFaceFront:W5,CullFaceFrontBack:_k,CullFaceNone:R5,Curve:Jr,CurvePath:jM,CustomBlending:V5,CustomToneMapping:tM,CylinderGeometry:JI,Cylindrical:lQ,Data3DTexture:l2,DataArrayTexture:xm,DataTexture:uI,DataTextureLoader:N2,DataUtils:cg,DecrementStencilOp:nT,DecrementWrapStencilOp:oT,DefaultLoadingManager:h3,DepthFormat:sl,DepthStencilFormat:xg,DepthTexture:h2,DirectionalLight:y3,DirectionalLightHelper:fQ,DiscreteInterpolant:C3,DisplayP3ColorSpace:r2,DodecahedronGeometry:_m,DoubleSide:Fr,DstAlphaFactor:K5,DstColorFactor:L5,DynamicCopyUsage:fT,DynamicDrawUsage:ZM,DynamicReadUsage:hT,EdgesGeometry:qM,EllipseCurve:zm,EqualCompare:mM,EqualDepth:P5,EqualStencilFunc:lT,EquirectangularReflectionMapping:wI,EquirectangularRefractionMapping:id,Euler:kg,EventDispatcher:Rs,ExtrudeGeometry:Jd,FileLoader:Zs,Float16BufferAttribute:s_,Float32BufferAttribute:Ct,Float64BufferAttribute:a_,FloatType:Zi,Fog:Mm,FogExp2:Ym,FramebufferTexture:PJ,FrontSide:Ca,Frustum:Xm,GLBufferAttribute:aQ,GLSL1:bT,GLSL3:_G,GreaterCompare:yM,GreaterDepth:J5,GreaterEqualCompare:GM,GreaterEqualDepth:D5,GreaterEqualStencilFunc:uT,GreaterStencilFunc:cT,GridHelper:AQ,Group:eI,HalfFloatType:Ti,HemisphereLight:f3,HemisphereLightHelper:hQ,HemisphereLightProbe:KO,IcosahedronGeometry:Od,ImageBitmapLoader:HO,ImageLoader:bd,ImageUtils:a2,IncrementStencilOp:tT,IncrementWrapStencilOp:iT,InstancedBufferAttribute:WI,InstancedBufferGeometry:Z3,InstancedInterleavedBuffer:sQ,InstancedMesh:CI,Int16BufferAttribute:o_,Int32BufferAttribute:r_,Int8BufferAttribute:t_,IntType:QZ,InterleavedBuffer:Hm,InterleavedBufferAttribute:Vg,Interpolant:qd,InterpolateDiscrete:sd,InterpolateLinear:ad,InterpolateSmooth:Pp,InvertStencilOp:rT,KeepStencilOp:Dp,KeyframeTrack:Or,LOD:TM,LatheGeometry:Dd,Layers:mg,LessCompare:fM,LessDepth:U5,LessEqualCompare:bM,LessEqualDepth:Xf,LessEqualStencilFunc:gT,LessStencilFunc:aT,Light:Sl,LightProbe:qm,Line:hl,Line3:cQ,LineBasicMaterial:co,LineCurve:Lm,LineCurve3:QM,LineDashedMaterial:c3,LineLoop:UM,LineSegments:xs,LinearEncoding:o2,LinearFilter:bn,LinearInterpolant:x2,LinearMipMapLinearFilter:Ok,LinearMipMapNearestFilter:Jk,LinearMipmapLinearFilter:dl,LinearMipmapNearestFilter:OZ,LinearSRGBColorSpace:_r,LinearToneMapping:q5,Loader:Io,LoaderUtils:qG,LoadingManager:X2,LoopOnce:cM,LoopPingPong:uM,LoopRepeat:IM,LuminanceAlphaFormat:sM,LuminanceFormat:rM,MOUSE:Ol,Material:Wi,MaterialLoader:$m,MathUtils:SM,Matrix3:Tt,Matrix4:Wt,MaxEquation:bG,Mesh:ci,MeshBasicMaterial:Bl,MeshDepthMaterial:C2,MeshDistanceMaterial:d2,MeshLambertMaterial:S2,MeshMatcapMaterial:g3,MeshNormalMaterial:l3,MeshPhongMaterial:s3,MeshPhysicalMaterial:r3,MeshStandardMaterial:w2,MeshToonMaterial:a3,MinEquation:mG,MirroredRepeatWrapping:rd,MixOperation:Q5,MultiplyBlending:fG,MultiplyOperation:Td,NearestFilter:Qn,NearestMipMapLinearFilter:Dk,NearestMipMapNearestFilter:Pk,NearestMipmapLinearFilter:ZC,NearestMipmapNearestFilter:Nf,NeverCompare:pM,NeverDepth:T5,NeverStencilFunc:sT,NoBlending:aa,NoColorSpace:ll,NoToneMapping:ys,NormalAnimationBlendMode:Wm,NormalBlending:pg,NotEqualCompare:vM,NotEqualDepth:O5,NotEqualStencilFunc:IT,NumberKeyframeTrack:pd,Object3D:Ot,ObjectLoader:YO,ObjectSpaceNormalMap:hM,OctahedronGeometry:Qd,OneFactor:M5,OneMinusDstAlphaFactor:z5,OneMinusDstColorFactor:E5,OneMinusSrcAlphaFactor:DZ,OneMinusSrcColorFactor:F5,OrthographicCamera:gl,PCFShadowMap:wm,PCFSoftShadowMap:BC,PMREMGenerator:PG,Path:Cd,PerspectiveCamera:qn,Plane:js,PlaneGeometry:Pd,PlaneHelper:vQ,PointLight:b3,PointLightHelper:CQ,Points:PM,PointsMaterial:m2,PolarGridHelper:pQ,PolyhedronGeometry:wl,PositionalAudio:_O,PropertyBinding:Qt,PropertyMixer:R3,QuadraticBezierCurve:v2,QuadraticBezierCurve3:G2,Quaternion:yi,QuaternionKeyframeTrack:OI,QuaternionLinearInterpolant:d3,RED_GREEN_RGTC2_Format:kG,RED_RGTC1_Format:gM,REVISION:Eg,RGBADepthPacking:dM,RGBAFormat:oo,RGBAIntegerFormat:n2,RGBA_ASTC_10x10_Format:KG,RGBA_ASTC_10x5_Format:MG,RGBA_ASTC_10x6_Format:HG,RGBA_ASTC_10x8_Format:FG,RGBA_ASTC_12x10_Format:zG,RGBA_ASTC_12x12_Format:LG,RGBA_ASTC_4x4_Format:SG,RGBA_ASTC_5x4_Format:RG,RGBA_ASTC_5x5_Format:WG,RGBA_ASTC_6x5_Format:xG,RGBA_ASTC_6x6_Format:VG,RGBA_ASTC_8x5_Format:XG,RGBA_ASTC_8x6_Format:NG,RGBA_ASTC_8x8_Format:YG,RGBA_BPTC_Format:Up,RGBA_ETC2_EAC_Format:wG,RGBA_PVRTC_2BPPV1_Format:BG,RGBA_PVRTC_4BPPV1_Format:GG,RGBA_S3TC_DXT1_Format:kp,RGBA_S3TC_DXT3_Format:Tp,RGBA_S3TC_DXT5_Format:_p,RGB_ETC1_Format:lM,RGB_ETC2_Format:ZG,RGB_PVRTC_2BPPV1_Format:vG,RGB_PVRTC_4BPPV1_Format:yG,RGB_S3TC_DXT1_Format:Ep,RGFormat:aM,RGIntegerFormat:t2,RawShaderMaterial:o3,Ray:PI,Raycaster:L2,RectAreaLight:G3,RedFormat:$Z,RedIntegerFormat:e2,ReinhardToneMapping:$5,RenderTarget:WM,RepeatWrapping:od,ReplaceStencilOp:eT,ReverseSubtractEquation:N5,RingGeometry:Pm,SIGNED_RED_GREEN_RGTC2_Format:TG,SIGNED_RED_RGTC1_Format:EG,SRGBColorSpace:Kt,Scene:ud,ShaderChunk:Ft,ShaderLib:Mr,ShaderMaterial:ao,ShadowMaterial:i3,Shape:bg,ShapeGeometry:Dm,ShapePath:V3,ShapeUtils:Gs,ShortType:iM,Skeleton:Fm,SkeletonHelper:uQ,SkinnedMesh:_M,Source:gg,Sphere:Dr,SphereGeometry:jd,Spherical:eB,SphericalHarmonics3:B3,SplineCurve:B2,SpotLight:m3,SpotLightHelper:IQ,Sprite:kM,SpriteMaterial:p2,SrcAlphaFactor:PZ,SrcAlphaSaturateFactor:k5,SrcColorFactor:H5,StaticCopyUsage:pT,StaticDrawUsage:gd,StaticReadUsage:dT,StereoCamera:LO,StreamCopyUsage:mT,StreamDrawUsage:CT,StreamReadUsage:AT,StringKeyframeTrack:_g,SubtractEquation:X5,SubtractiveBlending:pG,TOUCH:Ql,TangentSpaceNormalMap:Gl,TetrahedronGeometry:Jm,Texture:Xn,TextureLoader:p3,TorusGeometry:Om,TorusKnotGeometry:Qm,Triangle:Go,TriangleFanDrawMode:qk,TriangleStripDrawMode:jk,TrianglesDrawMode:Qk,TubeGeometry:jm,TwoPassDoubleSide:Uk,UVMapping:Sm,Uint16BufferAttribute:g2,Uint32BufferAttribute:c2,Uint8BufferAttribute:n_,Uint8ClampedBufferAttribute:i_,Uniform:z2,UniformsGroup:rQ,UniformsLib:Oe,UniformsUtils:Vm,UnsignedByteType:vs,UnsignedInt248Type:rl,UnsignedIntType:ia,UnsignedShort4444Type:jZ,UnsignedShort5551Type:qZ,UnsignedShortType:Rm,VSMShadowMap:Xr,Vector2:We,Vector3:E,Vector4:cn,VectorKeyframeTrack:fd,VideoTexture:UJ,WebGL1Renderer:LM,WebGL3DRenderTarget:_T,WebGLArrayRenderTarget:TT,WebGLCoordinateSystem:fs,WebGLCubeRenderTarget:I2,WebGLMultipleRenderTargets:UT,WebGLRenderTarget:Ar,WebGLRenderer:A2,WebGLUtils:KM,WebGPUCoordinateSystem:cd,WireframeGeometry:n3,WrapAroundEnding:ld,ZeroCurvatureEnding:ag,ZeroFactor:Y5,ZeroSlopeEnding:lg,ZeroStencilOp:$k,_SRGBAFormat:Yf,sRGBEncoding:al},Symbol.toStringTag,{value:"Module"}));var N3={exports:{}},Ug={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Ug.ConcurrentRoot=1;Ug.ContinuousEventPriority=4;Ug.DefaultEventPriority=16;Ug.DiscreteEventPriority=1;Ug.IdleEventPriority=536870912;Ug.LegacyRoot=0;N3.exports=Ug;var nI=N3.exports;function ZQ(t){let e;const n=new Set,i=(g,c)=>{const C=typeof g=="function"?g(e):g;if(C!==e){const d=e;e=c?C:Object.assign({},e,C),n.forEach(h=>h(e,d))}},o=()=>e,r=(g,c=o,C=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=c(e);function h(){const p=c(e);if(!C(d,p)){const v=d;g(d=p,v)}}return n.add(h),()=>n.delete(h)},l={setState:i,getState:o,subscribe:(g,c,C)=>c||C?r(g,c,C):(n.add(g),()=>n.delete(g)),destroy:()=>n.clear()};return e=t(i,o,l),l}const wQ=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),gx=wQ?x.useEffect:x.useLayoutEffect;function E2(t){const e=typeof t=="function"?ZQ(t):t,n=(i=e.getState,o=Object.is)=>{const[,r]=x.useReducer(f=>f+1,0),s=e.getState(),a=x.useRef(s),l=x.useRef(i),g=x.useRef(o),c=x.useRef(!1),C=x.useRef();C.current===void 0&&(C.current=i(s));let d,h=!1;(a.current!==s||l.current!==i||g.current!==o||c.current)&&(d=i(s),h=!o(C.current,d)),gx(()=>{h&&(C.current=d),a.current=s,l.current=i,g.current=o,c.current=!1});const p=x.useRef(s);gx(()=>{const f=()=>{try{const b=e.getState(),m=l.current(b);g.current(C.current,m)||(a.current=b,C.current=m,r())}catch{c.current=!0,r()}},A=e.subscribe(f);return e.getState()!==p.current&&f(),A},[]);const v=h?d:C.current;return x.useDebugValue(v),v};return Object.assign(n,e),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const i=[n,e];return{next(){const o=i.length<=0;return{value:i.shift(),done:o}}}},n}var Y3={exports:{}},Yy={exports:{}},My={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cx;function SQ(){return cx||(cx=1,function(t){function e(H,D){var T=H.length;H.push(D);e:for(;0<T;){var J=T-1>>>1,$=H[J];if(0<o($,D))H[J]=D,H[T]=$,T=J;else break e}}function n(H){return H.length===0?null:H[0]}function i(H){if(H.length===0)return null;var D=H[0],T=H.pop();if(T!==D){H[0]=T;e:for(var J=0,$=H.length,Ie=$>>>1;J<Ie;){var fe=2*(J+1)-1,ve=H[fe],Ge=fe+1,Me=H[Ge];if(0>o(ve,T))Ge<$&&0>o(Me,ve)?(H[J]=Me,H[Ge]=T,J=Ge):(H[J]=ve,H[fe]=T,J=fe);else if(Ge<$&&0>o(Me,T))H[J]=Me,H[Ge]=T,J=Ge;else break e}}return D}function o(H,D){var T=H.sortIndex-D.sortIndex;return T!==0?T:H.id-D.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var s=Date,a=s.now();t.unstable_now=function(){return s.now()-a}}var l=[],g=[],c=1,C=null,d=3,h=!1,p=!1,v=!1,f=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(H){for(var D=n(g);D!==null;){if(D.callback===null)i(g);else if(D.startTime<=H)i(g),D.sortIndex=D.expirationTime,e(l,D);else break;D=n(g)}}function B(H){if(v=!1,m(H),!p)if(n(l)!==null)p=!0,re(Z);else{var D=n(g);D!==null&&se(B,D.startTime-H)}}function Z(H,D){p=!1,v&&(v=!1,A(X),X=-1),h=!0;var T=d;try{for(m(D),C=n(l);C!==null&&(!(C.expirationTime>D)||H&&!z());){var J=C.callback;if(typeof J=="function"){C.callback=null,d=C.priorityLevel;var $=J(C.expirationTime<=D);D=t.unstable_now(),typeof $=="function"?C.callback=$:C===n(l)&&i(l),m(D)}else i(l);C=n(l)}if(C!==null)var Ie=!0;else{var fe=n(g);fe!==null&&se(B,fe.startTime-D),Ie=!1}return Ie}finally{C=null,d=T,h=!1}}var w=!1,W=null,X=-1,V=5,Y=-1;function z(){return!(t.unstable_now()-Y<V)}function q(){if(W!==null){var H=t.unstable_now();Y=H;var D=!0;try{D=W(!0,H)}finally{D?O():(w=!1,W=null)}}else w=!1}var O;if(typeof b=="function")O=function(){b(q)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,oe=te.port2;te.port1.onmessage=q,O=function(){oe.postMessage(null)}}else O=function(){f(q,0)};function re(H){W=H,w||(w=!0,O())}function se(H,D){X=f(function(){H(t.unstable_now())},D)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(H){H.callback=null},t.unstable_continueExecution=function(){p||h||(p=!0,re(Z))},t.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):V=0<H?Math.floor(1e3/H):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(H){switch(d){case 1:case 2:case 3:var D=3;break;default:D=d}var T=d;d=D;try{return H()}finally{d=T}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(H,D){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var T=d;d=H;try{return D()}finally{d=T}},t.unstable_scheduleCallback=function(H,D,T){var J=t.unstable_now();switch(typeof T=="object"&&T!==null?(T=T.delay,T=typeof T=="number"&&0<T?J+T:J):T=J,H){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=T+$,H={id:c++,callback:D,priorityLevel:H,startTime:T,expirationTime:$,sortIndex:-1},T>J?(H.sortIndex=T,e(g,H),n(l)===null&&H===n(g)&&(v?(A(X),X=-1):v=!0,se(B,T-J))):(H.sortIndex=$,e(l,H),p||h||(p=!0,re(Z))),H},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(H){var D=d;return function(){var T=d;d=D;try{return H.apply(this,arguments)}finally{d=T}}}}(My)),My}var Ix;function RQ(){return Ix||(Ix=1,Yy.exports=SQ()),Yy.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WQ=function(e){var n={},i=x,o=RQ(),r=Object.assign;function s(I){for(var u="https://reactjs.org/docs/error-decoder.html?invariant="+I,y=1;y<arguments.length;y++)u+="&args[]="+encodeURIComponent(arguments[y]);return"Minified React error #"+I+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),g=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),h=Symbol.for("react.provider"),p=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),B=Symbol.for("react.offscreen"),Z=Symbol.iterator;function w(I){return I===null||typeof I!="object"?null:(I=Z&&I[Z]||I["@@iterator"],typeof I=="function"?I:null)}function W(I){if(I==null)return null;if(typeof I=="function")return I.displayName||I.name||null;if(typeof I=="string")return I;switch(I){case c:return"Fragment";case g:return"Portal";case d:return"Profiler";case C:return"StrictMode";case f:return"Suspense";case A:return"SuspenseList"}if(typeof I=="object")switch(I.$$typeof){case p:return(I.displayName||"Context")+".Consumer";case h:return(I._context.displayName||"Context")+".Provider";case v:var u=I.render;return I=I.displayName,I||(I=u.displayName||u.name||"",I=I!==""?"ForwardRef("+I+")":"ForwardRef"),I;case b:return u=I.displayName||null,u!==null?u:W(I.type)||"Memo";case m:u=I._payload,I=I._init;try{return W(I(u))}catch{}}return null}function X(I){var u=I.type;switch(I.tag){case 24:return"Cache";case 9:return(u.displayName||"Context")+".Consumer";case 10:return(u._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return I=u.render,I=I.displayName||I.name||"",u.displayName||(I!==""?"ForwardRef("+I+")":"ForwardRef");case 7:return"Fragment";case 5:return u;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return W(u);case 8:return u===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof u=="function")return u.displayName||u.name||null;if(typeof u=="string")return u}return null}function V(I){var u=I,y=I;if(I.alternate)for(;u.return;)u=u.return;else{I=u;do u=I,u.flags&4098&&(y=u.return),I=u.return;while(I)}return u.tag===3?y:null}function Y(I){if(V(I)!==I)throw Error(s(188))}function z(I){var u=I.alternate;if(!u){if(u=V(I),u===null)throw Error(s(188));return u!==I?null:I}for(var y=I,G=u;;){var S=y.return;if(S===null)break;var N=S.alternate;if(N===null){if(G=S.return,G!==null){y=G;continue}break}if(S.child===N.child){for(N=S.child;N;){if(N===y)return Y(S),I;if(N===G)return Y(S),u;N=N.sibling}throw Error(s(188))}if(y.return!==G.return)y=S,G=N;else{for(var Q=!1,le=S.child;le;){if(le===y){Q=!0,y=S,G=N;break}if(le===G){Q=!0,G=S,y=N;break}le=le.sibling}if(!Q){for(le=N.child;le;){if(le===y){Q=!0,y=N,G=S;break}if(le===G){Q=!0,G=N,y=S;break}le=le.sibling}if(!Q)throw Error(s(189))}}if(y.alternate!==G)throw Error(s(190))}if(y.tag!==3)throw Error(s(188));return y.stateNode.current===y?I:u}function q(I){return I=z(I),I!==null?O(I):null}function O(I){if(I.tag===5||I.tag===6)return I;for(I=I.child;I!==null;){var u=O(I);if(u!==null)return u;I=I.sibling}return null}function te(I){if(I.tag===5||I.tag===6)return I;for(I=I.child;I!==null;){if(I.tag!==4){var u=te(I);if(u!==null)return u}I=I.sibling}return null}var oe=Array.isArray,re=e.getPublicInstance,se=e.getRootHostContext,H=e.getChildHostContext,D=e.prepareForCommit,T=e.resetAfterCommit,J=e.createInstance,$=e.appendInitialChild,Ie=e.finalizeInitialChildren,fe=e.prepareUpdate,ve=e.shouldSetTextContent,Ge=e.createTextInstance,Me=e.scheduleTimeout,_e=e.cancelTimeout,Bt=e.noTimeout,St=e.isPrimaryRenderer,ot=e.supportsMutation,ee=e.supportsPersistence,Ne=e.supportsHydration,Se=e.getInstanceFromNode,He=e.preparePortalMount,Ve=e.getCurrentEventPriority,at=e.detachDeletedInstance,Qe=e.supportsMicrotasks,et=e.scheduleMicrotask,ut=e.supportsTestSelectors,xt=e.findFiberRoot,on=e.getBoundingRect,L=e.getTextContent,F=e.isHiddenSubtree,ce=e.matchAccessibilityRole,Ye=e.setFocusIfFocusable,Xe=e.setupIntersectionObserver,Fe=e.appendChild,tt=e.appendChildToContainer,ze=e.commitTextUpdate,Ae=e.commitMount,ie=e.commitUpdate,me=e.insertBefore,xe=e.insertInContainerBefore,Ke=e.removeChild,ke=e.removeChildFromContainer,lt=e.resetTextContent,mt=e.hideInstance,ae=e.hideTextInstance,pe=e.unhideInstance,Ce=e.unhideTextInstance,Le=e.clearContainer,qe=e.cloneInstance,Pt=e.createContainerChildSet,Cn=e.appendChildToContainerChildSet,Rn=e.finalizeContainerChildren,Vo=e.replaceContainerChildren,rn=e.cloneHiddenInstance,Di=e.cloneHiddenTextInstance,ri=e.canHydrateInstance,Jg=e.canHydrateTextInstance,Og=e.canHydrateSuspenseInstance,Vs=e.isSuspenseInstancePending,jr=e.isSuspenseInstanceFallback,qr=e.registerSuspenseInstanceRetry,xi=e.getNextHydratableSibling,Lt=e.getFirstHydratableChild,Qg=e.getFirstHydratableChildWithinContainer,su=e.getFirstHydratableChildWithinSuspenseInstance,M=e.hydrateInstance,R=e.hydrateTextInstance,K=e.hydrateSuspenseInstance,_=e.getNextHydratableInstanceAfterSuspenseInstance,k=e.commitHydratedContainer,j=e.commitHydratedSuspenseInstance,ue=e.clearSuspenseBoundary,he=e.clearSuspenseBoundaryFromContainer,we=e.shouldDeleteUnhydratedTailInstances,Be=e.didNotMatchHydratedContainerTextInstance,Re=e.didNotMatchHydratedTextInstance,ye;function rt(I){if(ye===void 0)try{throw Error()}catch(y){var u=y.stack.trim().match(/\n( *(at )?)/);ye=u&&u[1]||""}return`
`+ye+I}var Ue=!1;function Je(I,u){if(!I||Ue)return"";Ue=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(u)if(u=function(){throw Error()},Object.defineProperty(u.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(u,[])}catch(Te){var G=Te}Reflect.construct(I,[],u)}else{try{u.call()}catch(Te){G=Te}I.call(u.prototype)}else{try{throw Error()}catch(Te){G=Te}I()}}catch(Te){if(Te&&G&&typeof Te.stack=="string"){for(var S=Te.stack.split(`
`),N=G.stack.split(`
`),Q=S.length-1,le=N.length-1;1<=Q&&0<=le&&S[Q]!==N[le];)le--;for(;1<=Q&&0<=le;Q--,le--)if(S[Q]!==N[le]){if(Q!==1||le!==1)do if(Q--,le--,0>le||S[Q]!==N[le]){var Ze=`
`+S[Q].replace(" at new "," at ");return I.displayName&&Ze.includes("<anonymous>")&&(Ze=Ze.replace("<anonymous>",I.displayName)),Ze}while(1<=Q&&0<=le);break}}}finally{Ue=!1,Error.prepareStackTrace=y}return(I=I?I.displayName||I.name:"")?rt(I):""}var pt=Object.prototype.hasOwnProperty,yt=[],bt=-1;function nt(I){return{current:I}}function Zt(I){0>bt||(I.current=yt[bt],yt[bt]=null,bt--)}function It(I,u){bt++,yt[bt]=I.current,I.current=u}var Yt={},sn=nt(Yt),Rt=nt(!1),an=Yt;function qt(I,u){var y=I.type.contextTypes;if(!y)return Yt;var G=I.stateNode;if(G&&G.__reactInternalMemoizedUnmaskedChildContext===u)return G.__reactInternalMemoizedMaskedChildContext;var S={},N;for(N in y)S[N]=u[N];return G&&(I=I.stateNode,I.__reactInternalMemoizedUnmaskedChildContext=u,I.__reactInternalMemoizedMaskedChildContext=S),S}function dn(I){return I=I.childContextTypes,I!=null}function Dn(){Zt(Rt),Zt(sn)}function Vt(I,u,y){if(sn.current!==Yt)throw Error(s(168));It(sn,u),It(Rt,y)}function Nn(I,u,y){var G=I.stateNode;if(u=u.childContextTypes,typeof G.getChildContext!="function")return y;G=G.getChildContext();for(var S in G)if(!(S in u))throw Error(s(108,X(I)||"Unknown",S));return r({},y,G)}function nn(I){return I=(I=I.stateNode)&&I.__reactInternalMemoizedMergedChildContext||Yt,an=sn.current,It(sn,I),It(Rt,Rt.current),!0}function Jt(I,u,y){var G=I.stateNode;if(!G)throw Error(s(169));y?(I=Nn(I,u,an),G.__reactInternalMemoizedMergedChildContext=I,Zt(Rt),Zt(sn),It(sn,I)):Zt(Rt),It(Rt,y)}var Wn=Math.clz32?Math.clz32:$r,Xs=Math.log,Ji=Math.LN2;function $r(I){return I>>>=0,I===0?32:31-(Xs(I)/Ji|0)|0}var dh=64,hh=4194304;function au(I){switch(I&-I){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return I&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return I&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return I}}function Ah(I,u){var y=I.pendingLanes;if(y===0)return 0;var G=0,S=I.suspendedLanes,N=I.pingedLanes,Q=y&268435455;if(Q!==0){var le=Q&~S;le!==0?G=au(le):(N&=Q,N!==0&&(G=au(N)))}else Q=y&~S,Q!==0?G=au(Q):N!==0&&(G=au(N));if(G===0)return 0;if(u!==0&&u!==G&&!(u&S)&&(S=G&-G,N=u&-u,S>=N||S===16&&(N&4194240)!==0))return u;if(G&4&&(G|=y&16),u=I.entangledLanes,u!==0)for(I=I.entanglements,u&=G;0<u;)y=31-Wn(u),S=1<<y,G|=I[y],u&=~S;return G}function V9(I,u){switch(I){case 1:case 2:case 4:return u+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function X9(I,u){for(var y=I.suspendedLanes,G=I.pingedLanes,S=I.expirationTimes,N=I.pendingLanes;0<N;){var Q=31-Wn(N),le=1<<Q,Ze=S[Q];Ze===-1?(!(le&y)||le&G)&&(S[Q]=V9(le,u)):Ze<=u&&(I.expiredLanes|=le),N&=~le}}function G0(I){return I=I.pendingLanes&-1073741825,I!==0?I:I&1073741824?1073741824:0}function B0(I){for(var u=[],y=0;31>y;y++)u.push(I);return u}function lu(I,u,y){I.pendingLanes|=u,u!==536870912&&(I.suspendedLanes=0,I.pingedLanes=0),I=I.eventTimes,u=31-Wn(u),I[u]=y}function N9(I,u){var y=I.pendingLanes&~u;I.pendingLanes=u,I.suspendedLanes=0,I.pingedLanes=0,I.expiredLanes&=u,I.mutableReadLanes&=u,I.entangledLanes&=u,u=I.entanglements;var G=I.eventTimes;for(I=I.expirationTimes;0<y;){var S=31-Wn(y),N=1<<S;u[S]=0,G[S]=-1,I[S]=-1,y&=~N}}function Z0(I,u){var y=I.entangledLanes|=u;for(I=I.entanglements;y;){var G=31-Wn(y),S=1<<G;S&u|I[G]&u&&(I[G]|=u),y&=~S}}var $t=0;function _w(I){return I&=-I,1<I?4<I?I&268435455?16:536870912:4:1}var w0=o.unstable_scheduleCallback,Uw=o.unstable_cancelCallback,Y9=o.unstable_shouldYield,M9=o.unstable_requestPaint,Ci=o.unstable_now,S0=o.unstable_ImmediatePriority,H9=o.unstable_UserBlockingPriority,R0=o.unstable_NormalPriority,F9=o.unstable_IdlePriority,ph=null,es=null;function K9(I){if(es&&typeof es.onCommitFiberRoot=="function")try{es.onCommitFiberRoot(ph,I,void 0,(I.current.flags&128)===128)}catch{}}function z9(I,u){return I===u&&(I!==0||1/I===1/u)||I!==I&&u!==u}var ts=typeof Object.is=="function"?Object.is:z9,Ns=null,fh=!1,W0=!1;function Pw(I){Ns===null?Ns=[I]:Ns.push(I)}function L9(I){fh=!0,Pw(I)}function ns(){if(!W0&&Ns!==null){W0=!0;var I=0,u=$t;try{var y=Ns;for($t=1;I<y.length;I++){var G=y[I];do G=G(!0);while(G!==null)}Ns=null,fh=!1}catch(S){throw Ns!==null&&(Ns=Ns.slice(I+1)),w0(S0,ns),S}finally{$t=u,W0=!1}}return null}var E9=a.ReactCurrentBatchConfig;function mh(I,u){if(ts(I,u))return!0;if(typeof I!="object"||I===null||typeof u!="object"||u===null)return!1;var y=Object.keys(I),G=Object.keys(u);if(y.length!==G.length)return!1;for(G=0;G<y.length;G++){var S=y[G];if(!pt.call(u,S)||!ts(I[S],u[S]))return!1}return!0}function k9(I){switch(I.tag){case 5:return rt(I.type);case 16:return rt("Lazy");case 13:return rt("Suspense");case 19:return rt("SuspenseList");case 0:case 2:case 15:return I=Je(I.type,!1),I;case 11:return I=Je(I.type.render,!1),I;case 1:return I=Je(I.type,!0),I;default:return""}}function vr(I,u){if(I&&I.defaultProps){u=r({},u),I=I.defaultProps;for(var y in I)u[y]===void 0&&(u[y]=I[y]);return u}return u}var bh=nt(null),yh=null,jg=null,x0=null;function V0(){x0=jg=yh=null}function Dw(I,u,y){St?(It(bh,u._currentValue),u._currentValue=y):(It(bh,u._currentValue2),u._currentValue2=y)}function X0(I){var u=bh.current;Zt(bh),St?I._currentValue=u:I._currentValue2=u}function N0(I,u,y){for(;I!==null;){var G=I.alternate;if((I.childLanes&u)!==u?(I.childLanes|=u,G!==null&&(G.childLanes|=u)):G!==null&&(G.childLanes&u)!==u&&(G.childLanes|=u),I===y)break;I=I.return}}function qg(I,u){yh=I,x0=jg=null,I=I.dependencies,I!==null&&I.firstContext!==null&&(I.lanes&u&&(Yo=!0),I.firstContext=null)}function Do(I){var u=St?I._currentValue:I._currentValue2;if(x0!==I)if(I={context:I,memoizedValue:u,next:null},jg===null){if(yh===null)throw Error(s(308));jg=I,yh.dependencies={lanes:0,firstContext:I}}else jg=jg.next=I;return u}var is=null,va=!1;function Y0(I){I.updateQueue={baseState:I.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Jw(I,u){I=I.updateQueue,u.updateQueue===I&&(u.updateQueue={baseState:I.baseState,firstBaseUpdate:I.firstBaseUpdate,lastBaseUpdate:I.lastBaseUpdate,shared:I.shared,effects:I.effects})}function Ys(I,u){return{eventTime:I,lane:u,tag:0,payload:null,callback:null,next:null}}function Ga(I,u){var y=I.updateQueue;y!==null&&(y=y.shared,$n!==null&&I.mode&1&&!(Ut&2)?(I=y.interleaved,I===null?(u.next=u,is===null?is=[y]:is.push(y)):(u.next=I.next,I.next=u),y.interleaved=u):(I=y.pending,I===null?u.next=u:(u.next=I.next,I.next=u),y.pending=u))}function vh(I,u,y){if(u=u.updateQueue,u!==null&&(u=u.shared,(y&4194240)!==0)){var G=u.lanes;G&=I.pendingLanes,y|=G,u.lanes=y,Z0(I,y)}}function Ow(I,u){var y=I.updateQueue,G=I.alternate;if(G!==null&&(G=G.updateQueue,y===G)){var S=null,N=null;if(y=y.firstBaseUpdate,y!==null){do{var Q={eventTime:y.eventTime,lane:y.lane,tag:y.tag,payload:y.payload,callback:y.callback,next:null};N===null?S=N=Q:N=N.next=Q,y=y.next}while(y!==null);N===null?S=N=u:N=N.next=u}else S=N=u;y={baseState:G.baseState,firstBaseUpdate:S,lastBaseUpdate:N,shared:G.shared,effects:G.effects},I.updateQueue=y;return}I=y.lastBaseUpdate,I===null?y.firstBaseUpdate=u:I.next=u,y.lastBaseUpdate=u}function Gh(I,u,y,G){var S=I.updateQueue;va=!1;var N=S.firstBaseUpdate,Q=S.lastBaseUpdate,le=S.shared.pending;if(le!==null){S.shared.pending=null;var Ze=le,Te=Ze.next;Ze.next=null,Q===null?N=Te:Q.next=Te,Q=Ze;var gt=I.alternate;gt!==null&&(gt=gt.updateQueue,le=gt.lastBaseUpdate,le!==Q&&(le===null?gt.firstBaseUpdate=Te:le.next=Te,gt.lastBaseUpdate=Ze))}if(N!==null){var Mt=S.baseState;Q=0,gt=Te=Ze=null,le=N;do{var vt=le.lane,mn=le.eventTime;if((G&vt)===vt){gt!==null&&(gt=gt.next={eventTime:mn,lane:0,tag:le.tag,payload:le.payload,callback:le.callback,next:null});e:{var ft=I,Yi=le;switch(vt=u,mn=y,Yi.tag){case 1:if(ft=Yi.payload,typeof ft=="function"){Mt=ft.call(mn,Mt,vt);break e}Mt=ft;break e;case 3:ft.flags=ft.flags&-65537|128;case 0:if(ft=Yi.payload,vt=typeof ft=="function"?ft.call(mn,Mt,vt):ft,vt==null)break e;Mt=r({},Mt,vt);break e;case 2:va=!0}}le.callback!==null&&le.lane!==0&&(I.flags|=64,vt=S.effects,vt===null?S.effects=[le]:vt.push(le))}else mn={eventTime:mn,lane:vt,tag:le.tag,payload:le.payload,callback:le.callback,next:null},gt===null?(Te=gt=mn,Ze=Mt):gt=gt.next=mn,Q|=vt;if(le=le.next,le===null){if(le=S.shared.pending,le===null)break;vt=le,le=vt.next,vt.next=null,S.lastBaseUpdate=vt,S.shared.pending=null}}while(1);if(gt===null&&(Ze=Mt),S.baseState=Ze,S.firstBaseUpdate=Te,S.lastBaseUpdate=gt,u=S.shared.interleaved,u!==null){S=u;do Q|=S.lane,S=S.next;while(S!==u)}else N===null&&(S.shared.lanes=0);ac|=Q,I.lanes=Q,I.memoizedState=Mt}}function Qw(I,u,y){if(I=u.effects,u.effects=null,I!==null)for(u=0;u<I.length;u++){var G=I[u],S=G.callback;if(S!==null){if(G.callback=null,G=y,typeof S!="function")throw Error(s(191,S));S.call(G)}}}var jw=new i.Component().refs;function M0(I,u,y,G){u=I.memoizedState,y=y(G,u),y=y==null?u:r({},u,y),I.memoizedState=y,I.lanes===0&&(I.updateQueue.baseState=y)}var Bh={isMounted:function(I){return(I=I._reactInternals)?V(I)===I:!1},enqueueSetState:function(I,u,y){I=I._reactInternals;var G=Qi(),S=wa(I),N=Ys(G,S);N.payload=u,y!=null&&(N.callback=y),Ga(I,N),u=qo(I,S,G),u!==null&&vh(u,I,S)},enqueueReplaceState:function(I,u,y){I=I._reactInternals;var G=Qi(),S=wa(I),N=Ys(G,S);N.tag=1,N.payload=u,y!=null&&(N.callback=y),Ga(I,N),u=qo(I,S,G),u!==null&&vh(u,I,S)},enqueueForceUpdate:function(I,u){I=I._reactInternals;var y=Qi(),G=wa(I),S=Ys(y,G);S.tag=2,u!=null&&(S.callback=u),Ga(I,S),u=qo(I,G,y),u!==null&&vh(u,I,G)}};function qw(I,u,y,G,S,N,Q){return I=I.stateNode,typeof I.shouldComponentUpdate=="function"?I.shouldComponentUpdate(G,N,Q):u.prototype&&u.prototype.isPureReactComponent?!mh(y,G)||!mh(S,N):!0}function $w(I,u,y){var G=!1,S=Yt,N=u.contextType;return typeof N=="object"&&N!==null?N=Do(N):(S=dn(u)?an:sn.current,G=u.contextTypes,N=(G=G!=null)?qt(I,S):Yt),u=new u(y,N),I.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,u.updater=Bh,I.stateNode=u,u._reactInternals=I,G&&(I=I.stateNode,I.__reactInternalMemoizedUnmaskedChildContext=S,I.__reactInternalMemoizedMaskedChildContext=N),u}function eS(I,u,y,G){I=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(y,G),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(y,G),u.state!==I&&Bh.enqueueReplaceState(u,u.state,null)}function H0(I,u,y,G){var S=I.stateNode;S.props=y,S.state=I.memoizedState,S.refs=jw,Y0(I);var N=u.contextType;typeof N=="object"&&N!==null?S.context=Do(N):(N=dn(u)?an:sn.current,S.context=qt(I,N)),S.state=I.memoizedState,N=u.getDerivedStateFromProps,typeof N=="function"&&(M0(I,u,N,y),S.state=I.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(u=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),u!==S.state&&Bh.enqueueReplaceState(S,S.state,null),Gh(I,y,S,G),S.state=I.memoizedState),typeof S.componentDidMount=="function"&&(I.flags|=4194308)}var $g=[],ec=0,Zh=null,wh=0,Jo=[],Oo=0,Wl=null,Ms=1,Hs="";function xl(I,u){$g[ec++]=wh,$g[ec++]=Zh,Zh=I,wh=u}function tS(I,u,y){Jo[Oo++]=Ms,Jo[Oo++]=Hs,Jo[Oo++]=Wl,Wl=I;var G=Ms;I=Hs;var S=32-Wn(G)-1;G&=~(1<<S),y+=1;var N=32-Wn(u)+S;if(30<N){var Q=S-S%5;N=(G&(1<<Q)-1).toString(32),G>>=Q,S-=Q,Ms=1<<32-Wn(u)+S|y<<S|G,Hs=N+I}else Ms=1<<N|y<<S|G,Hs=I}function F0(I){I.return!==null&&(xl(I,1),tS(I,1,0))}function K0(I){for(;I===Zh;)Zh=$g[--ec],$g[ec]=null,wh=$g[--ec],$g[ec]=null;for(;I===Wl;)Wl=Jo[--Oo],Jo[Oo]=null,Hs=Jo[--Oo],Jo[Oo]=null,Ms=Jo[--Oo],Jo[Oo]=null}var Xo=null,No=null,xn=!1,gu=!1,Gr=null;function nS(I,u){var y=$o(5,null,null,0);y.elementType="DELETED",y.stateNode=u,y.return=I,u=I.deletions,u===null?(I.deletions=[y],I.flags|=16):u.push(y)}function iS(I,u){switch(I.tag){case 5:return u=ri(u,I.type,I.pendingProps),u!==null?(I.stateNode=u,Xo=I,No=Lt(u),!0):!1;case 6:return u=Jg(u,I.pendingProps),u!==null?(I.stateNode=u,Xo=I,No=null,!0):!1;case 13:if(u=Og(u),u!==null){var y=Wl!==null?{id:Ms,overflow:Hs}:null;return I.memoizedState={dehydrated:u,treeContext:y,retryLane:1073741824},y=$o(18,null,null,0),y.stateNode=u,y.return=I,I.child=y,Xo=I,No=null,!0}return!1;default:return!1}}function z0(I){return(I.mode&1)!==0&&(I.flags&128)===0}function L0(I){if(xn){var u=No;if(u){var y=u;if(!iS(I,u)){if(z0(I))throw Error(s(418));u=xi(y);var G=Xo;u&&iS(I,u)?nS(G,y):(I.flags=I.flags&-4097|2,xn=!1,Xo=I)}}else{if(z0(I))throw Error(s(418));I.flags=I.flags&-4097|2,xn=!1,Xo=I}}}function oS(I){for(I=I.return;I!==null&&I.tag!==5&&I.tag!==3&&I.tag!==13;)I=I.return;Xo=I}function cu(I){if(!Ne||I!==Xo)return!1;if(!xn)return oS(I),xn=!0,!1;if(I.tag!==3&&(I.tag!==5||we(I.type)&&!ve(I.type,I.memoizedProps))){var u=No;if(u){if(z0(I)){for(I=No;I;)I=xi(I);throw Error(s(418))}for(;u;)nS(I,u),u=xi(u)}}if(oS(I),I.tag===13){if(!Ne)throw Error(s(316));if(I=I.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(s(317));No=_(I)}else No=Xo?xi(I.stateNode):null;return!0}function tc(){Ne&&(No=Xo=null,gu=xn=!1)}function E0(I){Gr===null?Gr=[I]:Gr.push(I)}function Iu(I,u,y){if(I=y.ref,I!==null&&typeof I!="function"&&typeof I!="object"){if(y._owner){if(y=y._owner,y){if(y.tag!==1)throw Error(s(309));var G=y.stateNode}if(!G)throw Error(s(147,I));var S=G,N=""+I;return u!==null&&u.ref!==null&&typeof u.ref=="function"&&u.ref._stringRef===N?u.ref:(u=function(Q){var le=S.refs;le===jw&&(le=S.refs={}),Q===null?delete le[N]:le[N]=Q},u._stringRef=N,u)}if(typeof I!="string")throw Error(s(284));if(!y._owner)throw Error(s(290,I))}return I}function Sh(I,u){throw I=Object.prototype.toString.call(u),Error(s(31,I==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":I))}function rS(I){var u=I._init;return u(I._payload)}function sS(I){function u(de,ge){if(I){var be=de.deletions;be===null?(de.deletions=[ge],de.flags|=16):be.push(ge)}}function y(de,ge){if(!I)return null;for(;ge!==null;)u(de,ge),ge=ge.sibling;return null}function G(de,ge){for(de=new Map;ge!==null;)ge.key!==null?de.set(ge.key,ge):de.set(ge.index,ge),ge=ge.sibling;return de}function S(de,ge){return de=Ra(de,ge),de.index=0,de.sibling=null,de}function N(de,ge,be){return de.index=be,I?(be=de.alternate,be!==null?(be=be.index,be<ge?(de.flags|=2,ge):be):(de.flags|=2,ge)):(de.flags|=1048576,ge)}function Q(de){return I&&de.alternate===null&&(de.flags|=2),de}function le(de,ge,be,it){return ge===null||ge.tag!==6?(ge=Bb(be,de.mode,it),ge.return=de,ge):(ge=S(ge,be),ge.return=de,ge)}function Ze(de,ge,be,it){var dt=be.type;return dt===c?gt(de,ge,be.props.children,it,be.key):ge!==null&&(ge.elementType===dt||typeof dt=="object"&&dt!==null&&dt.$$typeof===m&&rS(dt)===ge.type)?(it=S(ge,be.props),it.ref=Iu(de,ge,be),it.return=de,it):(it=oA(be.type,be.key,be.props,null,de.mode,it),it.ref=Iu(de,ge,be),it.return=de,it)}function Te(de,ge,be,it){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==be.containerInfo||ge.stateNode.implementation!==be.implementation?(ge=Zb(be,de.mode,it),ge.return=de,ge):(ge=S(ge,be.children||[]),ge.return=de,ge)}function gt(de,ge,be,it,dt){return ge===null||ge.tag!==7?(ge=Fl(be,de.mode,it,dt),ge.return=de,ge):(ge=S(ge,be),ge.return=de,ge)}function Mt(de,ge,be){if(typeof ge=="string"&&ge!==""||typeof ge=="number")return ge=Bb(""+ge,de.mode,be),ge.return=de,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case l:return be=oA(ge.type,ge.key,ge.props,null,de.mode,be),be.ref=Iu(de,null,ge),be.return=de,be;case g:return ge=Zb(ge,de.mode,be),ge.return=de,ge;case m:var it=ge._init;return Mt(de,it(ge._payload),be)}if(oe(ge)||w(ge))return ge=Fl(ge,de.mode,be,null),ge.return=de,ge;Sh(de,ge)}return null}function vt(de,ge,be,it){var dt=ge!==null?ge.key:null;if(typeof be=="string"&&be!==""||typeof be=="number")return dt!==null?null:le(de,ge,""+be,it);if(typeof be=="object"&&be!==null){switch(be.$$typeof){case l:return be.key===dt?Ze(de,ge,be,it):null;case g:return be.key===dt?Te(de,ge,be,it):null;case m:return dt=be._init,vt(de,ge,dt(be._payload),it)}if(oe(be)||w(be))return dt!==null?null:gt(de,ge,be,it,null);Sh(de,be)}return null}function mn(de,ge,be,it,dt){if(typeof it=="string"&&it!==""||typeof it=="number")return de=de.get(be)||null,le(ge,de,""+it,dt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case l:return de=de.get(it.key===null?be:it.key)||null,Ze(ge,de,it,dt);case g:return de=de.get(it.key===null?be:it.key)||null,Te(ge,de,it,dt);case m:var Et=it._init;return mn(de,ge,be,Et(it._payload),dt)}if(oe(it)||w(it))return de=de.get(be)||null,gt(ge,de,it,dt,null);Sh(ge,it)}return null}function ft(de,ge,be,it){for(var dt=null,Et=null,Ht=ge,en=ge=0,hi=null;Ht!==null&&en<be.length;en++){Ht.index>en?(hi=Ht,Ht=null):hi=Ht.sibling;var tn=vt(de,Ht,be[en],it);if(tn===null){Ht===null&&(Ht=hi);break}I&&Ht&&tn.alternate===null&&u(de,Ht),ge=N(tn,ge,en),Et===null?dt=tn:Et.sibling=tn,Et=tn,Ht=hi}if(en===be.length)return y(de,Ht),xn&&xl(de,en),dt;if(Ht===null){for(;en<be.length;en++)Ht=Mt(de,be[en],it),Ht!==null&&(ge=N(Ht,ge,en),Et===null?dt=Ht:Et.sibling=Ht,Et=Ht);return xn&&xl(de,en),dt}for(Ht=G(de,Ht);en<be.length;en++)hi=mn(Ht,de,en,be[en],it),hi!==null&&(I&&hi.alternate!==null&&Ht.delete(hi.key===null?en:hi.key),ge=N(hi,ge,en),Et===null?dt=hi:Et.sibling=hi,Et=hi);return I&&Ht.forEach(function(Wa){return u(de,Wa)}),xn&&xl(de,en),dt}function Yi(de,ge,be,it){var dt=w(be);if(typeof dt!="function")throw Error(s(150));if(be=dt.call(be),be==null)throw Error(s(151));for(var Et=dt=null,Ht=ge,en=ge=0,hi=null,tn=be.next();Ht!==null&&!tn.done;en++,tn=be.next()){Ht.index>en?(hi=Ht,Ht=null):hi=Ht.sibling;var Wa=vt(de,Ht,tn.value,it);if(Wa===null){Ht===null&&(Ht=hi);break}I&&Ht&&Wa.alternate===null&&u(de,Ht),ge=N(Wa,ge,en),Et===null?dt=Wa:Et.sibling=Wa,Et=Wa,Ht=hi}if(tn.done)return y(de,Ht),xn&&xl(de,en),dt;if(Ht===null){for(;!tn.done;en++,tn=be.next())tn=Mt(de,tn.value,it),tn!==null&&(ge=N(tn,ge,en),Et===null?dt=tn:Et.sibling=tn,Et=tn);return xn&&xl(de,en),dt}for(Ht=G(de,Ht);!tn.done;en++,tn=be.next())tn=mn(Ht,de,en,tn.value,it),tn!==null&&(I&&tn.alternate!==null&&Ht.delete(tn.key===null?en:tn.key),ge=N(tn,ge,en),Et===null?dt=tn:Et.sibling=tn,Et=tn);return I&&Ht.forEach(function(fz){return u(de,fz)}),xn&&xl(de,en),dt}function er(de,ge,be,it){if(typeof be=="object"&&be!==null&&be.type===c&&be.key===null&&(be=be.props.children),typeof be=="object"&&be!==null){switch(be.$$typeof){case l:e:{for(var dt=be.key,Et=ge;Et!==null;){if(Et.key===dt){if(dt=be.type,dt===c){if(Et.tag===7){y(de,Et.sibling),ge=S(Et,be.props.children),ge.return=de,de=ge;break e}}else if(Et.elementType===dt||typeof dt=="object"&&dt!==null&&dt.$$typeof===m&&rS(dt)===Et.type){y(de,Et.sibling),ge=S(Et,be.props),ge.ref=Iu(de,Et,be),ge.return=de,de=ge;break e}y(de,Et);break}else u(de,Et);Et=Et.sibling}be.type===c?(ge=Fl(be.props.children,de.mode,it,be.key),ge.return=de,de=ge):(it=oA(be.type,be.key,be.props,null,de.mode,it),it.ref=Iu(de,ge,be),it.return=de,de=it)}return Q(de);case g:e:{for(Et=be.key;ge!==null;){if(ge.key===Et)if(ge.tag===4&&ge.stateNode.containerInfo===be.containerInfo&&ge.stateNode.implementation===be.implementation){y(de,ge.sibling),ge=S(ge,be.children||[]),ge.return=de,de=ge;break e}else{y(de,ge);break}else u(de,ge);ge=ge.sibling}ge=Zb(be,de.mode,it),ge.return=de,de=ge}return Q(de);case m:return Et=be._init,er(de,ge,Et(be._payload),it)}if(oe(be))return ft(de,ge,be,it);if(w(be))return Yi(de,ge,be,it);Sh(de,be)}return typeof be=="string"&&be!==""||typeof be=="number"?(be=""+be,ge!==null&&ge.tag===6?(y(de,ge.sibling),ge=S(ge,be),ge.return=de,de=ge):(y(de,ge),ge=Bb(be,de.mode,it),ge.return=de,de=ge),Q(de)):y(de,ge)}return er}var nc=sS(!0),aS=sS(!1),uu={},Qo=nt(uu),Cu=nt(uu),ic=nt(uu);function os(I){if(I===uu)throw Error(s(174));return I}function k0(I,u){It(ic,u),It(Cu,I),It(Qo,uu),I=se(u),Zt(Qo),It(Qo,I)}function oc(){Zt(Qo),Zt(Cu),Zt(ic)}function lS(I){var u=os(ic.current),y=os(Qo.current);u=H(y,I.type,u),y!==u&&(It(Cu,I),It(Qo,u))}function T0(I){Cu.current===I&&(Zt(Qo),Zt(Cu))}var Yn=nt(0);function Rh(I){for(var u=I;u!==null;){if(u.tag===13){var y=u.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||Vs(y)||jr(y)))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if(u.flags&128)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===I)break;for(;u.sibling===null;){if(u.return===null||u.return===I)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}var _0=[];function U0(){for(var I=0;I<_0.length;I++){var u=_0[I];St?u._workInProgressVersionPrimary=null:u._workInProgressVersionSecondary=null}_0.length=0}var Wh=a.ReactCurrentDispatcher,jo=a.ReactCurrentBatchConfig,rc=0,kn=null,Vi=null,di=null,xh=!1,du=!1,hu=0,T9=0;function Xi(){throw Error(s(321))}function P0(I,u){if(u===null)return!1;for(var y=0;y<u.length&&y<I.length;y++)if(!ts(I[y],u[y]))return!1;return!0}function D0(I,u,y,G,S,N){if(rc=N,kn=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,Wh.current=I===null||I.memoizedState===null?D9:J9,I=y(G,S),du){N=0;do{if(du=!1,hu=0,25<=N)throw Error(s(301));N+=1,di=Vi=null,u.updateQueue=null,Wh.current=O9,I=y(G,S)}while(du)}if(Wh.current=Mh,u=Vi!==null&&Vi.next!==null,rc=0,di=Vi=kn=null,xh=!1,u)throw Error(s(300));return I}function J0(){var I=hu!==0;return hu=0,I}function Fs(){var I={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return di===null?kn.memoizedState=di=I:di=di.next=I,di}function rs(){if(Vi===null){var I=kn.alternate;I=I!==null?I.memoizedState:null}else I=Vi.next;var u=di===null?kn.memoizedState:di.next;if(u!==null)di=u,Vi=I;else{if(I===null)throw Error(s(310));Vi=I,I={memoizedState:Vi.memoizedState,baseState:Vi.baseState,baseQueue:Vi.baseQueue,queue:Vi.queue,next:null},di===null?kn.memoizedState=di=I:di=di.next=I}return di}function Vl(I,u){return typeof u=="function"?u(I):u}function Vh(I){var u=rs(),y=u.queue;if(y===null)throw Error(s(311));y.lastRenderedReducer=I;var G=Vi,S=G.baseQueue,N=y.pending;if(N!==null){if(S!==null){var Q=S.next;S.next=N.next,N.next=Q}G.baseQueue=S=N,y.pending=null}if(S!==null){N=S.next,G=G.baseState;var le=Q=null,Ze=null,Te=N;do{var gt=Te.lane;if((rc&gt)===gt)Ze!==null&&(Ze=Ze.next={lane:0,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null}),G=Te.hasEagerState?Te.eagerState:I(G,Te.action);else{var Mt={lane:gt,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null};Ze===null?(le=Ze=Mt,Q=G):Ze=Ze.next=Mt,kn.lanes|=gt,ac|=gt}Te=Te.next}while(Te!==null&&Te!==N);Ze===null?Q=G:Ze.next=le,ts(G,u.memoizedState)||(Yo=!0),u.memoizedState=G,u.baseState=Q,u.baseQueue=Ze,y.lastRenderedState=G}if(I=y.interleaved,I!==null){S=I;do N=S.lane,kn.lanes|=N,ac|=N,S=S.next;while(S!==I)}else S===null&&(y.lanes=0);return[u.memoizedState,y.dispatch]}function Xh(I){var u=rs(),y=u.queue;if(y===null)throw Error(s(311));y.lastRenderedReducer=I;var G=y.dispatch,S=y.pending,N=u.memoizedState;if(S!==null){y.pending=null;var Q=S=S.next;do N=I(N,Q.action),Q=Q.next;while(Q!==S);ts(N,u.memoizedState)||(Yo=!0),u.memoizedState=N,u.baseQueue===null&&(u.baseState=N),y.lastRenderedState=N}return[N,G]}function gS(){}function cS(I,u){var y=kn,G=rs(),S=u(),N=!ts(G.memoizedState,S);if(N&&(G.memoizedState=S,Yo=!0),G=G.queue,pu(CS.bind(null,y,G,I),[I]),G.getSnapshot!==u||N||di!==null&&di.memoizedState.tag&1){if(y.flags|=2048,Au(9,uS.bind(null,y,G,S,u),void 0,null),$n===null)throw Error(s(349));rc&30||IS(y,u,S)}return S}function IS(I,u,y){I.flags|=16384,I={getSnapshot:u,value:y},u=kn.updateQueue,u===null?(u={lastEffect:null,stores:null},kn.updateQueue=u,u.stores=[I]):(y=u.stores,y===null?u.stores=[I]:y.push(I))}function uS(I,u,y,G){u.value=y,u.getSnapshot=G,dS(u)&&qo(I,1,-1)}function CS(I,u,y){return y(function(){dS(u)&&qo(I,1,-1)})}function dS(I){var u=I.getSnapshot;I=I.value;try{var y=u();return!ts(I,y)}catch{return!0}}function O0(I){var u=Fs();return typeof I=="function"&&(I=I()),u.memoizedState=u.baseState=I,I={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vl,lastRenderedState:I},u.queue=I,I=I.dispatch=P9.bind(null,kn,I),[u.memoizedState,I]}function Au(I,u,y,G){return I={tag:I,create:u,destroy:y,deps:G,next:null},u=kn.updateQueue,u===null?(u={lastEffect:null,stores:null},kn.updateQueue=u,u.lastEffect=I.next=I):(y=u.lastEffect,y===null?u.lastEffect=I.next=I:(G=y.next,y.next=I,I.next=G,u.lastEffect=I)),I}function hS(){return rs().memoizedState}function Nh(I,u,y,G){var S=Fs();kn.flags|=I,S.memoizedState=Au(1|u,y,void 0,G===void 0?null:G)}function Yh(I,u,y,G){var S=rs();G=G===void 0?null:G;var N=void 0;if(Vi!==null){var Q=Vi.memoizedState;if(N=Q.destroy,G!==null&&P0(G,Q.deps)){S.memoizedState=Au(u,y,N,G);return}}kn.flags|=I,S.memoizedState=Au(1|u,y,N,G)}function Q0(I,u){return Nh(8390656,8,I,u)}function pu(I,u){return Yh(2048,8,I,u)}function AS(I,u){return Yh(4,2,I,u)}function pS(I,u){return Yh(4,4,I,u)}function fS(I,u){if(typeof u=="function")return I=I(),u(I),function(){u(null)};if(u!=null)return I=I(),u.current=I,function(){u.current=null}}function mS(I,u,y){return y=y!=null?y.concat([I]):null,Yh(4,4,fS.bind(null,u,I),y)}function j0(){}function bS(I,u){var y=rs();u=u===void 0?null:u;var G=y.memoizedState;return G!==null&&u!==null&&P0(u,G[1])?G[0]:(y.memoizedState=[I,u],I)}function yS(I,u){var y=rs();u=u===void 0?null:u;var G=y.memoizedState;return G!==null&&u!==null&&P0(u,G[1])?G[0]:(I=I(),y.memoizedState=[I,u],I)}function _9(I,u){var y=$t;$t=y!==0&&4>y?y:4,I(!0);var G=jo.transition;jo.transition={};try{I(!1),u()}finally{$t=y,jo.transition=G}}function vS(){return rs().memoizedState}function U9(I,u,y){var G=wa(I);y={lane:G,action:y,hasEagerState:!1,eagerState:null,next:null},GS(I)?BS(u,y):(ZS(I,u,y),y=Qi(),I=qo(I,G,y),I!==null&&wS(I,u,G))}function P9(I,u,y){var G=wa(I),S={lane:G,action:y,hasEagerState:!1,eagerState:null,next:null};if(GS(I))BS(u,S);else{ZS(I,u,S);var N=I.alternate;if(I.lanes===0&&(N===null||N.lanes===0)&&(N=u.lastRenderedReducer,N!==null))try{var Q=u.lastRenderedState,le=N(Q,y);if(S.hasEagerState=!0,S.eagerState=le,ts(le,Q))return}catch{}finally{}y=Qi(),I=qo(I,G,y),I!==null&&wS(I,u,G)}}function GS(I){var u=I.alternate;return I===kn||u!==null&&u===kn}function BS(I,u){du=xh=!0;var y=I.pending;y===null?u.next=u:(u.next=y.next,y.next=u),I.pending=u}function ZS(I,u,y){$n!==null&&I.mode&1&&!(Ut&2)?(I=u.interleaved,I===null?(y.next=y,is===null?is=[u]:is.push(u)):(y.next=I.next,I.next=y),u.interleaved=y):(I=u.pending,I===null?y.next=y:(y.next=I.next,I.next=y),u.pending=y)}function wS(I,u,y){if(y&4194240){var G=u.lanes;G&=I.pendingLanes,y|=G,u.lanes=y,Z0(I,y)}}var Mh={readContext:Do,useCallback:Xi,useContext:Xi,useEffect:Xi,useImperativeHandle:Xi,useInsertionEffect:Xi,useLayoutEffect:Xi,useMemo:Xi,useReducer:Xi,useRef:Xi,useState:Xi,useDebugValue:Xi,useDeferredValue:Xi,useTransition:Xi,useMutableSource:Xi,useSyncExternalStore:Xi,useId:Xi,unstable_isNewReconciler:!1},D9={readContext:Do,useCallback:function(I,u){return Fs().memoizedState=[I,u===void 0?null:u],I},useContext:Do,useEffect:Q0,useImperativeHandle:function(I,u,y){return y=y!=null?y.concat([I]):null,Nh(4194308,4,fS.bind(null,u,I),y)},useLayoutEffect:function(I,u){return Nh(4194308,4,I,u)},useInsertionEffect:function(I,u){return Nh(4,2,I,u)},useMemo:function(I,u){var y=Fs();return u=u===void 0?null:u,I=I(),y.memoizedState=[I,u],I},useReducer:function(I,u,y){var G=Fs();return u=y!==void 0?y(u):u,G.memoizedState=G.baseState=u,I={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:I,lastRenderedState:u},G.queue=I,I=I.dispatch=U9.bind(null,kn,I),[G.memoizedState,I]},useRef:function(I){var u=Fs();return I={current:I},u.memoizedState=I},useState:O0,useDebugValue:j0,useDeferredValue:function(I){var u=O0(I),y=u[0],G=u[1];return Q0(function(){var S=jo.transition;jo.transition={};try{G(I)}finally{jo.transition=S}},[I]),y},useTransition:function(){var I=O0(!1),u=I[0];return I=_9.bind(null,I[1]),Fs().memoizedState=I,[u,I]},useMutableSource:function(){},useSyncExternalStore:function(I,u,y){var G=kn,S=Fs();if(xn){if(y===void 0)throw Error(s(407));y=y()}else{if(y=u(),$n===null)throw Error(s(349));rc&30||IS(G,u,y)}S.memoizedState=y;var N={value:y,getSnapshot:u};return S.queue=N,Q0(CS.bind(null,G,N,I),[I]),G.flags|=2048,Au(9,uS.bind(null,G,N,y,u),void 0,null),y},useId:function(){var I=Fs(),u=$n.identifierPrefix;if(xn){var y=Hs,G=Ms;y=(G&~(1<<32-Wn(G)-1)).toString(32)+y,u=":"+u+"R"+y,y=hu++,0<y&&(u+="H"+y.toString(32)),u+=":"}else y=T9++,u=":"+u+"r"+y.toString(32)+":";return I.memoizedState=u},unstable_isNewReconciler:!1},J9={readContext:Do,useCallback:bS,useContext:Do,useEffect:pu,useImperativeHandle:mS,useInsertionEffect:AS,useLayoutEffect:pS,useMemo:yS,useReducer:Vh,useRef:hS,useState:function(){return Vh(Vl)},useDebugValue:j0,useDeferredValue:function(I){var u=Vh(Vl),y=u[0],G=u[1];return pu(function(){var S=jo.transition;jo.transition={};try{G(I)}finally{jo.transition=S}},[I]),y},useTransition:function(){var I=Vh(Vl)[0],u=rs().memoizedState;return[I,u]},useMutableSource:gS,useSyncExternalStore:cS,useId:vS,unstable_isNewReconciler:!1},O9={readContext:Do,useCallback:bS,useContext:Do,useEffect:pu,useImperativeHandle:mS,useInsertionEffect:AS,useLayoutEffect:pS,useMemo:yS,useReducer:Xh,useRef:hS,useState:function(){return Xh(Vl)},useDebugValue:j0,useDeferredValue:function(I){var u=Xh(Vl),y=u[0],G=u[1];return pu(function(){var S=jo.transition;jo.transition={};try{G(I)}finally{jo.transition=S}},[I]),y},useTransition:function(){var I=Xh(Vl)[0],u=rs().memoizedState;return[I,u]},useMutableSource:gS,useSyncExternalStore:cS,useId:vS,unstable_isNewReconciler:!1};function q0(I,u){try{var y="",G=u;do y+=k9(G),G=G.return;while(G);var S=y}catch(N){S=`
Error generating stack: `+N.message+`
`+N.stack}return{value:I,source:u,stack:S}}function $0(I,u){try{console.error(u.value)}catch(y){setTimeout(function(){throw y})}}var Q9=typeof WeakMap=="function"?WeakMap:Map;function SS(I,u,y){y=Ys(-1,y),y.tag=3,y.payload={element:null};var G=u.value;return y.callback=function(){jh||(jh=!0,pb=G),$0(I,u)},y}function RS(I,u,y){y=Ys(-1,y),y.tag=3;var G=I.type.getDerivedStateFromError;if(typeof G=="function"){var S=u.value;y.payload=function(){return G(S)},y.callback=function(){$0(I,u)}}var N=I.stateNode;return N!==null&&typeof N.componentDidCatch=="function"&&(y.callback=function(){$0(I,u),typeof G!="function"&&(Ba===null?Ba=new Set([this]):Ba.add(this));var Q=u.stack;this.componentDidCatch(u.value,{componentStack:Q!==null?Q:""})}),y}function WS(I,u,y){var G=I.pingCache;if(G===null){G=I.pingCache=new Q9;var S=new Set;G.set(u,S)}else S=G.get(u),S===void 0&&(S=new Set,G.set(u,S));S.has(y)||(S.add(y),I=cz.bind(null,I,u,y),u.then(I,I))}function xS(I){do{var u;if((u=I.tag===13)&&(u=I.memoizedState,u=u!==null?u.dehydrated!==null:!0),u)return I;I=I.return}while(I!==null);return null}function VS(I,u,y,G,S){return I.mode&1?(I.flags|=65536,I.lanes=S,I):(I===u?I.flags|=65536:(I.flags|=128,y.flags|=131072,y.flags&=-52805,y.tag===1&&(y.alternate===null?y.tag=17:(u=Ys(-1,1),u.tag=2,Ga(y,u))),y.lanes|=1),I)}function ss(I){I.flags|=4}function XS(I,u){if(I!==null&&I.child===u.child)return!0;if(u.flags&16)return!1;for(I=u.child;I!==null;){if(I.flags&12854||I.subtreeFlags&12854)return!1;I=I.sibling}return!0}var fu,mu,Hh,Fh;if(ot)fu=function(I,u){for(var y=u.child;y!==null;){if(y.tag===5||y.tag===6)$(I,y.stateNode);else if(y.tag!==4&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===u)break;for(;y.sibling===null;){if(y.return===null||y.return===u)return;y=y.return}y.sibling.return=y.return,y=y.sibling}},mu=function(){},Hh=function(I,u,y,G,S){if(I=I.memoizedProps,I!==G){var N=u.stateNode,Q=os(Qo.current);y=fe(N,y,I,G,S,Q),(u.updateQueue=y)&&ss(u)}},Fh=function(I,u,y,G){y!==G&&ss(u)};else if(ee){fu=function(I,u,y,G){for(var S=u.child;S!==null;){if(S.tag===5){var N=S.stateNode;y&&G&&(N=rn(N,S.type,S.memoizedProps,S)),$(I,N)}else if(S.tag===6)N=S.stateNode,y&&G&&(N=Di(N,S.memoizedProps,S)),$(I,N);else if(S.tag!==4){if(S.tag===22&&S.memoizedState!==null)N=S.child,N!==null&&(N.return=S),fu(I,S,!0,!0);else if(S.child!==null){S.child.return=S,S=S.child;continue}}if(S===u)break;for(;S.sibling===null;){if(S.return===null||S.return===u)return;S=S.return}S.sibling.return=S.return,S=S.sibling}};var NS=function(I,u,y,G){for(var S=u.child;S!==null;){if(S.tag===5){var N=S.stateNode;y&&G&&(N=rn(N,S.type,S.memoizedProps,S)),Cn(I,N)}else if(S.tag===6)N=S.stateNode,y&&G&&(N=Di(N,S.memoizedProps,S)),Cn(I,N);else if(S.tag!==4){if(S.tag===22&&S.memoizedState!==null)N=S.child,N!==null&&(N.return=S),NS(I,S,!0,!0);else if(S.child!==null){S.child.return=S,S=S.child;continue}}if(S===u)break;for(;S.sibling===null;){if(S.return===null||S.return===u)return;S=S.return}S.sibling.return=S.return,S=S.sibling}};mu=function(I,u){var y=u.stateNode;if(!XS(I,u)){I=y.containerInfo;var G=Pt(I);NS(G,u,!1,!1),y.pendingChildren=G,ss(u),Rn(I,G)}},Hh=function(I,u,y,G,S){var N=I.stateNode,Q=I.memoizedProps;if((I=XS(I,u))&&Q===G)u.stateNode=N;else{var le=u.stateNode,Ze=os(Qo.current),Te=null;Q!==G&&(Te=fe(le,y,Q,G,S,Ze)),I&&Te===null?u.stateNode=N:(N=qe(N,Te,y,Q,G,u,I,le),Ie(N,y,G,S,Ze)&&ss(u),u.stateNode=N,I?ss(u):fu(N,u,!1,!1))}},Fh=function(I,u,y,G){y!==G?(I=os(ic.current),y=os(Qo.current),u.stateNode=Ge(G,I,y,u),ss(u)):u.stateNode=I.stateNode}}else mu=function(){},Hh=function(){},Fh=function(){};function bu(I,u){if(!xn)switch(I.tailMode){case"hidden":u=I.tail;for(var y=null;u!==null;)u.alternate!==null&&(y=u),u=u.sibling;y===null?I.tail=null:y.sibling=null;break;case"collapsed":y=I.tail;for(var G=null;y!==null;)y.alternate!==null&&(G=y),y=y.sibling;G===null?u||I.tail===null?I.tail=null:I.tail.sibling=null:G.sibling=null}}function Ni(I){var u=I.alternate!==null&&I.alternate.child===I.child,y=0,G=0;if(u)for(var S=I.child;S!==null;)y|=S.lanes|S.childLanes,G|=S.subtreeFlags&14680064,G|=S.flags&14680064,S.return=I,S=S.sibling;else for(S=I.child;S!==null;)y|=S.lanes|S.childLanes,G|=S.subtreeFlags,G|=S.flags,S.return=I,S=S.sibling;return I.subtreeFlags|=G,I.childLanes=y,u}function j9(I,u,y){var G=u.pendingProps;switch(K0(u),u.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ni(u),null;case 1:return dn(u.type)&&Dn(),Ni(u),null;case 3:return G=u.stateNode,oc(),Zt(Rt),Zt(sn),U0(),G.pendingContext&&(G.context=G.pendingContext,G.pendingContext=null),(I===null||I.child===null)&&(cu(u)?ss(u):I===null||I.memoizedState.isDehydrated&&!(u.flags&256)||(u.flags|=1024,Gr!==null&&(bb(Gr),Gr=null))),mu(I,u),Ni(u),null;case 5:T0(u),y=os(ic.current);var S=u.type;if(I!==null&&u.stateNode!=null)Hh(I,u,S,G,y),I.ref!==u.ref&&(u.flags|=512,u.flags|=2097152);else{if(!G){if(u.stateNode===null)throw Error(s(166));return Ni(u),null}if(I=os(Qo.current),cu(u)){if(!Ne)throw Error(s(175));I=M(u.stateNode,u.type,u.memoizedProps,y,I,u,!gu),u.updateQueue=I,I!==null&&ss(u)}else{var N=J(S,G,y,I,u);fu(N,u,!1,!1),u.stateNode=N,Ie(N,S,G,y,I)&&ss(u)}u.ref!==null&&(u.flags|=512,u.flags|=2097152)}return Ni(u),null;case 6:if(I&&u.stateNode!=null)Fh(I,u,I.memoizedProps,G);else{if(typeof G!="string"&&u.stateNode===null)throw Error(s(166));if(I=os(ic.current),y=os(Qo.current),cu(u)){if(!Ne)throw Error(s(176));if(I=u.stateNode,G=u.memoizedProps,(y=R(I,G,u,!gu))&&(S=Xo,S!==null))switch(N=(S.mode&1)!==0,S.tag){case 3:Be(S.stateNode.containerInfo,I,G,N);break;case 5:Re(S.type,S.memoizedProps,S.stateNode,I,G,N)}y&&ss(u)}else u.stateNode=Ge(G,I,y,u)}return Ni(u),null;case 13:if(Zt(Yn),G=u.memoizedState,xn&&No!==null&&u.mode&1&&!(u.flags&128)){for(I=No;I;)I=xi(I);return tc(),u.flags|=98560,u}if(G!==null&&G.dehydrated!==null){if(G=cu(u),I===null){if(!G)throw Error(s(318));if(!Ne)throw Error(s(344));if(I=u.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(s(317));K(I,u)}else tc(),!(u.flags&128)&&(u.memoizedState=null),u.flags|=4;return Ni(u),null}return Gr!==null&&(bb(Gr),Gr=null),u.flags&128?(u.lanes=y,u):(G=G!==null,y=!1,I===null?cu(u):y=I.memoizedState!==null,G&&!y&&(u.child.flags|=8192,u.mode&1&&(I===null||Yn.current&1?si===0&&(si=3):vb())),u.updateQueue!==null&&(u.flags|=4),Ni(u),null);case 4:return oc(),mu(I,u),I===null&&He(u.stateNode.containerInfo),Ni(u),null;case 10:return X0(u.type._context),Ni(u),null;case 17:return dn(u.type)&&Dn(),Ni(u),null;case 19:if(Zt(Yn),S=u.memoizedState,S===null)return Ni(u),null;if(G=(u.flags&128)!==0,N=S.rendering,N===null)if(G)bu(S,!1);else{if(si!==0||I!==null&&I.flags&128)for(I=u.child;I!==null;){if(N=Rh(I),N!==null){for(u.flags|=128,bu(S,!1),I=N.updateQueue,I!==null&&(u.updateQueue=I,u.flags|=4),u.subtreeFlags=0,I=y,G=u.child;G!==null;)y=G,S=I,y.flags&=14680066,N=y.alternate,N===null?(y.childLanes=0,y.lanes=S,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=N.childLanes,y.lanes=N.lanes,y.child=N.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=N.memoizedProps,y.memoizedState=N.memoizedState,y.updateQueue=N.updateQueue,y.type=N.type,S=N.dependencies,y.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext}),G=G.sibling;return It(Yn,Yn.current&1|2),u.child}I=I.sibling}S.tail!==null&&Ci()>Ab&&(u.flags|=128,G=!0,bu(S,!1),u.lanes=4194304)}else{if(!G)if(I=Rh(N),I!==null){if(u.flags|=128,G=!0,I=I.updateQueue,I!==null&&(u.updateQueue=I,u.flags|=4),bu(S,!0),S.tail===null&&S.tailMode==="hidden"&&!N.alternate&&!xn)return Ni(u),null}else 2*Ci()-S.renderingStartTime>Ab&&y!==1073741824&&(u.flags|=128,G=!0,bu(S,!1),u.lanes=4194304);S.isBackwards?(N.sibling=u.child,u.child=N):(I=S.last,I!==null?I.sibling=N:u.child=N,S.last=N)}return S.tail!==null?(u=S.tail,S.rendering=u,S.tail=u.sibling,S.renderingStartTime=Ci(),u.sibling=null,I=Yn.current,It(Yn,G?I&1|2:I&1),u):(Ni(u),null);case 22:case 23:return yb(),G=u.memoizedState!==null,I!==null&&I.memoizedState!==null!==G&&(u.flags|=8192),G&&u.mode&1?Mo&1073741824&&(Ni(u),ot&&u.subtreeFlags&6&&(u.flags|=8192)):Ni(u),null;case 24:return null;case 25:return null}throw Error(s(156,u.tag))}var q9=a.ReactCurrentOwner,Yo=!1;function Oi(I,u,y,G){u.child=I===null?aS(u,null,y,G):nc(u,I.child,y,G)}function YS(I,u,y,G,S){y=y.render;var N=u.ref;return qg(u,S),G=D0(I,u,y,G,N,S),y=J0(),I!==null&&!Yo?(u.updateQueue=I.updateQueue,u.flags&=-2053,I.lanes&=~S,Ks(I,u,S)):(xn&&y&&F0(u),u.flags|=1,Oi(I,u,G,S),u.child)}function MS(I,u,y,G,S){if(I===null){var N=y.type;return typeof N=="function"&&!Gb(N)&&N.defaultProps===void 0&&y.compare===null&&y.defaultProps===void 0?(u.tag=15,u.type=N,HS(I,u,N,G,S)):(I=oA(y.type,null,G,u,u.mode,S),I.ref=u.ref,I.return=u,u.child=I)}if(N=I.child,!(I.lanes&S)){var Q=N.memoizedProps;if(y=y.compare,y=y!==null?y:mh,y(Q,G)&&I.ref===u.ref)return Ks(I,u,S)}return u.flags|=1,I=Ra(N,G),I.ref=u.ref,I.return=u,u.child=I}function HS(I,u,y,G,S){if(I!==null&&mh(I.memoizedProps,G)&&I.ref===u.ref)if(Yo=!1,(I.lanes&S)!==0)I.flags&131072&&(Yo=!0);else return u.lanes=I.lanes,Ks(I,u,S);return eb(I,u,y,G,S)}function FS(I,u,y){var G=u.pendingProps,S=G.children,N=I!==null?I.memoizedState:null;if(G.mode==="hidden")if(!(u.mode&1))u.memoizedState={baseLanes:0,cachePool:null},It(sc,Mo),Mo|=y;else if(y&1073741824)u.memoizedState={baseLanes:0,cachePool:null},G=N!==null?N.baseLanes:y,It(sc,Mo),Mo|=G;else return I=N!==null?N.baseLanes|y:y,u.lanes=u.childLanes=1073741824,u.memoizedState={baseLanes:I,cachePool:null},u.updateQueue=null,It(sc,Mo),Mo|=I,null;else N!==null?(G=N.baseLanes|y,u.memoizedState=null):G=y,It(sc,Mo),Mo|=G;return Oi(I,u,S,y),u.child}function KS(I,u){var y=u.ref;(I===null&&y!==null||I!==null&&I.ref!==y)&&(u.flags|=512,u.flags|=2097152)}function eb(I,u,y,G,S){var N=dn(y)?an:sn.current;return N=qt(u,N),qg(u,S),y=D0(I,u,y,G,N,S),G=J0(),I!==null&&!Yo?(u.updateQueue=I.updateQueue,u.flags&=-2053,I.lanes&=~S,Ks(I,u,S)):(xn&&G&&F0(u),u.flags|=1,Oi(I,u,y,S),u.child)}function zS(I,u,y,G,S){if(dn(y)){var N=!0;nn(u)}else N=!1;if(qg(u,S),u.stateNode===null)I!==null&&(I.alternate=null,u.alternate=null,u.flags|=2),$w(u,y,G),H0(u,y,G,S),G=!0;else if(I===null){var Q=u.stateNode,le=u.memoizedProps;Q.props=le;var Ze=Q.context,Te=y.contextType;typeof Te=="object"&&Te!==null?Te=Do(Te):(Te=dn(y)?an:sn.current,Te=qt(u,Te));var gt=y.getDerivedStateFromProps,Mt=typeof gt=="function"||typeof Q.getSnapshotBeforeUpdate=="function";Mt||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(le!==G||Ze!==Te)&&eS(u,Q,G,Te),va=!1;var vt=u.memoizedState;Q.state=vt,Gh(u,G,Q,S),Ze=u.memoizedState,le!==G||vt!==Ze||Rt.current||va?(typeof gt=="function"&&(M0(u,y,gt,G),Ze=u.memoizedState),(le=va||qw(u,y,le,G,vt,Ze,Te))?(Mt||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount()),typeof Q.componentDidMount=="function"&&(u.flags|=4194308)):(typeof Q.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=G,u.memoizedState=Ze),Q.props=G,Q.state=Ze,Q.context=Te,G=le):(typeof Q.componentDidMount=="function"&&(u.flags|=4194308),G=!1)}else{Q=u.stateNode,Jw(I,u),le=u.memoizedProps,Te=u.type===u.elementType?le:vr(u.type,le),Q.props=Te,Mt=u.pendingProps,vt=Q.context,Ze=y.contextType,typeof Ze=="object"&&Ze!==null?Ze=Do(Ze):(Ze=dn(y)?an:sn.current,Ze=qt(u,Ze));var mn=y.getDerivedStateFromProps;(gt=typeof mn=="function"||typeof Q.getSnapshotBeforeUpdate=="function")||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(le!==Mt||vt!==Ze)&&eS(u,Q,G,Ze),va=!1,vt=u.memoizedState,Q.state=vt,Gh(u,G,Q,S);var ft=u.memoizedState;le!==Mt||vt!==ft||Rt.current||va?(typeof mn=="function"&&(M0(u,y,mn,G),ft=u.memoizedState),(Te=va||qw(u,y,Te,G,vt,ft,Ze)||!1)?(gt||typeof Q.UNSAFE_componentWillUpdate!="function"&&typeof Q.componentWillUpdate!="function"||(typeof Q.componentWillUpdate=="function"&&Q.componentWillUpdate(G,ft,Ze),typeof Q.UNSAFE_componentWillUpdate=="function"&&Q.UNSAFE_componentWillUpdate(G,ft,Ze)),typeof Q.componentDidUpdate=="function"&&(u.flags|=4),typeof Q.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof Q.componentDidUpdate!="function"||le===I.memoizedProps&&vt===I.memoizedState||(u.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||le===I.memoizedProps&&vt===I.memoizedState||(u.flags|=1024),u.memoizedProps=G,u.memoizedState=ft),Q.props=G,Q.state=ft,Q.context=Ze,G=Te):(typeof Q.componentDidUpdate!="function"||le===I.memoizedProps&&vt===I.memoizedState||(u.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||le===I.memoizedProps&&vt===I.memoizedState||(u.flags|=1024),G=!1)}return tb(I,u,y,G,N,S)}function tb(I,u,y,G,S,N){KS(I,u);var Q=(u.flags&128)!==0;if(!G&&!Q)return S&&Jt(u,y,!1),Ks(I,u,N);G=u.stateNode,q9.current=u;var le=Q&&typeof y.getDerivedStateFromError!="function"?null:G.render();return u.flags|=1,I!==null&&Q?(u.child=nc(u,I.child,null,N),u.child=nc(u,null,le,N)):Oi(I,u,le,N),u.memoizedState=G.state,S&&Jt(u,y,!0),u.child}function LS(I){var u=I.stateNode;u.pendingContext?Vt(I,u.pendingContext,u.pendingContext!==u.context):u.context&&Vt(I,u.context,!1),k0(I,u.containerInfo)}function ES(I,u,y,G,S){return tc(),E0(S),u.flags|=256,Oi(I,u,y,G),u.child}var Kh={dehydrated:null,treeContext:null,retryLane:0};function zh(I){return{baseLanes:I,cachePool:null}}function kS(I,u,y){var G=u.pendingProps,S=Yn.current,N=!1,Q=(u.flags&128)!==0,le;if((le=Q)||(le=I!==null&&I.memoizedState===null?!1:(S&2)!==0),le?(N=!0,u.flags&=-129):(I===null||I.memoizedState!==null)&&(S|=1),It(Yn,S&1),I===null)return L0(u),I=u.memoizedState,I!==null&&(I=I.dehydrated,I!==null)?(u.mode&1?jr(I)?u.lanes=8:u.lanes=1073741824:u.lanes=1,null):(S=G.children,I=G.fallback,N?(G=u.mode,N=u.child,S={mode:"hidden",children:S},!(G&1)&&N!==null?(N.childLanes=0,N.pendingProps=S):N=rA(S,G,0,null),I=Fl(I,G,y,null),N.return=u,I.return=u,N.sibling=I,u.child=N,u.child.memoizedState=zh(y),u.memoizedState=Kh,I):nb(u,S));if(S=I.memoizedState,S!==null){if(le=S.dehydrated,le!==null){if(Q)return u.flags&256?(u.flags&=-257,Lh(I,u,y,Error(s(422)))):u.memoizedState!==null?(u.child=I.child,u.flags|=128,null):(N=G.fallback,S=u.mode,G=rA({mode:"visible",children:G.children},S,0,null),N=Fl(N,S,y,null),N.flags|=2,G.return=u,N.return=u,G.sibling=N,u.child=G,u.mode&1&&nc(u,I.child,null,y),u.child.memoizedState=zh(y),u.memoizedState=Kh,N);if(!(u.mode&1))u=Lh(I,u,y,null);else if(jr(le))u=Lh(I,u,y,Error(s(419)));else if(G=(y&I.childLanes)!==0,Yo||G){if(G=$n,G!==null){switch(y&-y){case 4:N=2;break;case 16:N=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:N=32;break;case 536870912:N=268435456;break;default:N=0}G=N&(G.suspendedLanes|y)?0:N,G!==0&&G!==S.retryLane&&(S.retryLane=G,qo(I,G,-1))}vb(),u=Lh(I,u,y,Error(s(421)))}else Vs(le)?(u.flags|=128,u.child=I.child,u=Iz.bind(null,I),qr(le,u),u=null):(y=S.treeContext,Ne&&(No=su(le),Xo=u,xn=!0,Gr=null,gu=!1,y!==null&&(Jo[Oo++]=Ms,Jo[Oo++]=Hs,Jo[Oo++]=Wl,Ms=y.id,Hs=y.overflow,Wl=u)),u=nb(u,u.pendingProps.children),u.flags|=4096);return u}return N?(G=_S(I,u,G.children,G.fallback,y),N=u.child,S=I.child.memoizedState,N.memoizedState=S===null?zh(y):{baseLanes:S.baseLanes|y,cachePool:null},N.childLanes=I.childLanes&~y,u.memoizedState=Kh,G):(y=TS(I,u,G.children,y),u.memoizedState=null,y)}return N?(G=_S(I,u,G.children,G.fallback,y),N=u.child,S=I.child.memoizedState,N.memoizedState=S===null?zh(y):{baseLanes:S.baseLanes|y,cachePool:null},N.childLanes=I.childLanes&~y,u.memoizedState=Kh,G):(y=TS(I,u,G.children,y),u.memoizedState=null,y)}function nb(I,u){return u=rA({mode:"visible",children:u},I.mode,0,null),u.return=I,I.child=u}function TS(I,u,y,G){var S=I.child;return I=S.sibling,y=Ra(S,{mode:"visible",children:y}),!(u.mode&1)&&(y.lanes=G),y.return=u,y.sibling=null,I!==null&&(G=u.deletions,G===null?(u.deletions=[I],u.flags|=16):G.push(I)),u.child=y}function _S(I,u,y,G,S){var N=u.mode;I=I.child;var Q=I.sibling,le={mode:"hidden",children:y};return!(N&1)&&u.child!==I?(y=u.child,y.childLanes=0,y.pendingProps=le,u.deletions=null):(y=Ra(I,le),y.subtreeFlags=I.subtreeFlags&14680064),Q!==null?G=Ra(Q,G):(G=Fl(G,N,S,null),G.flags|=2),G.return=u,y.return=u,y.sibling=G,u.child=y,G}function Lh(I,u,y,G){return G!==null&&E0(G),nc(u,I.child,null,y),I=nb(u,u.pendingProps.children),I.flags|=2,u.memoizedState=null,I}function US(I,u,y){I.lanes|=u;var G=I.alternate;G!==null&&(G.lanes|=u),N0(I.return,u,y)}function ib(I,u,y,G,S){var N=I.memoizedState;N===null?I.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:G,tail:y,tailMode:S}:(N.isBackwards=u,N.rendering=null,N.renderingStartTime=0,N.last=G,N.tail=y,N.tailMode=S)}function PS(I,u,y){var G=u.pendingProps,S=G.revealOrder,N=G.tail;if(Oi(I,u,G.children,y),G=Yn.current,G&2)G=G&1|2,u.flags|=128;else{if(I!==null&&I.flags&128)e:for(I=u.child;I!==null;){if(I.tag===13)I.memoizedState!==null&&US(I,y,u);else if(I.tag===19)US(I,y,u);else if(I.child!==null){I.child.return=I,I=I.child;continue}if(I===u)break e;for(;I.sibling===null;){if(I.return===null||I.return===u)break e;I=I.return}I.sibling.return=I.return,I=I.sibling}G&=1}if(It(Yn,G),!(u.mode&1))u.memoizedState=null;else switch(S){case"forwards":for(y=u.child,S=null;y!==null;)I=y.alternate,I!==null&&Rh(I)===null&&(S=y),y=y.sibling;y=S,y===null?(S=u.child,u.child=null):(S=y.sibling,y.sibling=null),ib(u,!1,S,y,N);break;case"backwards":for(y=null,S=u.child,u.child=null;S!==null;){if(I=S.alternate,I!==null&&Rh(I)===null){u.child=S;break}I=S.sibling,S.sibling=y,y=S,S=I}ib(u,!0,y,null,N);break;case"together":ib(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function Ks(I,u,y){if(I!==null&&(u.dependencies=I.dependencies),ac|=u.lanes,!(y&u.childLanes))return null;if(I!==null&&u.child!==I.child)throw Error(s(153));if(u.child!==null){for(I=u.child,y=Ra(I,I.pendingProps),u.child=y,y.return=u;I.sibling!==null;)I=I.sibling,y=y.sibling=Ra(I,I.pendingProps),y.return=u;y.sibling=null}return u.child}function $9(I,u,y){switch(u.tag){case 3:LS(u),tc();break;case 5:lS(u);break;case 1:dn(u.type)&&nn(u);break;case 4:k0(u,u.stateNode.containerInfo);break;case 10:Dw(u,u.type._context,u.memoizedProps.value);break;case 13:var G=u.memoizedState;if(G!==null)return G.dehydrated!==null?(It(Yn,Yn.current&1),u.flags|=128,null):y&u.child.childLanes?kS(I,u,y):(It(Yn,Yn.current&1),I=Ks(I,u,y),I!==null?I.sibling:null);It(Yn,Yn.current&1);break;case 19:if(G=(y&u.childLanes)!==0,I.flags&128){if(G)return PS(I,u,y);u.flags|=128}var S=u.memoizedState;if(S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),It(Yn,Yn.current),G)break;return null;case 22:case 23:return u.lanes=0,FS(I,u,y)}return Ks(I,u,y)}function ez(I,u){switch(K0(u),u.tag){case 1:return dn(u.type)&&Dn(),I=u.flags,I&65536?(u.flags=I&-65537|128,u):null;case 3:return oc(),Zt(Rt),Zt(sn),U0(),I=u.flags,I&65536&&!(I&128)?(u.flags=I&-65537|128,u):null;case 5:return T0(u),null;case 13:if(Zt(Yn),I=u.memoizedState,I!==null&&I.dehydrated!==null){if(u.alternate===null)throw Error(s(340));tc()}return I=u.flags,I&65536?(u.flags=I&-65537|128,u):null;case 19:return Zt(Yn),null;case 4:return oc(),null;case 10:return X0(u.type._context),null;case 22:case 23:return yb(),null;case 24:return null;default:return null}}var Eh=!1,Xl=!1,tz=typeof WeakSet=="function"?WeakSet:Set,$e=null;function kh(I,u){var y=I.ref;if(y!==null)if(typeof y=="function")try{y(null)}catch(G){ho(I,u,G)}else y.current=null}function ob(I,u,y){try{y()}catch(G){ho(I,u,G)}}var DS=!1;function nz(I,u){for(D(I.containerInfo),$e=u;$e!==null;)if(I=$e,u=I.child,(I.subtreeFlags&1028)!==0&&u!==null)u.return=I,$e=u;else for(;$e!==null;){I=$e;try{var y=I.alternate;if(I.flags&1024)switch(I.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var G=y.memoizedProps,S=y.memoizedState,N=I.stateNode,Q=N.getSnapshotBeforeUpdate(I.elementType===I.type?G:vr(I.type,G),S);N.__reactInternalSnapshotBeforeUpdate=Q}break;case 3:ot&&Le(I.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(le){ho(I,I.return,le)}if(u=I.sibling,u!==null){u.return=I.return,$e=u;break}$e=I.return}return y=DS,DS=!1,y}function Nl(I,u,y){var G=u.updateQueue;if(G=G!==null?G.lastEffect:null,G!==null){var S=G=G.next;do{if((S.tag&I)===I){var N=S.destroy;S.destroy=void 0,N!==void 0&&ob(u,y,N)}S=S.next}while(S!==G)}}function yu(I,u){if(u=u.updateQueue,u=u!==null?u.lastEffect:null,u!==null){var y=u=u.next;do{if((y.tag&I)===I){var G=y.create;y.destroy=G()}y=y.next}while(y!==u)}}function rb(I){var u=I.ref;if(u!==null){var y=I.stateNode;switch(I.tag){case 5:I=re(y);break;default:I=y}typeof u=="function"?u(I):u.current=I}}function JS(I,u,y){if(es&&typeof es.onCommitFiberUnmount=="function")try{es.onCommitFiberUnmount(ph,u)}catch{}switch(u.tag){case 0:case 11:case 14:case 15:if(I=u.updateQueue,I!==null&&(I=I.lastEffect,I!==null)){var G=I=I.next;do{var S=G,N=S.destroy;S=S.tag,N!==void 0&&(S&2||S&4)&&ob(u,y,N),G=G.next}while(G!==I)}break;case 1:if(kh(u,y),I=u.stateNode,typeof I.componentWillUnmount=="function")try{I.props=u.memoizedProps,I.state=u.memoizedState,I.componentWillUnmount()}catch(Q){ho(u,y,Q)}break;case 5:kh(u,y);break;case 4:ot?eR(I,u,y):ee&&ee&&(u=u.stateNode.containerInfo,y=Pt(u),Vo(u,y))}}function OS(I,u,y){for(var G=u;;)if(JS(I,G,y),G.child===null||ot&&G.tag===4){if(G===u)break;for(;G.sibling===null;){if(G.return===null||G.return===u)return;G=G.return}G.sibling.return=G.return,G=G.sibling}else G.child.return=G,G=G.child}function QS(I){var u=I.alternate;u!==null&&(I.alternate=null,QS(u)),I.child=null,I.deletions=null,I.sibling=null,I.tag===5&&(u=I.stateNode,u!==null&&at(u)),I.stateNode=null,I.return=null,I.dependencies=null,I.memoizedProps=null,I.memoizedState=null,I.pendingProps=null,I.stateNode=null,I.updateQueue=null}function jS(I){return I.tag===5||I.tag===3||I.tag===4}function qS(I){e:for(;;){for(;I.sibling===null;){if(I.return===null||jS(I.return))return null;I=I.return}for(I.sibling.return=I.return,I=I.sibling;I.tag!==5&&I.tag!==6&&I.tag!==18;){if(I.flags&2||I.child===null||I.tag===4)continue e;I.child.return=I,I=I.child}if(!(I.flags&2))return I.stateNode}}function $S(I){if(ot){e:{for(var u=I.return;u!==null;){if(jS(u))break e;u=u.return}throw Error(s(160))}var y=u;switch(y.tag){case 5:u=y.stateNode,y.flags&32&&(lt(u),y.flags&=-33),y=qS(I),ab(I,y,u);break;case 3:case 4:u=y.stateNode.containerInfo,y=qS(I),sb(I,y,u);break;default:throw Error(s(161))}}}function sb(I,u,y){var G=I.tag;if(G===5||G===6)I=I.stateNode,u?xe(y,I,u):tt(y,I);else if(G!==4&&(I=I.child,I!==null))for(sb(I,u,y),I=I.sibling;I!==null;)sb(I,u,y),I=I.sibling}function ab(I,u,y){var G=I.tag;if(G===5||G===6)I=I.stateNode,u?me(y,I,u):Fe(y,I);else if(G!==4&&(I=I.child,I!==null))for(ab(I,u,y),I=I.sibling;I!==null;)ab(I,u,y),I=I.sibling}function eR(I,u,y){for(var G=u,S=!1,N,Q;;){if(!S){S=G.return;e:for(;;){if(S===null)throw Error(s(160));switch(N=S.stateNode,S.tag){case 5:Q=!1;break e;case 3:N=N.containerInfo,Q=!0;break e;case 4:N=N.containerInfo,Q=!0;break e}S=S.return}S=!0}if(G.tag===5||G.tag===6)OS(I,G,y),Q?ke(N,G.stateNode):Ke(N,G.stateNode);else if(G.tag===18)Q?he(N,G.stateNode):ue(N,G.stateNode);else if(G.tag===4){if(G.child!==null){N=G.stateNode.containerInfo,Q=!0,G.child.return=G,G=G.child;continue}}else if(JS(I,G,y),G.child!==null){G.child.return=G,G=G.child;continue}if(G===u)break;for(;G.sibling===null;){if(G.return===null||G.return===u)return;G=G.return,G.tag===4&&(S=!1)}G.sibling.return=G.return,G=G.sibling}}function lb(I,u){if(ot){switch(u.tag){case 0:case 11:case 14:case 15:Nl(3,u,u.return),yu(3,u),Nl(5,u,u.return);return;case 1:return;case 5:var y=u.stateNode;if(y!=null){var G=u.memoizedProps;I=I!==null?I.memoizedProps:G;var S=u.type,N=u.updateQueue;u.updateQueue=null,N!==null&&ie(y,N,S,I,G,u)}return;case 6:if(u.stateNode===null)throw Error(s(162));y=u.memoizedProps,ze(u.stateNode,I!==null?I.memoizedProps:y,y);return;case 3:Ne&&I!==null&&I.memoizedState.isDehydrated&&k(u.stateNode.containerInfo);return;case 12:return;case 13:Th(u);return;case 19:Th(u);return;case 17:return}throw Error(s(163))}switch(u.tag){case 0:case 11:case 14:case 15:Nl(3,u,u.return),yu(3,u),Nl(5,u,u.return);return;case 12:return;case 13:Th(u);return;case 19:Th(u);return;case 3:Ne&&I!==null&&I.memoizedState.isDehydrated&&k(u.stateNode.containerInfo);break;case 22:case 23:return}e:if(ee){switch(u.tag){case 1:case 5:case 6:break e;case 3:case 4:u=u.stateNode,Vo(u.containerInfo,u.pendingChildren);break e}throw Error(s(163))}}function Th(I){var u=I.updateQueue;if(u!==null){I.updateQueue=null;var y=I.stateNode;y===null&&(y=I.stateNode=new tz),u.forEach(function(G){var S=uz.bind(null,I,G);y.has(G)||(y.add(G),G.then(S,S))})}}function iz(I,u){for($e=u;$e!==null;){u=$e;var y=u.deletions;if(y!==null)for(var G=0;G<y.length;G++){var S=y[G];try{var N=I;ot?eR(N,S,u):OS(N,S,u);var Q=S.alternate;Q!==null&&(Q.return=null),S.return=null}catch(dt){ho(S,u,dt)}}if(y=u.child,u.subtreeFlags&12854&&y!==null)y.return=u,$e=y;else for(;$e!==null;){u=$e;try{var le=u.flags;if(le&32&&ot&&lt(u.stateNode),le&512){var Ze=u.alternate;if(Ze!==null){var Te=Ze.ref;Te!==null&&(typeof Te=="function"?Te(null):Te.current=null)}}if(le&8192)switch(u.tag){case 13:if(u.memoizedState!==null){var gt=u.alternate;(gt===null||gt.memoizedState===null)&&(hb=Ci())}break;case 22:var Mt=u.memoizedState!==null,vt=u.alternate,mn=vt!==null&&vt.memoizedState!==null;if(y=u,ot){e:if(G=y,S=Mt,N=null,ot)for(var ft=G;;){if(ft.tag===5){if(N===null){N=ft;var Yi=ft.stateNode;S?mt(Yi):pe(ft.stateNode,ft.memoizedProps)}}else if(ft.tag===6){if(N===null){var er=ft.stateNode;S?ae(er):Ce(er,ft.memoizedProps)}}else if((ft.tag!==22&&ft.tag!==23||ft.memoizedState===null||ft===G)&&ft.child!==null){ft.child.return=ft,ft=ft.child;continue}if(ft===G)break;for(;ft.sibling===null;){if(ft.return===null||ft.return===G)break e;N===ft&&(N=null),ft=ft.return}N===ft&&(N=null),ft.sibling.return=ft.return,ft=ft.sibling}}if(Mt&&!mn&&y.mode&1){$e=y;for(var de=y.child;de!==null;){for(y=$e=de;$e!==null;){G=$e;var ge=G.child;switch(G.tag){case 0:case 11:case 14:case 15:Nl(4,G,G.return);break;case 1:kh(G,G.return);var be=G.stateNode;if(typeof be.componentWillUnmount=="function"){var it=G.return;try{be.props=G.memoizedProps,be.state=G.memoizedState,be.componentWillUnmount()}catch(dt){ho(G,it,dt)}}break;case 5:kh(G,G.return);break;case 22:if(G.memoizedState!==null){iR(y);continue}}ge!==null?(ge.return=G,$e=ge):iR(y)}de=de.sibling}}}switch(le&4102){case 2:$S(u),u.flags&=-3;break;case 6:$S(u),u.flags&=-3,lb(u.alternate,u);break;case 4096:u.flags&=-4097;break;case 4100:u.flags&=-4097,lb(u.alternate,u);break;case 4:lb(u.alternate,u)}}catch(dt){ho(u,u.return,dt)}if(y=u.sibling,y!==null){y.return=u.return,$e=y;break}$e=u.return}}}function oz(I,u,y){$e=I,tR(I)}function tR(I,u,y){for(var G=(I.mode&1)!==0;$e!==null;){var S=$e,N=S.child;if(S.tag===22&&G){var Q=S.memoizedState!==null||Eh;if(!Q){var le=S.alternate,Ze=le!==null&&le.memoizedState!==null||Xl;le=Eh;var Te=Xl;if(Eh=Q,(Xl=Ze)&&!Te)for($e=S;$e!==null;)Q=$e,Ze=Q.child,Q.tag===22&&Q.memoizedState!==null?oR(S):Ze!==null?(Ze.return=Q,$e=Ze):oR(S);for(;N!==null;)$e=N,tR(N),N=N.sibling;$e=S,Eh=le,Xl=Te}nR(I)}else S.subtreeFlags&8772&&N!==null?(N.return=S,$e=N):nR(I)}}function nR(I){for(;$e!==null;){var u=$e;if(u.flags&8772){var y=u.alternate;try{if(u.flags&8772)switch(u.tag){case 0:case 11:case 15:Xl||yu(5,u);break;case 1:var G=u.stateNode;if(u.flags&4&&!Xl)if(y===null)G.componentDidMount();else{var S=u.elementType===u.type?y.memoizedProps:vr(u.type,y.memoizedProps);G.componentDidUpdate(S,y.memoizedState,G.__reactInternalSnapshotBeforeUpdate)}var N=u.updateQueue;N!==null&&Qw(u,N,G);break;case 3:var Q=u.updateQueue;if(Q!==null){if(y=null,u.child!==null)switch(u.child.tag){case 5:y=re(u.child.stateNode);break;case 1:y=u.child.stateNode}Qw(u,Q,y)}break;case 5:var le=u.stateNode;y===null&&u.flags&4&&Ae(le,u.type,u.memoizedProps,u);break;case 6:break;case 4:break;case 12:break;case 13:if(Ne&&u.memoizedState===null){var Ze=u.alternate;if(Ze!==null){var Te=Ze.memoizedState;if(Te!==null){var gt=Te.dehydrated;gt!==null&&j(gt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(s(163))}Xl||u.flags&512&&rb(u)}catch(Mt){ho(u,u.return,Mt)}}if(u===I){$e=null;break}if(y=u.sibling,y!==null){y.return=u.return,$e=y;break}$e=u.return}}function iR(I){for(;$e!==null;){var u=$e;if(u===I){$e=null;break}var y=u.sibling;if(y!==null){y.return=u.return,$e=y;break}$e=u.return}}function oR(I){for(;$e!==null;){var u=$e;try{switch(u.tag){case 0:case 11:case 15:var y=u.return;try{yu(4,u)}catch(Ze){ho(u,y,Ze)}break;case 1:var G=u.stateNode;if(typeof G.componentDidMount=="function"){var S=u.return;try{G.componentDidMount()}catch(Ze){ho(u,S,Ze)}}var N=u.return;try{rb(u)}catch(Ze){ho(u,N,Ze)}break;case 5:var Q=u.return;try{rb(u)}catch(Ze){ho(u,Q,Ze)}}}catch(Ze){ho(u,u.return,Ze)}if(u===I){$e=null;break}var le=u.sibling;if(le!==null){le.return=u.return,$e=le;break}$e=u.return}}var _h=0,Uh=1,Ph=2,Dh=3,Jh=4;if(typeof Symbol=="function"&&Symbol.for){var vu=Symbol.for;_h=vu("selector.component"),Uh=vu("selector.has_pseudo_class"),Ph=vu("selector.role"),Dh=vu("selector.test_id"),Jh=vu("selector.text")}function gb(I){var u=Se(I);if(u!=null){if(typeof u.memoizedProps["data-testname"]!="string")throw Error(s(364));return u}if(I=xt(I),I===null)throw Error(s(362));return I.stateNode.current}function cb(I,u){switch(u.$$typeof){case _h:if(I.type===u.value)return!0;break;case Uh:e:{u=u.value,I=[I,0];for(var y=0;y<I.length;){var G=I[y++],S=I[y++],N=u[S];if(G.tag!==5||!F(G)){for(;N!=null&&cb(G,N);)S++,N=u[S];if(S===u.length){u=!0;break e}else for(G=G.child;G!==null;)I.push(G,S),G=G.sibling}}u=!1}return u;case Ph:if(I.tag===5&&ce(I.stateNode,u.value))return!0;break;case Jh:if((I.tag===5||I.tag===6)&&(I=L(I),I!==null&&0<=I.indexOf(u.value)))return!0;break;case Dh:if(I.tag===5&&(I=I.memoizedProps["data-testname"],typeof I=="string"&&I.toLowerCase()===u.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function Ib(I){switch(I.$$typeof){case _h:return"<"+(W(I.value)||"Unknown")+">";case Uh:return":has("+(Ib(I)||"")+")";case Ph:return'[role="'+I.value+'"]';case Jh:return'"'+I.value+'"';case Dh:return'[data-testname="'+I.value+'"]';default:throw Error(s(365))}}function rR(I,u){var y=[];I=[I,0];for(var G=0;G<I.length;){var S=I[G++],N=I[G++],Q=u[N];if(S.tag!==5||!F(S)){for(;Q!=null&&cb(S,Q);)N++,Q=u[N];if(N===u.length)y.push(S);else for(S=S.child;S!==null;)I.push(S,N),S=S.sibling}}return y}function ub(I,u){if(!ut)throw Error(s(363));I=gb(I),I=rR(I,u),u=[],I=Array.from(I);for(var y=0;y<I.length;){var G=I[y++];if(G.tag===5)F(G)||u.push(G.stateNode);else for(G=G.child;G!==null;)I.push(G),G=G.sibling}return u}var rz=Math.ceil,Oh=a.ReactCurrentDispatcher,Cb=a.ReactCurrentOwner,Jn=a.ReactCurrentBatchConfig,Ut=0,$n=null,ei=null,vi=0,Mo=0,sc=nt(0),si=0,Gu=null,ac=0,Qh=0,db=0,Bu=null,uo=null,hb=0,Ab=1/0;function lc(){Ab=Ci()+500}var jh=!1,pb=null,Ba=null,qh=!1,Za=null,$h=0,Zu=0,fb=null,eA=-1,tA=0;function Qi(){return Ut&6?Ci():eA!==-1?eA:eA=Ci()}function wa(I){return I.mode&1?Ut&2&&vi!==0?vi&-vi:E9.transition!==null?(tA===0&&(I=dh,dh<<=1,!(dh&4194240)&&(dh=64),tA=I),tA):(I=$t,I!==0?I:Ve()):1}function qo(I,u,y){if(50<Zu)throw Zu=0,fb=null,Error(s(185));var G=nA(I,u);return G===null?null:(lu(G,u,y),(!(Ut&2)||G!==$n)&&(G===$n&&(!(Ut&2)&&(Qh|=u),si===4&&Sa(G,vi)),Co(G,y),u===1&&Ut===0&&!(I.mode&1)&&(lc(),fh&&ns())),G)}function nA(I,u){I.lanes|=u;var y=I.alternate;for(y!==null&&(y.lanes|=u),y=I,I=I.return;I!==null;)I.childLanes|=u,y=I.alternate,y!==null&&(y.childLanes|=u),y=I,I=I.return;return y.tag===3?y.stateNode:null}function Co(I,u){var y=I.callbackNode;X9(I,u);var G=Ah(I,I===$n?vi:0);if(G===0)y!==null&&Uw(y),I.callbackNode=null,I.callbackPriority=0;else if(u=G&-G,I.callbackPriority!==u){if(y!=null&&Uw(y),u===1)I.tag===0?L9(aR.bind(null,I)):Pw(aR.bind(null,I)),Qe?et(function(){Ut===0&&ns()}):w0(S0,ns),y=null;else{switch(_w(G)){case 1:y=S0;break;case 4:y=H9;break;case 16:y=R0;break;case 536870912:y=F9;break;default:y=R0}y=AR(y,sR.bind(null,I))}I.callbackPriority=u,I.callbackNode=y}}function sR(I,u){if(eA=-1,tA=0,Ut&6)throw Error(s(327));var y=I.callbackNode;if(Hl()&&I.callbackNode!==y)return null;var G=Ah(I,I===$n?vi:0);if(G===0)return null;if(G&30||G&I.expiredLanes||u)u=iA(I,G);else{u=G;var S=Ut;Ut|=2;var N=cR();($n!==I||vi!==u)&&(lc(),Yl(I,u));do try{lz();break}catch(le){gR(I,le)}while(1);V0(),Oh.current=N,Ut=S,ei!==null?u=0:($n=null,vi=0,u=si)}if(u!==0){if(u===2&&(S=G0(I),S!==0&&(G=S,u=mb(I,S))),u===1)throw y=Gu,Yl(I,0),Sa(I,G),Co(I,Ci()),y;if(u===6)Sa(I,G);else{if(S=I.current.alternate,!(G&30)&&!sz(S)&&(u=iA(I,G),u===2&&(N=G0(I),N!==0&&(G=N,u=mb(I,N))),u===1))throw y=Gu,Yl(I,0),Sa(I,G),Co(I,Ci()),y;switch(I.finishedWork=S,I.finishedLanes=G,u){case 0:case 1:throw Error(s(345));case 2:Ml(I,uo);break;case 3:if(Sa(I,G),(G&130023424)===G&&(u=hb+500-Ci(),10<u)){if(Ah(I,0)!==0)break;if(S=I.suspendedLanes,(S&G)!==G){Qi(),I.pingedLanes|=I.suspendedLanes&S;break}I.timeoutHandle=Me(Ml.bind(null,I,uo),u);break}Ml(I,uo);break;case 4:if(Sa(I,G),(G&4194240)===G)break;for(u=I.eventTimes,S=-1;0<G;){var Q=31-Wn(G);N=1<<Q,Q=u[Q],Q>S&&(S=Q),G&=~N}if(G=S,G=Ci()-G,G=(120>G?120:480>G?480:1080>G?1080:1920>G?1920:3e3>G?3e3:4320>G?4320:1960*rz(G/1960))-G,10<G){I.timeoutHandle=Me(Ml.bind(null,I,uo),G);break}Ml(I,uo);break;case 5:Ml(I,uo);break;default:throw Error(s(329))}}}return Co(I,Ci()),I.callbackNode===y?sR.bind(null,I):null}function mb(I,u){var y=Bu;return I.current.memoizedState.isDehydrated&&(Yl(I,u).flags|=256),I=iA(I,u),I!==2&&(u=uo,uo=y,u!==null&&bb(u)),I}function bb(I){uo===null?uo=I:uo.push.apply(uo,I)}function sz(I){for(var u=I;;){if(u.flags&16384){var y=u.updateQueue;if(y!==null&&(y=y.stores,y!==null))for(var G=0;G<y.length;G++){var S=y[G],N=S.getSnapshot;S=S.value;try{if(!ts(N(),S))return!1}catch{return!1}}}if(y=u.child,u.subtreeFlags&16384&&y!==null)y.return=u,u=y;else{if(u===I)break;for(;u.sibling===null;){if(u.return===null||u.return===I)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function Sa(I,u){for(u&=~db,u&=~Qh,I.suspendedLanes|=u,I.pingedLanes&=~u,I=I.expirationTimes;0<u;){var y=31-Wn(u),G=1<<y;I[y]=-1,u&=~G}}function aR(I){if(Ut&6)throw Error(s(327));Hl();var u=Ah(I,0);if(!(u&1))return Co(I,Ci()),null;var y=iA(I,u);if(I.tag!==0&&y===2){var G=G0(I);G!==0&&(u=G,y=mb(I,G))}if(y===1)throw y=Gu,Yl(I,0),Sa(I,u),Co(I,Ci()),y;if(y===6)throw Error(s(345));return I.finishedWork=I.current.alternate,I.finishedLanes=u,Ml(I,uo),Co(I,Ci()),null}function lR(I){Za!==null&&Za.tag===0&&!(Ut&6)&&Hl();var u=Ut;Ut|=1;var y=Jn.transition,G=$t;try{if(Jn.transition=null,$t=1,I)return I()}finally{$t=G,Jn.transition=y,Ut=u,!(Ut&6)&&ns()}}function yb(){Mo=sc.current,Zt(sc)}function Yl(I,u){I.finishedWork=null,I.finishedLanes=0;var y=I.timeoutHandle;if(y!==Bt&&(I.timeoutHandle=Bt,_e(y)),ei!==null)for(y=ei.return;y!==null;){var G=y;switch(K0(G),G.tag){case 1:G=G.type.childContextTypes,G!=null&&Dn();break;case 3:oc(),Zt(Rt),Zt(sn),U0();break;case 5:T0(G);break;case 4:oc();break;case 13:Zt(Yn);break;case 19:Zt(Yn);break;case 10:X0(G.type._context);break;case 22:case 23:yb()}y=y.return}if($n=I,ei=I=Ra(I.current,null),vi=Mo=u,si=0,Gu=null,db=Qh=ac=0,uo=Bu=null,is!==null){for(u=0;u<is.length;u++)if(y=is[u],G=y.interleaved,G!==null){y.interleaved=null;var S=G.next,N=y.pending;if(N!==null){var Q=N.next;N.next=S,G.next=Q}y.pending=G}is=null}return I}function gR(I,u){do{var y=ei;try{if(V0(),Wh.current=Mh,xh){for(var G=kn.memoizedState;G!==null;){var S=G.queue;S!==null&&(S.pending=null),G=G.next}xh=!1}if(rc=0,di=Vi=kn=null,du=!1,hu=0,Cb.current=null,y===null||y.return===null){si=1,Gu=u,ei=null;break}e:{var N=I,Q=y.return,le=y,Ze=u;if(u=vi,le.flags|=32768,Ze!==null&&typeof Ze=="object"&&typeof Ze.then=="function"){var Te=Ze,gt=le,Mt=gt.tag;if(!(gt.mode&1)&&(Mt===0||Mt===11||Mt===15)){var vt=gt.alternate;vt?(gt.updateQueue=vt.updateQueue,gt.memoizedState=vt.memoizedState,gt.lanes=vt.lanes):(gt.updateQueue=null,gt.memoizedState=null)}var mn=xS(Q);if(mn!==null){mn.flags&=-257,VS(mn,Q,le,N,u),mn.mode&1&&WS(N,Te,u),u=mn,Ze=Te;var ft=u.updateQueue;if(ft===null){var Yi=new Set;Yi.add(Ze),u.updateQueue=Yi}else ft.add(Ze);break e}else{if(!(u&1)){WS(N,Te,u),vb();break e}Ze=Error(s(426))}}else if(xn&&le.mode&1){var er=xS(Q);if(er!==null){!(er.flags&65536)&&(er.flags|=256),VS(er,Q,le,N,u),E0(Ze);break e}}N=Ze,si!==4&&(si=2),Bu===null?Bu=[N]:Bu.push(N),Ze=q0(Ze,le),le=Q;do{switch(le.tag){case 3:le.flags|=65536,u&=-u,le.lanes|=u;var de=SS(le,Ze,u);Ow(le,de);break e;case 1:N=Ze;var ge=le.type,be=le.stateNode;if(!(le.flags&128)&&(typeof ge.getDerivedStateFromError=="function"||be!==null&&typeof be.componentDidCatch=="function"&&(Ba===null||!Ba.has(be)))){le.flags|=65536,u&=-u,le.lanes|=u;var it=RS(le,N,u);Ow(le,it);break e}}le=le.return}while(le!==null)}uR(y)}catch(dt){u=dt,ei===y&&y!==null&&(ei=y=y.return);continue}break}while(1)}function cR(){var I=Oh.current;return Oh.current=Mh,I===null?Mh:I}function vb(){(si===0||si===3||si===2)&&(si=4),$n===null||!(ac&268435455)&&!(Qh&268435455)||Sa($n,vi)}function iA(I,u){var y=Ut;Ut|=2;var G=cR();$n===I&&vi===u||Yl(I,u);do try{az();break}catch(S){gR(I,S)}while(1);if(V0(),Ut=y,Oh.current=G,ei!==null)throw Error(s(261));return $n=null,vi=0,si}function az(){for(;ei!==null;)IR(ei)}function lz(){for(;ei!==null&&!Y9();)IR(ei)}function IR(I){var u=hR(I.alternate,I,Mo);I.memoizedProps=I.pendingProps,u===null?uR(I):ei=u,Cb.current=null}function uR(I){var u=I;do{var y=u.alternate;if(I=u.return,u.flags&32768){if(y=ez(y,u),y!==null){y.flags&=32767,ei=y;return}if(I!==null)I.flags|=32768,I.subtreeFlags=0,I.deletions=null;else{si=6,ei=null;return}}else if(y=j9(y,u,Mo),y!==null){ei=y;return}if(u=u.sibling,u!==null){ei=u;return}ei=u=I}while(u!==null);si===0&&(si=5)}function Ml(I,u){var y=$t,G=Jn.transition;try{Jn.transition=null,$t=1,gz(I,u,y)}finally{Jn.transition=G,$t=y}return null}function gz(I,u,y){do Hl();while(Za!==null);if(Ut&6)throw Error(s(327));var G=I.finishedWork,S=I.finishedLanes;if(G===null)return null;if(I.finishedWork=null,I.finishedLanes=0,G===I.current)throw Error(s(177));I.callbackNode=null,I.callbackPriority=0;var N=G.lanes|G.childLanes;if(N9(I,N),I===$n&&(ei=$n=null,vi=0),!(G.subtreeFlags&2064)&&!(G.flags&2064)||qh||(qh=!0,AR(R0,function(){return Hl(),null})),N=(G.flags&15990)!==0,G.subtreeFlags&15990||N){N=Jn.transition,Jn.transition=null;var Q=$t;$t=1;var le=Ut;Ut|=4,Cb.current=null,nz(I,G),iz(I,G),T(I.containerInfo),I.current=G,oz(G),M9(),Ut=le,$t=Q,Jn.transition=N}else I.current=G;if(qh&&(qh=!1,Za=I,$h=S),N=I.pendingLanes,N===0&&(Ba=null),K9(G.stateNode),Co(I,Ci()),u!==null)for(y=I.onRecoverableError,G=0;G<u.length;G++)y(u[G]);if(jh)throw jh=!1,I=pb,pb=null,I;return $h&1&&I.tag!==0&&Hl(),N=I.pendingLanes,N&1?I===fb?Zu++:(Zu=0,fb=I):Zu=0,ns(),null}function Hl(){if(Za!==null){var I=_w($h),u=Jn.transition,y=$t;try{if(Jn.transition=null,$t=16>I?16:I,Za===null)var G=!1;else{if(I=Za,Za=null,$h=0,Ut&6)throw Error(s(331));var S=Ut;for(Ut|=4,$e=I.current;$e!==null;){var N=$e,Q=N.child;if($e.flags&16){var le=N.deletions;if(le!==null){for(var Ze=0;Ze<le.length;Ze++){var Te=le[Ze];for($e=Te;$e!==null;){var gt=$e;switch(gt.tag){case 0:case 11:case 15:Nl(8,gt,N)}var Mt=gt.child;if(Mt!==null)Mt.return=gt,$e=Mt;else for(;$e!==null;){gt=$e;var vt=gt.sibling,mn=gt.return;if(QS(gt),gt===Te){$e=null;break}if(vt!==null){vt.return=mn,$e=vt;break}$e=mn}}}var ft=N.alternate;if(ft!==null){var Yi=ft.child;if(Yi!==null){ft.child=null;do{var er=Yi.sibling;Yi.sibling=null,Yi=er}while(Yi!==null)}}$e=N}}if(N.subtreeFlags&2064&&Q!==null)Q.return=N,$e=Q;else e:for(;$e!==null;){if(N=$e,N.flags&2048)switch(N.tag){case 0:case 11:case 15:Nl(9,N,N.return)}var de=N.sibling;if(de!==null){de.return=N.return,$e=de;break e}$e=N.return}}var ge=I.current;for($e=ge;$e!==null;){Q=$e;var be=Q.child;if(Q.subtreeFlags&2064&&be!==null)be.return=Q,$e=be;else e:for(Q=ge;$e!==null;){if(le=$e,le.flags&2048)try{switch(le.tag){case 0:case 11:case 15:yu(9,le)}}catch(dt){ho(le,le.return,dt)}if(le===Q){$e=null;break e}var it=le.sibling;if(it!==null){it.return=le.return,$e=it;break e}$e=le.return}}if(Ut=S,ns(),es&&typeof es.onPostCommitFiberRoot=="function")try{es.onPostCommitFiberRoot(ph,I)}catch{}G=!0}return G}finally{$t=y,Jn.transition=u}}return!1}function CR(I,u,y){u=q0(y,u),u=SS(I,u,1),Ga(I,u),u=Qi(),I=nA(I,1),I!==null&&(lu(I,1,u),Co(I,u))}function ho(I,u,y){if(I.tag===3)CR(I,I,y);else for(;u!==null;){if(u.tag===3){CR(u,I,y);break}else if(u.tag===1){var G=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof G.componentDidCatch=="function"&&(Ba===null||!Ba.has(G))){I=q0(y,I),I=RS(u,I,1),Ga(u,I),I=Qi(),u=nA(u,1),u!==null&&(lu(u,1,I),Co(u,I));break}}u=u.return}}function cz(I,u,y){var G=I.pingCache;G!==null&&G.delete(u),u=Qi(),I.pingedLanes|=I.suspendedLanes&y,$n===I&&(vi&y)===y&&(si===4||si===3&&(vi&130023424)===vi&&500>Ci()-hb?Yl(I,0):db|=y),Co(I,u)}function dR(I,u){u===0&&(I.mode&1?(u=hh,hh<<=1,!(hh&130023424)&&(hh=4194304)):u=1);var y=Qi();I=nA(I,u),I!==null&&(lu(I,u,y),Co(I,y))}function Iz(I){var u=I.memoizedState,y=0;u!==null&&(y=u.retryLane),dR(I,y)}function uz(I,u){var y=0;switch(I.tag){case 13:var G=I.stateNode,S=I.memoizedState;S!==null&&(y=S.retryLane);break;case 19:G=I.stateNode;break;default:throw Error(s(314))}G!==null&&G.delete(u),dR(I,y)}var hR;hR=function(I,u,y){if(I!==null)if(I.memoizedProps!==u.pendingProps||Rt.current)Yo=!0;else{if(!(I.lanes&y)&&!(u.flags&128))return Yo=!1,$9(I,u,y);Yo=!!(I.flags&131072)}else Yo=!1,xn&&u.flags&1048576&&tS(u,wh,u.index);switch(u.lanes=0,u.tag){case 2:var G=u.type;I!==null&&(I.alternate=null,u.alternate=null,u.flags|=2),I=u.pendingProps;var S=qt(u,sn.current);qg(u,y),S=D0(null,u,G,I,S,y);var N=J0();return u.flags|=1,typeof S=="object"&&S!==null&&typeof S.render=="function"&&S.$$typeof===void 0?(u.tag=1,u.memoizedState=null,u.updateQueue=null,dn(G)?(N=!0,nn(u)):N=!1,u.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,Y0(u),S.updater=Bh,u.stateNode=S,S._reactInternals=u,H0(u,G,I,y),u=tb(null,u,G,!0,N,y)):(u.tag=0,xn&&N&&F0(u),Oi(null,u,S,y),u=u.child),u;case 16:G=u.elementType;e:{switch(I!==null&&(I.alternate=null,u.alternate=null,u.flags|=2),I=u.pendingProps,S=G._init,G=S(G._payload),u.type=G,S=u.tag=dz(G),I=vr(G,I),S){case 0:u=eb(null,u,G,I,y);break e;case 1:u=zS(null,u,G,I,y);break e;case 11:u=YS(null,u,G,I,y);break e;case 14:u=MS(null,u,G,vr(G.type,I),y);break e}throw Error(s(306,G,""))}return u;case 0:return G=u.type,S=u.pendingProps,S=u.elementType===G?S:vr(G,S),eb(I,u,G,S,y);case 1:return G=u.type,S=u.pendingProps,S=u.elementType===G?S:vr(G,S),zS(I,u,G,S,y);case 3:e:{if(LS(u),I===null)throw Error(s(387));G=u.pendingProps,N=u.memoizedState,S=N.element,Jw(I,u),Gh(u,G,null,y);var Q=u.memoizedState;if(G=Q.element,Ne&&N.isDehydrated)if(N={element:G,isDehydrated:!1,cache:Q.cache,transitions:Q.transitions},u.updateQueue.baseState=N,u.memoizedState=N,u.flags&256){S=Error(s(423)),u=ES(I,u,G,y,S);break e}else if(G!==S){S=Error(s(424)),u=ES(I,u,G,y,S);break e}else for(Ne&&(No=Qg(u.stateNode.containerInfo),Xo=u,xn=!0,Gr=null,gu=!1),y=aS(u,null,G,y),u.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(tc(),G===S){u=Ks(I,u,y);break e}Oi(I,u,G,y)}u=u.child}return u;case 5:return lS(u),I===null&&L0(u),G=u.type,S=u.pendingProps,N=I!==null?I.memoizedProps:null,Q=S.children,ve(G,S)?Q=null:N!==null&&ve(G,N)&&(u.flags|=32),KS(I,u),Oi(I,u,Q,y),u.child;case 6:return I===null&&L0(u),null;case 13:return kS(I,u,y);case 4:return k0(u,u.stateNode.containerInfo),G=u.pendingProps,I===null?u.child=nc(u,null,G,y):Oi(I,u,G,y),u.child;case 11:return G=u.type,S=u.pendingProps,S=u.elementType===G?S:vr(G,S),YS(I,u,G,S,y);case 7:return Oi(I,u,u.pendingProps,y),u.child;case 8:return Oi(I,u,u.pendingProps.children,y),u.child;case 12:return Oi(I,u,u.pendingProps.children,y),u.child;case 10:e:{if(G=u.type._context,S=u.pendingProps,N=u.memoizedProps,Q=S.value,Dw(u,G,Q),N!==null)if(ts(N.value,Q)){if(N.children===S.children&&!Rt.current){u=Ks(I,u,y);break e}}else for(N=u.child,N!==null&&(N.return=u);N!==null;){var le=N.dependencies;if(le!==null){Q=N.child;for(var Ze=le.firstContext;Ze!==null;){if(Ze.context===G){if(N.tag===1){Ze=Ys(-1,y&-y),Ze.tag=2;var Te=N.updateQueue;if(Te!==null){Te=Te.shared;var gt=Te.pending;gt===null?Ze.next=Ze:(Ze.next=gt.next,gt.next=Ze),Te.pending=Ze}}N.lanes|=y,Ze=N.alternate,Ze!==null&&(Ze.lanes|=y),N0(N.return,y,u),le.lanes|=y;break}Ze=Ze.next}}else if(N.tag===10)Q=N.type===u.type?null:N.child;else if(N.tag===18){if(Q=N.return,Q===null)throw Error(s(341));Q.lanes|=y,le=Q.alternate,le!==null&&(le.lanes|=y),N0(Q,y,u),Q=N.sibling}else Q=N.child;if(Q!==null)Q.return=N;else for(Q=N;Q!==null;){if(Q===u){Q=null;break}if(N=Q.sibling,N!==null){N.return=Q.return,Q=N;break}Q=Q.return}N=Q}Oi(I,u,S.children,y),u=u.child}return u;case 9:return S=u.type,G=u.pendingProps.children,qg(u,y),S=Do(S),G=G(S),u.flags|=1,Oi(I,u,G,y),u.child;case 14:return G=u.type,S=vr(G,u.pendingProps),S=vr(G.type,S),MS(I,u,G,S,y);case 15:return HS(I,u,u.type,u.pendingProps,y);case 17:return G=u.type,S=u.pendingProps,S=u.elementType===G?S:vr(G,S),I!==null&&(I.alternate=null,u.alternate=null,u.flags|=2),u.tag=1,dn(G)?(I=!0,nn(u)):I=!1,qg(u,y),$w(u,G,S),H0(u,G,S,y),tb(null,u,G,!0,I,y);case 19:return PS(I,u,y);case 22:return FS(I,u,y)}throw Error(s(156,u.tag))};function AR(I,u){return w0(I,u)}function Cz(I,u,y,G){this.tag=I,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=G,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $o(I,u,y,G){return new Cz(I,u,y,G)}function Gb(I){return I=I.prototype,!(!I||!I.isReactComponent)}function dz(I){if(typeof I=="function")return Gb(I)?1:0;if(I!=null){if(I=I.$$typeof,I===v)return 11;if(I===b)return 14}return 2}function Ra(I,u){var y=I.alternate;return y===null?(y=$o(I.tag,u,I.key,I.mode),y.elementType=I.elementType,y.type=I.type,y.stateNode=I.stateNode,y.alternate=I,I.alternate=y):(y.pendingProps=u,y.type=I.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=I.flags&14680064,y.childLanes=I.childLanes,y.lanes=I.lanes,y.child=I.child,y.memoizedProps=I.memoizedProps,y.memoizedState=I.memoizedState,y.updateQueue=I.updateQueue,u=I.dependencies,y.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},y.sibling=I.sibling,y.index=I.index,y.ref=I.ref,y}function oA(I,u,y,G,S,N){var Q=2;if(G=I,typeof I=="function")Gb(I)&&(Q=1);else if(typeof I=="string")Q=5;else e:switch(I){case c:return Fl(y.children,S,N,u);case C:Q=8,S|=8;break;case d:return I=$o(12,y,u,S|2),I.elementType=d,I.lanes=N,I;case f:return I=$o(13,y,u,S),I.elementType=f,I.lanes=N,I;case A:return I=$o(19,y,u,S),I.elementType=A,I.lanes=N,I;case B:return rA(y,S,N,u);default:if(typeof I=="object"&&I!==null)switch(I.$$typeof){case h:Q=10;break e;case p:Q=9;break e;case v:Q=11;break e;case b:Q=14;break e;case m:Q=16,G=null;break e}throw Error(s(130,I==null?I:typeof I,""))}return u=$o(Q,y,u,S),u.elementType=I,u.type=G,u.lanes=N,u}function Fl(I,u,y,G){return I=$o(7,I,G,u),I.lanes=y,I}function rA(I,u,y,G){return I=$o(22,I,G,u),I.elementType=B,I.lanes=y,I.stateNode={},I}function Bb(I,u,y){return I=$o(6,I,null,u),I.lanes=y,I}function Zb(I,u,y){return u=$o(4,I.children!==null?I.children:[],I.key,u),u.lanes=y,u.stateNode={containerInfo:I.containerInfo,pendingChildren:null,implementation:I.implementation},u}function hz(I,u,y,G,S){this.tag=u,this.containerInfo=I,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Bt,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=B0(0),this.expirationTimes=B0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=B0(0),this.identifierPrefix=G,this.onRecoverableError=S,Ne&&(this.mutableSourceEagerHydrationData=null)}function pR(I,u,y,G,S,N,Q,le,Ze){return I=new hz(I,u,y,le,Ze),u===1?(u=1,N===!0&&(u|=8)):u=0,N=$o(3,null,null,u),I.current=N,N.stateNode=I,N.memoizedState={element:G,isDehydrated:y,cache:null,transitions:null},Y0(N),I}function fR(I){if(!I)return Yt;I=I._reactInternals;e:{if(V(I)!==I||I.tag!==1)throw Error(s(170));var u=I;do{switch(u.tag){case 3:u=u.stateNode.context;break e;case 1:if(dn(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break e}}u=u.return}while(u!==null);throw Error(s(171))}if(I.tag===1){var y=I.type;if(dn(y))return Nn(I,y,u)}return u}function mR(I){var u=I._reactInternals;if(u===void 0)throw typeof I.render=="function"?Error(s(188)):(I=Object.keys(I).join(","),Error(s(268,I)));return I=q(u),I===null?null:I.stateNode}function bR(I,u){if(I=I.memoizedState,I!==null&&I.dehydrated!==null){var y=I.retryLane;I.retryLane=y!==0&&y<u?y:u}}function wb(I,u){bR(I,u),(I=I.alternate)&&bR(I,u)}function Az(I){return I=q(I),I===null?null:I.stateNode}function pz(){return null}return n.attemptContinuousHydration=function(I){if(I.tag===13){var u=Qi();qo(I,134217728,u),wb(I,134217728)}},n.attemptHydrationAtCurrentPriority=function(I){if(I.tag===13){var u=Qi(),y=wa(I);qo(I,y,u),wb(I,y)}},n.attemptSynchronousHydration=function(I){switch(I.tag){case 3:var u=I.stateNode;if(u.current.memoizedState.isDehydrated){var y=au(u.pendingLanes);y!==0&&(Z0(u,y|1),Co(u,Ci()),!(Ut&6)&&(lc(),ns()))}break;case 13:var G=Qi();lR(function(){return qo(I,1,G)}),wb(I,1)}},n.batchedUpdates=function(I,u){var y=Ut;Ut|=1;try{return I(u)}finally{Ut=y,Ut===0&&(lc(),fh&&ns())}},n.createComponentSelector=function(I){return{$$typeof:_h,value:I}},n.createContainer=function(I,u,y,G,S,N,Q){return pR(I,u,!1,null,y,G,S,N,Q)},n.createHasPseudoClassSelector=function(I){return{$$typeof:Uh,value:I}},n.createHydrationContainer=function(I,u,y,G,S,N,Q,le,Ze){return I=pR(y,G,!0,I,S,N,Q,le,Ze),I.context=fR(null),y=I.current,G=Qi(),S=wa(y),N=Ys(G,S),N.callback=u??null,Ga(y,N),I.current.lanes=S,lu(I,S,G),Co(I,G),I},n.createPortal=function(I,u,y){var G=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:g,key:G==null?null:""+G,children:I,containerInfo:u,implementation:y}},n.createRoleSelector=function(I){return{$$typeof:Ph,value:I}},n.createTestNameSelector=function(I){return{$$typeof:Dh,value:I}},n.createTextSelector=function(I){return{$$typeof:Jh,value:I}},n.deferredUpdates=function(I){var u=$t,y=Jn.transition;try{return Jn.transition=null,$t=16,I()}finally{$t=u,Jn.transition=y}},n.discreteUpdates=function(I,u,y,G,S){var N=$t,Q=Jn.transition;try{return Jn.transition=null,$t=1,I(u,y,G,S)}finally{$t=N,Jn.transition=Q,Ut===0&&lc()}},n.findAllNodes=ub,n.findBoundingRects=function(I,u){if(!ut)throw Error(s(363));u=ub(I,u),I=[];for(var y=0;y<u.length;y++)I.push(on(u[y]));for(u=I.length-1;0<u;u--){y=I[u];for(var G=y.x,S=G+y.width,N=y.y,Q=N+y.height,le=u-1;0<=le;le--)if(u!==le){var Ze=I[le],Te=Ze.x,gt=Te+Ze.width,Mt=Ze.y,vt=Mt+Ze.height;if(G>=Te&&N>=Mt&&S<=gt&&Q<=vt){I.splice(u,1);break}else if(G!==Te||y.width!==Ze.width||vt<N||Mt>Q){if(!(N!==Mt||y.height!==Ze.height||gt<G||Te>S)){Te>G&&(Ze.width+=Te-G,Ze.x=G),gt<S&&(Ze.width=S-Te),I.splice(u,1);break}}else{Mt>N&&(Ze.height+=Mt-N,Ze.y=N),vt<Q&&(Ze.height=Q-Mt),I.splice(u,1);break}}}return I},n.findHostInstance=mR,n.findHostInstanceWithNoPortals=function(I){return I=z(I),I=I!==null?te(I):null,I===null?null:I.stateNode},n.findHostInstanceWithWarning=function(I){return mR(I)},n.flushControlled=function(I){var u=Ut;Ut|=1;var y=Jn.transition,G=$t;try{Jn.transition=null,$t=1,I()}finally{$t=G,Jn.transition=y,Ut=u,Ut===0&&(lc(),ns())}},n.flushPassiveEffects=Hl,n.flushSync=lR,n.focusWithin=function(I,u){if(!ut)throw Error(s(363));for(I=gb(I),u=rR(I,u),u=Array.from(u),I=0;I<u.length;){var y=u[I++];if(!F(y)){if(y.tag===5&&Ye(y.stateNode))return!0;for(y=y.child;y!==null;)u.push(y),y=y.sibling}}return!1},n.getCurrentUpdatePriority=function(){return $t},n.getFindAllNodesFailureDescription=function(I,u){if(!ut)throw Error(s(363));var y=0,G=[];I=[gb(I),0];for(var S=0;S<I.length;){var N=I[S++],Q=I[S++],le=u[Q];if((N.tag!==5||!F(N))&&(cb(N,le)&&(G.push(Ib(le)),Q++,Q>y&&(y=Q)),Q<u.length))for(N=N.child;N!==null;)I.push(N,Q),N=N.sibling}if(y<u.length){for(I=[];y<u.length;y++)I.push(Ib(u[y]));return`findAllNodes was able to match part of the selector:
  `+(G.join(" > ")+`

No matching component was found for:
  `)+I.join(" > ")}return null},n.getPublicRootInstance=function(I){if(I=I.current,!I.child)return null;switch(I.child.tag){case 5:return re(I.child.stateNode);default:return I.child.stateNode}},n.injectIntoDevTools=function(I){if(I={bundleType:I.bundleType,version:I.version,rendererPackageName:I.rendererPackageName,rendererConfig:I.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:Az,findFiberByHostInstance:I.findFiberByHostInstance||pz,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")I=!1;else{var u=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(u.isDisabled||!u.supportsFiber)I=!0;else{try{ph=u.inject(I),es=u}catch{}I=!!u.checkDCE}}return I},n.isAlreadyRendering=function(){return!1},n.observeVisibleRects=function(I,u,y,G){if(!ut)throw Error(s(363));I=ub(I,u);var S=Xe(I,y,G).disconnect;return{disconnect:function(){S()}}},n.registerMutableSourceForHydration=function(I,u){var y=u._getVersion;y=y(u._source),I.mutableSourceEagerHydrationData==null?I.mutableSourceEagerHydrationData=[u,y]:I.mutableSourceEagerHydrationData.push(u,y)},n.runWithPriority=function(I,u){var y=$t;try{return $t=I,u()}finally{$t=y}},n.shouldError=function(){return null},n.shouldSuspend=function(){return!1},n.updateContainer=function(I,u,y,G){var S=u.current,N=Qi(),Q=wa(S);return y=fR(y),u.context===null?u.context=y:u.pendingContext=y,u=Ys(N,Q),u.payload={element:I},G=G===void 0?null:G,G!==null&&(u.callback=G),Ga(S,u),I=qo(S,Q,N),I!==null&&vh(I,S,Q),Q},n};Y3.exports=WQ;var xQ=Y3.exports;const VQ=LI(xQ);var M3={exports:{}},H3={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(H,D){var T=H.length;H.push(D);e:for(;0<T;){var J=T-1>>>1,$=H[J];if(0<o($,D))H[J]=D,H[T]=$,T=J;else break e}}function n(H){return H.length===0?null:H[0]}function i(H){if(H.length===0)return null;var D=H[0],T=H.pop();if(T!==D){H[0]=T;e:for(var J=0,$=H.length,Ie=$>>>1;J<Ie;){var fe=2*(J+1)-1,ve=H[fe],Ge=fe+1,Me=H[Ge];if(0>o(ve,T))Ge<$&&0>o(Me,ve)?(H[J]=Me,H[Ge]=T,J=Ge):(H[J]=ve,H[fe]=T,J=fe);else if(Ge<$&&0>o(Me,T))H[J]=Me,H[Ge]=T,J=Ge;else break e}}return D}function o(H,D){var T=H.sortIndex-D.sortIndex;return T!==0?T:H.id-D.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var s=Date,a=s.now();t.unstable_now=function(){return s.now()-a}}var l=[],g=[],c=1,C=null,d=3,h=!1,p=!1,v=!1,f=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(H){for(var D=n(g);D!==null;){if(D.callback===null)i(g);else if(D.startTime<=H)i(g),D.sortIndex=D.expirationTime,e(l,D);else break;D=n(g)}}function B(H){if(v=!1,m(H),!p)if(n(l)!==null)p=!0,re(Z);else{var D=n(g);D!==null&&se(B,D.startTime-H)}}function Z(H,D){p=!1,v&&(v=!1,A(X),X=-1),h=!0;var T=d;try{for(m(D),C=n(l);C!==null&&(!(C.expirationTime>D)||H&&!z());){var J=C.callback;if(typeof J=="function"){C.callback=null,d=C.priorityLevel;var $=J(C.expirationTime<=D);D=t.unstable_now(),typeof $=="function"?C.callback=$:C===n(l)&&i(l),m(D)}else i(l);C=n(l)}if(C!==null)var Ie=!0;else{var fe=n(g);fe!==null&&se(B,fe.startTime-D),Ie=!1}return Ie}finally{C=null,d=T,h=!1}}var w=!1,W=null,X=-1,V=5,Y=-1;function z(){return!(t.unstable_now()-Y<V)}function q(){if(W!==null){var H=t.unstable_now();Y=H;var D=!0;try{D=W(!0,H)}finally{D?O():(w=!1,W=null)}}else w=!1}var O;if(typeof b=="function")O=function(){b(q)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,oe=te.port2;te.port1.onmessage=q,O=function(){oe.postMessage(null)}}else O=function(){f(q,0)};function re(H){W=H,w||(w=!0,O())}function se(H,D){X=f(function(){H(t.unstable_now())},D)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(H){H.callback=null},t.unstable_continueExecution=function(){p||h||(p=!0,re(Z))},t.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):V=0<H?Math.floor(1e3/H):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(H){switch(d){case 1:case 2:case 3:var D=3;break;default:D=d}var T=d;d=D;try{return H()}finally{d=T}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(H,D){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var T=d;d=H;try{return D()}finally{d=T}},t.unstable_scheduleCallback=function(H,D,T){var J=t.unstable_now();switch(typeof T=="object"&&T!==null?(T=T.delay,T=typeof T=="number"&&0<T?J+T:J):T=J,H){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=T+$,H={id:c++,callback:D,priorityLevel:H,startTime:T,expirationTime:$,sortIndex:-1},T>J?(H.sortIndex=T,e(g,H),n(l)===null&&H===n(g)&&(v?(A(X),X=-1):v=!0,se(B,T-J))):(H.sortIndex=$,e(l,H),p||h||(p=!0,re(Z))),H},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(H){var D=d;return function(){var T=d;d=D;try{return H.apply(this,arguments)}finally{d=T}}}})(H3);M3.exports=H3;var ux=M3.exports;const XQ=t=>typeof t=="object"&&typeof t.then=="function",ug=[];function F3(t,e,n=(i,o)=>i===o){if(t===e)return!0;if(!t||!e)return!1;const i=t.length;if(e.length!==i)return!1;for(let o=0;o<i;o++)if(!n(t[o],e[o]))return!1;return!0}function K3(t,e=null,n=!1,i={}){e===null&&(e=[t]);for(const r of ug)if(F3(e,r.keys,r.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(r,"error"))throw r.error;if(Object.prototype.hasOwnProperty.call(r,"response"))return i.lifespan&&i.lifespan>0&&(r.timeout&&clearTimeout(r.timeout),r.timeout=setTimeout(r.remove,i.lifespan)),r.response;if(!n)throw r.promise}const o={keys:e,equal:i.equal,remove:()=>{const r=ug.indexOf(o);r!==-1&&ug.splice(r,1)},promise:(XQ(t)?t:t(...e)).then(r=>{o.response=r,i.lifespan&&i.lifespan>0&&(o.timeout=setTimeout(o.remove,i.lifespan))}).catch(r=>o.error=r)};if(ug.push(o),!n)throw o.promise}const z3=(t,e,n)=>K3(t,e,!1,n),L3=(t,e,n)=>void K3(t,e,!0,n),E3=t=>{if(t===void 0||t.length===0)ug.splice(0,ug.length);else{const e=ug.find(n=>F3(t,n.keys,n.equal));e&&e.remove()}},k2={},e0=t=>void Object.assign(k2,t);function NQ(t,e){function n(c,{args:C=[],attach:d,...h},p){let v=`${c[0].toUpperCase()}${c.slice(1)}`,f;if(c==="primitive"){if(h.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const A=h.object;f=Kc(A,{type:c,root:p,attach:d,primitive:!0})}else{const A=k2[v];if(!A)throw new Error(`R3F: ${v} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(C))throw new Error("R3F: The args prop must be an array!");f=Kc(new A(...C),{type:c,root:p,attach:d,memoizedProps:{args:C}})}return f.__r3f.attach===void 0&&(f instanceof _t?f.__r3f.attach="geometry":f instanceof Wi&&(f.__r3f.attach="material")),v!=="inject"&&Ky(f,h),f}function i(c,C){let d=!1;if(C){var h,p;(h=C.__r3f)!=null&&h.attach?Fy(c,C,C.__r3f.attach):C.isObject3D&&c.isObject3D&&(c.add(C),d=!0),d||(p=c.__r3f)==null||p.objects.push(C),C.__r3f||Kc(C,{}),C.__r3f.parent=c,nB(C),zc(C)}}function o(c,C,d){let h=!1;if(C){var p,v;if((p=C.__r3f)!=null&&p.attach)Fy(c,C,C.__r3f.attach);else if(C.isObject3D&&c.isObject3D){C.parent=c,C.dispatchEvent({type:"added"});const f=c.children.filter(b=>b!==C),A=f.indexOf(d);c.children=[...f.slice(0,A),C,...f.slice(A)],h=!0}h||(v=c.__r3f)==null||v.objects.push(C),C.__r3f||Kc(C,{}),C.__r3f.parent=c,nB(C),zc(C)}}function r(c,C,d=!1){c&&[...c].forEach(h=>s(C,h,d))}function s(c,C,d){if(C){var h,p,v;if(C.__r3f&&(C.__r3f.parent=null),(h=c.__r3f)!=null&&h.objects&&(c.__r3f.objects=c.__r3f.objects.filter(B=>B!==C)),(p=C.__r3f)!=null&&p.attach)px(c,C,C.__r3f.attach);else if(C.isObject3D&&c.isObject3D){var f;c.remove(C),(f=C.__r3f)!=null&&f.root&&LQ(C.__r3f.root,C)}const b=(v=C.__r3f)==null?void 0:v.primitive,m=d===void 0?C.dispose!==null&&!b:d;if(!b){var A;r((A=C.__r3f)==null?void 0:A.objects,C,m),r(C.children,C,m)}delete C.__r3f,m&&C.dispose&&C.type!=="Scene"&&ux.unstable_scheduleCallback(ux.unstable_IdlePriority,()=>{try{C.dispose()}catch{}}),zc(c)}}function a(c,C,d,h){var p;const v=(p=c.__r3f)==null?void 0:p.parent;if(!v)return;const f=n(C,d,c.__r3f.root);if(c.children){for(const A of c.children)A.__r3f&&i(f,A);c.children=c.children.filter(A=>!A.__r3f)}c.__r3f.objects.forEach(A=>i(f,A)),c.__r3f.objects=[],c.__r3f.autoRemovedBeforeAppend||s(v,c),f.parent&&(f.__r3f.autoRemovedBeforeAppend=!0),i(v,f),f.raycast&&f.__r3f.eventCount&&f.__r3f.root.getState().internal.interaction.push(f),[h,h.alternate].forEach(A=>{A!==null&&(A.stateNode=f,A.ref&&(typeof A.ref=="function"?A.ref(f):A.ref.current=f))})}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:VQ({createInstance:n,removeChild:s,appendChild:i,appendInitialChild:i,insertBefore:o,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(c,C)=>{if(!C)return;const d=c.getState().scene;d.__r3f&&(d.__r3f.root=c,i(d,C))},removeChildFromContainer:(c,C)=>{C&&s(c.getState().scene,C)},insertInContainerBefore:(c,C,d)=>{if(!C||!d)return;const h=c.getState().scene;h.__r3f&&o(h,C,d)},getRootHostContext:()=>null,getChildHostContext:c=>c,finalizeInitialChildren(c){var C;return!!((C=c==null?void 0:c.__r3f)!=null?C:{}).handlers},prepareUpdate(c,C,d,h){var p;if(((p=c==null?void 0:c.__r3f)!=null?p:{}).primitive&&h.object&&h.object!==c)return[!0];{const{args:f=[],children:A,...b}=h,{args:m=[],children:B,...Z}=d;if(!Array.isArray(f))throw new Error("R3F: the args prop must be an array!");if(f.some((W,X)=>W!==m[X]))return[!0];const w=J3(c,b,Z,!0);return w.changes.length?[!1,w]:null}},commitUpdate(c,[C,d],h,p,v,f){C?a(c,h,v,f):Ky(c,d)},commitMount(c,C,d,h){var p;const v=(p=c.__r3f)!=null?p:{};c.raycast&&v.handlers&&v.eventCount&&c.__r3f.root.getState().internal.interaction.push(c)},getPublicInstance:c=>c,prepareForCommit:()=>null,preparePortalMount:c=>Kc(c.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(c){var C;const{attach:d,parent:h}=(C=c.__r3f)!=null?C:{};d&&h&&px(h,c,d),c.isObject3D&&(c.visible=!1),zc(c)},unhideInstance(c,C){var d;const{attach:h,parent:p}=(d=c.__r3f)!=null?d:{};h&&p&&Fy(p,c,h),(c.isObject3D&&C.visible==null||C.visible)&&(c.visible=!0),zc(c)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>e?e():nI.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Zn.fun(performance.now)?performance.now:Zn.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Zn.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Zn.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ky}}var Cx,dx;const Hy=t=>"colorSpace"in t||"outputColorSpace"in t,k3=()=>{var t;return(t=k2.ColorManagement)!=null?t:null},T3=t=>t&&t.isOrthographicCamera,YQ=t=>t&&t.hasOwnProperty("current"),$d=typeof window<"u"&&((Cx=window.document)!=null&&Cx.createElement||((dx=window.navigator)==null?void 0:dx.product)==="ReactNative")?x.useLayoutEffect:x.useEffect;function _3(t){const e=x.useRef(t);return $d(()=>void(e.current=t),[t]),e}function MQ({set:t}){return $d(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}class U3 extends x.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}U3.getDerivedStateFromError=()=>({error:!0});const P3="__default",hx=new Map,HQ=t=>t&&!!t.memoized&&!!t.changes;function D3(t){var e;const n=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],n),t[1]):t}const _u=t=>{var e;return(e=t.__r3f)==null?void 0:e.root.getState()},Zn={obj:t=>t===Object(t)&&!Zn.arr(t)&&typeof t!="function",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",boo:t=>typeof t=="boolean",und:t=>t===void 0,arr:t=>Array.isArray(t),equ(t,e,{arrays:n="shallow",objects:i="reference",strict:o=!0}={}){if(typeof t!=typeof e||!!t!=!!e)return!1;if(Zn.str(t)||Zn.num(t))return t===e;const r=Zn.obj(t);if(r&&i==="reference")return t===e;const s=Zn.arr(t);if(s&&n==="reference")return t===e;if((s||r)&&t===e)return!0;let a;for(a in t)if(!(a in e))return!1;if(r&&n==="shallow"&&i==="shallow"){for(a in o?e:t)if(!Zn.equ(t[a],e[a],{strict:o,objects:"reference"}))return!1}else for(a in o?e:t)if(t[a]!==e[a])return!1;if(Zn.und(a)){if(s&&t.length===0&&e.length===0||r&&Object.keys(t).length===0&&Object.keys(e).length===0)return!0;if(t!==e)return!1}return!0}};function FQ(t){const e={nodes:{},materials:{}};return t&&t.traverse(n=>{n.name&&(e.nodes[n.name]=n),n.material&&!e.materials[n.material.name]&&(e.materials[n.material.name]=n.material)}),e}function KQ(t){t.dispose&&t.type!=="Scene"&&t.dispose();for(const e in t)e.dispose==null||e.dispose(),delete t[e]}function Kc(t,e){const n=t;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},t}function tB(t,e){let n=t;if(e.includes("-")){const i=e.split("-"),o=i.pop();return n=i.reduce((r,s)=>r[s],t),{target:n,key:o}}else return{target:n,key:e}}const Ax=/-\d+$/;function Fy(t,e,n){if(Zn.str(n)){if(Ax.test(n)){const r=n.replace(Ax,""),{target:s,key:a}=tB(t,r);Array.isArray(s[a])||(s[a]=[])}const{target:i,key:o}=tB(t,n);e.__r3f.previousAttach=i[o],i[o]=e}else e.__r3f.previousAttach=n(t,e)}function px(t,e,n){var i,o;if(Zn.str(n)){const{target:r,key:s}=tB(t,n),a=e.__r3f.previousAttach;a===void 0?delete r[s]:r[s]=a}else(i=e.__r3f)==null||i.previousAttach==null||i.previousAttach(t,e);(o=e.__r3f)==null||delete o.previousAttach}function J3(t,{children:e,key:n,ref:i,...o},{children:r,key:s,ref:a,...l}={},g=!1){var c;const C=(c=t==null?void 0:t.__r3f)!=null?c:{},d=Object.entries(o),h=[];if(g){const v=Object.keys(l);for(let f=0;f<v.length;f++)o.hasOwnProperty(v[f])||d.unshift([v[f],P3+"remove"])}d.forEach(([v,f])=>{var A;if((A=t.__r3f)!=null&&A.primitive&&v==="object"||Zn.equ(f,l[v]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(v))return h.push([v,f,!0,[]]);let b=[];v.includes("-")&&(b=v.split("-")),h.push([v,f,!1,b]);for(const m in o){const B=o[m];m.startsWith(`${v}-`)&&h.push([m,B,!1,m.split("-")])}});const p={...o};return C.memoizedProps&&C.memoizedProps.args&&(p.args=C.memoizedProps.args),C.memoizedProps&&C.memoizedProps.attach&&(p.attach=C.memoizedProps.attach),{memoized:p,changes:h}}function Ky(t,e){var n,i,o;const r=(n=t.__r3f)!=null?n:{},s=r.root,a=(i=s==null||s.getState==null?void 0:s.getState())!=null?i:{},{memoized:l,changes:g}=HQ(e)?e:J3(t,e),c=r.eventCount;t.__r3f&&(t.__r3f.memoizedProps=l);for(let d=0;d<g.length;d++){let[h,p,v,f]=g[d];if(Hy(t)){const B="srgb",Z="srgb-linear";h==="encoding"?(h="colorSpace",p=p===3001?B:Z):h==="outputEncoding"&&(h="outputColorSpace",p=p===3001?B:Z)}let A=t,b=A[h];if(f.length&&(b=f.reduce((m,B)=>m[B],t),!(b&&b.set))){const[m,...B]=f.reverse();A=B.reverse().reduce((Z,w)=>Z[w],t),h=m}if(p===P3+"remove")if(A.constructor){let m=hx.get(A.constructor);m||(m=new A.constructor,hx.set(A.constructor,m)),p=m[h]}else p=0;if(v)p?r.handlers[h]=p:delete r.handlers[h],r.eventCount=Object.keys(r.handlers).length;else if(b&&b.set&&(b.copy||b instanceof mg)){if(Array.isArray(p))b.fromArray?b.fromArray(p):b.set(...p);else if(b.copy&&p&&p.constructor&&b.constructor===p.constructor)b.copy(p);else if(p!==void 0){const m=b instanceof je;!m&&b.setScalar?b.setScalar(p):b instanceof mg&&p instanceof mg?b.mask=p.mask:b.set(p),!k3()&&!a.linear&&m&&b.convertSRGBToLinear()}}else if(A[h]=p,A[h]instanceof Xn&&A[h].format===oo&&A[h].type===vs){const m=A[h];Hy(m)&&Hy(a.gl)?m.colorSpace=a.gl.outputColorSpace:m.encoding=a.gl.outputEncoding}zc(t)}if(r.parent&&a.internal&&t.raycast&&c!==r.eventCount){const d=a.internal.interaction.indexOf(t);d>-1&&a.internal.interaction.splice(d,1),r.eventCount&&a.internal.interaction.push(t)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(o=t.__r3f)!=null&&o.parent&&nB(t),t}function zc(t){var e,n;const i=(e=t.__r3f)==null||(n=e.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function nB(t){t.onUpdate==null||t.onUpdate(t)}function O3(t,e){t.manual||(T3(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix(),t.updateMatrixWorld())}function cp(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function zQ(){var t;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return nI.DefaultEventPriority;switch((t=e.event)==null?void 0:t.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return nI.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return nI.ContinuousEventPriority;default:return nI.DefaultEventPriority}}function Q3(t,e,n,i){const o=n.get(e);o&&(n.delete(e),n.size===0&&(t.delete(i),o.target.releasePointerCapture(i)))}function LQ(t,e){const{internal:n}=t.getState();n.interaction=n.interaction.filter(i=>i!==e),n.initialHits=n.initialHits.filter(i=>i!==e),n.hovered.forEach((i,o)=>{(i.eventObject===e||i.object===e)&&n.hovered.delete(o)}),n.capturedMap.forEach((i,o)=>{Q3(n.capturedMap,e,i,o)})}function EQ(t){function e(l){const{internal:g}=t.getState(),c=l.offsetX-g.initialClick[0],C=l.offsetY-g.initialClick[1];return Math.round(Math.sqrt(c*c+C*C))}function n(l){return l.filter(g=>["Move","Over","Enter","Out","Leave"].some(c=>{var C;return(C=g.__r3f)==null?void 0:C.handlers["onPointer"+c]}))}function i(l,g){const c=t.getState(),C=new Set,d=[],h=g?g(c.internal.interaction):c.internal.interaction;for(let A=0;A<h.length;A++){const b=_u(h[A]);b&&(b.raycaster.camera=void 0)}c.previousRoot||c.events.compute==null||c.events.compute(l,c);function p(A){const b=_u(A);if(!b||!b.events.enabled||b.raycaster.camera===null)return[];if(b.raycaster.camera===void 0){var m;b.events.compute==null||b.events.compute(l,b,(m=b.previousRoot)==null?void 0:m.getState()),b.raycaster.camera===void 0&&(b.raycaster.camera=null)}return b.raycaster.camera?b.raycaster.intersectObject(A,!0):[]}let v=h.flatMap(p).sort((A,b)=>{const m=_u(A.object),B=_u(b.object);return!m||!B?A.distance-b.distance:B.events.priority-m.events.priority||A.distance-b.distance}).filter(A=>{const b=cp(A);return C.has(b)?!1:(C.add(b),!0)});c.events.filter&&(v=c.events.filter(v,c));for(const A of v){let b=A.object;for(;b;){var f;(f=b.__r3f)!=null&&f.eventCount&&d.push({...A,eventObject:b}),b=b.parent}}if("pointerId"in l&&c.internal.capturedMap.has(l.pointerId))for(let A of c.internal.capturedMap.get(l.pointerId).values())C.has(cp(A.intersection))||d.push(A.intersection);return d}function o(l,g,c,C){const d=t.getState();if(l.length){const h={stopped:!1};for(const p of l){const v=_u(p.object)||d,{raycaster:f,pointer:A,camera:b,internal:m}=v,B=new E(A.x,A.y,0).unproject(b),Z=Y=>{var z,q;return(z=(q=m.capturedMap.get(Y))==null?void 0:q.has(p.eventObject))!=null?z:!1},w=Y=>{const z={intersection:p,target:g.target};m.capturedMap.has(Y)?m.capturedMap.get(Y).set(p.eventObject,z):m.capturedMap.set(Y,new Map([[p.eventObject,z]])),g.target.setPointerCapture(Y)},W=Y=>{const z=m.capturedMap.get(Y);z&&Q3(m.capturedMap,p.eventObject,z,Y)};let X={};for(let Y in g){let z=g[Y];typeof z!="function"&&(X[Y]=z)}let V={...p,...X,pointer:A,intersections:l,stopped:h.stopped,delta:c,unprojectedPoint:B,ray:f.ray,camera:b,stopPropagation(){const Y="pointerId"in g&&m.capturedMap.get(g.pointerId);if((!Y||Y.has(p.eventObject))&&(V.stopped=h.stopped=!0,m.hovered.size&&Array.from(m.hovered.values()).find(z=>z.eventObject===p.eventObject))){const z=l.slice(0,l.indexOf(p));r([...z,p])}},target:{hasPointerCapture:Z,setPointerCapture:w,releasePointerCapture:W},currentTarget:{hasPointerCapture:Z,setPointerCapture:w,releasePointerCapture:W},nativeEvent:g};if(C(V),h.stopped===!0)break}}return l}function r(l){const{internal:g}=t.getState();for(const c of g.hovered.values())if(!l.length||!l.find(C=>C.object===c.object&&C.index===c.index&&C.instanceId===c.instanceId)){const d=c.eventObject.__r3f,h=d==null?void 0:d.handlers;if(g.hovered.delete(cp(c)),d!=null&&d.eventCount){const p={...c,intersections:l};h.onPointerOut==null||h.onPointerOut(p),h.onPointerLeave==null||h.onPointerLeave(p)}}}function s(l,g){for(let c=0;c<g.length;c++){const C=g[c].__r3f;C==null||C.handlers.onPointerMissed==null||C.handlers.onPointerMissed(l)}}function a(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>r([]);case"onLostPointerCapture":return g=>{const{internal:c}=t.getState();"pointerId"in g&&c.capturedMap.has(g.pointerId)&&requestAnimationFrame(()=>{c.capturedMap.has(g.pointerId)&&(c.capturedMap.delete(g.pointerId),r([]))})}}return function(c){const{onPointerMissed:C,internal:d}=t.getState();d.lastEvent.current=c;const h=l==="onPointerMove",p=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",f=i(c,h?n:void 0),A=p?e(c):0;l==="onPointerDown"&&(d.initialClick=[c.offsetX,c.offsetY],d.initialHits=f.map(m=>m.eventObject)),p&&!f.length&&A<=2&&(s(c,d.interaction),C&&C(c)),h&&r(f);function b(m){const B=m.eventObject,Z=B.__r3f,w=Z==null?void 0:Z.handlers;if(Z!=null&&Z.eventCount)if(h){if(w.onPointerOver||w.onPointerEnter||w.onPointerOut||w.onPointerLeave){const W=cp(m),X=d.hovered.get(W);X?X.stopped&&m.stopPropagation():(d.hovered.set(W,m),w.onPointerOver==null||w.onPointerOver(m),w.onPointerEnter==null||w.onPointerEnter(m))}w.onPointerMove==null||w.onPointerMove(m)}else{const W=w[l];W?(!p||d.initialHits.includes(B))&&(s(c,d.interaction.filter(X=>!d.initialHits.includes(X))),W(m)):p&&d.initialHits.includes(B)&&s(c,d.interaction.filter(X=>!d.initialHits.includes(X)))}}o(f,c,A,b)}}return{handlePointer:a}}const kQ=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],j3=t=>!!(t!=null&&t.render),T2=x.createContext(null),TQ=(t,e)=>{const n=E2((a,l)=>{const g=new E,c=new E,C=new E;function d(A=l().camera,b=c,m=l().size){const{width:B,height:Z,top:w,left:W}=m,X=B/Z;b instanceof E?C.copy(b):C.set(...b);const V=A.getWorldPosition(g).distanceTo(C);if(T3(A))return{width:B/A.zoom,height:Z/A.zoom,top:w,left:W,factor:1,distance:V,aspect:X};{const Y=A.fov*Math.PI/180,z=2*Math.tan(Y/2)*V,q=z*(B/Z);return{width:q,height:z,top:w,left:W,factor:B/q,distance:V,aspect:X}}}let h;const p=A=>a(b=>({performance:{...b.performance,current:A}})),v=new We;return{set:a,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(A=1)=>t(l(),A),advance:(A,b)=>e(A,b,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new H2,pointer:v,mouse:v,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const A=l();h&&clearTimeout(h),A.performance.current!==A.performance.min&&p(A.performance.min),h=setTimeout(()=>p(l().performance.max),A.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:A=>a(b=>({...b,events:{...b.events,...A}})),setSize:(A,b,m,B,Z)=>{const w=l().camera,W={width:A,height:b,top:B||0,left:Z||0,updateStyle:m};a(X=>({size:W,viewport:{...X.viewport,...d(w,c,W)}}))},setDpr:A=>a(b=>{const m=D3(A);return{viewport:{...b.viewport,dpr:m,initialDpr:b.viewport.initialDpr||m}}}),setFrameloop:(A="always")=>{const b=l().clock;b.stop(),b.elapsedTime=0,A!=="never"&&(b.start(),b.elapsedTime=0),a(()=>({frameloop:A}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:x.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(A,b,m)=>{const B=l().internal;return B.priority=B.priority+(b>0?1:0),B.subscribers.push({ref:A,priority:b,store:m}),B.subscribers=B.subscribers.sort((Z,w)=>Z.priority-w.priority),()=>{const Z=l().internal;Z!=null&&Z.subscribers&&(Z.priority=Z.priority-(b>0?1:0),Z.subscribers=Z.subscribers.filter(w=>w.ref!==A))}}}}}),i=n.getState();let o=i.size,r=i.viewport.dpr,s=i.camera;return n.subscribe(()=>{const{camera:a,size:l,viewport:g,gl:c,set:C}=n.getState();if(l!==o||g.dpr!==r){var d;o=l,r=g.dpr,O3(a,l),c.setPixelRatio(g.dpr);const h=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&c.domElement instanceof HTMLCanvasElement;c.setSize(l.width,l.height,h)}a!==s&&(s=a,C(h=>({viewport:{...h.viewport,...h.viewport.getCurrentViewport(a)}})))}),n.subscribe(a=>t(a)),n};function _Q(t,e){const n={callback:t};return e.add(n),()=>void e.delete(n)}let Ip,q3=new Set,UQ=new Set,PQ=new Set;const DQ=t=>_Q(t,q3);function zy(t,e){if(t.size)for(const{callback:n}of t.values())n(e)}function Uu(t,e){switch(t){case"before":return zy(q3,e);case"after":return zy(UQ,e);case"tail":return zy(PQ,e)}}let Ly,Ey;function ky(t,e,n){let i=e.clock.getDelta();for(e.frameloop==="never"&&typeof t=="number"&&(i=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),Ly=e.internal.subscribers,Ip=0;Ip<Ly.length;Ip++)Ey=Ly[Ip],Ey.ref.current(Ey.store.getState(),i,n);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function JQ(t){let e=!1,n,i,o;function r(l){i=requestAnimationFrame(r),e=!0,n=0,Uu("before",l);for(const c of t.values()){var g;o=c.store.getState(),o.internal.active&&(o.frameloop==="always"||o.internal.frames>0)&&!((g=o.gl.xr)!=null&&g.isPresenting)&&(n+=ky(l,o))}if(Uu("after",l),n===0)return Uu("tail",l),e=!1,cancelAnimationFrame(i)}function s(l,g=1){var c;if(!l)return t.forEach(C=>s(C.store.getState()),g);(c=l.gl.xr)!=null&&c.isPresenting||!l.internal.active||l.frameloop==="never"||(l.internal.frames=Math.min(60,l.internal.frames+g),e||(e=!0,requestAnimationFrame(r)))}function a(l,g=!0,c,C){if(g&&Uu("before",l),c)ky(l,c,C);else for(const d of t.values())ky(l,d.store.getState());g&&Uu("after",l)}return{loop:r,invalidate:s,advance:a}}function _2(){const t=x.useContext(T2);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function li(t=n=>n,e){return _2()(t,e)}function Pg(t,e=0){const n=_2(),i=n.getState().internal.subscribe,o=_3(t);return $d(()=>i(o,e,n),[e,i,n]),null}function $3(t,e){return function(n,...i){const o=new n;return t&&t(o),Promise.all(i.map(r=>new Promise((s,a)=>o.load(r,l=>{l.scene&&Object.assign(l,FQ(l.scene)),s(l)},e,l=>a(new Error(`Could not load ${r}: ${l.message}`))))))}}function U2(t,e,n,i){const o=Array.isArray(e)?e:[e],r=z3($3(n,i),[t,...o],{equal:Zn.equ});return Array.isArray(e)?r:r[0]}U2.preload=function(t,e,n){const i=Array.isArray(e)?e:[e];return L3($3(n),[t,...i])};U2.clear=function(t,e){const n=Array.isArray(e)?e:[e];return E3([t,...n])};const xI=new Map,{invalidate:fx,advance:mx}=JQ(xI),{reconciler:yd,applyProps:ql}=NQ(xI,zQ),Xc={objects:"shallow",strict:!1},OQ=(t,e)=>{const n=typeof t=="function"?t(e):t;return j3(n)?n:new A2({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...t})};function QQ(t,e){if(e)return e;if(typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:n,height:i,top:o,left:r}=t.parentElement.getBoundingClientRect();return{width:n,height:i,top:o,left:r}}else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function jQ(t){const e=xI.get(t),n=e==null?void 0:e.fiber,i=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const o=typeof reportError=="function"?reportError:console.error,r=i||TQ(fx,mx),s=n||yd.createContainer(r,nI.ConcurrentRoot,null,!1,null,"",o,null);e||xI.set(t,{fiber:s,store:r});let a,l=!1,g;return{configure(c={}){let{gl:C,size:d,scene:h,events:p,onCreated:v,shadows:f=!1,linear:A=!1,flat:b=!1,legacy:m=!1,orthographic:B=!1,frameloop:Z="always",dpr:w=[1,2],performance:W,raycaster:X,camera:V,onPointerMissed:Y}=c,z=r.getState(),q=z.gl;z.gl||z.set({gl:q=OQ(C,t)});let O=z.raycaster;O||z.set({raycaster:O=new L2});const{params:te,...oe}=X||{};if(Zn.equ(oe,O,Xc)||ql(O,{...oe}),Zn.equ(te,O.params,Xc)||ql(O,{params:{...O.params,...te}}),!z.camera||z.camera===g&&!Zn.equ(g,V,Xc)){g=V;const $=V instanceof _d,Ie=$?V:B?new gl(0,0,0,0,.1,1e3):new qn(75,0,.1,1e3);$||(Ie.position.z=5,V&&ql(Ie,V),!z.camera&&!(V!=null&&V.rotation)&&Ie.lookAt(0,0,0)),z.set({camera:Ie})}if(!z.scene){let $;h instanceof ud?$=h:($=new ud,h&&ql($,h)),z.set({scene:Kc($)})}if(!z.xr){var re;const $=(ve,Ge)=>{const Me=r.getState();Me.frameloop!=="never"&&mx(ve,!0,Me,Ge)},Ie=()=>{const ve=r.getState();ve.gl.xr.enabled=ve.gl.xr.isPresenting,ve.gl.xr.setAnimationLoop(ve.gl.xr.isPresenting?$:null),ve.gl.xr.isPresenting||fx(ve)},fe={connect(){const ve=r.getState().gl;ve.xr.addEventListener("sessionstart",Ie),ve.xr.addEventListener("sessionend",Ie)},disconnect(){const ve=r.getState().gl;ve.xr.removeEventListener("sessionstart",Ie),ve.xr.removeEventListener("sessionend",Ie)}};typeof((re=q.xr)==null?void 0:re.addEventListener)=="function"&&fe.connect(),z.set({xr:fe})}if(q.shadowMap){const $=q.shadowMap.enabled,Ie=q.shadowMap.type;if(q.shadowMap.enabled=!!f,Zn.boo(f))q.shadowMap.type=BC;else if(Zn.str(f)){var se;const fe={basic:x5,percentage:wm,soft:BC,variance:Xr};q.shadowMap.type=(se=fe[f])!=null?se:BC}else Zn.obj(f)&&Object.assign(q.shadowMap,f);($!==q.shadowMap.enabled||Ie!==q.shadowMap.type)&&(q.shadowMap.needsUpdate=!0)}const H=k3();H&&("enabled"in H?H.enabled=!m:"legacyMode"in H&&(H.legacyMode=m)),ql(q,{outputEncoding:A?3e3:3001,toneMapping:b?ys:JZ}),z.legacy!==m&&z.set(()=>({legacy:m})),z.linear!==A&&z.set(()=>({linear:A})),z.flat!==b&&z.set(()=>({flat:b})),C&&!Zn.fun(C)&&!j3(C)&&!Zn.equ(C,q,Xc)&&ql(q,C),p&&!z.events.handlers&&z.set({events:p(r)});const J=QQ(t,d);return Zn.equ(J,z.size,Xc)||z.setSize(J.width,J.height,J.updateStyle,J.top,J.left),w&&z.viewport.dpr!==D3(w)&&z.setDpr(w),z.frameloop!==Z&&z.setFrameloop(Z),z.onPointerMissed||z.set({onPointerMissed:Y}),W&&!Zn.equ(W,z.performance,Xc)&&z.set($=>({performance:{...$.performance,...W}})),a=v,l=!0,this},render(c){return l||this.configure(),yd.updateContainer(x.createElement(qQ,{store:r,children:c,onCreated:a,rootElement:t}),s,null,()=>{}),r},unmount(){eH(t)}}}function qQ({store:t,children:e,onCreated:n,rootElement:i}){return $d(()=>{const o=t.getState();o.set(r=>({internal:{...r.internal,active:!0}})),n&&n(o),t.getState().events.connected||o.events.connect==null||o.events.connect(i)},[]),x.createElement(T2.Provider,{value:t},e)}function eH(t,e){const n=xI.get(t),i=n==null?void 0:n.fiber;if(i){const o=n==null?void 0:n.store.getState();o&&(o.internal.active=!1),yd.updateContainer(null,i,null,()=>{o&&setTimeout(()=>{try{var r,s,a,l;o.events.disconnect==null||o.events.disconnect(),(r=o.gl)==null||(s=r.renderLists)==null||s.dispose==null||s.dispose(),(a=o.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(l=o.gl)!=null&&l.xr&&o.xr.disconnect(),KQ(o),xI.delete(t),e&&e(t)}catch{}},500)})}}function $Q(t,e,n){return x.createElement(e4,{key:e.uuid,children:t,container:e,state:n})}function e4({state:t={},children:e,container:n}){const{events:i,size:o,...r}=t,s=_2(),[a]=x.useState(()=>new L2),[l]=x.useState(()=>new We),g=x.useCallback((C,d)=>{const h={...C};Object.keys(C).forEach(v=>{(kQ.includes(v)||C[v]!==d[v]&&d[v])&&delete h[v]});let p;if(d&&o){const v=d.camera;p=C.viewport.getCurrentViewport(v,new E,o),v!==C.camera&&O3(v,o)}return{...h,scene:n,raycaster:a,pointer:l,mouse:l,previousRoot:s,events:{...C.events,...d==null?void 0:d.events,...i},size:{...C.size,...o},viewport:{...C.viewport,...p},...r}},[t]),[c]=x.useState(()=>{const C=s.getState();return E2((h,p)=>({...C,scene:n,raycaster:a,pointer:l,mouse:l,previousRoot:s,events:{...C.events,...i},size:{...C.size,...o},...r,set:h,get:p,setEvents:v=>h(f=>({...f,events:{...f.events,...v}}))}))});return x.useEffect(()=>{const C=s.subscribe(d=>c.setState(h=>g(d,h)));return()=>{C(),c.destroy()}},[]),x.useEffect(()=>{c.setState(C=>g(s.getState(),C))},[g]),x.createElement(x.Fragment,null,yd.createPortal(x.createElement(T2.Provider,{value:c},e),c,null))}yd.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:x.version});function pn(){return pn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},pn.apply(this,arguments)}function iB(t,e,n){var i,o,r,s,a;e==null&&(e=100);function l(){var c=Date.now()-s;c<e&&c>=0?i=setTimeout(l,e-c):(i=null,n||(a=t.apply(r,o),r=o=null))}var g=function(){r=this,o=arguments,s=Date.now();var c=n&&!i;return i||(i=setTimeout(l,e)),c&&(a=t.apply(r,o),r=o=null),a};return g.clear=function(){i&&(clearTimeout(i),i=null)},g.flush=function(){i&&(a=t.apply(r,o),r=o=null,clearTimeout(i),i=null)},g}iB.debounce=iB;var t4=iB;const bx=LI(t4);function n4(t){let{debounce:e,scroll:n,polyfill:i,offsetSize:o}=t===void 0?{debounce:0,scroll:!1,offsetSize:!1}:t;const r=i||(typeof window>"u"?class{}:window.ResizeObserver);if(!r)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=x.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=x.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s}),g=e?typeof e=="number"?e:e.scroll:null,c=e?typeof e=="number"?e:e.resize:null,C=x.useRef(!1);x.useEffect(()=>(C.current=!0,()=>void(C.current=!1)));const[d,h,p]=x.useMemo(()=>{const b=()=>{if(!l.current.element)return;const{left:m,top:B,width:Z,height:w,bottom:W,right:X,x:V,y:Y}=l.current.element.getBoundingClientRect(),z={left:m,top:B,width:Z,height:w,bottom:W,right:X,x:V,y:Y};l.current.element instanceof HTMLElement&&o&&(z.height=l.current.element.offsetHeight,z.width=l.current.element.offsetWidth),Object.freeze(z),C.current&&!s4(l.current.lastBounds,z)&&a(l.current.lastBounds=z)};return[b,c?bx(b,c):b,g?bx(b,g):b]},[a,o,g,c]);function v(){l.current.scrollContainers&&(l.current.scrollContainers.forEach(b=>b.removeEventListener("scroll",p,!0)),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null)}function f(){l.current.element&&(l.current.resizeObserver=new r(p),l.current.resizeObserver.observe(l.current.element),n&&l.current.scrollContainers&&l.current.scrollContainers.forEach(b=>b.addEventListener("scroll",p,{capture:!0,passive:!0})))}const A=b=>{!b||b===l.current.element||(v(),l.current.element=b,l.current.scrollContainers=tH(b),f())};return o4(p,!!n),i4(h),x.useEffect(()=>{v(),f()},[n,p,h]),x.useEffect(()=>v,[]),[A,s,d]}function i4(t){x.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[t])}function o4(t,e){x.useEffect(()=>{if(e){const n=t;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[t,e])}function tH(t){const e=[];if(!t||t===document.body)return e;const{overflow:n,overflowX:i,overflowY:o}=window.getComputedStyle(t);return[n,i,o].some(r=>r==="auto"||r==="scroll")&&e.push(t),[...e,...tH(t.parentElement)]}const r4=["x","y","top","bottom","left","right","width","height"],s4=(t,e)=>r4.every(n=>t[n]===e[n]);var a4=Object.defineProperty,l4=Object.defineProperties,g4=Object.getOwnPropertyDescriptors,yx=Object.getOwnPropertySymbols,c4=Object.prototype.hasOwnProperty,I4=Object.prototype.propertyIsEnumerable,vx=(t,e,n)=>e in t?a4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Gx=(t,e)=>{for(var n in e||(e={}))c4.call(e,n)&&vx(t,n,e[n]);if(yx)for(var n of yx(e))I4.call(e,n)&&vx(t,n,e[n]);return t},u4=(t,e)=>l4(t,g4(e));function nH(t,e,n){if(!t)return;if(n(t)===!0)return t;let i=e?t.return:t.child;for(;i;){const o=nH(i,e,n);if(o)return o;i=e?null:i.sibling}}function iH(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const P2=iH(x.createContext(null));class oH extends x.Component{render(){return x.createElement(P2.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:Bx,ReactCurrentDispatcher:Zx}=x.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function C4(){const t=x.useContext(P2);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=x.useId();return x.useMemo(()=>{for(const i of[Bx==null?void 0:Bx.current,t,t==null?void 0:t.alternate]){if(!i)continue;const o=nH(i,!1,r=>{let s=r.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(o)return o}},[t,e])}function d4(){var t,e;const n=C4(),[i]=x.useState(()=>new Map);i.clear();let o=n;for(;o;){const r=(t=o.type)==null?void 0:t._context;r&&r!==P2&&!i.has(r)&&i.set(r,(e=Zx==null?void 0:Zx.current)==null?void 0:e.readContext(iH(r))),o=o.return}return i}function h4(){const t=d4();return x.useMemo(()=>Array.from(t.keys()).reduce((e,n)=>i=>x.createElement(e,null,x.createElement(n.Provider,u4(Gx({},i),{value:t.get(n)}))),e=>x.createElement(oH,Gx({},e))),[t])}const Ty={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function A4(t){const{handlePointer:e}=EQ(t);return{priority:1,enabled:!0,compute(n,i,o){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Ty).reduce((n,i)=>({...n,[i]:e(i)}),{}),update:()=>{var n;const{events:i,internal:o}=t.getState();(n=o.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(o.lastEvent.current)},connect:n=>{var i;const{set:o,events:r}=t.getState();r.disconnect==null||r.disconnect(),o(s=>({events:{...s.events,connected:n}})),Object.entries((i=r.handlers)!=null?i:[]).forEach(([s,a])=>{const[l,g]=Ty[s];n.addEventListener(l,a,{passive:g})})},disconnect:()=>{const{set:n,events:i}=t.getState();if(i.connected){var o;Object.entries((o=i.handlers)!=null?o:[]).forEach(([r,s])=>{if(i&&i.connected instanceof HTMLElement){const[a]=Ty[r];i.connected.removeEventListener(a,s)}}),n(r=>({events:{...r.events,connected:void 0}}))}}}}const p4=x.forwardRef(function({children:e,fallback:n,resize:i,style:o,gl:r,events:s=A4,eventSource:a,eventPrefix:l,shadows:g,linear:c,flat:C,legacy:d,orthographic:h,frameloop:p,dpr:v,performance:f,raycaster:A,camera:b,scene:m,onPointerMissed:B,onCreated:Z,...w},W){x.useMemo(()=>e0(X3),[]);const X=h4(),[V,Y]=n4({scroll:!0,debounce:{scroll:50,resize:0},...i}),z=x.useRef(null),q=x.useRef(null);x.useImperativeHandle(W,()=>z.current);const O=_3(B),[te,oe]=x.useState(!1),[re,se]=x.useState(!1);if(te)throw te;if(re)throw re;const H=x.useRef(null);$d(()=>{const T=z.current;Y.width>0&&Y.height>0&&T&&(H.current||(H.current=jQ(T)),H.current.configure({gl:r,events:s,shadows:g,linear:c,flat:C,legacy:d,orthographic:h,frameloop:p,dpr:v,performance:f,raycaster:A,camera:b,scene:m,size:Y,onPointerMissed:(...J)=>O.current==null?void 0:O.current(...J),onCreated:J=>{J.events.connect==null||J.events.connect(a?YQ(a)?a.current:a:q.current),l&&J.setEvents({compute:($,Ie)=>{const fe=$[l+"X"],ve=$[l+"Y"];Ie.pointer.set(fe/Ie.size.width*2-1,-(ve/Ie.size.height)*2+1),Ie.raycaster.setFromCamera(Ie.pointer,Ie.camera)}}),Z==null||Z(J)}}),H.current.render(x.createElement(X,null,x.createElement(U3,{set:se},x.createElement(x.Suspense,{fallback:x.createElement(MQ,{set:oe})},e)))))}),x.useEffect(()=>{const T=z.current;if(T)return()=>eH(T)},[]);const D=a?"none":"auto";return x.createElement("div",pn({ref:q,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:D,...o}},w),x.createElement("div",{ref:V,style:{width:"100%",height:"100%"}},x.createElement("canvas",{ref:z,style:{display:"block"}},n)))}),rH=x.forwardRef(function(e,n){return x.createElement(oH,null,x.createElement(p4,pn({},e,{ref:n})))});function f4(){return Pe.jsx(rH,{})}function sH(t){return function(e){t.forEach(function(n){typeof n=="function"?n(e):n!=null&&(n.current=e)})}}function m4(t,e,n){return Math.max(e,Math.min(t,n))}const _i={toVector(t,e){return t===void 0&&(t=e),Array.isArray(t)?t:[t,t]},add(t,e){return[t[0]+e[0],t[1]+e[1]]},sub(t,e){return[t[0]-e[0],t[1]-e[1]]},addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function wx(t,e,n){return e===0||Math.abs(e)===1/0?Math.pow(t,n*5):t*e*n/(e+n*t)}function Sx(t,e,n,i=.15){return i===0?m4(t,e,n):t<e?-wx(e-t,n-e,i)+e:t>n?+wx(t-n,n-e,i)+n:t}function b4(t,[e,n],[i,o]){const[[r,s],[a,l]]=t;return[Sx(e,r,s,i),Sx(n,a,l,o)]}function y4(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function v4(t){var e=y4(t,"string");return typeof e=="symbol"?e:String(e)}function mo(t,e,n){return e=v4(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Rx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function zn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Rx(Object(n),!0).forEach(function(i){mo(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Rx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const aH={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function Wx(t){return t?t[0].toUpperCase()+t.slice(1):""}const G4=["enter","leave"];function B4(t=!1,e){return t&&!G4.includes(e)}function Z4(t,e="",n=!1){const i=aH[t],o=i&&i[e]||e;return"on"+Wx(t)+Wx(o)+(B4(n,o)?"Capture":"")}const w4=["gotpointercapture","lostpointercapture"];function S4(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const i=w4.includes(e)?"capturecapture":"capture",o=!!~e.indexOf(i);return o&&(e=e.replace("capture","")),{device:e,capture:o,passive:n}}function R4(t,e=""){const n=aH[t],i=n&&n[e]||e;return t+i}function t0(t){return"touches"in t}function lH(t){return t0(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function W4(t){return Array.from(t.touches).filter(e=>{var n,i;return e.target===t.currentTarget||((n=t.currentTarget)===null||n===void 0||(i=n.contains)===null||i===void 0?void 0:i.call(n,e.target))})}function x4(t){return t.type==="touchend"||t.type==="touchcancel"?t.changedTouches:t.targetTouches}function gH(t){return t0(t)?x4(t)[0]:t}function V4(t){return W4(t).map(e=>e.identifier)}function _y(t){const e=gH(t);return t0(t)?e.identifier:e.pointerId}function xx(t){const e=gH(t);return[e.clientX,e.clientY]}function X4(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:i,metaKey:o,ctrlKey:r}=t;Object.assign(e,{shiftKey:n,altKey:i,metaKey:o,ctrlKey:r})}return e}function Hf(t,...e){return typeof t=="function"?t(...e):t}function N4(){}function Y4(...t){return t.length===0?N4:t.length===1?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function Vx(t,e){return Object.assign({},e,t||{})}const M4=32;class H4{constructor(e,n,i){this.ctrl=e,this.args=n,this.key=i,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:n,ingKey:i,args:o}=this;n[i]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=o,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const n=this.state,i=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=e.target,n.currentTarget=e.currentTarget,n.lastOffset=i.from?Hf(i.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=e.timeStamp)}computeValues(e){const n=this.state;n._values=e,n.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:n,config:i,shared:o}=this;n.args=this.args;let r=0;if(e&&(n.event=e,i.preventDefault&&e.cancelable&&n.event.preventDefault(),n.type=e.type,o.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,o.locked=!!document.pointerLockElement,Object.assign(o,X4(e)),o.down=o.pressed=o.buttons%2===1||o.touches>0,r=e.timeStamp-n.timeStamp,n.timeStamp=e.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const w=n._delta.map(Math.abs);_i.addTo(n._distance,w)}this.axisIntent&&this.axisIntent(e);const[s,a]=n._movement,[l,g]=i.threshold,{_step:c,values:C}=n;if(i.hasCustomTransform?(c[0]===!1&&(c[0]=Math.abs(s)>=l&&C[0]),c[1]===!1&&(c[1]=Math.abs(a)>=g&&C[1])):(c[0]===!1&&(c[0]=Math.abs(s)>=l&&Math.sign(s)*l),c[1]===!1&&(c[1]=Math.abs(a)>=g&&Math.sign(a)*g)),n.intentional=c[0]!==!1||c[1]!==!1,!n.intentional)return;const d=[0,0];if(i.hasCustomTransform){const[w,W]=C;d[0]=c[0]!==!1?w-c[0]:0,d[1]=c[1]!==!1?W-c[1]:0}else d[0]=c[0]!==!1?s-c[0]:0,d[1]=c[1]!==!1?a-c[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(d);const h=n.offset,p=n._active&&!n._blocked||n.active;p&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=o[this.ingKey]=n._active,e&&(n.first&&("bounds"in i&&(n._bounds=Hf(i.bounds,n)),this.setup&&this.setup()),n.movement=d,this.computeOffset()));const[v,f]=n.offset,[[A,b],[m,B]]=n._bounds;n.overflow=[v<A?-1:v>b?1:0,f<m?-1:f>B?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const Z=n._active?i.rubberband||[0,0]:[0,0];if(n.offset=b4(n._bounds,n.offset,Z),n.delta=_i.sub(n.offset,h),this.computeMovement(),p&&(!n.last||r>M4)){n.delta=_i.sub(n.offset,h);const w=n.delta.map(Math.abs);_i.addTo(n.distance,w),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&r>0&&(n.velocity=[w[0]/r,w[1]/r],n.timeDelta=r)}}emit(){const e=this.state,n=this.shared,i=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!i.triggerAllEvents)return;const o=this.handler(zn(zn(zn({},n),e),{},{[this.aliasKey]:e.values}));o!==void 0&&(e.memo=o)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function F4([t,e],n){const i=Math.abs(t),o=Math.abs(e);if(i>o&&i>n)return"x";if(o>i&&o>n)return"y"}class K4 extends H4{constructor(...e){super(...e),mo(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=_i.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=_i.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const n=this.state,i=this.config;if(!n.axis&&e){const o=typeof i.axisThreshold=="object"?i.axisThreshold[lH(e)]:i.axisThreshold;n.axis=F4(n._movement,o)}n._blocked=(i.lockDirection||!!i.axis)&&!n.axis||!!i.axis&&i.axis!==n.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const z4=t=>t,Xx=.15,cH={enabled(t=!0){return t},eventOptions(t,e,n){return zn(zn({},n.shared.eventOptions),t)},preventDefault(t=!1){return t},triggerAllEvents(t=!1){return t},rubberband(t=0){switch(t){case!0:return[Xx,Xx];case!1:return[0,0];default:return _i.toVector(t)}},from(t){if(typeof t=="function")return t;if(t!=null)return _i.toVector(t)},transform(t,e,n){const i=t||n.shared.transform;return this.hasCustomTransform=!!i,i||z4},threshold(t){return _i.toVector(t,0)}},L4=0,eh=zn(zn({},cH),{},{axis(t,e,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(t=L4){return t},bounds(t={}){if(typeof t=="function")return r=>eh.bounds(t(r));if("current"in t)return()=>t.current;if(typeof HTMLElement=="function"&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:i=-1/0,bottom:o=1/0}=t;return[[e,n],[i,o]]}}),Nx={ArrowRight:(t,e=1)=>[t*e,0],ArrowLeft:(t,e=1)=>[-1*t*e,0],ArrowUp:(t,e=1)=>[0,-1*t*e],ArrowDown:(t,e=1)=>[0,t*e]};class E4 extends K4{constructor(...e){super(...e),mo(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const n=e._bounds.getBoundingClientRect(),i=e.currentTarget.getBoundingClientRect(),o={left:n.left-i.left+e.offset[0],right:n.right-i.right+e.offset[0],top:n.top-i.top+e.offset[1],bottom:n.bottom-i.bottom+e.offset[1]};e._bounds=eh.bounds(o)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const n=this.config,i=this.state;if(e.buttons!=null&&(Array.isArray(n.pointerButtons)?!n.pointerButtons.includes(e.buttons):n.pointerButtons!==-1&&n.pointerButtons!==e.buttons))return;const o=this.ctrl.setEventIds(e);n.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(o&&o.size>1&&i._pointerActive)&&(this.start(e),this.setupPointer(e),i._pointerId=_y(e),i._pointerActive=!0,this.computeValues(xx(e)),this.computeInitial(),n.preventScrollAxis&&lH(e)!=="mouse"?(i._active=!1,this.setupScrollPrevention(e)):n.delay>0?(this.setupDelayTrigger(e),n.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const n=this.state;n._active=!0,n._preventScroll=!0,n._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const n=this.state,i=this.config;if(!n._pointerActive)return;const o=_y(e);if(n._pointerId!==void 0&&o!==n._pointerId)return;const r=xx(e);if(document.pointerLockElement===e.target?n._delta=[e.movementX,e.movementY]:(n._delta=_i.sub(r,n._values),this.computeValues(r)),_i.addTo(n._movement,n._delta),this.compute(e),n._delayed&&n.intentional){this.timeoutStore.remove("dragDelay"),n.active=!1,this.startPointerDrag(e);return}if(i.preventScrollAxis&&!n._preventScroll)if(n.axis)if(n.axis===i.preventScrollAxis||i.preventScrollAxis==="xy"){n._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const n=this.state,i=this.config;if(!n._active||!n._pointerActive)return;const o=_y(e);if(n._pointerId!==void 0&&o!==n._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[r,s]=n._distance;if(n.tap=r<=i.tapsThreshold&&s<=i.tapsThreshold,n.tap&&i.filterTaps)n._force=!0;else{const[a,l]=n._delta,[g,c]=n._movement,[C,d]=i.swipe.velocity,[h,p]=i.swipe.distance,v=i.swipe.duration;if(n.elapsedTime<v){const f=Math.abs(a/n.timeDelta),A=Math.abs(l/n.timeDelta);f>C&&Math.abs(g)>h&&(n.swipe[0]=Math.sign(a)),A>d&&Math.abs(c)>p&&(n.swipe[1]=Math.sign(l))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const n=this.config,i=n.device;n.pointerLock&&e.currentTarget.requestPointerLock(),n.pointerCapture||(this.eventStore.add(this.sharedConfig.window,i,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,i,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,i,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,k4(e);const n=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",n),this.eventStore.add(this.sharedConfig.window,"touch","cancel",n),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const n=Nx[e.key];if(n){const i=this.state,o=e.shiftKey?10:e.altKey?.1:1;this.start(e),i._delta=n(this.config.keyboardDisplacement,o),i._keyboardActive=!0,_i.addTo(i._movement,i._delta),this.compute(e),this.emit()}}keyUp(e){e.key in Nx&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const n=this.config.device;e(n,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(n,"change",this.pointerMove.bind(this)),e(n,"end",this.pointerUp.bind(this)),e(n,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function k4(t){"persist"in t&&typeof t.persist=="function"&&t.persist()}const th=typeof window<"u"&&window.document&&window.document.createElement;function T4(){return th&&"ontouchstart"in window}function Yx(){return T4()||th&&window.navigator.maxTouchPoints>1}function _4(){return th&&"onpointerdown"in window}function U4(){return th&&"exitPointerLock"in window.document}function P4(){try{return"constructor"in GestureEvent}catch{return!1}}const ar={isBrowser:th,gesture:P4(),touch:Yx(),touchscreen:Yx(),pointer:_4(),pointerLock:U4()},D4=250,J4=180,O4=.5,Q4=50,j4=250,q4=10,Mx={mouse:0,touch:0,pen:8},$4=zn(zn({},eh),{},{device(t,e,{pointer:{touch:n=!1,lock:i=!1,mouse:o=!1}={}}){return this.pointerLock=i&&ar.pointerLock,ar.touch&&n?"touch":this.pointerLock?"mouse":ar.pointer&&!o?"pointer":ar.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&t?D4:void 0,!(!ar.touchscreen||n===!1))return t||(n!==void 0?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:i=1,keys:o=!0}={}}){return this.pointerButtons=i,this.keys=o,!this.pointerLock&&this.device==="pointer"&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:i=3,axis:o=void 0}){const r=_i.toVector(t,n?i:o?1:0);return this.filterTaps=n,this.tapsThreshold=i,r},swipe({velocity:t=O4,distance:e=Q4,duration:n=j4}={}){return{velocity:this.transform(_i.toVector(t)),distance:this.transform(_i.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return J4;case!1:return 0;default:return t}},axisThreshold(t){return t?zn(zn({},Mx),t):Mx},keyboardDisplacement(t=q4){return t}});zn(zn({},cH),{},{device(t,e,{shared:n,pointer:{touch:i=!1}={}}){if(n.target&&!ar.touch&&ar.gesture)return"gesture";if(ar.touch&&i)return"touch";if(ar.touchscreen){if(ar.pointer)return"pointer";if(ar.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:i={}}){const o=s=>{const a=Vx(Hf(n,s),{min:-1/0,max:1/0});return[a.min,a.max]},r=s=>{const a=Vx(Hf(i,s),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof i!="function"?[o(),r()]:s=>[o(s),r(s)]},threshold(t,e,n){return this.lockDirection=n.axis==="lock",_i.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey(t){return t===void 0?"ctrlKey":t},pinchOnWheel(t=!0){return t}});zn(zn({},eh),{},{mouseOnly:(t=!0)=>t});zn(zn({},eh),{},{mouseOnly:(t=!0)=>t});const IH=new Map,oB=new Map;function ej(t){IH.set(t.key,t.engine),oB.set(t.key,t.resolver)}const tj={key:"drag",engine:E4,resolver:$4};function nj(t,e){if(t==null)return{};var n={},i=Object.keys(t),o,r;for(r=0;r<i.length;r++)o=i[r],!(e.indexOf(o)>=0)&&(n[o]=t[o]);return n}function ij(t,e){if(t==null)return{};var n=nj(t,e),i,o;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}const oj={target(t){if(t)return()=>"current"in t?t.current:t},enabled(t=!0){return t},window(t=ar.isBrowser?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform(t){return t}},rj=["target","eventOptions","window","enabled","transform"];function Op(t={},e){const n={};for(const[i,o]of Object.entries(e))switch(typeof o){case"function":n[i]=o.call(n,t[i],i,t);break;case"object":n[i]=Op(t[i],o);break;case"boolean":o&&(n[i]=t[i]);break}return n}function sj(t,e,n={}){const i=t,{target:o,eventOptions:r,window:s,enabled:a,transform:l}=i,g=ij(i,rj);if(n.shared=Op({target:o,eventOptions:r,window:s,enabled:a,transform:l},oj),e){const c=oB.get(e);n[e]=Op(zn({shared:n.shared},g),c)}else for(const c in g){const C=oB.get(c);C&&(n[c]=Op(zn({shared:n.shared},g[c]),C))}return n}class uH{constructor(e,n){mo(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=n}add(e,n,i,o,r){const s=this._listeners,a=R4(n,i),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},g=zn(zn({},l),r);e.addEventListener(a,o,g);const c=()=>{e.removeEventListener(a,o,g),s.delete(c)};return s.add(c),c}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class aj{constructor(){mo(this,"_timeouts",new Map)}add(e,n,i=140,...o){this.remove(e),this._timeouts.set(e,window.setTimeout(n,i,...o))}remove(e){const n=this._timeouts.get(e);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}let lj=class{constructor(e){mo(this,"gestures",new Set),mo(this,"_targetEventStore",new uH(this)),mo(this,"gestureEventStores",{}),mo(this,"gestureTimeoutStores",{}),mo(this,"handlers",{}),mo(this,"config",{}),mo(this,"pointerIds",new Set),mo(this,"touchIds",new Set),mo(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),gj(this,e)}setEventIds(e){if(t0(e))return this.touchIds=new Set(V4(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,n){this.handlers=e,this.nativeHandlers=n}applyConfig(e,n){this.config=sj(e,n,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const n=this.config.shared,i={};let o;if(!(n.target&&(o=n.target(),!o))){if(n.enabled){for(const s of this.gestures){const a=this.config[s],l=Hx(i,a.eventOptions,!!o);if(a.enabled){const g=IH.get(s);new g(this,e,s).bind(l)}}const r=Hx(i,n.eventOptions,!!o);for(const s in this.nativeHandlers)r(s,"",a=>this.nativeHandlers[s](zn(zn({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const r in i)i[r]=Y4(...i[r]);if(!o)return i;for(const r in i){const{device:s,capture:a,passive:l}=S4(r);this._targetEventStore.add(o,s,"",i[r],{capture:a,passive:l})}}}};function Nc(t,e){t.gestures.add(e),t.gestureEventStores[e]=new uH(t,e),t.gestureTimeoutStores[e]=new aj}function gj(t,e){e.drag&&Nc(t,"drag"),e.wheel&&Nc(t,"wheel"),e.scroll&&Nc(t,"scroll"),e.move&&Nc(t,"move"),e.pinch&&Nc(t,"pinch"),e.hover&&Nc(t,"hover")}const Hx=(t,e,n)=>(i,o,r,s={},a=!1)=>{var l,g;const c=(l=s.capture)!==null&&l!==void 0?l:e.capture,C=(g=s.passive)!==null&&g!==void 0?g:e.passive;let d=a?i:Z4(i,o,c);n&&C&&(d+="Passive"),t[d]=t[d]||[],t[d].push(r)};function cj(t,e={},n,i){const o=ne.useMemo(()=>new lj(t),[]);if(o.applyHandlers(t,i),o.applyConfig(e,n),ne.useEffect(o.effect.bind(o)),ne.useEffect(()=>o.clean.bind(o),[]),e.target===void 0)return o.bind.bind(o)}function Ij(t,e){return ej(tj),cj({drag:t},e||{},"drag")}const uj=t=>(e,n,i)=>{const o=i.subscribe;return i.subscribe=(s,a,l)=>{let g=s;if(a){const c=(l==null?void 0:l.equalityFn)||Object.is;let C=s(i.getState());g=d=>{const h=s(d);if(!c(C,h)){const p=C;a(C=h,p)}},l!=null&&l.fireImmediately&&a(C,C)}return o(g)},t(e,n,i)};function Cj(t,e=1e-4){e=Math.max(e,Number.EPSILON);const n={},i=t.getIndex(),o=t.getAttribute("position"),r=i?i.count:o.count;let s=0;const a=Object.keys(t.attributes),l={},g={},c=[],C=["getX","getY","getZ","getW"];for(let v=0,f=a.length;v<f;v++){const A=a[v];l[A]=[];const b=t.morphAttributes[A];b&&(g[A]=new Array(b.length).fill(0).map(()=>[]))}const d=Math.log10(1/e),h=Math.pow(10,d);for(let v=0;v<r;v++){const f=i?i.getX(v):v;let A="";for(let b=0,m=a.length;b<m;b++){const B=a[b],Z=t.getAttribute(B),w=Z.itemSize;for(let W=0;W<w;W++)A+=`${~~(Z[C[W]](f)*h)},`}if(A in n)c.push(n[A]);else{for(let b=0,m=a.length;b<m;b++){const B=a[b],Z=t.getAttribute(B),w=t.morphAttributes[B],W=Z.itemSize,X=l[B],V=g[B];for(let Y=0;Y<W;Y++){const z=C[Y];if(X.push(Z[z](f)),w)for(let q=0,O=w.length;q<O;q++)V[q].push(w[q][z](f))}}n[A]=s,c.push(s),s++}}const p=t.clone();for(let v=0,f=a.length;v<f;v++){const A=a[v],b=t.getAttribute(A),m=new b.array.constructor(l[A]),B=new un(m,b.itemSize,b.normalized);if(p.setAttribute(A,B),A in g)for(let Z=0;Z<g[A].length;Z++){const w=t.morphAttributes[A][Z],W=new w.array.constructor(g[A][Z]),X=new un(W,w.itemSize,w.normalized);p.morphAttributes[A][Z]=X}}return p.setIndex(c),p}var lr=Uint8Array,Da=Uint16Array,rB=Uint32Array,CH=new lr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),dH=new lr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dj=new lr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hH=function(t,e){for(var n=new Da(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];for(var o=new rB(n[30]),i=1;i<30;++i)for(var r=n[i];r<n[i+1];++r)o[r]=r-n[i]<<5|i;return[n,o]},AH=hH(CH,2),pH=AH[0],hj=AH[1];pH[28]=258,hj[258]=28;var Aj=hH(dH,0),pj=Aj[0],sB=new Da(32768);for(var wn=0;wn<32768;++wn){var Ha=(wn&43690)>>>1|(wn&21845)<<1;Ha=(Ha&52428)>>>2|(Ha&13107)<<2,Ha=(Ha&61680)>>>4|(Ha&3855)<<4,sB[wn]=((Ha&65280)>>>8|(Ha&255)<<8)>>>1}var xC=function(t,e,n){for(var i=t.length,o=0,r=new Da(e);o<i;++o)++r[t[o]-1];var s=new Da(e);for(o=0;o<e;++o)s[o]=s[o-1]+r[o-1]<<1;var a;if(n){a=new Da(1<<e);var l=15-e;for(o=0;o<i;++o)if(t[o])for(var g=o<<4|t[o],c=e-t[o],C=s[t[o]-1]++<<c,d=C|(1<<c)-1;C<=d;++C)a[sB[C]>>>l]=g}else for(a=new Da(i),o=0;o<i;++o)t[o]&&(a[o]=sB[s[t[o]-1]++]>>>15-t[o]);return a},nh=new lr(288);for(var wn=0;wn<144;++wn)nh[wn]=8;for(var wn=144;wn<256;++wn)nh[wn]=9;for(var wn=256;wn<280;++wn)nh[wn]=7;for(var wn=280;wn<288;++wn)nh[wn]=8;var fH=new lr(32);for(var wn=0;wn<32;++wn)fH[wn]=5;var fj=xC(nh,9,1),mj=xC(fH,5,1),Uy=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},Rr=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(e&7)&n},Py=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(e&7)},bj=function(t){return(t/8|0)+(t&7&&1)},yj=function(t,e,n){(e==null||e<0)&&(e=0),(n==null||n>t.length)&&(n=t.length);var i=new(t instanceof Da?Da:t instanceof rB?rB:lr)(n-e);return i.set(t.subarray(e,n)),i},vj=function(t,e,n){var i=t.length;if(!i||n&&!n.l&&i<5)return e||new lr(0);var o=!e||n,r=!n||n.i;n||(n={}),e||(e=new lr(i*3));var s=function(Ge){var Me=e.length;if(Ge>Me){var _e=new lr(Math.max(Me*2,Ge));_e.set(e),e=_e}},a=n.f||0,l=n.p||0,g=n.b||0,c=n.l,C=n.d,d=n.m,h=n.n,p=i*8;do{if(!c){n.f=a=Rr(t,l,1);var v=Rr(t,l+1,3);if(l+=3,v)if(v==1)c=fj,C=mj,d=9,h=5;else if(v==2){var m=Rr(t,l,31)+257,B=Rr(t,l+10,15)+4,Z=m+Rr(t,l+5,31)+1;l+=14;for(var w=new lr(Z),W=new lr(19),X=0;X<B;++X)W[dj[X]]=Rr(t,l+X*3,7);l+=B*3;for(var V=Uy(W),Y=(1<<V)-1,z=xC(W,V,1),X=0;X<Z;){var q=z[Rr(t,l,Y)];l+=q&15;var f=q>>>4;if(f<16)w[X++]=f;else{var O=0,te=0;for(f==16?(te=3+Rr(t,l,3),l+=2,O=w[X-1]):f==17?(te=3+Rr(t,l,7),l+=3):f==18&&(te=11+Rr(t,l,127),l+=7);te--;)w[X++]=O}}var oe=w.subarray(0,m),re=w.subarray(m);d=Uy(oe),h=Uy(re),c=xC(oe,d,1),C=xC(re,h,1)}else throw"invalid block type";else{var f=bj(l)+4,A=t[f-4]|t[f-3]<<8,b=f+A;if(b>i){if(r)throw"unexpected EOF";break}o&&s(g+A),e.set(t.subarray(f,b),g),n.b=g+=A,n.p=l=b*8;continue}if(l>p){if(r)throw"unexpected EOF";break}}o&&s(g+131072);for(var se=(1<<d)-1,H=(1<<h)-1,D=l;;D=l){var O=c[Py(t,l)&se],T=O>>>4;if(l+=O&15,l>p){if(r)throw"unexpected EOF";break}if(!O)throw"invalid length/literal";if(T<256)e[g++]=T;else if(T==256){D=l,c=null;break}else{var J=T-254;if(T>264){var X=T-257,$=CH[X];J=Rr(t,l,(1<<$)-1)+pH[X],l+=$}var Ie=C[Py(t,l)&H],fe=Ie>>>4;if(!Ie)throw"invalid distance";l+=Ie&15;var re=pj[fe];if(fe>3){var $=dH[fe];re+=Py(t,l)&(1<<$)-1,l+=$}if(l>p){if(r)throw"unexpected EOF";break}o&&s(g+131072);for(var ve=g+J;g<ve;g+=4)e[g]=e[g-re],e[g+1]=e[g+1-re],e[g+2]=e[g+2-re],e[g+3]=e[g+3-re];g=ve}}n.l=c,n.p=D,n.b=g,c&&(a=1,n.m=d,n.d=C,n.n=h)}while(!a);return g==e.length?e:yj(e,0,g)},Gj=new lr(0),Bj=function(t){if((t[0]&15)!=8||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(t[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function up(t,e){return vj((Bj(t),t.subarray(2,-4)),e)}var Zj=typeof TextDecoder<"u"&&new TextDecoder,wj=0;try{Zj.decode(Gj,{stream:!0}),wj=1}catch{}var Sj=Object.defineProperty,Rj=(t,e,n)=>e in t?Sj(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,mH=(t,e,n)=>(Rj(t,typeof e!="symbol"?e+"":e,n),n);const Qp={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new E},up:{value:new E(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${parseInt(Eg.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},bH=new ao({name:"SkyShader",fragmentShader:Qp.fragmentShader,vertexShader:Qp.vertexShader,uniforms:Vm.clone(Qp.uniforms),side:Si,depthWrite:!1});let D2=class extends ci{constructor(){super(new Zl(1,1,1),bH)}};mH(D2,"SkyShader",Qp);mH(D2,"material",bH);const Wj=t=>t&&t.isCubeTexture;class xj extends ci{constructor(e,n){var i,o;const r=Wj(e),a=((o=r?(i=e.image[0])==null?void 0:i.width:e.image.width)!=null?o:1024)/4,l=Math.floor(Math.log2(a)),g=Math.pow(2,l),c=3*Math.max(g,16*7),C=4*g,d=[r?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/c}`,`#define CUBEUV_TEXEL_HEIGHT ${1/C}`,`#define CUBEUV_MAX_MIP ${l}.0`],h=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,p=d.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(Eg.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,v={map:{value:e},height:{value:(n==null?void 0:n.height)||15},radius:{value:(n==null?void 0:n.radius)||100}},f=new Od(1,16),A=new ao({uniforms:v,fragmentShader:p,vertexShader:h,side:Fr});super(f,A)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var Vj=Object.defineProperty,Xj=(t,e,n)=>e in t?Vj(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Xt=(t,e,n)=>(Xj(t,typeof e!="symbol"?e+"":e,n),n);const Fx=(t,e)=>(t%e+e)%e;let Nj=class extends Rs{constructor(e,n){super(),Xt(this,"object"),Xt(this,"domElement"),Xt(this,"enabled",!0),Xt(this,"target",new E),Xt(this,"minDistance",0),Xt(this,"maxDistance",1/0),Xt(this,"minZoom",0),Xt(this,"maxZoom",1/0),Xt(this,"minPolarAngle",0),Xt(this,"maxPolarAngle",Math.PI),Xt(this,"minAzimuthAngle",-1/0),Xt(this,"maxAzimuthAngle",1/0),Xt(this,"enableDamping",!1),Xt(this,"dampingFactor",.05),Xt(this,"enableZoom",!0),Xt(this,"zoomSpeed",1),Xt(this,"enableRotate",!0),Xt(this,"rotateSpeed",1),Xt(this,"enablePan",!0),Xt(this,"panSpeed",1),Xt(this,"screenSpacePanning",!0),Xt(this,"keyPanSpeed",7),Xt(this,"autoRotate",!1),Xt(this,"autoRotateSpeed",2),Xt(this,"reverseOrbit",!1),Xt(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Xt(this,"mouseButtons",{LEFT:Ol.ROTATE,MIDDLE:Ol.DOLLY,RIGHT:Ol.PAN}),Xt(this,"touches",{ONE:Ql.ROTATE,TWO:Ql.DOLLY_PAN}),Xt(this,"target0"),Xt(this,"position0"),Xt(this,"zoom0"),Xt(this,"_domElementKeyEvents",null),Xt(this,"getPolarAngle"),Xt(this,"getAzimuthalAngle"),Xt(this,"setPolarAngle"),Xt(this,"setAzimuthalAngle"),Xt(this,"getDistance"),Xt(this,"listenToKeyEvents"),Xt(this,"stopListenToKeyEvents"),Xt(this,"saveState"),Xt(this,"reset"),Xt(this,"update"),Xt(this,"connect"),Xt(this,"dispose"),this.object=e,this.domElement=n,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=ie=>{let me=Fx(ie,2*Math.PI),xe=c.phi;xe<0&&(xe+=2*Math.PI),me<0&&(me+=2*Math.PI);let Ke=Math.abs(me-xe);2*Math.PI-Ke<Ke&&(me<xe?me+=2*Math.PI:xe+=2*Math.PI),C.phi=me-xe,i.update()},this.setAzimuthalAngle=ie=>{let me=Fx(ie,2*Math.PI),xe=c.theta;xe<0&&(xe+=2*Math.PI),me<0&&(me+=2*Math.PI);let Ke=Math.abs(me-xe);2*Math.PI-Ke<Ke&&(me<xe?me+=2*Math.PI:xe+=2*Math.PI),C.theta=me-xe,i.update()},this.getDistance=()=>i.object.position.distanceTo(i.target),this.listenToKeyEvents=ie=>{ie.addEventListener("keydown",F),this._domElementKeyEvents=ie},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",F),this._domElementKeyEvents=null},this.saveState=()=>{i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=()=>{i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(o),i.update(),l=a.NONE},this.update=(()=>{const ie=new E,me=new E(0,1,0),xe=new yi().setFromUnitVectors(e.up,me),Ke=xe.clone().invert(),ke=new E,lt=new yi,mt=2*Math.PI;return function(){const pe=i.object.position;xe.setFromUnitVectors(e.up,me),Ke.copy(xe).invert(),ie.copy(pe).sub(i.target),ie.applyQuaternion(xe),c.setFromVector3(ie),i.autoRotate&&l===a.NONE&&q(Y()),i.enableDamping?(c.theta+=C.theta*i.dampingFactor,c.phi+=C.phi*i.dampingFactor):(c.theta+=C.theta,c.phi+=C.phi);let Ce=i.minAzimuthAngle,Le=i.maxAzimuthAngle;return isFinite(Ce)&&isFinite(Le)&&(Ce<-Math.PI?Ce+=mt:Ce>Math.PI&&(Ce-=mt),Le<-Math.PI?Le+=mt:Le>Math.PI&&(Le-=mt),Ce<=Le?c.theta=Math.max(Ce,Math.min(Le,c.theta)):c.theta=c.theta>(Ce+Le)/2?Math.max(Ce,c.theta):Math.min(Le,c.theta)),c.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=d,c.radius=Math.max(i.minDistance,Math.min(i.maxDistance,c.radius)),i.enableDamping===!0?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),ie.setFromSpherical(c),ie.applyQuaternion(Ke),pe.copy(i.target).add(ie),i.object.lookAt(i.target),i.enableDamping===!0?(C.theta*=1-i.dampingFactor,C.phi*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor)):(C.set(0,0,0),h.set(0,0,0)),d=1,p||ke.distanceToSquared(i.object.position)>g||8*(1-lt.dot(i.object.quaternion))>g?(i.dispatchEvent(o),ke.copy(i.object.position),lt.copy(i.object.quaternion),p=!1,!0):!1}})(),this.connect=ie=>{ie===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),i.domElement=ie,i.domElement.style.touchAction="none",i.domElement.addEventListener("contextmenu",Xe),i.domElement.addEventListener("pointerdown",at),i.domElement.addEventListener("pointercancel",ut),i.domElement.addEventListener("wheel",L)},this.dispose=()=>{var ie,me,xe,Ke,ke,lt;(ie=i.domElement)==null||ie.removeEventListener("contextmenu",Xe),(me=i.domElement)==null||me.removeEventListener("pointerdown",at),(xe=i.domElement)==null||xe.removeEventListener("pointercancel",ut),(Ke=i.domElement)==null||Ke.removeEventListener("wheel",L),(ke=i.domElement)==null||ke.ownerDocument.removeEventListener("pointermove",Qe),(lt=i.domElement)==null||lt.ownerDocument.removeEventListener("pointerup",et),i._domElementKeyEvents!==null&&i._domElementKeyEvents.removeEventListener("keydown",F)};const i=this,o={type:"change"},r={type:"start"},s={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=a.NONE;const g=1e-6,c=new eB,C=new eB;let d=1;const h=new E;let p=!1;const v=new We,f=new We,A=new We,b=new We,m=new We,B=new We,Z=new We,w=new We,W=new We,X=[],V={};function Y(){return 2*Math.PI/60/60*i.autoRotateSpeed}function z(){return Math.pow(.95,i.zoomSpeed)}function q(ie){i.reverseOrbit?C.theta+=ie:C.theta-=ie}function O(ie){i.reverseOrbit?C.phi+=ie:C.phi-=ie}const te=(()=>{const ie=new E;return function(xe,Ke){ie.setFromMatrixColumn(Ke,0),ie.multiplyScalar(-xe),h.add(ie)}})(),oe=(()=>{const ie=new E;return function(xe,Ke){i.screenSpacePanning===!0?ie.setFromMatrixColumn(Ke,1):(ie.setFromMatrixColumn(Ke,0),ie.crossVectors(i.object.up,ie)),ie.multiplyScalar(xe),h.add(ie)}})(),re=(()=>{const ie=new E;return function(xe,Ke){const ke=i.domElement;if(ke&&i.object instanceof qn&&i.object.isPerspectiveCamera){const lt=i.object.position;ie.copy(lt).sub(i.target);let mt=ie.length();mt*=Math.tan(i.object.fov/2*Math.PI/180),te(2*xe*mt/ke.clientHeight,i.object.matrix),oe(2*Ke*mt/ke.clientHeight,i.object.matrix)}else ke&&i.object instanceof gl&&i.object.isOrthographicCamera?(te(xe*(i.object.right-i.object.left)/i.object.zoom/ke.clientWidth,i.object.matrix),oe(Ke*(i.object.top-i.object.bottom)/i.object.zoom/ke.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}})();function se(ie){i.object instanceof qn&&i.object.isPerspectiveCamera?d/=ie:i.object instanceof gl&&i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*ie)),i.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function H(ie){i.object instanceof qn&&i.object.isPerspectiveCamera?d*=ie:i.object instanceof gl&&i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/ie)),i.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function D(ie){v.set(ie.clientX,ie.clientY)}function T(ie){Z.set(ie.clientX,ie.clientY)}function J(ie){b.set(ie.clientX,ie.clientY)}function $(ie){f.set(ie.clientX,ie.clientY),A.subVectors(f,v).multiplyScalar(i.rotateSpeed);const me=i.domElement;me&&(q(2*Math.PI*A.x/me.clientHeight),O(2*Math.PI*A.y/me.clientHeight)),v.copy(f),i.update()}function Ie(ie){w.set(ie.clientX,ie.clientY),W.subVectors(w,Z),W.y>0?se(z()):W.y<0&&H(z()),Z.copy(w),i.update()}function fe(ie){m.set(ie.clientX,ie.clientY),B.subVectors(m,b).multiplyScalar(i.panSpeed),re(B.x,B.y),b.copy(m),i.update()}function ve(ie){ie.deltaY<0?H(z()):ie.deltaY>0&&se(z()),i.update()}function Ge(ie){let me=!1;switch(ie.code){case i.keys.UP:re(0,i.keyPanSpeed),me=!0;break;case i.keys.BOTTOM:re(0,-i.keyPanSpeed),me=!0;break;case i.keys.LEFT:re(i.keyPanSpeed,0),me=!0;break;case i.keys.RIGHT:re(-i.keyPanSpeed,0),me=!0;break}me&&(ie.preventDefault(),i.update())}function Me(){if(X.length==1)v.set(X[0].pageX,X[0].pageY);else{const ie=.5*(X[0].pageX+X[1].pageX),me=.5*(X[0].pageY+X[1].pageY);v.set(ie,me)}}function _e(){if(X.length==1)b.set(X[0].pageX,X[0].pageY);else{const ie=.5*(X[0].pageX+X[1].pageX),me=.5*(X[0].pageY+X[1].pageY);b.set(ie,me)}}function Bt(){const ie=X[0].pageX-X[1].pageX,me=X[0].pageY-X[1].pageY,xe=Math.sqrt(ie*ie+me*me);Z.set(0,xe)}function St(){i.enableZoom&&Bt(),i.enablePan&&_e()}function ot(){i.enableZoom&&Bt(),i.enableRotate&&Me()}function ee(ie){if(X.length==1)f.set(ie.pageX,ie.pageY);else{const xe=Ae(ie),Ke=.5*(ie.pageX+xe.x),ke=.5*(ie.pageY+xe.y);f.set(Ke,ke)}A.subVectors(f,v).multiplyScalar(i.rotateSpeed);const me=i.domElement;me&&(q(2*Math.PI*A.x/me.clientHeight),O(2*Math.PI*A.y/me.clientHeight)),v.copy(f)}function Ne(ie){if(X.length==1)m.set(ie.pageX,ie.pageY);else{const me=Ae(ie),xe=.5*(ie.pageX+me.x),Ke=.5*(ie.pageY+me.y);m.set(xe,Ke)}B.subVectors(m,b).multiplyScalar(i.panSpeed),re(B.x,B.y),b.copy(m)}function Se(ie){const me=Ae(ie),xe=ie.pageX-me.x,Ke=ie.pageY-me.y,ke=Math.sqrt(xe*xe+Ke*Ke);w.set(0,ke),W.set(0,Math.pow(w.y/Z.y,i.zoomSpeed)),se(W.y),Z.copy(w)}function He(ie){i.enableZoom&&Se(ie),i.enablePan&&Ne(ie)}function Ve(ie){i.enableZoom&&Se(ie),i.enableRotate&&ee(ie)}function at(ie){var me,xe;i.enabled!==!1&&(X.length===0&&((me=i.domElement)==null||me.ownerDocument.addEventListener("pointermove",Qe),(xe=i.domElement)==null||xe.ownerDocument.addEventListener("pointerup",et)),Fe(ie),ie.pointerType==="touch"?ce(ie):xt(ie))}function Qe(ie){i.enabled!==!1&&(ie.pointerType==="touch"?Ye(ie):on(ie))}function et(ie){var me,xe,Ke;tt(ie),X.length===0&&((me=i.domElement)==null||me.releasePointerCapture(ie.pointerId),(xe=i.domElement)==null||xe.ownerDocument.removeEventListener("pointermove",Qe),(Ke=i.domElement)==null||Ke.ownerDocument.removeEventListener("pointerup",et)),i.dispatchEvent(s),l=a.NONE}function ut(ie){tt(ie)}function xt(ie){let me;switch(ie.button){case 0:me=i.mouseButtons.LEFT;break;case 1:me=i.mouseButtons.MIDDLE;break;case 2:me=i.mouseButtons.RIGHT;break;default:me=-1}switch(me){case Ol.DOLLY:if(i.enableZoom===!1)return;T(ie),l=a.DOLLY;break;case Ol.ROTATE:if(ie.ctrlKey||ie.metaKey||ie.shiftKey){if(i.enablePan===!1)return;J(ie),l=a.PAN}else{if(i.enableRotate===!1)return;D(ie),l=a.ROTATE}break;case Ol.PAN:if(ie.ctrlKey||ie.metaKey||ie.shiftKey){if(i.enableRotate===!1)return;D(ie),l=a.ROTATE}else{if(i.enablePan===!1)return;J(ie),l=a.PAN}break;default:l=a.NONE}l!==a.NONE&&i.dispatchEvent(r)}function on(ie){if(i.enabled!==!1)switch(l){case a.ROTATE:if(i.enableRotate===!1)return;$(ie);break;case a.DOLLY:if(i.enableZoom===!1)return;Ie(ie);break;case a.PAN:if(i.enablePan===!1)return;fe(ie);break}}function L(ie){i.enabled===!1||i.enableZoom===!1||l!==a.NONE&&l!==a.ROTATE||(ie.preventDefault(),i.dispatchEvent(r),ve(ie),i.dispatchEvent(s))}function F(ie){i.enabled===!1||i.enablePan===!1||Ge(ie)}function ce(ie){switch(ze(ie),X.length){case 1:switch(i.touches.ONE){case Ql.ROTATE:if(i.enableRotate===!1)return;Me(),l=a.TOUCH_ROTATE;break;case Ql.PAN:if(i.enablePan===!1)return;_e(),l=a.TOUCH_PAN;break;default:l=a.NONE}break;case 2:switch(i.touches.TWO){case Ql.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;St(),l=a.TOUCH_DOLLY_PAN;break;case Ql.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;ot(),l=a.TOUCH_DOLLY_ROTATE;break;default:l=a.NONE}break;default:l=a.NONE}l!==a.NONE&&i.dispatchEvent(r)}function Ye(ie){switch(ze(ie),l){case a.TOUCH_ROTATE:if(i.enableRotate===!1)return;ee(ie),i.update();break;case a.TOUCH_PAN:if(i.enablePan===!1)return;Ne(ie),i.update();break;case a.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;He(ie),i.update();break;case a.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Ve(ie),i.update();break;default:l=a.NONE}}function Xe(ie){i.enabled!==!1&&ie.preventDefault()}function Fe(ie){X.push(ie)}function tt(ie){delete V[ie.pointerId];for(let me=0;me<X.length;me++)if(X[me].pointerId==ie.pointerId){X.splice(me,1);return}}function ze(ie){let me=V[ie.pointerId];me===void 0&&(me=new We,V[ie.pointerId]=me),me.set(ie.pageX,ie.pageY)}function Ae(ie){const me=ie.pointerId===X[0].pointerId?X[1]:X[0];return V[me.pointerId]}n!==void 0&&this.connect(n),this.update()}};class Yj extends Jd{constructor(e,n={}){const{bevelEnabled:i=!1,bevelSize:o=8,bevelThickness:r=10,font:s,height:a=50,size:l=100,lineHeight:g=1,letterSpacing:c=0,...C}=n;if(s===void 0)super();else{const d=s.generateShapes(e,l,{lineHeight:g,letterSpacing:c});super(d,{...C,bevelEnabled:i,bevelSize:o,bevelThickness:r,depth:a})}this.type="TextGeometry"}}var Mj=Object.defineProperty,Hj=(t,e,n)=>e in t?Mj(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,J2=(t,e,n)=>(Hj(t,typeof e!="symbol"?e+"":e,n),n);class Fj extends Io{constructor(e){super(e)}load(e,n,i,o){const r=new Zs(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,s=>{if(typeof s!="string")throw new Error("unsupported data type");const a=JSON.parse(s),l=this.parse(a);n&&n(l)},i,o)}loadAsync(e,n){return super.loadAsync(e,n)}parse(e){return new O2(e)}}class O2{constructor(e){J2(this,"data"),this.data=e}generateShapes(e,n=100,i){const o=[],r={letterSpacing:0,lineHeight:1,...i},s=Kj(e,n,this.data,r);for(let a=0,l=s.length;a<l;a++)Array.prototype.push.apply(o,s[a].toShapes(!1));return o}}J2(O2,"isFont");J2(O2,"type");function Kj(t,e,n,i){const o=Array.from(t),r=e/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,a=[];let l=0,g=0;for(let c=0;c<o.length;c++){const C=o[c];if(C===`
`)l=0,g-=s*i.lineHeight;else{const d=zj(C,r,l,g,n);d&&(l+=d.offsetX+i.letterSpacing,a.push(d.path))}}return a}function zj(t,e,n,i,o){const r=o.glyphs[t]||o.glyphs["?"];if(!r){console.error('THREE.Font: character "'+t+'" does not exists in font family '+o.familyName+".");return}const s=new V3;let a,l,g,c,C,d,h,p;if(r.o){const v=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let f=0,A=v.length;f<A;)switch(v[f++]){case"m":a=parseInt(v[f++])*e+n,l=parseInt(v[f++])*e+i,s.moveTo(a,l);break;case"l":a=parseInt(v[f++])*e+n,l=parseInt(v[f++])*e+i,s.lineTo(a,l);break;case"q":g=parseInt(v[f++])*e+n,c=parseInt(v[f++])*e+i,C=parseInt(v[f++])*e+n,d=parseInt(v[f++])*e+i,s.quadraticCurveTo(C,d,g,c);break;case"b":g=parseInt(v[f++])*e+n,c=parseInt(v[f++])*e+i,C=parseInt(v[f++])*e+n,d=parseInt(v[f++])*e+i,h=parseInt(v[f++])*e+n,p=parseInt(v[f++])*e+i,s.bezierCurveTo(C,d,h,p,g,c);break}}return{offsetX:r.ha*e,path:s}}class Lj extends N2{constructor(e){super(e),this.type=Ti}parse(e){const a=function(m,B){switch(m){case 1:console.error("THREE.RGBELoader Read Error: "+(B||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(B||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(B||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(B||""))}return-1},C=`
`,d=function(m,B,Z){B=B||1024;let W=m.pos,X=-1,V=0,Y="",z=String.fromCharCode.apply(null,new Uint16Array(m.subarray(W,W+128)));for(;0>(X=z.indexOf(C))&&V<B&&W<m.byteLength;)Y+=z,V+=z.length,W+=128,z+=String.fromCharCode.apply(null,new Uint16Array(m.subarray(W,W+128)));return-1<X?(Z!==!1&&(m.pos+=V+X+1),Y+z.slice(0,X)):!1},h=function(m){const B=/^#\?(\S+)/,Z=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,w=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,W=/^\s*FORMAT=(\S+)\s*$/,X=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,V={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Y,z;if(m.pos>=m.byteLength||!(Y=d(m)))return a(1,"no header found");if(!(z=Y.match(B)))return a(3,"bad initial token");for(V.valid|=1,V.programtype=z[1],V.string+=Y+`
`;Y=d(m),Y!==!1;){if(V.string+=Y+`
`,Y.charAt(0)==="#"){V.comments+=Y+`
`;continue}if((z=Y.match(Z))&&(V.gamma=parseFloat(z[1])),(z=Y.match(w))&&(V.exposure=parseFloat(z[1])),(z=Y.match(W))&&(V.valid|=2,V.format=z[1]),(z=Y.match(X))&&(V.valid|=4,V.height=parseInt(z[1],10),V.width=parseInt(z[2],10)),V.valid&2&&V.valid&4)break}return V.valid&2?V.valid&4?V:a(3,"missing image size specifier"):a(3,"missing format specifier")},p=function(m,B,Z){const w=B;if(w<8||w>32767||m[0]!==2||m[1]!==2||m[2]&128)return new Uint8Array(m);if(w!==(m[2]<<8|m[3]))return a(3,"wrong scanline width");const W=new Uint8Array(4*B*Z);if(!W.length)return a(4,"unable to allocate buffer space");let X=0,V=0;const Y=4*w,z=new Uint8Array(4),q=new Uint8Array(Y);let O=Z;for(;O>0&&V<m.byteLength;){if(V+4>m.byteLength)return a(1);if(z[0]=m[V++],z[1]=m[V++],z[2]=m[V++],z[3]=m[V++],z[0]!=2||z[1]!=2||(z[2]<<8|z[3])!=w)return a(3,"bad rgbe scanline format");let te=0,oe;for(;te<Y&&V<m.byteLength;){oe=m[V++];const se=oe>128;if(se&&(oe-=128),oe===0||te+oe>Y)return a(3,"bad scanline data");if(se){const H=m[V++];for(let D=0;D<oe;D++)q[te++]=H}else q.set(m.subarray(V,V+oe),te),te+=oe,V+=oe}const re=w;for(let se=0;se<re;se++){let H=0;W[X]=q[se+H],H+=w,W[X+1]=q[se+H],H+=w,W[X+2]=q[se+H],H+=w,W[X+3]=q[se+H],X+=4}O--}return W},v=function(m,B,Z,w){const W=m[B+3],X=Math.pow(2,W-128)/255;Z[w+0]=m[B+0]*X,Z[w+1]=m[B+1]*X,Z[w+2]=m[B+2]*X,Z[w+3]=1},f=function(m,B,Z,w){const W=m[B+3],X=Math.pow(2,W-128)/255;Z[w+0]=cg.toHalfFloat(Math.min(m[B+0]*X,65504)),Z[w+1]=cg.toHalfFloat(Math.min(m[B+1]*X,65504)),Z[w+2]=cg.toHalfFloat(Math.min(m[B+2]*X,65504)),Z[w+3]=cg.toHalfFloat(1)},A=new Uint8Array(e);A.pos=0;const b=h(A);if(b!==-1){const m=b.width,B=b.height,Z=p(A.subarray(A.pos),m,B);if(Z!==-1){let w,W,X;switch(this.type){case Zi:X=Z.length/4;const V=new Float32Array(X*4);for(let z=0;z<X;z++)v(Z,z*4,V,z*4);w=V,W=Zi;break;case Ti:X=Z.length/4;const Y=new Uint16Array(X*4);for(let z=0;z<X;z++)f(Z,z*4,Y,z*4);w=Y,W=Ti;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:m,height:B,data:w,header:b.string,gamma:b.gamma,exposure:b.exposure,type:W}}}return null}setDataType(e){return this.type=e,this}load(e,n,i,o){function r(s,a){switch(s.type){case Zi:case Ti:"colorSpace"in s?s.colorSpace="srgb-linear":s.encoding=3e3,s.minFilter=bn,s.magFilter=bn,s.generateMipmaps=!1,s.flipY=!0;break}n&&n(s,a)}return super.load(e,r,i,o)}}const Pu="colorSpace"in new Xn;class Ej extends N2{constructor(e){super(e),this.type=Ti}parse(e){const V=Math.pow(2.7182818,2.2);function Y(M,R){for(var K=0,_=0;_<65536;++_)(_==0||M[_>>3]&1<<(_&7))&&(R[K++]=_);for(var k=K-1;K<65536;)R[K++]=0;return k}function z(M){for(var R=0;R<16384;R++)M[R]={},M[R].len=0,M[R].lit=0,M[R].p=null}const q={l:0,c:0,lc:0};function O(M,R,K,_,k){for(;K<M;)R=R<<8|Ke(_,k),K+=8;K-=M,q.l=R>>K&(1<<M)-1,q.c=R,q.lc=K}const te=new Array(59);function oe(M){for(var R=0;R<=58;++R)te[R]=0;for(var R=0;R<65537;++R)te[M[R]]+=1;for(var K=0,R=58;R>0;--R){var _=K+te[R]>>1;te[R]=K,K=_}for(var R=0;R<65537;++R){var k=M[R];k>0&&(M[R]=k|te[k]++<<6)}}function re(M,R,K,_,k,j,ue){for(var he=K,we=0,Be=0;k<=j;k++){if(he.value-K.value>_)return!1;O(6,we,Be,M,he);var Re=q.l;if(we=q.c,Be=q.lc,ue[k]=Re,Re==63){if(he.value-K.value>_)throw"Something wrong with hufUnpackEncTable";O(8,we,Be,M,he);var ye=q.l+6;if(we=q.c,Be=q.lc,k+ye>j+1)throw"Something wrong with hufUnpackEncTable";for(;ye--;)ue[k++]=0;k--}else if(Re>=59){var ye=Re-59+2;if(k+ye>j+1)throw"Something wrong with hufUnpackEncTable";for(;ye--;)ue[k++]=0;k--}}oe(ue)}function se(M){return M&63}function H(M){return M>>6}function D(M,R,K,_){for(;R<=K;R++){var k=H(M[R]),j=se(M[R]);if(k>>j)throw"Invalid table entry";if(j>14){var ue=_[k>>j-14];if(ue.len)throw"Invalid table entry";if(ue.lit++,ue.p){var he=ue.p;ue.p=new Array(ue.lit);for(var we=0;we<ue.lit-1;++we)ue.p[we]=he[we]}else ue.p=new Array(1);ue.p[ue.lit-1]=R}else if(j)for(var Be=0,we=1<<14-j;we>0;we--){var ue=_[(k<<14-j)+Be];if(ue.len||ue.p)throw"Invalid table entry";ue.len=j,ue.lit=R,Be++}}return!0}const T={c:0,lc:0};function J(M,R,K,_){M=M<<8|Ke(K,_),R+=8,T.c=M,T.lc=R}const $={c:0,lc:0};function Ie(M,R,K,_,k,j,ue,he,we,Be){if(M==R){_<8&&(J(K,_,k,ue),K=T.c,_=T.lc),_-=8;var Re=K>>_,Re=new Uint8Array([Re])[0];if(we.value+Re>Be)return!1;for(var ye=he[we.value-1];Re-- >0;)he[we.value++]=ye}else if(we.value<Be)he[we.value++]=M;else return!1;$.c=K,$.lc=_}function fe(M){return M&65535}function ve(M){var R=fe(M);return R>32767?R-65536:R}const Ge={a:0,b:0};function Me(M,R){var K=ve(M),_=ve(R),k=_,j=K+(k&1)+(k>>1),ue=j,he=j-k;Ge.a=ue,Ge.b=he}function _e(M,R){var K=fe(M),_=fe(R),k=K-(_>>1)&65535,j=_+k-32768&65535;Ge.a=j,Ge.b=k}function Bt(M,R,K,_,k,j,ue){for(var he=ue<16384,we=K>k?k:K,Be=1,Re;Be<=we;)Be<<=1;for(Be>>=1,Re=Be,Be>>=1;Be>=1;){for(var ye=0,rt=ye+j*(k-Re),Ue=j*Be,Je=j*Re,pt=_*Be,yt=_*Re,bt,nt,Zt,It;ye<=rt;ye+=Je){for(var Yt=ye,sn=ye+_*(K-Re);Yt<=sn;Yt+=yt){var Rt=Yt+pt,an=Yt+Ue,qt=an+pt;he?(Me(M[Yt+R],M[an+R]),bt=Ge.a,Zt=Ge.b,Me(M[Rt+R],M[qt+R]),nt=Ge.a,It=Ge.b,Me(bt,nt),M[Yt+R]=Ge.a,M[Rt+R]=Ge.b,Me(Zt,It),M[an+R]=Ge.a,M[qt+R]=Ge.b):(_e(M[Yt+R],M[an+R]),bt=Ge.a,Zt=Ge.b,_e(M[Rt+R],M[qt+R]),nt=Ge.a,It=Ge.b,_e(bt,nt),M[Yt+R]=Ge.a,M[Rt+R]=Ge.b,_e(Zt,It),M[an+R]=Ge.a,M[qt+R]=Ge.b)}if(K&Be){var an=Yt+Ue;he?Me(M[Yt+R],M[an+R]):_e(M[Yt+R],M[an+R]),bt=Ge.a,M[an+R]=Ge.b,M[Yt+R]=bt}}if(k&Be)for(var Yt=ye,sn=ye+_*(K-Re);Yt<=sn;Yt+=yt){var Rt=Yt+pt;he?Me(M[Yt+R],M[Rt+R]):_e(M[Yt+R],M[Rt+R]),bt=Ge.a,M[Rt+R]=Ge.b,M[Yt+R]=bt}Re=Be,Be>>=1}return ye}function St(M,R,K,_,k,j,ue,he,we,Be){for(var Re=0,ye=0,rt=he,Ue=Math.trunc(k.value+(j+7)/8);k.value<Ue;)for(J(Re,ye,K,k),Re=T.c,ye=T.lc;ye>=14;){var Je=Re>>ye-14&16383,pt=R[Je];if(pt.len)ye-=pt.len,Ie(pt.lit,ue,Re,ye,K,_,k,we,Be,rt),Re=$.c,ye=$.lc;else{if(!pt.p)throw"hufDecode issues";var yt;for(yt=0;yt<pt.lit;yt++){for(var bt=se(M[pt.p[yt]]);ye<bt&&k.value<Ue;)J(Re,ye,K,k),Re=T.c,ye=T.lc;if(ye>=bt&&H(M[pt.p[yt]])==(Re>>ye-bt&(1<<bt)-1)){ye-=bt,Ie(pt.p[yt],ue,Re,ye,K,_,k,we,Be,rt),Re=$.c,ye=$.lc;break}}if(yt==pt.lit)throw"hufDecode issues"}}var nt=8-j&7;for(Re>>=nt,ye-=nt;ye>0;){var pt=R[Re<<14-ye&16383];if(pt.len)ye-=pt.len,Ie(pt.lit,ue,Re,ye,K,_,k,we,Be,rt),Re=$.c,ye=$.lc;else throw"hufDecode issues"}return!0}function ot(M,R,K,_,k,j){var ue={value:0},he=K.value,we=xe(R,K),Be=xe(R,K);K.value+=4;var Re=xe(R,K);if(K.value+=4,we<0||we>=65537||Be<0||Be>=65537)throw"Something wrong with HUF_ENCSIZE";var ye=new Array(65537),rt=new Array(16384);z(rt);var Ue=_-(K.value-he);if(re(M,R,K,Ue,we,Be,ye),Re>8*(_-(K.value-he)))throw"Something wrong with hufUncompress";D(ye,we,Be,rt),St(ye,rt,M,R,K,Re,Be,j,k,ue)}function ee(M,R,K){for(var _=0;_<K;++_)R[_]=M[R[_]]}function Ne(M){for(var R=1;R<M.length;R++){var K=M[R-1]+M[R]-128;M[R]=K}}function Se(M,R){for(var K=0,_=Math.floor((M.length+1)/2),k=0,j=M.length-1;!(k>j||(R[k++]=M[K++],k>j));)R[k++]=M[_++]}function He(M){for(var R=M.byteLength,K=new Array,_=0,k=new DataView(M);R>0;){var j=k.getInt8(_++);if(j<0){var ue=-j;R-=ue+1;for(var he=0;he<ue;he++)K.push(k.getUint8(_++))}else{var ue=j;R-=2;for(var we=k.getUint8(_++),he=0;he<ue+1;he++)K.push(we)}}return K}function Ve(M,R,K,_,k,j){var Rt=new DataView(j.buffer),ue=K[M.idx[0]].width,he=K[M.idx[0]].height,we=3,Be=Math.floor(ue/8),Re=Math.ceil(ue/8),ye=Math.ceil(he/8),rt=ue-(Re-1)*8,Ue=he-(ye-1)*8,Je={value:0},pt=new Array(we),yt=new Array(we),bt=new Array(we),nt=new Array(we),Zt=new Array(we);for(let Vt=0;Vt<we;++Vt)Zt[Vt]=R[M.idx[Vt]],pt[Vt]=Vt<1?0:pt[Vt-1]+Re*ye,yt[Vt]=new Float32Array(64),bt[Vt]=new Uint16Array(64),nt[Vt]=new Uint16Array(Re*64);for(let Vt=0;Vt<ye;++Vt){var It=8;Vt==ye-1&&(It=Ue);var Yt=8;for(let nn=0;nn<Re;++nn){nn==Re-1&&(Yt=rt);for(let Jt=0;Jt<we;++Jt)bt[Jt].fill(0),bt[Jt][0]=k[pt[Jt]++],at(Je,_,bt[Jt]),Qe(bt[Jt],yt[Jt]),et(yt[Jt]);ut(yt);for(let Jt=0;Jt<we;++Jt)xt(yt[Jt],nt[Jt],nn*64)}let Nn=0;for(let nn=0;nn<we;++nn){const Jt=K[M.idx[nn]].type;for(let Wn=8*Vt;Wn<8*Vt+It;++Wn){Nn=Zt[nn][Wn];for(let Xs=0;Xs<Be;++Xs){const Ji=Xs*64+(Wn&7)*8;Rt.setUint16(Nn+0*2*Jt,nt[nn][Ji+0],!0),Rt.setUint16(Nn+1*2*Jt,nt[nn][Ji+1],!0),Rt.setUint16(Nn+2*2*Jt,nt[nn][Ji+2],!0),Rt.setUint16(Nn+3*2*Jt,nt[nn][Ji+3],!0),Rt.setUint16(Nn+4*2*Jt,nt[nn][Ji+4],!0),Rt.setUint16(Nn+5*2*Jt,nt[nn][Ji+5],!0),Rt.setUint16(Nn+6*2*Jt,nt[nn][Ji+6],!0),Rt.setUint16(Nn+7*2*Jt,nt[nn][Ji+7],!0),Nn+=8*2*Jt}}if(Be!=Re)for(let Wn=8*Vt;Wn<8*Vt+It;++Wn){const Xs=Zt[nn][Wn]+8*Be*2*Jt,Ji=Be*64+(Wn&7)*8;for(let $r=0;$r<Yt;++$r)Rt.setUint16(Xs+$r*2*Jt,nt[nn][Ji+$r],!0)}}}for(var sn=new Uint16Array(ue),Rt=new DataView(j.buffer),an=0;an<we;++an){K[M.idx[an]].decoded=!0;var qt=K[M.idx[an]].type;if(K[an].type==2)for(var dn=0;dn<he;++dn){const Vt=Zt[an][dn];for(var Dn=0;Dn<ue;++Dn)sn[Dn]=Rt.getUint16(Vt+Dn*2*qt,!0);for(var Dn=0;Dn<ue;++Dn)Rt.setFloat32(Vt+Dn*2*qt,pe(sn[Dn]),!0)}}}function at(M,R,K){for(var _,k=1;k<64;)_=R[M.value],_==65280?k=64:_>>8==255?k+=_&255:(K[k]=_,k++),M.value++}function Qe(M,R){R[0]=pe(M[0]),R[1]=pe(M[1]),R[2]=pe(M[5]),R[3]=pe(M[6]),R[4]=pe(M[14]),R[5]=pe(M[15]),R[6]=pe(M[27]),R[7]=pe(M[28]),R[8]=pe(M[2]),R[9]=pe(M[4]),R[10]=pe(M[7]),R[11]=pe(M[13]),R[12]=pe(M[16]),R[13]=pe(M[26]),R[14]=pe(M[29]),R[15]=pe(M[42]),R[16]=pe(M[3]),R[17]=pe(M[8]),R[18]=pe(M[12]),R[19]=pe(M[17]),R[20]=pe(M[25]),R[21]=pe(M[30]),R[22]=pe(M[41]),R[23]=pe(M[43]),R[24]=pe(M[9]),R[25]=pe(M[11]),R[26]=pe(M[18]),R[27]=pe(M[24]),R[28]=pe(M[31]),R[29]=pe(M[40]),R[30]=pe(M[44]),R[31]=pe(M[53]),R[32]=pe(M[10]),R[33]=pe(M[19]),R[34]=pe(M[23]),R[35]=pe(M[32]),R[36]=pe(M[39]),R[37]=pe(M[45]),R[38]=pe(M[52]),R[39]=pe(M[54]),R[40]=pe(M[20]),R[41]=pe(M[22]),R[42]=pe(M[33]),R[43]=pe(M[38]),R[44]=pe(M[46]),R[45]=pe(M[51]),R[46]=pe(M[55]),R[47]=pe(M[60]),R[48]=pe(M[21]),R[49]=pe(M[34]),R[50]=pe(M[37]),R[51]=pe(M[47]),R[52]=pe(M[50]),R[53]=pe(M[56]),R[54]=pe(M[59]),R[55]=pe(M[61]),R[56]=pe(M[35]),R[57]=pe(M[36]),R[58]=pe(M[48]),R[59]=pe(M[49]),R[60]=pe(M[57]),R[61]=pe(M[58]),R[62]=pe(M[62]),R[63]=pe(M[63])}function et(M){const R=.5*Math.cos(.7853975),K=.5*Math.cos(3.14159/16),_=.5*Math.cos(3.14159/8),k=.5*Math.cos(3*3.14159/16),j=.5*Math.cos(5*3.14159/16),ue=.5*Math.cos(3*3.14159/8),he=.5*Math.cos(7*3.14159/16);for(var we=new Array(4),Be=new Array(4),Re=new Array(4),ye=new Array(4),rt=0;rt<8;++rt){var Ue=rt*8;we[0]=_*M[Ue+2],we[1]=ue*M[Ue+2],we[2]=_*M[Ue+6],we[3]=ue*M[Ue+6],Be[0]=K*M[Ue+1]+k*M[Ue+3]+j*M[Ue+5]+he*M[Ue+7],Be[1]=k*M[Ue+1]-he*M[Ue+3]-K*M[Ue+5]-j*M[Ue+7],Be[2]=j*M[Ue+1]-K*M[Ue+3]+he*M[Ue+5]+k*M[Ue+7],Be[3]=he*M[Ue+1]-j*M[Ue+3]+k*M[Ue+5]-K*M[Ue+7],Re[0]=R*(M[Ue+0]+M[Ue+4]),Re[3]=R*(M[Ue+0]-M[Ue+4]),Re[1]=we[0]+we[3],Re[2]=we[1]-we[2],ye[0]=Re[0]+Re[1],ye[1]=Re[3]+Re[2],ye[2]=Re[3]-Re[2],ye[3]=Re[0]-Re[1],M[Ue+0]=ye[0]+Be[0],M[Ue+1]=ye[1]+Be[1],M[Ue+2]=ye[2]+Be[2],M[Ue+3]=ye[3]+Be[3],M[Ue+4]=ye[3]-Be[3],M[Ue+5]=ye[2]-Be[2],M[Ue+6]=ye[1]-Be[1],M[Ue+7]=ye[0]-Be[0]}for(var Je=0;Je<8;++Je)we[0]=_*M[16+Je],we[1]=ue*M[16+Je],we[2]=_*M[48+Je],we[3]=ue*M[48+Je],Be[0]=K*M[8+Je]+k*M[24+Je]+j*M[40+Je]+he*M[56+Je],Be[1]=k*M[8+Je]-he*M[24+Je]-K*M[40+Je]-j*M[56+Je],Be[2]=j*M[8+Je]-K*M[24+Je]+he*M[40+Je]+k*M[56+Je],Be[3]=he*M[8+Je]-j*M[24+Je]+k*M[40+Je]-K*M[56+Je],Re[0]=R*(M[Je]+M[32+Je]),Re[3]=R*(M[Je]-M[32+Je]),Re[1]=we[0]+we[3],Re[2]=we[1]-we[2],ye[0]=Re[0]+Re[1],ye[1]=Re[3]+Re[2],ye[2]=Re[3]-Re[2],ye[3]=Re[0]-Re[1],M[0+Je]=ye[0]+Be[0],M[8+Je]=ye[1]+Be[1],M[16+Je]=ye[2]+Be[2],M[24+Je]=ye[3]+Be[3],M[32+Je]=ye[3]-Be[3],M[40+Je]=ye[2]-Be[2],M[48+Je]=ye[1]-Be[1],M[56+Je]=ye[0]-Be[0]}function ut(M){for(var R=0;R<64;++R){var K=M[0][R],_=M[1][R],k=M[2][R];M[0][R]=K+1.5747*k,M[1][R]=K-.1873*_-.4682*k,M[2][R]=K+1.8556*_}}function xt(M,R,K){for(var _=0;_<64;++_)R[K+_]=cg.toHalfFloat(on(M[_]))}function on(M){return M<=1?Math.sign(M)*Math.pow(Math.abs(M),2.2):Math.sign(M)*Math.pow(V,Math.abs(M)-1)}function L(M){return new DataView(M.array.buffer,M.offset.value,M.size)}function F(M){var R=M.viewer.buffer.slice(M.offset.value,M.offset.value+M.size),K=new Uint8Array(He(R)),_=new Uint8Array(K.length);return Ne(K),Se(K,_),new DataView(_.buffer)}function ce(M){var R=M.array.slice(M.offset.value,M.offset.value+M.size),K=up(R),_=new Uint8Array(K.length);return Ne(K),Se(K,_),new DataView(_.buffer)}function Ye(M){for(var R=M.viewer,K={value:M.offset.value},_=new Uint16Array(M.width*M.scanlineBlockSize*(M.channels*M.type)),k=new Uint8Array(8192),j=0,ue=new Array(M.channels),he=0;he<M.channels;he++)ue[he]={},ue[he].start=j,ue[he].end=ue[he].start,ue[he].nx=M.width,ue[he].ny=M.lines,ue[he].size=M.type,j+=ue[he].nx*ue[he].ny*ue[he].size;var we=Ce(R,K),Be=Ce(R,K);if(Be>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(we<=Be)for(var he=0;he<Be-we+1;he++)k[he+we]=ke(R,K);var Re=new Uint16Array(65536),ye=Y(k,Re),rt=xe(R,K);ot(M.array,R,K,rt,_,j);for(var he=0;he<M.channels;++he)for(var Ue=ue[he],Je=0;Je<ue[he].size;++Je)Bt(_,Ue.start+Je,Ue.nx,Ue.size,Ue.ny,Ue.nx*Ue.size,ye);ee(Re,_,j);for(var pt=0,yt=new Uint8Array(_.buffer.byteLength),bt=0;bt<M.lines;bt++)for(var nt=0;nt<M.channels;nt++){var Ue=ue[nt],Zt=Ue.nx*Ue.size,It=new Uint8Array(_.buffer,Ue.end*2,Zt*2);yt.set(It,pt),pt+=Zt*2,Ue.end+=Zt}return new DataView(yt.buffer)}function Xe(M){var R=M.array.slice(M.offset.value,M.offset.value+M.size),K=up(R);const _=M.lines*M.channels*M.width,k=M.type==1?new Uint16Array(_):new Uint32Array(_);let j=0,ue=0;const he=new Array(4);for(let we=0;we<M.lines;we++)for(let Be=0;Be<M.channels;Be++){let Re=0;switch(M.type){case 1:he[0]=j,he[1]=he[0]+M.width,j=he[1]+M.width;for(let ye=0;ye<M.width;++ye){const rt=K[he[0]++]<<8|K[he[1]++];Re+=rt,k[ue]=Re,ue++}break;case 2:he[0]=j,he[1]=he[0]+M.width,he[2]=he[1]+M.width,j=he[2]+M.width;for(let ye=0;ye<M.width;++ye){const rt=K[he[0]++]<<24|K[he[1]++]<<16|K[he[2]++]<<8;Re+=rt,k[ue]=Re,ue++}break}}return new DataView(k.buffer)}function Fe(M){var R=M.viewer,K={value:M.offset.value},_=new Uint8Array(M.width*M.lines*(M.channels*M.type*2)),k={version:lt(R,K),unknownUncompressedSize:lt(R,K),unknownCompressedSize:lt(R,K),acCompressedSize:lt(R,K),dcCompressedSize:lt(R,K),rleCompressedSize:lt(R,K),rleUncompressedSize:lt(R,K),rleRawSize:lt(R,K),totalAcUncompressedCount:lt(R,K),totalDcUncompressedCount:lt(R,K),acCompression:lt(R,K)};if(k.version<2)throw"EXRLoader.parse: "+xi.compression+" version "+k.version+" is unsupported";for(var j=new Array,ue=Ce(R,K)-2;ue>0;){var he=tt(R.buffer,K),we=ke(R,K),Be=we>>2&3,Re=(we>>4)-1,ye=new Int8Array([Re])[0],rt=ke(R,K);j.push({name:he,index:ye,type:rt,compression:Be}),ue-=he.length+3}for(var Ue=xi.channels,Je=new Array(M.channels),pt=0;pt<M.channels;++pt){var yt=Je[pt]={},bt=Ue[pt];yt.name=bt.name,yt.compression=0,yt.decoded=!1,yt.type=bt.pixelType,yt.pLinear=bt.pLinear,yt.width=M.width,yt.height=M.lines}for(var nt={idx:new Array(3)},Zt=0;Zt<M.channels;++Zt)for(var yt=Je[Zt],pt=0;pt<j.length;++pt){var It=j[pt];yt.name==It.name&&(yt.compression=It.compression,It.index>=0&&(nt.idx[It.index]=Zt),yt.offset=Zt)}if(k.acCompressedSize>0)switch(k.acCompression){case 0:var Rt=new Uint16Array(k.totalAcUncompressedCount);ot(M.array,R,K,k.acCompressedSize,Rt,k.totalAcUncompressedCount);break;case 1:var Yt=M.array.slice(K.value,K.value+k.totalAcUncompressedCount),sn=up(Yt),Rt=new Uint16Array(sn.buffer);K.value+=k.totalAcUncompressedCount;break}if(k.dcCompressedSize>0){var an={array:M.array,offset:K,size:k.dcCompressedSize},qt=new Uint16Array(ce(an).buffer);K.value+=k.dcCompressedSize}if(k.rleRawSize>0){var Yt=M.array.slice(K.value,K.value+k.rleCompressedSize),sn=up(Yt),dn=He(sn.buffer);K.value+=k.rleCompressedSize}for(var Dn=0,Vt=new Array(Je.length),pt=0;pt<Vt.length;++pt)Vt[pt]=new Array;for(var Nn=0;Nn<M.lines;++Nn)for(var nn=0;nn<Je.length;++nn)Vt[nn].push(Dn),Dn+=Je[nn].width*M.type*2;Ve(nt,Vt,Je,Rt,qt,_);for(var pt=0;pt<Je.length;++pt){var yt=Je[pt];if(!yt.decoded)switch(yt.compression){case 2:for(var Jt=0,Wn=0,Nn=0;Nn<M.lines;++Nn){for(var Xs=Vt[pt][Jt],Ji=0;Ji<yt.width;++Ji){for(var $r=0;$r<2*yt.type;++$r)_[Xs++]=dn[Wn+$r*yt.width*yt.height];Wn++}Jt++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(_.buffer)}function tt(M,R){for(var K=new Uint8Array(M),_=0;K[R.value+_]!=0;)_+=1;var k=new TextDecoder().decode(K.slice(R.value,R.value+_));return R.value=R.value+_+1,k}function ze(M,R,K){var _=new TextDecoder().decode(new Uint8Array(M).slice(R.value,R.value+K));return R.value=R.value+K,_}function Ae(M,R){var K=me(M,R),_=xe(M,R);return[K,_]}function ie(M,R){var K=xe(M,R),_=xe(M,R);return[K,_]}function me(M,R){var K=M.getInt32(R.value,!0);return R.value=R.value+4,K}function xe(M,R){var K=M.getUint32(R.value,!0);return R.value=R.value+4,K}function Ke(M,R){var K=M[R.value];return R.value=R.value+1,K}function ke(M,R){var K=M.getUint8(R.value);return R.value=R.value+1,K}const lt=function(M,R){let K;return"getBigInt64"in DataView.prototype?K=Number(M.getBigInt64(R.value,!0)):K=M.getUint32(R.value+4,!0)+Number(M.getUint32(R.value,!0)<<32),R.value+=8,K};function mt(M,R){var K=M.getFloat32(R.value,!0);return R.value+=4,K}function ae(M,R){return cg.toHalfFloat(mt(M,R))}function pe(M){var R=(M&31744)>>10,K=M&1023;return(M>>15?-1:1)*(R?R===31?K?NaN:1/0:Math.pow(2,R-15)*(1+K/1024):6103515625e-14*(K/1024))}function Ce(M,R){var K=M.getUint16(R.value,!0);return R.value+=2,K}function Le(M,R){return pe(Ce(M,R))}function qe(M,R,K,_){for(var k=K.value,j=[];K.value<k+_-1;){var ue=tt(R,K),he=me(M,K),we=ke(M,K);K.value+=3;var Be=me(M,K),Re=me(M,K);j.push({name:ue,pixelType:he,pLinear:we,xSampling:Be,ySampling:Re})}return K.value+=1,j}function Pt(M,R){var K=mt(M,R),_=mt(M,R),k=mt(M,R),j=mt(M,R),ue=mt(M,R),he=mt(M,R),we=mt(M,R),Be=mt(M,R);return{redX:K,redY:_,greenX:k,greenY:j,blueX:ue,blueY:he,whiteX:we,whiteY:Be}}function Cn(M,R){var K=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],_=ke(M,R);return K[_]}function Rn(M,R){var K=xe(M,R),_=xe(M,R),k=xe(M,R),j=xe(M,R);return{xMin:K,yMin:_,xMax:k,yMax:j}}function Vo(M,R){var K=["INCREASING_Y"],_=ke(M,R);return K[_]}function rn(M,R){var K=mt(M,R),_=mt(M,R);return[K,_]}function Di(M,R){var K=mt(M,R),_=mt(M,R),k=mt(M,R);return[K,_,k]}function ri(M,R,K,_,k){if(_==="string"||_==="stringvector"||_==="iccProfile")return ze(R,K,k);if(_==="chlist")return qe(M,R,K,k);if(_==="chromaticities")return Pt(M,K);if(_==="compression")return Cn(M,K);if(_==="box2i")return Rn(M,K);if(_==="lineOrder")return Vo(M,K);if(_==="float")return mt(M,K);if(_==="v2f")return rn(M,K);if(_==="v3f")return Di(M,K);if(_==="int")return me(M,K);if(_==="rational")return Ae(M,K);if(_==="timecode")return ie(M,K);if(_==="preview")return K.value+=k,"skipped";K.value+=k}function Jg(M,R,K){const _={};if(M.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";_.version=M.getUint8(4);const k=M.getUint8(5);_.spec={singleTile:!!(k&2),longName:!!(k&4),deepFormat:!!(k&8),multiPart:!!(k&16)},K.value=8;for(var j=!0;j;){var ue=tt(R,K);if(ue==0)j=!1;else{var he=tt(R,K),we=xe(M,K),Be=ri(M,R,K,he,we);Be===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${he}'.`):_[ue]=Be}}if(k!=0)throw console.error("EXRHeader:",_),"THREE.EXRLoader: provided file is currently unsupported.";return _}function Og(M,R,K,_,k){const j={size:0,viewer:R,array:K,offset:_,width:M.dataWindow.xMax-M.dataWindow.xMin+1,height:M.dataWindow.yMax-M.dataWindow.yMin+1,channels:M.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:M.channels[0].pixelType,uncompress:null,getter:null,format:null,[Pu?"colorSpace":"encoding"]:null};switch(M.compression){case"NO_COMPRESSION":j.lines=1,j.uncompress=L;break;case"RLE_COMPRESSION":j.lines=1,j.uncompress=F;break;case"ZIPS_COMPRESSION":j.lines=1,j.uncompress=ce;break;case"ZIP_COMPRESSION":j.lines=16,j.uncompress=ce;break;case"PIZ_COMPRESSION":j.lines=32,j.uncompress=Ye;break;case"PXR24_COMPRESSION":j.lines=16,j.uncompress=Xe;break;case"DWAA_COMPRESSION":j.lines=32,j.uncompress=Fe;break;case"DWAB_COMPRESSION":j.lines=256,j.uncompress=Fe;break;default:throw"EXRLoader.parse: "+M.compression+" is unsupported"}if(j.scanlineBlockSize=j.lines,j.type==1)switch(k){case Zi:j.getter=Le,j.inputSize=2;break;case Ti:j.getter=Ce,j.inputSize=2;break}else if(j.type==2)switch(k){case Zi:j.getter=mt,j.inputSize=4;break;case Ti:j.getter=ae,j.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+j.type+" for "+M.compression+".";j.blockCount=(M.dataWindow.yMax+1)/j.scanlineBlockSize;for(var ue=0;ue<j.blockCount;ue++)lt(R,_);j.outputChannels=j.channels==3?4:j.channels;const he=j.width*j.height*j.outputChannels;switch(k){case Zi:j.byteArray=new Float32Array(he),j.channels<j.outputChannels&&j.byteArray.fill(1,0,he);break;case Ti:j.byteArray=new Uint16Array(he),j.channels<j.outputChannels&&j.byteArray.fill(15360,0,he);break;default:console.error("THREE.EXRLoader: unsupported type: ",k);break}return j.bytesPerLine=j.width*j.inputSize*j.channels,j.outputChannels==4?j.format=oo:j.format=$Z,Pu?j.colorSpace="srgb-linear":j.encoding=3e3,j}const Vs=new DataView(e),jr=new Uint8Array(e),qr={value:0},xi=Jg(Vs,e,qr),Lt=Og(xi,Vs,jr,qr,this.type),Qg={value:0},su={R:0,G:1,B:2,A:3,Y:0};for(let M=0;M<Lt.height/Lt.scanlineBlockSize;M++){const R=xe(Vs,qr);Lt.size=xe(Vs,qr),Lt.lines=R+Lt.scanlineBlockSize>Lt.height?Lt.height-R:Lt.scanlineBlockSize;const _=Lt.size<Lt.lines*Lt.bytesPerLine?Lt.uncompress(Lt):L(Lt);qr.value+=Lt.size;for(let k=0;k<Lt.scanlineBlockSize;k++){const j=k+M*Lt.scanlineBlockSize;if(j>=Lt.height)break;for(let ue=0;ue<Lt.channels;ue++){const he=su[xi.channels[ue].name];for(let we=0;we<Lt.width;we++){Qg.value=(k*(Lt.channels*Lt.width)+ue*Lt.width+we)*Lt.inputSize;const Be=(Lt.height-1-j)*(Lt.width*Lt.outputChannels)+we*Lt.outputChannels+he;Lt.byteArray[Be]=Lt.getter(_,Qg)}}}}return{header:xi,width:Lt.width,height:Lt.height,data:Lt.byteArray,format:Lt.format,[Pu?"colorSpace":"encoding"]:Lt[Pu?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,n,i,o){function r(s,a){Pu?s.colorSpace=a.colorSpace:s.encoding=a.encoding,s.minFilter=bn,s.magFilter=bn,s.generateMipmaps=!1,s.flipY=!1,n&&n(s,a)}return super.load(e,r,i,o)}}function ih(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(let i=0;i<n.length;i++)if(!Object.prototype.hasOwnProperty.call(e,n[i])||!Object.is(t[n[i]],e[n[i]]))return!1;return!0}let Dy=null;async function yH(t){Dy||(Dy=new Fj);let e=typeof t=="string"?await(await fetch(t)).json():t;return Dy.parse(e)}function Q2(t){return z3(yH,[t])}Q2.preload=t=>L3(yH,[t]);Q2.clear=t=>E3([t]);const kj=["string","number"],Tj=t=>{let e="";const n=[];return x.Children.forEach(t,i=>{kj.includes(typeof i)?e+=i+"":n.push(i)}),[e,...n]},_j=x.forwardRef(({font:t,letterSpacing:e=0,lineHeight:n=1,size:i=1,height:o=.2,bevelThickness:r=.1,bevelSize:s=.01,bevelEnabled:a=!1,bevelOffset:l=0,bevelSegments:g=4,curveSegments:c=8,smooth:C,children:d,...h},p)=>{x.useMemo(()=>e0({RenamedTextGeometry:Yj}),[]);const v=x.useRef(null),f=Q2(t),A=x.useMemo(()=>({font:f,size:i,height:o,bevelThickness:r,bevelSize:s,bevelEnabled:a,bevelSegments:g,bevelOffset:l,curveSegments:c,letterSpacing:e,lineHeight:n}),[f,i,o,r,s,a,g,l,c,e,n]),[b,...m]=x.useMemo(()=>Tj(d),[d]),B=x.useMemo(()=>[b,A],[b,A]);return x.useLayoutEffect(()=>{C&&(v.current.geometry=Cj(v.current.geometry,C),v.current.geometry.computeVertexNormals())},[B,C]),x.useImperativeHandle(p,()=>v.current,[]),x.createElement("mesh",pn({},h,{ref:v}),x.createElement("renamedTextGeometry",{args:B}),m)});function Uj(t,e,n,i){const o=class extends ao{constructor(s={}){const a=Object.entries(t);super({uniforms:a.reduce((l,[g,c])=>{const C=Vm.clone({[g]:{value:c}});return{...l,...C}},{}),vertexShader:e,fragmentShader:n}),this.key="",a.forEach(([l])=>Object.defineProperty(this,l,{get:()=>this.uniforms[l].value,set:g=>this.uniforms[l].value=g})),Object.assign(this,s),i&&i(this)}};return o.key=SM.generateUUID(),o}function Pj(t,e,n){const i=li(d=>d.size),o=li(d=>d.viewport),r=typeof t=="number"?t:i.width*o.dpr,s=typeof e=="number"?e:i.height*o.dpr,a=(typeof t=="number"?n:t)||{},{samples:l=0,depth:g,...c}=a,C=x.useMemo(()=>{const d=new Ar(r,s,{minFilter:bn,magFilter:bn,type:Ti,...c});return g&&(d.depthTexture=new h2(r,s,Zi)),d.samples=l,d},[]);return x.useLayoutEffect(()=>{C.setSize(r,s),l&&(C.samples=l)},[l,C,r,s]),x.useEffect(()=>()=>C.dispose(),[]),C}const Dj=t=>typeof t=="function",Jj=x.forwardRef(({envMap:t,resolution:e=256,frames:n=1/0,makeDefault:i,children:o,...r},s)=>{const a=li(({set:f})=>f),l=li(({camera:f})=>f),g=li(({size:f})=>f),c=x.useRef(null),C=x.useRef(null),d=Pj(e);x.useLayoutEffect(()=>{r.manual||(c.current.aspect=g.width/g.height)},[g,r]),x.useLayoutEffect(()=>{c.current.updateProjectionMatrix()});let h=0,p=null;const v=Dj(o);return Pg(f=>{v&&(n===1/0||h<n)&&(C.current.visible=!1,f.gl.setRenderTarget(d),p=f.scene.background,t&&(f.scene.background=t),f.gl.render(f.scene,c.current),f.scene.background=p,f.gl.setRenderTarget(null),C.current.visible=!0,h++)}),x.useLayoutEffect(()=>{if(i){const f=l;return a(()=>({camera:c.current})),()=>a(()=>({camera:f}))}},[c,i,a]),x.createElement(x.Fragment,null,x.createElement("perspectiveCamera",pn({ref:sH([c,s])},r),!v&&o),x.createElement("group",{ref:C},v&&o(d.texture)))}),vH=x.forwardRef(({makeDefault:t,camera:e,regress:n,domElement:i,enableDamping:o=!0,keyEvents:r=!1,onChange:s,onStart:a,onEnd:l,...g},c)=>{const C=li(w=>w.invalidate),d=li(w=>w.camera),h=li(w=>w.gl),p=li(w=>w.events),v=li(w=>w.setEvents),f=li(w=>w.set),A=li(w=>w.get),b=li(w=>w.performance),m=e||d,B=i||p.connected||h.domElement,Z=x.useMemo(()=>new Nj(m),[m]);return Pg(()=>{Z.enabled&&Z.update()},-1),x.useEffect(()=>(r&&Z.connect(r===!0?B:r),Z.connect(B),()=>void Z.dispose()),[r,B,n,Z,C]),x.useEffect(()=>{const w=V=>{C(),n&&b.regress(),s&&s(V)},W=V=>{a&&a(V)},X=V=>{l&&l(V)};return Z.addEventListener("change",w),Z.addEventListener("start",W),Z.addEventListener("end",X),()=>{Z.removeEventListener("start",W),Z.removeEventListener("end",X),Z.removeEventListener("change",w)}},[s,a,l,Z,C,v]),x.useEffect(()=>{if(t){const w=A().controls;return f({controls:Z}),()=>f({controls:w})}},[t,Z]),x.createElement("primitive",pn({ref:c,object:Z,enableDamping:o},g))}),Oj=Uj({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,cellThickness:.5,sectionThickness:1,cellColor:new je,sectionColor:new je,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new E,worldPlanePosition:new E},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      float dist = distance(worldCamProjPosition, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${parseInt(Eg.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),Qj=x.forwardRef(({args:t,cellColor:e="#000000",sectionColor:n="#2080ff",cellSize:i=.5,sectionSize:o=1,followCamera:r=!1,infiniteGrid:s=!1,fadeDistance:a=100,fadeStrength:l=1,cellThickness:g=.5,sectionThickness:c=1,side:C=Si,...d},h)=>{e0({GridMaterial:Oj});const p=x.useRef(null),v=new js,f=new E(0,1,0),A=new E(0,0,0);Pg(B=>{v.setFromNormalAndCoplanarPoint(f,A).applyMatrix4(p.current.matrixWorld);const Z=p.current.material,w=Z.uniforms.worldCamProjPosition,W=Z.uniforms.worldPlanePosition;v.projectPoint(B.camera.position,w.value),W.value.set(0,0,0).applyMatrix4(p.current.matrixWorld)});const b={cellSize:i,sectionSize:o,cellColor:e,sectionColor:n,cellThickness:g,sectionThickness:c},m={fadeDistance:a,fadeStrength:l,infiniteGrid:s,followCamera:r};return x.createElement("mesh",pn({ref:sH([p,h]),frustumCulled:!1},d),x.createElement("gridMaterial",pn({transparent:!0,"extensions-derivatives":!0,side:C},b,m)),x.createElement("planeGeometry",{args:t}))}),Jy={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},jj="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Kx=t=>Array.isArray(t);function GH({files:t=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:e="",preset:n=void 0,encoding:i=void 0,extensions:o}={}){var r,s,a;let l=null,g=!1,c;if(n){if(!(n in Jy))throw new Error("Preset must be one of: "+Object.keys(Jy).join(", "));t=Jy[n],e=jj}if(g=Kx(t),c=Kx(t)?"cube":t.startsWith("data:application/exr")?"exr":t.startsWith("data:application/hdr")?"hdr":(r=t.split(".").pop())==null||(s=r.split("?"))==null||(a=s.shift())==null?void 0:a.toLowerCase(),l=g?A3:c==="hdr"?Lj:c==="exr"?Ej:null,!l)throw new Error("useEnvironment: Unrecognized file extension: "+t);const C=U2(l,g?[t]:t,v=>{v.setPath==null||v.setPath(e),o&&o(v)}),d=g?C[0]:C;d.mapping=g?Bs:wI;const h=3001,p=3e3;return"colorSpace"in d?d.colorSpace=i??g?"srgb":"srgb-linear":d.encoding=i??g?h:p,d}const qj=t=>t.current&&t.current.isScene,$j=t=>qj(t)?t.current:t;function j2(t,e,n,i,o=0){const r=$j(e||n),s=r.background,a=r.environment,l=r.backgroundBlurriness||0;return t!=="only"&&(r.environment=i),t&&(r.background=i),t&&r.backgroundBlurriness!==void 0&&(r.backgroundBlurriness=o),()=>{t!=="only"&&(r.environment=a),t&&(r.background=s),t&&r.backgroundBlurriness!==void 0&&(r.backgroundBlurriness=l)}}function q2({scene:t,background:e=!1,blur:n,map:i}){const o=li(r=>r.scene);return x.useLayoutEffect(()=>{if(i)return j2(e,t,o,i,n)},[o,t,i,e,n]),null}function BH({background:t=!1,scene:e,blur:n,...i}){const o=GH(i),r=li(s=>s.scene);return x.useLayoutEffect(()=>j2(t,e,r,o,n),[o,t,e,r,n]),null}function e7({children:t,near:e=1,far:n=1e3,resolution:i=256,frames:o=1,map:r,background:s=!1,blur:a,scene:l,files:g,path:c,preset:C=void 0,extensions:d}){const h=li(m=>m.gl),p=li(m=>m.scene),v=x.useRef(null),[f]=x.useState(()=>new ud),A=x.useMemo(()=>{const m=new I2(i);return m.texture.type=Ti,m},[i]);x.useLayoutEffect(()=>(o===1&&v.current.update(h,f),j2(s,l,p,A.texture,a)),[t,f,A.texture,l,p,s,o,h]);let b=1;return Pg(()=>{(o===1/0||b<o)&&(v.current.update(h,f),b++)}),x.createElement(x.Fragment,null,$Q(x.createElement(x.Fragment,null,t,x.createElement("cubeCamera",{ref:v,args:[e,n,A]}),g||C?x.createElement(BH,{background:!0,files:g,preset:C,path:c,extensions:d}):r?x.createElement(q2,{background:!0,map:r,extensions:d}):null),f))}function t7(t){var e,n,i,o;const r=GH(t),s=t.map||r;x.useMemo(()=>e0({GroundProjectedEnvImpl:xj}),[]);const a=x.useMemo(()=>[s],[s]),l=(e=t.ground)==null?void 0:e.height,g=(n=t.ground)==null?void 0:n.radius,c=(i=(o=t.ground)==null?void 0:o.scale)!==null&&i!==void 0?i:1e3;return x.createElement(x.Fragment,null,x.createElement(q2,pn({},t,{map:s})),x.createElement("groundProjectedEnvImpl",{args:a,scale:c,height:l,radius:g}))}function n7(t){return t.ground?x.createElement(t7,t):t.map?x.createElement(q2,t):t.children?x.createElement(e7,t):x.createElement(BH,t)}function i7(t,e,n=new E){const i=Math.PI*(t-.5),o=2*Math.PI*(e-.5);return n.x=Math.cos(o),n.y=Math.sin(i),n.z=Math.sin(o),n}const o7=x.forwardRef(({inclination:t=.6,azimuth:e=.1,distance:n=1e3,mieCoefficient:i=.005,mieDirectionalG:o=.8,rayleigh:r=.5,turbidity:s=10,sunPosition:a=i7(t,e),...l},g)=>{const c=x.useMemo(()=>new E().setScalar(n),[n]),[C]=x.useState(()=>new D2);return x.createElement("primitive",pn({object:C,ref:g,"material-uniforms-mieCoefficient-value":i,"material-uniforms-mieDirectionalG-value":o,"material-uniforms-rayleigh-value":r,"material-uniforms-sunPosition-value":a,"material-uniforms-turbidity-value":s,scale:c},l))});var ZH={exports:{}},r7="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",s7=r7,a7=s7;function wH(){}function SH(){}SH.resetWarningCache=wH;var l7=function(){function t(i,o,r,s,a,l){if(l!==a7){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:SH,resetWarningCache:wH};return n.PropTypes=n,n};ZH.exports=l7();var g7=ZH.exports;const yn=LI(g7);var wo=function(){return wo=Object.assign||function(e){for(var n,i=1,o=arguments.length;i<o;i++){n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},wo.apply(this,arguments)};function QI(t,e,n,i){function o(r){return r instanceof n?r:new n(function(s){s(r)})}return new(n||(n=Promise))(function(r,s){function a(c){try{g(i.next(c))}catch(C){s(C)}}function l(c){try{g(i.throw(c))}catch(C){s(C)}}function g(c){c.done?r(c.value):o(c.value).then(a,l)}g((i=i.apply(t,e||[])).next())})}function jI(t,e){var n={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,o,r,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(g){return function(c){return l([g,c])}}function l(g){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,g[0]&&(n=0)),n;)try{if(i=1,o&&(r=g[0]&2?o.return:g[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,g[1])).done)return r;switch(o=0,r&&(g=[g[0]&2,r.value]),g[0]){case 0:case 1:r=g;break;case 4:return n.label++,{value:g[1],done:!1};case 5:n.label++,o=g[1],g=[0];continue;case 7:g=n.ops.pop(),n.trys.pop();continue;default:if(r=n.trys,!(r=r.length>0&&r[r.length-1])&&(g[0]===6||g[0]===2)){n=0;continue}if(g[0]===3&&(!r||g[1]>r[0]&&g[1]<r[3])){n.label=g[1];break}if(g[0]===6&&n.label<r[1]){n.label=r[1],r=g;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(g);break}r[2]&&n.ops.pop(),n.trys.pop();continue}g=e.call(t,n)}catch(c){g=[6,c],o=0}finally{i=r=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}function c7(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),o,r=[],s;try{for(;(e===void 0||e-- >0)&&!(o=i.next()).done;)r.push(o.value)}catch(a){s={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return r}function I7(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c7(arguments[e]));return t}function Ff(t,e,n){if(n||arguments.length===2)for(var i=0,o=e.length,r;i<o;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}var Bn="-ms-",VC="-moz-",ln="-webkit-",RH="comm",n0="rule",$2="decl",u7="@import",WH="@keyframes",C7="@layer",d7=Math.abs,ew=String.fromCharCode,aB=Object.assign;function h7(t,e){return fi(t,0)^45?(((e<<2^fi(t,0))<<2^fi(t,1))<<2^fi(t,2))<<2^fi(t,3):0}function xH(t){return t.trim()}function Js(t,e){return(t=e.exec(t))?t[0]:t}function kt(t,e,n){return t.replace(e,n)}function jp(t,e){return t.indexOf(e)}function fi(t,e){return t.charCodeAt(e)|0}function VI(t,e,n){return t.slice(e,n)}function hs(t){return t.length}function VH(t){return t.length}function IC(t,e){return e.push(t),t}function A7(t,e){return t.map(e).join("")}function zx(t,e){return t.filter(function(n){return!Js(n,e)})}var i0=1,XI=1,XH=0,pr=0,ni=0,qI="";function o0(t,e,n,i,o,r,s,a){return{value:t,root:e,parent:n,type:i,props:o,children:r,line:i0,column:XI,length:s,return:"",siblings:a}}function Ka(t,e){return aB(o0("",null,null,"",null,null,0,t.siblings),t,{length:-t.length},e)}function Yc(t){for(;t.root;)t=Ka(t.root,{children:[t]});IC(t,t.siblings)}function p7(){return ni}function f7(){return ni=pr>0?fi(qI,--pr):0,XI--,ni===10&&(XI=1,i0--),ni}function Er(){return ni=pr<XH?fi(qI,pr++):0,XI++,ni===10&&(XI=1,i0++),ni}function yg(){return fi(qI,pr)}function qp(){return pr}function r0(t,e){return VI(qI,t,e)}function lB(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function m7(t){return i0=XI=1,XH=hs(qI=t),pr=0,[]}function b7(t){return qI="",t}function Oy(t){return xH(r0(pr-1,gB(t===91?t+2:t===40?t+1:t)))}function y7(t){for(;(ni=yg())&&ni<33;)Er();return lB(t)>2||lB(ni)>3?"":" "}function v7(t,e){for(;--e&&Er()&&!(ni<48||ni>102||ni>57&&ni<65||ni>70&&ni<97););return r0(t,qp()+(e<6&&yg()==32&&Er()==32))}function gB(t){for(;Er();)switch(ni){case t:return pr;case 34:case 39:t!==34&&t!==39&&gB(ni);break;case 40:t===41&&gB(t);break;case 92:Er();break}return pr}function G7(t,e){for(;Er()&&t+ni!==47+10;)if(t+ni===42+42&&yg()===47)break;return"/*"+r0(e,pr-1)+"*"+ew(t===47?t:Er())}function B7(t){for(;!lB(yg());)Er();return r0(t,pr)}function Z7(t){return b7($p("",null,null,null,[""],t=m7(t),0,[0],t))}function $p(t,e,n,i,o,r,s,a,l){for(var g=0,c=0,C=s,d=0,h=0,p=0,v=1,f=1,A=1,b=0,m="",B=o,Z=r,w=i,W=m;f;)switch(p=b,b=Er()){case 40:if(p!=108&&fi(W,C-1)==58){jp(W+=kt(Oy(b),"&","&\f"),"&\f")!=-1&&(A=-1);break}case 34:case 39:case 91:W+=Oy(b);break;case 9:case 10:case 13:case 32:W+=y7(p);break;case 92:W+=v7(qp()-1,7);continue;case 47:switch(yg()){case 42:case 47:IC(w7(G7(Er(),qp()),e,n,l),l);break;default:W+="/"}break;case 123*v:a[g++]=hs(W)*A;case 125*v:case 59:case 0:switch(b){case 0:case 125:f=0;case 59+c:A==-1&&(W=kt(W,/\f/g,"")),h>0&&hs(W)-C&&IC(h>32?Ex(W+";",i,n,C-1,l):Ex(kt(W," ","")+";",i,n,C-2,l),l);break;case 59:W+=";";default:if(IC(w=Lx(W,e,n,g,c,o,a,m,B=[],Z=[],C,r),r),b===123)if(c===0)$p(W,e,w,w,B,r,C,a,Z);else switch(d===99&&fi(W,3)===110?100:d){case 100:case 108:case 109:case 115:$p(t,w,w,i&&IC(Lx(t,w,w,0,0,o,a,m,o,B=[],C,Z),Z),o,Z,C,a,i?B:Z);break;default:$p(W,w,w,w,[""],Z,0,a,Z)}}g=c=h=0,v=A=1,m=W="",C=s;break;case 58:C=1+hs(W),h=p;default:if(v<1){if(b==123)--v;else if(b==125&&v++==0&&f7()==125)continue}switch(W+=ew(b),b*v){case 38:A=c>0?1:(W+="\f",-1);break;case 44:a[g++]=(hs(W)-1)*A,A=1;break;case 64:yg()===45&&(W+=Oy(Er())),d=yg(),c=C=hs(m=W+=B7(qp())),b++;break;case 45:p===45&&hs(W)==2&&(v=0)}}return r}function Lx(t,e,n,i,o,r,s,a,l,g,c,C){for(var d=o-1,h=o===0?r:[""],p=VH(h),v=0,f=0,A=0;v<i;++v)for(var b=0,m=VI(t,d+1,d=d7(f=s[v])),B=t;b<p;++b)(B=xH(f>0?h[b]+" "+m:kt(m,/&\f/g,h[b])))&&(l[A++]=B);return o0(t,e,n,o===0?n0:a,l,g,c,C)}function w7(t,e,n,i){return o0(t,e,n,RH,ew(p7()),VI(t,2,-2),0,i)}function Ex(t,e,n,i,o){return o0(t,e,n,$2,VI(t,0,i),VI(t,i+1,-1),i,o)}function NH(t,e,n){switch(h7(t,e)){case 5103:return ln+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ln+t+t;case 4789:return VC+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return ln+t+VC+t+Bn+t+t;case 5936:switch(fi(t,e+11)){case 114:return ln+t+Bn+kt(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return ln+t+Bn+kt(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return ln+t+Bn+kt(t,/[svh]\w+-[tblr]{2}/,"lr")+t}case 6828:case 4268:case 2903:return ln+t+Bn+t+t;case 6165:return ln+t+Bn+"flex-"+t+t;case 5187:return ln+t+kt(t,/(\w+).+(:[^]+)/,ln+"box-$1$2"+Bn+"flex-$1$2")+t;case 5443:return ln+t+Bn+"flex-item-"+kt(t,/flex-|-self/g,"")+(Js(t,/flex-|baseline/)?"":Bn+"grid-row-"+kt(t,/flex-|-self/g,""))+t;case 4675:return ln+t+Bn+"flex-line-pack"+kt(t,/align-content|flex-|-self/g,"")+t;case 5548:return ln+t+Bn+kt(t,"shrink","negative")+t;case 5292:return ln+t+Bn+kt(t,"basis","preferred-size")+t;case 6060:return ln+"box-"+kt(t,"-grow","")+ln+t+Bn+kt(t,"grow","positive")+t;case 4554:return ln+kt(t,/([^-])(transform)/g,"$1"+ln+"$2")+t;case 6187:return kt(kt(kt(t,/(zoom-|grab)/,ln+"$1"),/(image-set)/,ln+"$1"),t,"")+t;case 5495:case 3959:return kt(t,/(image-set\([^]*)/,ln+"$1$`$1");case 4968:return kt(kt(t,/(.+:)(flex-)?(.*)/,ln+"box-pack:$3"+Bn+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ln+t+t;case 4200:if(!Js(t,/flex-|baseline/))return Bn+"grid-column-align"+VI(t,e)+t;break;case 2592:case 3360:return Bn+kt(t,"template-","")+t;case 4384:case 3616:return n&&n.some(function(i,o){return e=o,Js(i.props,/grid-\w+-end/)})?~jp(t+(n=n[e].value),"span")?t:Bn+kt(t,"-start","")+t+Bn+"grid-row-span:"+(~jp(n,"span")?Js(n,/\d+/):+Js(n,/\d+/)-+Js(t,/\d+/))+";":Bn+kt(t,"-start","")+t;case 4896:case 4128:return n&&n.some(function(i){return Js(i.props,/grid-\w+-start/)})?t:Bn+kt(kt(t,"-end","-span"),"span ","")+t;case 4095:case 3583:case 4068:case 2532:return kt(t,/(.+)-inline(.+)/,ln+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(hs(t)-1-e>6)switch(fi(t,e+1)){case 109:if(fi(t,e+4)!==45)break;case 102:return kt(t,/(.+:)(.+)-([^]+)/,"$1"+ln+"$2-$3$1"+VC+(fi(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~jp(t,"stretch")?NH(kt(t,"stretch","fill-available"),e,n)+t:t}break;case 5152:case 5920:return kt(t,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(i,o,r,s,a,l,g){return Bn+o+":"+r+g+(s?Bn+o+"-span:"+(a?l:+l-+r)+g:"")+t});case 4949:if(fi(t,e+6)===121)return kt(t,":",":"+ln)+t;break;case 6444:switch(fi(t,fi(t,14)===45?18:11)){case 120:return kt(t,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+ln+(fi(t,14)===45?"inline-":"")+"box$3$1"+ln+"$2$3$1"+Bn+"$2box$3")+t;case 100:return kt(t,":",":"+Bn)+t}break;case 5719:case 2647:case 2135:case 3927:case 2391:return kt(t,"scroll-","scroll-snap-")+t}return t}function Kf(t,e){for(var n="",i=0;i<t.length;i++)n+=e(t[i],i,t,e)||"";return n}function S7(t,e,n,i){switch(t.type){case C7:if(t.children.length)break;case u7:case $2:return t.return=t.return||t.value;case RH:return"";case WH:return t.return=t.value+"{"+Kf(t.children,i)+"}";case n0:if(!hs(t.value=t.props.join(",")))return""}return hs(n=Kf(t.children,i))?t.return=t.value+"{"+n+"}":""}function R7(t){var e=VH(t);return function(n,i,o,r){for(var s="",a=0;a<e;a++)s+=t[a](n,i,o,r)||"";return s}}function W7(t){return function(e){e.root||(e=e.return)&&t(e)}}function x7(t,e,n,i){if(t.length>-1&&!t.return)switch(t.type){case $2:t.return=NH(t.value,t.length,n);return;case WH:return Kf([Ka(t,{value:kt(t.value,"@","@"+ln)})],i);case n0:if(t.length)return A7(n=t.props,function(o){switch(Js(o,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Yc(Ka(t,{props:[kt(o,/:(read-\w+)/,":"+VC+"$1")]})),Yc(Ka(t,{props:[o]})),aB(t,{props:zx(n,i)});break;case"::placeholder":Yc(Ka(t,{props:[kt(o,/:(plac\w+)/,":"+ln+"input-$1")]})),Yc(Ka(t,{props:[kt(o,/:(plac\w+)/,":"+VC+"$1")]})),Yc(Ka(t,{props:[kt(o,/:(plac\w+)/,Bn+"input-$1")]})),Yc(Ka(t,{props:[o]})),aB(t,{props:zx(n,i)});break}return""})}}var V7={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},NI=typeof process<"u"&&process.env!==void 0&&({}.REACT_APP_SC_ATTR||{}.SC_ATTR)||"data-styled",tw=typeof window<"u"&&"HTMLElement"in window,X7=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&process.env!==void 0&&{}.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&{}.REACT_APP_SC_DISABLE_SPEEDY!==""?{}.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&{}.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&process.env!==void 0&&{}.SC_DISABLE_SPEEDY!==void 0&&{}.SC_DISABLE_SPEEDY!==""&&{}.SC_DISABLE_SPEEDY!=="false"&&{}.SC_DISABLE_SPEEDY),s0=Object.freeze([]),YI=Object.freeze({});function N7(t,e,n){return n===void 0&&(n=YI),t.theme!==n.theme&&t.theme||e||n.theme}var YH=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),Y7=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,M7=/(^-|-$)/g;function kx(t){return t.replace(Y7,"-").replace(M7,"")}var H7=/(a)(d)/gi,Tx=function(t){return String.fromCharCode(t+(t>25?39:97))};function cB(t){var e,n="";for(e=Math.abs(t);e>52;e=e/52|0)n=Tx(e%52)+n;return(Tx(e%52)+n).replace(H7,"$1-$2")}var Qy,iI=function(t,e){for(var n=e.length;n;)t=33*t^e.charCodeAt(--n);return t},MH=function(t){return iI(5381,t)};function F7(t){return cB(MH(t)>>>0)}function K7(t){return t.displayName||t.name||"Component"}function jy(t){return typeof t=="string"&&!0}var HH=typeof Symbol=="function"&&Symbol.for,FH=HH?Symbol.for("react.memo"):60115,z7=HH?Symbol.for("react.forward_ref"):60112,L7={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},E7={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},KH={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},k7=((Qy={})[z7]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Qy[FH]=KH,Qy);function _x(t){return("type"in(e=t)&&e.type.$$typeof)===FH?KH:"$$typeof"in t?k7[t.$$typeof]:L7;var e}var T7=Object.defineProperty,_7=Object.getOwnPropertyNames,Ux=Object.getOwnPropertySymbols,U7=Object.getOwnPropertyDescriptor,P7=Object.getPrototypeOf,Px=Object.prototype;function zH(t,e,n){if(typeof e!="string"){if(Px){var i=P7(e);i&&i!==Px&&zH(t,i,n)}var o=_7(e);Ux&&(o=o.concat(Ux(e)));for(var r=_x(t),s=_x(e),a=0;a<o.length;++a){var l=o[a];if(!(l in E7||n&&n[l]||s&&l in s||r&&l in r)){var g=U7(e,l);try{T7(t,l,g)}catch{}}}}return t}function MI(t){return typeof t=="function"}function nw(t){return typeof t=="object"&&"styledComponentId"in t}function Cg(t,e){return t&&e?"".concat(t," ").concat(e):t||e||""}function Dx(t,e){if(t.length===0)return"";for(var n=t[0],i=1;i<t.length;i++)n+=e?e+t[i]:t[i];return n}function vd(t){return t!==null&&typeof t=="object"&&t.constructor.name===Object.name&&!("props"in t&&t.$$typeof)}function IB(t,e,n){if(n===void 0&&(n=!1),!n&&!vd(t)&&!Array.isArray(t))return e;if(Array.isArray(e))for(var i=0;i<e.length;i++)t[i]=IB(t[i],e[i]);else if(vd(e))for(var i in e)t[i]=IB(t[i],e[i]);return t}function iw(t,e){Object.defineProperty(t,"toString",{value:e})}function oh(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(t," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var D7=function(){function t(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return t.prototype.indexOfGroup=function(e){for(var n=0,i=0;i<e;i++)n+=this.groupSizes[i];return n},t.prototype.insertRules=function(e,n){if(e>=this.groupSizes.length){for(var i=this.groupSizes,o=i.length,r=o;e>=r;)if((r<<=1)<0)throw oh(16,"".concat(e));this.groupSizes=new Uint32Array(r),this.groupSizes.set(i),this.length=r;for(var s=o;s<r;s++)this.groupSizes[s]=0}for(var a=this.indexOfGroup(e+1),l=(s=0,n.length);s<l;s++)this.tag.insertRule(a,n[s])&&(this.groupSizes[e]++,a++)},t.prototype.clearGroup=function(e){if(e<this.length){var n=this.groupSizes[e],i=this.indexOfGroup(e),o=i+n;this.groupSizes[e]=0;for(var r=i;r<o;r++)this.tag.deleteRule(i)}},t.prototype.getGroup=function(e){var n="";if(e>=this.length||this.groupSizes[e]===0)return n;for(var i=this.groupSizes[e],o=this.indexOfGroup(e),r=o+i,s=o;s<r;s++)n+="".concat(this.tag.getRule(s)).concat(`/*!sc*/
`);return n},t}(),ef=new Map,zf=new Map,qy=1,Cp=function(t){if(ef.has(t))return ef.get(t);for(;zf.has(qy);)qy++;var e=qy++;return ef.set(t,e),zf.set(e,t),e},J7=function(t,e){ef.set(t,e),zf.set(e,t)},O7="style[".concat(NI,"][").concat("data-styled-version",'="').concat("6.0.7",'"]'),Q7=new RegExp("^".concat(NI,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),j7=function(t,e,n){for(var i,o=n.split(","),r=0,s=o.length;r<s;r++)(i=o[r])&&t.registerName(e,i)},q7=function(t,e){for(var n,i=((n=e.textContent)!==null&&n!==void 0?n:"").split(`/*!sc*/
`),o=[],r=0,s=i.length;r<s;r++){var a=i[r].trim();if(a){var l=a.match(Q7);if(l){var g=0|parseInt(l[1],10),c=l[2];g!==0&&(J7(c,g),j7(t,c,l[3]),t.getTag().insertRules(g,o)),o.length=0}else o.push(a)}}};function $7(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var LH=function(t){var e=document.head,n=t||e,i=document.createElement("style"),o=function(a){var l=Array.from(a.querySelectorAll("style[".concat(NI,"]")));return l[l.length-1]}(n),r=o!==void 0?o.nextSibling:null;i.setAttribute(NI,"active"),i.setAttribute("data-styled-version","6.0.7");var s=$7();return s&&i.setAttribute("nonce",s),n.insertBefore(i,r),i},e8=function(){function t(e){this.element=LH(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var i=document.styleSheets,o=0,r=i.length;o<r;o++){var s=i[o];if(s.ownerNode===n)return s}throw oh(17)}(this.element),this.length=0}return t.prototype.insertRule=function(e,n){try{return this.sheet.insertRule(n,e),this.length++,!0}catch{return!1}},t.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.prototype.getRule=function(e){var n=this.sheet.cssRules[e];return n&&n.cssText?n.cssText:""},t}(),t8=function(){function t(e){this.element=LH(e),this.nodes=this.element.childNodes,this.length=0}return t.prototype.insertRule=function(e,n){if(e<=this.length&&e>=0){var i=document.createTextNode(n);return this.element.insertBefore(i,this.nodes[e]||null),this.length++,!0}return!1},t.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},t}(),n8=function(){function t(e){this.rules=[],this.length=0}return t.prototype.insertRule=function(e,n){return e<=this.length&&(this.rules.splice(e,0,n),this.length++,!0)},t.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},t}(),Jx=tw,i8={isServer:!tw,useCSSOMInjection:!X7},EH=function(){function t(e,n,i){e===void 0&&(e=YI),n===void 0&&(n={});var o=this;this.options=wo(wo({},i8),e),this.gs=n,this.names=new Map(i),this.server=!!e.isServer,!this.server&&tw&&Jx&&(Jx=!1,function(r){for(var s=document.querySelectorAll(O7),a=0,l=s.length;a<l;a++){var g=s[a];g&&g.getAttribute(NI)!=="active"&&(q7(r,g),g.parentNode&&g.parentNode.removeChild(g))}}(this)),iw(this,function(){return function(r){for(var s=r.getTag(),a=s.length,l="",g=function(C){var d=function(A){return zf.get(A)}(C);if(d===void 0)return"continue";var h=r.names.get(d),p=s.getGroup(C);if(h===void 0||p.length===0)return"continue";var v="".concat(NI,".g").concat(C,'[id="').concat(d,'"]'),f="";h!==void 0&&h.forEach(function(A){A.length>0&&(f+="".concat(A,","))}),l+="".concat(p).concat(v,'{content:"').concat(f,'"}').concat(`/*!sc*/
`)},c=0;c<a;c++)g(c);return l}(o)})}return t.registerId=function(e){return Cp(e)},t.prototype.reconstructWithOptions=function(e,n){return n===void 0&&(n=!0),new t(wo(wo({},this.options),e),this.gs,n&&this.names||void 0)},t.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.prototype.getTag=function(){return this.tag||(this.tag=(e=function(n){var i=n.useCSSOMInjection,o=n.target;return n.isServer?new n8(o):i?new e8(o):new t8(o)}(this.options),new D7(e)));var e},t.prototype.hasNameForId=function(e,n){return this.names.has(e)&&this.names.get(e).has(n)},t.prototype.registerName=function(e,n){if(Cp(e),this.names.has(e))this.names.get(e).add(n);else{var i=new Set;i.add(n),this.names.set(e,i)}},t.prototype.insertRules=function(e,n,i){this.registerName(e,n),this.getTag().insertRules(Cp(e),i)},t.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.prototype.clearRules=function(e){this.getTag().clearGroup(Cp(e)),this.clearNames(e)},t.prototype.clearTag=function(){this.tag=void 0},t}(),o8=/&/g,r8=/^\s*\/\/.*$/gm;function kH(t,e){return t.map(function(n){return n.type==="rule"&&(n.value="".concat(e," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(e," ")),n.props=n.props.map(function(i){return"".concat(e," ").concat(i)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=kH(n.children,e)),n})}function s8(t){var e,n,i,o=t===void 0?YI:t,r=o.options,s=r===void 0?YI:r,a=o.plugins,l=a===void 0?s0:a,g=function(d,h,p){return p===n||p.startsWith(n)&&p.endsWith(n)&&p.replaceAll(n,"").length>0?".".concat(e):d},c=l.slice();c.push(function(d){d.type===n0&&d.value.includes("&")&&(d.props[0]=d.props[0].replace(o8,n).replace(i,g))}),s.prefix&&c.push(x7),c.push(S7);var C=function(d,h,p,v){h===void 0&&(h=""),p===void 0&&(p=""),v===void 0&&(v="&"),e=v,n=h,i=new RegExp("\\".concat(n,"\\b"),"g");var f=d.replace(r8,""),A=Z7(p||h?"".concat(p," ").concat(h," { ").concat(f," }"):f);s.namespace&&(A=kH(A,s.namespace));var b=[];return Kf(A,R7(c.concat(W7(function(m){return b.push(m)})))),b};return C.hash=l.length?l.reduce(function(d,h){return h.name||oh(15),iI(d,h.name)},5381).toString():"",C}var a8=new EH,uB=s8(),TH=ne.createContext({shouldForwardProp:void 0,styleSheet:a8,stylis:uB});TH.Consumer;ne.createContext(void 0);function Ox(){return x.useContext(TH)}var l8=function(){function t(e,n){var i=this;this.inject=function(o,r){r===void 0&&(r=uB);var s=i.name+r.hash;o.hasNameForId(i.id,s)||o.insertRules(i.id,s,r(i.rules,s,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=n,iw(this,function(){throw oh(12,String(i.name))})}return t.prototype.getName=function(e){return e===void 0&&(e=uB),this.name+e.hash},t}(),g8=function(t){return t>="A"&&t<="Z"};function Qx(t){for(var e="",n=0;n<t.length;n++){var i=t[n];if(n===1&&i==="-"&&t[0]==="-")return t;g8(i)?e+="-"+i.toLowerCase():e+=i}return e.startsWith("ms-")?"-"+e:e}var _H=function(t){return t==null||t===!1||t===""},UH=function(t){var e,n,i=[];for(var o in t){var r=t[o];t.hasOwnProperty(o)&&!_H(r)&&(Array.isArray(r)&&r.isCss||MI(r)?i.push("".concat(Qx(o),":"),r,";"):vd(r)?i.push.apply(i,Ff(Ff(["".concat(o," {")],UH(r),!1),["}"],!1)):i.push("".concat(Qx(o),": ").concat((e=o,(n=r)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||e in V7||e.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return i};function vg(t,e,n,i){if(_H(t))return[];if(nw(t))return[".".concat(t.styledComponentId)];if(MI(t)){if(!MI(r=t)||r.prototype&&r.prototype.isReactComponent||!e)return[t];var o=t(e);return vg(o,e,n,i)}var r;return t instanceof l8?n?(t.inject(n,i),[t.getName(i)]):[t]:vd(t)?UH(t):Array.isArray(t)?Array.prototype.concat.apply(s0,t.map(function(s){return vg(s,e,n,i)})):[t.toString()]}function c8(t){for(var e=0;e<t.length;e+=1){var n=t[e];if(MI(n)&&!nw(n))return!1}return!0}var I8=MH("6.0.7"),u8=function(){function t(e,n,i){this.rules=e,this.staticRulesId="",this.isStatic=(i===void 0||i.isStatic)&&c8(e),this.componentId=n,this.baseHash=iI(I8,n),this.baseStyle=i,EH.registerId(n)}return t.prototype.generateAndInjectStyles=function(e,n,i){var o=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,n,i):"";if(this.isStatic&&!i.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))o=Cg(o,this.staticRulesId);else{var r=Dx(vg(this.rules,e,n,i)),s=cB(iI(this.baseHash,r)>>>0);if(!n.hasNameForId(this.componentId,s)){var a=i(r,".".concat(s),void 0,this.componentId);n.insertRules(this.componentId,s,a)}o=Cg(o,s),this.staticRulesId=s}else{for(var l=iI(this.baseHash,i.hash),g="",c=0;c<this.rules.length;c++){var C=this.rules[c];if(typeof C=="string")g+=C;else if(C){var d=Dx(vg(C,e,n,i));l=iI(l,d),g+=d}}if(g){var h=cB(l>>>0);n.hasNameForId(this.componentId,h)||n.insertRules(this.componentId,h,i(g,".".concat(h),void 0,this.componentId)),o=Cg(o,h)}}return o},t}(),PH=ne.createContext(void 0);PH.Consumer;var $y={};function C8(t,e,n){var i=nw(t),o=t,r=!jy(t),s=e.attrs,a=s===void 0?s0:s,l=e.componentId,g=l===void 0?function(m,B){var Z=typeof m!="string"?"sc":kx(m);$y[Z]=($y[Z]||0)+1;var w="".concat(Z,"-").concat(F7("6.0.7"+Z+$y[Z]));return B?"".concat(B,"-").concat(w):w}(e.displayName,e.parentComponentId):l,c=e.displayName;c===void 0&&function(m){return jy(m)?"styled.".concat(m):"Styled(".concat(K7(m),")")}(t);var C=e.displayName&&e.componentId?"".concat(kx(e.displayName),"-").concat(e.componentId):e.componentId||g,d=i&&o.attrs?o.attrs.concat(a).filter(Boolean):a,h=e.shouldForwardProp;if(i&&o.shouldForwardProp){var p=o.shouldForwardProp;if(e.shouldForwardProp){var v=e.shouldForwardProp;h=function(m,B){return p(m,B)&&v(m,B)}}else h=p}var f=new u8(n,C,i?o.componentStyle:void 0);function A(m,B){return function(Z,w,W){var X=Z.attrs,V=Z.componentStyle,Y=Z.defaultProps,z=Z.foldedComponentIds,q=Z.styledComponentId,O=Z.target,te=ne.useContext(PH),oe=Ox(),re=Z.shouldForwardProp||oe.shouldForwardProp,se=function(Ie,fe,ve){for(var Ge,Me=wo(wo({},fe),{className:void 0,theme:ve}),_e=0;_e<Ie.length;_e+=1){var Bt=MI(Ge=Ie[_e])?Ge(Me):Ge;for(var St in Bt)Me[St]=St==="className"?Cg(Me[St],Bt[St]):St==="style"?wo(wo({},Me[St]),Bt[St]):Bt[St]}return fe.className&&(Me.className=Cg(Me.className,fe.className)),Me}(X,w,N7(w,te,Y)||YI),H=se.as||O,D={};for(var T in se)se[T]===void 0||T[0]==="$"||T==="as"||T==="theme"||(T==="forwardedAs"?D.as=se.forwardedAs:re&&!re(T,H)||(D[T]=se[T]));var J=function(Ie,fe){var ve=Ox(),Ge=Ie.generateAndInjectStyles(fe,ve.styleSheet,ve.stylis);return Ge}(V,se),$=Cg(z,q);return J&&($+=" "+J),se.className&&($+=" "+se.className),D[jy(H)&&!YH.has(H)?"class":"className"]=$,D.ref=W,x.createElement(H,D)}(b,m,B)}var b=ne.forwardRef(A);return b.attrs=d,b.componentStyle=f,b.shouldForwardProp=h,b.foldedComponentIds=i?Cg(o.foldedComponentIds,o.styledComponentId):"",b.styledComponentId=C,b.target=i?o.target:t,Object.defineProperty(b,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(m){this._foldedDefaultProps=i?function(B){for(var Z=[],w=1;w<arguments.length;w++)Z[w-1]=arguments[w];for(var W=0,X=Z;W<X.length;W++)IB(B,X[W],!0);return B}({},o.defaultProps,m):m}}),iw(b,function(){return".".concat(b.styledComponentId)}),r&&zH(b,t,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),b}function jx(t,e){for(var n=[t[0]],i=0,o=e.length;i<o;i+=1)n.push(e[i],t[i+1]);return n}var qx=function(t){return Object.assign(t,{isCss:!0})};function d8(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(MI(t)||vd(t)){var i=t;return qx(vg(jx(s0,Ff([i],e,!0))))}var o=t;return e.length===0&&o.length===1&&typeof o[0]=="string"?vg(o):qx(vg(jx(o,e)))}function CB(t,e,n){if(n===void 0&&(n=YI),!e)throw oh(1,e);var i=function(o){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];return t(e,n,d8.apply(void 0,Ff([o],r,!1)))};return i.attrs=function(o){return CB(t,e,wo(wo({},n),{attrs:Array.prototype.concat(n.attrs,o).filter(Boolean)}))},i.withConfig=function(o){return CB(t,e,wo(wo({},n),o))},i}var DH=function(t){return CB(C8,t)},Rl=DH;YH.forEach(function(t){Rl[t]=DH(t)});function JH({children:t,shadow:e,camera:n}){return Pe.jsx(h8,{children:Pe.jsx(rH,{camera:n,shadows:e,children:t})})}const h8=Rl.div`
    display: flex;
    flex: 1;
`;function A8(){const t=li(e=>e.gl);return x.useLayoutEffect(()=>{t.shadowMap.enabled=!0},[t]),null}function dB(t){const e=new p3,[n,i]=x.useState(0),[o,r]=x.useState(),[s,a]=x.useState(new Xn);return x.useEffect(()=>{e.load(t,l=>{a(l)},l=>i(l.loaded/l.total),l=>{console.error("Texture load error: ",l),r(new Error(l.message))})},[t]),[s,n,o]}var Gd={},a0={},l0={};Object.defineProperty(l0,"__esModule",{value:!0});l0.factoriesGl1=void 0;l0.factoriesGl1={uniform1f:(t,e)=>({location:e,set:n=>t.uniform1f(e,n),setV:n=>t.uniform1fv(e,n)}),uniform2f:(t,e)=>({location:e,set:(n,i)=>t.uniform2f(e,n,i),setV:n=>t.uniform2fv(e,n)}),uniform3f:(t,e)=>({location:e,set:(n,i,o)=>t.uniform3f(e,n,i,o),setV:n=>t.uniform3fv(e,n)}),uniform4f:(t,e)=>({location:e,set:(n,i,o,r)=>t.uniform4f(e,n,i,o,r),setV:n=>t.uniform4fv(e,n)}),uniform1i:(t,e)=>({location:e,set:n=>t.uniform1i(e,n),setV:n=>t.uniform1iv(e,n)}),uniform2i:(t,e)=>({location:e,set:(n,i)=>t.uniform2i(e,n,i),setV:n=>t.uniform2iv(e,n)}),uniform3i:(t,e)=>({location:e,set:(n,i,o)=>t.uniform3i(e,n,i,o),setV:n=>t.uniform3iv(e,n)}),uniform4i:(t,e)=>({location:e,set:(n,i,o,r)=>t.uniform4i(e,n,i,o,r),setV:n=>t.uniform4iv(e,n)}),uniformMatrix2f:(t,e)=>({location:e,set:(n,i)=>t.uniformMatrix2fv(e,n,i)}),uniformMatrix3f:(t,e)=>({location:e,set:(n,i)=>t.uniformMatrix3fv(e,n,i)}),uniformMatrix4f:(t,e)=>({location:e,set:(n,i)=>t.uniformMatrix4fv(e,n,i)}),vertexAttrib1f:(t,e)=>({location:e,set:n=>t.vertexAttrib1f(e,n),setV:n=>t.vertexAttrib1fv(e,n)}),vertexAttrib2f:(t,e)=>({location:e,set:(n,i)=>t.vertexAttrib2f(e,n,i),setV:n=>t.vertexAttrib2fv(e,n)}),vertexAttrib3f:(t,e)=>({location:e,set:(n,i,o)=>t.vertexAttrib3f(e,n,i,o),setV:n=>t.vertexAttrib3fv(e,n)}),vertexAttrib4f:(t,e)=>({location:e,set:(n,i,o,r)=>t.vertexAttrib4f(e,n,i,o,r),setV:n=>t.vertexAttrib4fv(e,n)}),vertexAttribPointer:(t,e)=>({location:e,enable:()=>t.enableVertexAttribArray(e),disable:()=>t.disableVertexAttribArray(e),set:(n,i,o,r,s)=>t.vertexAttribPointer(e,n,i,o,r,s)})};Object.defineProperty(a0,"__esModule",{value:!0});a0.factoriesGl2=void 0;const p8=l0;a0.factoriesGl2=Object.assign(Object.assign({},p8.factoriesGl1),{uniform1ui:(t,e)=>({location:e,set:n=>t.uniform1ui(e,n),setV:(n,i,o)=>t.uniform1uiv(e,n,i,o)}),uniform2ui:(t,e)=>({location:e,set:(n,i)=>t.uniform2ui(e,n,i),setV:(n,i,o)=>t.uniform2uiv(e,n,i,o)}),uniform3ui:(t,e)=>({location:e,set:(n,i,o)=>t.uniform3ui(e,n,i,o),setV:(n,i,o)=>t.uniform3uiv(e,n,i,o)}),uniform4ui:(t,e)=>({location:e,set:(n,i,o,r)=>t.uniform4ui(e,n,i,o,r),setV:(n,i,o)=>t.uniform4uiv(e,n,i,o)}),uniformMatrix2x3f:(t,e)=>({location:e,set:(n,i,o,r)=>t.uniformMatrix2x3fv(e,n,i,o,r)}),uniformMatrix2x4f:(t,e)=>({location:e,set:(n,i,o,r)=>t.uniformMatrix2x4fv(e,n,i,o,r)}),uniformMatrix3x2f:(t,e)=>({location:e,set:(n,i,o,r)=>t.uniformMatrix3x2fv(e,n,i,o,r)}),uniformMatrix3x4f:(t,e)=>({location:e,set:(n,i,o,r)=>t.uniformMatrix3x4fv(e,n,i,o,r)}),uniformMatrix4x2f:(t,e)=>({location:e,set:(n,i,o,r)=>t.uniformMatrix4x2fv(e,n,i,o,r)}),uniformMatrix4x3f:(t,e)=>({location:e,set:(n,i,o,r)=>t.uniformMatrix4x3fv(e,n,i,o,r)}),vertexAttribDivisor:(t,e)=>({location:e,set:n=>t.vertexAttribDivisor(e,n)}),vertexAttribI4i:(t,e)=>({location:e,set:(n,i,o,r)=>t.vertexAttribI4i(e,n,i,o,r),setV:n=>t.vertexAttribI4iv(e,n)}),vertexAttribI4ui:(t,e)=>({location:e,set:(n,i,o,r)=>t.vertexAttribI4ui(e,n,i,o,r),setV:n=>t.vertexAttribI4uiv(e,n)}),vertexAttribIPointer:(t,e)=>({location:e,enable:()=>t.enableVertexAttribArray(e),disable:()=>t.disableVertexAttribArray(e),set:(n,i,o,r)=>t.vertexAttribIPointer(e,n,i,o,r)})});Object.defineProperty(Gd,"__esModule",{value:!0});Gd.createShaderProgram=$I=Gd.glsl=void 0;const f8=a0;function m8(t,...e){let n="";for(let i=0;i<e.length;i++)n+=t[i],n+=e[i];return n.replace(/^[\r\n]+/,"")+t[t.length-1]}var $I=Gd.glsl=m8;function $x(t,e,n,i){const o=t.createShader(n);return t.shaderSource(o,i),t.compileShader(o),t.attachShader(e,o),o}function b8(t,e,n,i){const o=t.createProgram(),r={},s=$x(t,o,t.VERTEX_SHADER,e),a=$x(t,o,t.FRAGMENT_SHADER,n);t.linkProgram(o),t.useProgram(o);for(const l of Object.keys(i)){const g=i[l],c=f8.factoriesGl2[g];if(!c)throw new Error(`Can't handle ${g}!`);const C=g.startsWith("uniform")?t.getUniformLocation(o,l):t.getAttribLocation(o,l);r[l]=c(t,C)}return Object.assign(Object.assign({},r),{use(){t.useProgram(o)},dispose(){t.useProgram(null),t.deleteShader(a),t.deleteShader(s),t.deleteProgram(o)}})}Gd.createShaderProgram=b8;const y8=$I`

  varying vec2 vUv;
  uniform float fragColorRatio;
  uniform sampler2D colorMap;
  uniform sampler2D displacementMap;

  void main() {

    vec4 colorTex = texture2D(colorMap, vUv);
    vec4 disTex = texture2D(displacementMap, vUv);

    vec4 tex = colorTex * fragColorRatio + disTex * (1.0 - fragColorRatio);
    
    float colorMapAlpha = texture2D(colorMap, vUv).a;

    gl_FragColor = vec4(tex.rgb, colorMapAlpha);

  }
`,v8=$I`

  ${Ft.common}

  // varying vec2 vUv;
  // void main() {
  //   vUv = uv;
  //   gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  // }
  // uniform sampler2D displacementMap;
  // varying vec3 vColor;
  // uniform vec3 color1;
  // uniform vec3 color2;

  // void main() {
  //   vColor = mix( color1, color2, texture2D( displacementMap, uv ).x );
  // }

  varying vec2 vUv;
  uniform sampler2D displacementMap;
  uniform float displacementScale;
  
  void main() {

    vUv = uv;
    vec4 tex = texture2D(displacementMap, vUv);
    vec3 nPos = position + normal * tex.r * displacementScale;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( nPos, 1.0 );

  }

`;function G8({islandColorRatio:t,islandScale:e}){const[n,i,o]=dB("/bg.png"),[r,s,a]=dB("/displacement_map.jpg");new S2;const l=x.useMemo(()=>{if(n&&r)return new ao({uniforms:{fragColorRatio:{value:t},colorMap:{value:n},displacementMap:{value:r},displacementScale:{value:e},color1:{value:new je("blue")},color2:{value:new je("green")}},vertexShader:v8,fragmentShader:y8,transparent:!0})},[n,r,o,a]);return x.useEffect(()=>{l&&(l.uniforms.fragColorRatio.value=t,l.uniforms.displacementScale.value=e)},[t,e]),Pe.jsx("mesh",{material:l,receiveShadow:!0,castShadow:!0,children:Pe.jsx("sphereGeometry",{args:[5.01,512,512]})})}function B8(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function OH(...t){return e=>t.forEach(n=>B8(n,e))}function eu(...t){return x.useCallback(OH(...t),t)}const QH=x.forwardRef((t,e)=>{const{children:n,...i}=t,o=x.Children.toArray(n),r=o.find(Z8);if(r){const s=r.props.children,a=o.map(l=>l===r?x.Children.count(s)>1?x.Children.only(null):x.isValidElement(s)?s.props.children:null:l);return x.createElement(hB,pn({},i,{ref:e}),x.isValidElement(s)?x.cloneElement(s,void 0,a):null)}return x.createElement(hB,pn({},i,{ref:e}),n)});QH.displayName="Slot";const hB=x.forwardRef((t,e)=>{const{children:n,...i}=t;return x.isValidElement(n)?x.cloneElement(n,{...w8(i,n.props),ref:e?OH(e,n.ref):n.ref}):x.Children.count(n)>1?x.Children.only(null):null});hB.displayName="SlotClone";const jH=({children:t})=>x.createElement(x.Fragment,null,t);function Z8(t){return x.isValidElement(t)&&t.type===jH}function w8(t,e){const n={...e};for(const i in e){const o=t[i],r=e[i];/^on[A-Z]/.test(i)?o&&r?n[i]=(...a)=>{r(...a),o(...a)}:o&&(n[i]=o):i==="style"?n[i]={...o,...r}:i==="className"&&(n[i]=[o,r].filter(Boolean).join(" "))}return{...t,...n}}const S8=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Dg=S8.reduce((t,e)=>{const n=x.forwardRef((i,o)=>{const{asChild:r,...s}=i,a=r?QH:e;return x.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),x.createElement(a,pn({},s,{ref:o}))});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function R8(t,e){t&&Ld.flushSync(()=>t.dispatchEvent(e))}const W8=x.forwardRef((t,e)=>{var n;const{container:i=globalThis==null||(n=globalThis.document)===null||n===void 0?void 0:n.body,...o}=t;return i?A5.createPortal(x.createElement(Dg.div,pn({},o,{ref:e})),i):null}),x8=W8;var eV=Object.prototype.hasOwnProperty;function Bd(t,e){var n,i;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((i=t.length)===e.length)for(;i--&&Bd(t[i],e[i]););return i===-1}if(!n||typeof t=="object"){i=0;for(n in t)if(eV.call(t,n)&&++i&&!eV.call(e,n)||!(n in e)||!Bd(t[n],e[n]))return!1;return Object.keys(e).length===i}}return t!==t&&e!==e}var g0=function(e,n,i,o){this.name=e,this.fn=n,this.args=i,this.modifiers=o};g0.prototype._test=function(e){var n=this.fn;try{dI(this.modifiers.slice(),n,this)(e)}catch{n=function(){return!1}}try{return dI(this.modifiers.slice(),n,this)(e)}catch{return!1}};g0.prototype._check=function(e){try{dI(this.modifiers.slice(),this.fn,this)(e)}catch{if(dI(this.modifiers.slice(),function(i){return i},this)(!1))return}if(!dI(this.modifiers.slice(),this.fn,this)(e))throw null};g0.prototype._testAsync=function(e){var n=this;return new Promise(function(i,o){$H(n.modifiers.slice(),n.fn,n)(e).then(function(r){r?i(e):o(null)}).catch(function(r){return o(r)})})};function qH(t,e){return e===void 0&&(e="simple"),typeof t=="object"?t[e]:t}function dI(t,e,n){if(t.length){var i=t.shift(),o=dI(t,e,n);return i.perform(o,n)}else return qH(e)}function $H(t,e,n){if(t.length){var i=t.shift(),o=$H(t,e,n);return i.performAsync(o,n)}else return function(r){return Promise.resolve(qH(e,"async")(r))}}var V8=function(e,n,i){this.name=e,this.perform=n,this.performAsync=i},ow=function(t){function e(n,i,o,r){for(var s=[],a=arguments.length-4;a-- >0;)s[a]=arguments[a+4];t.call(this,s),t.captureStackTrace&&t.captureStackTrace(this,e),this.rule=n,this.value=i,this.cause=o,this.target=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),ws=function(e,n){e===void 0&&(e=[]),n===void 0&&(n=[]),this.chain=e,this.nextRuleModifiers=n};ws.prototype._applyRule=function(e,n){var i=this;return function(){for(var o=[],r=arguments.length;r--;)o[r]=arguments[r];return i.chain.push(new g0(n,e.apply(i,o),o,i.nextRuleModifiers)),i.nextRuleModifiers=[],i}};ws.prototype._applyModifier=function(e,n){return this.nextRuleModifiers.push(new V8(n,e.simple,e.async)),this};ws.prototype._clone=function(){return new ws(this.chain.slice(),this.nextRuleModifiers.slice())};ws.prototype.test=function(e){return this.chain.every(function(n){return n._test(e)})};ws.prototype.testAll=function(e){var n=[];return this.chain.forEach(function(i){try{i._check(e)}catch(o){n.push(new ow(i,e,o))}}),n};ws.prototype.check=function(e){this.chain.forEach(function(n){try{n._check(e)}catch(i){throw new ow(n,e,i)}})};ws.prototype.testAsync=function(e){var n=this;return new Promise(function(i,o){eF(e,n.chain.slice(),i,o)})};function eF(t,e,n,i){if(e.length){var o=e.shift();o._testAsync(t).then(function(){eF(t,e,n,i)},function(r){i(new ow(o,t,r))})}else n(t)}var tV=function(t,e){return e&&typeof t=="string"&&t.trim().length===0?!0:t==null};function X8(t,e){return e===void 0&&(e=!1),{simple:function(n){return tV(n,e)||t.check(n)===void 0},async:function(n){return tV(n,e)||t.testAsync(n)}}}function So(){return typeof Proxy<"u"?tF(new ws):AB(new ws)}var Zd={};So.extend=function(t){Object.assign(Zd,t)};So.clearCustomRules=function(){Zd={}};function tF(t){return new Proxy(t,{get:function(n,i){if(i in n)return n[i];var o=tF(t._clone());if(i in Lf)return o._applyModifier(Lf[i],i);if(i in Zd)return o._applyRule(Zd[i],i);if(i in pB)return o._applyRule(pB[i],i)}})}function AB(t){var e=function(o,r){return Object.keys(o).forEach(function(s){r[s]=function(){for(var a=[],l=arguments.length;l--;)a[l]=arguments[l];var g=AB(r._clone()),c=g._applyRule(o[s],s).apply(void 0,a);return c}}),r},n=e(pB,t),i=e(Zd,n);return Object.keys(Lf).forEach(function(o){Object.defineProperty(i,o,{get:function(){var r=AB(i._clone());return r._applyModifier(Lf[o],o)}})}),i}var Lf={not:{simple:function(t){return function(e){return!t(e)}},async:function(t){return function(e){return Promise.resolve(t(e)).then(function(n){return!n}).catch(function(){return!0})}}},some:{simple:function(t){return function(e){return dp(e).some(function(n){try{return t(n)}catch{return!1}})}},async:function(t){return function(e){return Promise.all(dp(e).map(function(n){try{return t(n).catch(function(){return!1})}catch{return!1}})).then(function(n){return n.some(Boolean)})}}},every:{simple:function(t){return function(e){return e!==!1&&dp(e).every(t)}},async:function(t){return function(e){return Promise.all(dp(e).map(t)).then(function(n){return n.every(Boolean)})}}},strict:{simple:function(t,e){return function(n){return nV(e)&&n&&typeof n=="object"?Object.keys(e.args[0]).length===Object.keys(n).length&&t(n):t(n)}},async:function(t,e){return function(n){return Promise.resolve(t(n)).then(function(i){return nV(e)&&n&&typeof n=="object"?Object.keys(e.args[0]).length===Object.keys(n).length&&i:i}).catch(function(){return!1})}}}};function nV(t){return t&&t.name==="schema"&&t.args.length>0&&typeof t.args[0]=="object"}function dp(t){return typeof t=="string"?t.split(""):t}var pB={equal:function(t){return function(e){return e==t}},exact:function(t){return function(e){return e===t}},number:function(t){return t===void 0&&(t=!0),function(e){return typeof e=="number"&&(t||isFinite(e))}},integer:function(){return function(t){var e=Number.isInteger||N8;return e(t)}},numeric:function(){return function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},string:function(){return Mc("string")},boolean:function(){return Mc("boolean")},undefined:function(){return Mc("undefined")},null:function(){return Mc("null")},array:function(){return Mc("array")},object:function(){return Mc("object")},instanceOf:function(t){return function(e){return e instanceof t}},pattern:function(t){return function(e){return t.test(e)}},lowercase:function(){return function(t){return typeof t=="boolean"||t===t.toLowerCase()&&t.trim()!==""}},uppercase:function(){return function(t){return t===t.toUpperCase()&&t.trim()!==""}},vowel:function(){return function(t){return/^[aeiou]+$/i.test(t)}},consonant:function(){return function(t){return/^(?=[^aeiou])([a-z]+)$/i.test(t)}},first:function(t){return function(e){return e[0]==t}},last:function(t){return function(e){return e[e.length-1]==t}},empty:function(){return function(t){return t.length===0}},length:function(t,e){return function(n){return n.length>=t&&n.length<=(e||t)}},minLength:function(t){return function(e){return e.length>=t}},maxLength:function(t){return function(e){return e.length<=t}},negative:function(){return function(t){return t<0}},positive:function(){return function(t){return t>=0}},between:function(t,e){return function(n){return n>=t&&n<=e}},range:function(t,e){return function(n){return n>=t&&n<=e}},lessThan:function(t){return function(e){return e<t}},lessThanOrEqual:function(t){return function(e){return e<=t}},greaterThan:function(t){return function(e){return e>t}},greaterThanOrEqual:function(t){return function(e){return e>=t}},even:function(){return function(t){return t%2===0}},odd:function(){return function(t){return t%2!==0}},includes:function(t){return function(e){return~e.indexOf(t)}},schema:function(t){return Y8(t)},passesAnyOf:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return function(n){return t.some(function(i){return i.test(n)})}},optional:X8};function Mc(t){return function(e){return Array.isArray(e)&&t==="array"||e===null&&t==="null"||typeof e===t}}function N8(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t}function Y8(t){return{simple:function(e){var n=[];if(Object.keys(t).forEach(function(i){var o=t[i];try{o.check((e||{})[i])}catch(r){r.target=i,n.push(r)}}),n.length>0)throw n;return!0},async:function(e){var n=[],i=Object.keys(t).map(function(o){var r=t[o];return r.testAsync((e||{})[o]).catch(function(s){s.target=o,n.push(s)})});return Promise.all(i).then(function(){if(n.length>0)throw n;return!0})}}}var hn="colors",qi="sizes",ct="space",M8={gap:ct,gridGap:ct,columnGap:ct,gridColumnGap:ct,rowGap:ct,gridRowGap:ct,inset:ct,insetBlock:ct,insetBlockEnd:ct,insetBlockStart:ct,insetInline:ct,insetInlineEnd:ct,insetInlineStart:ct,margin:ct,marginTop:ct,marginRight:ct,marginBottom:ct,marginLeft:ct,marginBlock:ct,marginBlockEnd:ct,marginBlockStart:ct,marginInline:ct,marginInlineEnd:ct,marginInlineStart:ct,padding:ct,paddingTop:ct,paddingRight:ct,paddingBottom:ct,paddingLeft:ct,paddingBlock:ct,paddingBlockEnd:ct,paddingBlockStart:ct,paddingInline:ct,paddingInlineEnd:ct,paddingInlineStart:ct,top:ct,right:ct,bottom:ct,left:ct,scrollMargin:ct,scrollMarginTop:ct,scrollMarginRight:ct,scrollMarginBottom:ct,scrollMarginLeft:ct,scrollMarginX:ct,scrollMarginY:ct,scrollMarginBlock:ct,scrollMarginBlockEnd:ct,scrollMarginBlockStart:ct,scrollMarginInline:ct,scrollMarginInlineEnd:ct,scrollMarginInlineStart:ct,scrollPadding:ct,scrollPaddingTop:ct,scrollPaddingRight:ct,scrollPaddingBottom:ct,scrollPaddingLeft:ct,scrollPaddingX:ct,scrollPaddingY:ct,scrollPaddingBlock:ct,scrollPaddingBlockEnd:ct,scrollPaddingBlockStart:ct,scrollPaddingInline:ct,scrollPaddingInlineEnd:ct,scrollPaddingInlineStart:ct,fontSize:"fontSizes",background:hn,backgroundColor:hn,backgroundImage:hn,borderImage:hn,border:hn,borderBlock:hn,borderBlockEnd:hn,borderBlockStart:hn,borderBottom:hn,borderBottomColor:hn,borderColor:hn,borderInline:hn,borderInlineEnd:hn,borderInlineStart:hn,borderLeft:hn,borderLeftColor:hn,borderRight:hn,borderRightColor:hn,borderTop:hn,borderTopColor:hn,caretColor:hn,color:hn,columnRuleColor:hn,fill:hn,outline:hn,outlineColor:hn,stroke:hn,textDecorationColor:hn,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:qi,minBlockSize:qi,maxBlockSize:qi,inlineSize:qi,minInlineSize:qi,maxInlineSize:qi,width:qi,minWidth:qi,maxWidth:qi,height:qi,minHeight:qi,maxHeight:qi,flexBasis:qi,gridTemplateColumns:qi,gridTemplateRows:qi,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},H8=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,tu=()=>{const t=Object.create(null);return(e,n,...i)=>{const o=(r=>JSON.stringify(r,H8))(e);return o in t?t[o]:t[o]=n(e,...i)}},Gg=Symbol.for("sxs.internal"),rw=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),iV=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:F8}=Object.prototype,fB=t=>t.includes("-")?t:t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),K8=/\s+(?![^()]*\))/,Hc=t=>e=>t(...typeof e=="string"?String(e).split(K8):[e]),oV={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:Hc((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t})),marginInline:Hc((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t})),maxSize:Hc((t,e)=>({maxBlockSize:t,maxInlineSize:e||t})),minSize:Hc((t,e)=>({minBlockSize:t,minInlineSize:e||t})),paddingBlock:Hc((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t})),paddingInline:Hc((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t}))},ev=/([\d.]+)([^]*)/,z8=(t,e)=>t.length?t.reduce((n,i)=>(n.push(...e.map(o=>o.includes("&")?o.replace(/&/g,/[ +>|~]/.test(i)&&/&.*&/.test(o)?`:is(${i})`:i):i+" "+o)),n),[]):e,L8=(t,e)=>t in E8&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(n,i,o,r)=>i+(o==="stretch"?`-moz-available${r};${fB(t)}:${i}-webkit-fill-available`:`-moz-fit-content${r};${fB(t)}:${i}fit-content`)+r):String(e),E8={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},da=t=>t?t+"-":"",nF=(t,e,n)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(i,o,r,s,a)=>s=="$"==!!r?i:(o||s=="--"?"calc(":"")+"var(--"+(s==="$"?da(e)+(a.includes("$")?"":da(n))+a.replace(/\$/g,"-"):a)+")"+(o||s=="--"?"*"+(o||"")+(r||"1")+")":"")),k8=/\s*,\s*(?![^()]*\))/,T8=Object.prototype.toString,oI=(t,e,n,i,o)=>{let r,s,a;const l=(g,c,C)=>{let d,h;const p=v=>{for(d in v){const b=d.charCodeAt(0)===64,m=b&&Array.isArray(v[d])?v[d]:[v[d]];for(h of m){const B=/[A-Z]/.test(A=d)?A:A.replace(/-[^]/g,w=>w[1].toUpperCase()),Z=typeof h=="object"&&h&&h.toString===T8&&(!i.utils[B]||!c.length);if(B in i.utils&&!Z){const w=i.utils[B];if(w!==s){s=w,p(w(h)),s=null;continue}}else if(B in oV){const w=oV[B];if(w!==a){a=w,p(w(h)),a=null;continue}}if(b&&(f=d.slice(1)in i.media?"@media "+i.media[d.slice(1)]:d,d=f.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(w,W,X,V,Y,z)=>{const q=ev.test(W),O=.0625*(q?-1:1),[te,oe]=q?[V,W]:[W,V];return"("+(X[0]==="="?"":X[0]===">"===q?"max-":"min-")+te+":"+(X[0]!=="="&&X.length===1?oe.replace(ev,(re,se,H)=>Number(se)+O*(X===">"?1:-1)+H):oe)+(Y?") and ("+(Y[0]===">"?"min-":"max-")+te+":"+(Y.length===1?z.replace(ev,(re,se,H)=>Number(se)+O*(Y===">"?-1:1)+H):z):"")+")"})),Z){const w=b?C.concat(d):[...C],W=b?[...c]:z8(c,d.split(k8));r!==void 0&&o(rV(...r)),r=void 0,l(h,W,w)}else r===void 0&&(r=[[],c,C]),d=b||d.charCodeAt(0)!==36?d:`--${da(i.prefix)}${d.slice(1).replace(/\$/g,"-")}`,h=Z?h:typeof h=="number"?h&&B in _8?String(h)+"px":String(h):nF(L8(B,h??""),i.prefix,i.themeMap[B]),r[0].push(`${b?`${d} `:`${fB(d)}:`}${h}`)}}var f,A};p(g),r!==void 0&&o(rV(...r)),r=void 0};l(t,e,n)},rV=(t,e,n)=>`${n.map(i=>`${i}{`).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(n.length?n.length+1:0).join("}")}`,_8={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},sV=t=>String.fromCharCode(t+(t>25?39:97)),Bg=t=>(e=>{let n,i="";for(n=Math.abs(e);n>52;n=n/52|0)i=sV(n%52)+i;return sV(n%52)+i})(((e,n)=>{let i=n.length;for(;i;)e=33*e^n.charCodeAt(--i);return e})(5381,JSON.stringify(t))>>>0),uC=["themed","global","styled","onevar","resonevar","allvar","inline"],U8=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},P8=t=>{let e;const n=()=>{const{cssRules:o}=e.sheet;return[].map.call(o,(r,s)=>{const{cssText:a}=r;let l="";if(a.startsWith("--sxs"))return"";if(o[s-1]&&(l=o[s-1].cssText).startsWith("--sxs")){if(!r.cssRules.length)return"";for(const g in e.rules)if(e.rules[g].group===r)return`--sxs{--sxs:${[...e.rules[g].cache].join(" ")}}${a}`;return r.cssRules.length?`${l}${a}`:""}return a}).join("")},i=()=>{if(e){const{rules:a,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const g in a)delete a[g]}const o=Object(t).styleSheets||[];for(const a of o)if(U8(a)){for(let l=0,g=a.cssRules;g[l];++l){const c=Object(g[l]);if(c.type!==1)continue;const C=Object(g[l+1]);if(C.type!==4)continue;++l;const{cssText:d}=c;if(!d.startsWith("--sxs"))continue;const h=d.slice(14,-3).trim().split(/\s+/),p=uC[h[0]];p&&(e||(e={sheet:a,reset:i,rules:{},toString:n}),e.rules[p]={group:C,index:l,cache:new Set(h)})}if(e)break}if(!e){const a=(l,g)=>({type:g,cssRules:[],insertRule(c,C){this.cssRules.splice(C,0,a(c,{import:3,undefined:1}[(c.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,c=>c.cssText).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:a("","text/css"),rules:{},reset:i,toString:n}}const{sheet:r,rules:s}=e;for(let a=uC.length-1;a>=0;--a){const l=uC[a];if(!s[l]){const g=uC[a+1],c=s[g]?s[g].index:r.cssRules.length;r.insertRule("@media{}",c),r.insertRule(`--sxs{--sxs:${a}}`,c),s[l]={group:r.cssRules[c+1],index:c,cache:new Set([a])}}D8(s[l])}};return i(),e},D8=t=>{const e=t.group;let n=e.cssRules.length;t.apply=i=>{try{e.insertRule(i,n),++n}catch{}}},Du=Symbol(),J8=tu(),aV=(t,e)=>J8(t,()=>(...n)=>{let i={type:null,composers:new Set};for(const o of n)if(o!=null)if(o[Gg]){i.type==null&&(i.type=o[Gg].type);for(const r of o[Gg].composers)i.composers.add(r)}else o.constructor!==Object||o.$$typeof?i.type==null&&(i.type=o):i.composers.add(O8(o,t));return i.type==null&&(i.type="span"),i.composers.size||i.composers.add(["PJLV",{},[],[],{},[]]),Q8(t,i,e)}),O8=({variants:t,compoundVariants:e,defaultVariants:n,...i},o)=>{const r=`${da(o.prefix)}c-${Bg(i)}`,s=[],a=[],l=Object.create(null),g=[];for(const d in n)l[d]=String(n[d]);if(typeof t=="object"&&t)for(const d in t){c=l,C=d,F8.call(c,C)||(l[d]="undefined");const h=t[d];for(const p in h){const v={[d]:String(p)};String(p)==="undefined"&&g.push(d);const f=h[p],A=[v,f,!iV(f)];s.push(A)}}var c,C;if(typeof e=="object"&&e)for(const d of e){let{css:h,...p}=d;h=typeof h=="object"&&h||{};for(const f in p)p[f]=String(p[f]);const v=[p,h,!iV(h)];a.push(v)}return[r,i,s,a,l,g]},Q8=(t,e,n)=>{const[i,o,r,s]=j8(e.composers),a=typeof e.type=="function"||e.type.$$typeof?(C=>{function d(){for(let h=0;h<d[Du].length;h++){const[p,v]=d[Du][h];C.rules[p].apply(v)}return d[Du]=[],null}return d[Du]=[],d.rules={},uC.forEach(h=>d.rules[h]={apply:p=>d[Du].push([h,p])}),d})(n):null,l=(a||n).rules,g=`.${i}${o.length>1?`:where(.${o.slice(1).join(".")})`:""}`,c=C=>{C=typeof C=="object"&&C||q8;const{css:d,...h}=C,p={};for(const A in r)if(delete h[A],A in C){let b=C[A];typeof b=="object"&&b?p[A]={"@initial":r[A],...b}:(b=String(b),p[A]=b!=="undefined"||s.has(A)?b:r[A])}else p[A]=r[A];const v=new Set([...o]);for(const[A,b,m,B]of e.composers){n.rules.styled.cache.has(A)||(n.rules.styled.cache.add(A),oI(b,[`.${A}`],[],t,W=>{l.styled.apply(W)}));const Z=lV(m,p,t.media),w=lV(B,p,t.media,!0);for(const W of Z)if(W!==void 0)for(const[X,V,Y]of W){const z=`${A}-${Bg(V)}-${X}`;v.add(z);const q=(Y?n.rules.resonevar:n.rules.onevar).cache,O=Y?l.resonevar:l.onevar;q.has(z)||(q.add(z),oI(V,[`.${z}`],[],t,te=>{O.apply(te)}))}for(const W of w)if(W!==void 0)for(const[X,V]of W){const Y=`${A}-${Bg(V)}-${X}`;v.add(Y),n.rules.allvar.cache.has(Y)||(n.rules.allvar.cache.add(Y),oI(V,[`.${Y}`],[],t,z=>{l.allvar.apply(z)}))}}if(typeof d=="object"&&d){const A=`${i}-i${Bg(d)}-css`;v.add(A),n.rules.inline.cache.has(A)||(n.rules.inline.cache.add(A),oI(d,[`.${A}`],[],t,b=>{l.inline.apply(b)}))}for(const A of String(C.className||"").trim().split(/\s+/))A&&v.add(A);const f=h.className=[...v].join(" ");return{type:e.type,className:f,selector:g,props:h,toString:()=>f,deferredInjector:a}};return rw(c,{className:i,selector:g,[Gg]:e,toString:()=>(n.rules.styled.cache.has(i)||c(),i)})},j8=t=>{let e="";const n=[],i={},o=[];for(const[r,,,,s,a]of t){e===""&&(e=r),n.push(r),o.push(...a);for(const l in s){const g=s[l];(i[l]===void 0||g!=="undefined"||a.includes(g))&&(i[l]=g)}}return[e,n,i,new Set(o)]},lV=(t,e,n,i)=>{const o=[];e:for(let[r,s,a]of t){if(a)continue;let l,g=0,c=!1;for(l in r){const C=r[l];let d=e[l];if(d!==C){if(typeof d!="object"||!d)continue e;{let h,p,v=0;for(const f in d){if(C===String(d[f])){if(f!=="@initial"){const A=f.slice(1);(p=p||[]).push(A in n?n[A]:f.replace(/^@media ?/,"")),c=!0}g+=v,h=!0}++v}if(p&&p.length&&(s={["@media "+p.join(", ")]:s}),!h)continue e}}}(o[g]=o[g]||[]).push([i?"cv":`${l}-${r[l]}`,s,c])}return o},q8={},$8=tu(),eq=(t,e)=>$8(t,()=>(...n)=>{const i=()=>{for(let o of n){o=typeof o=="object"&&o||{};let r=Bg(o);if(!e.rules.global.cache.has(r)){if(e.rules.global.cache.add(r),"@import"in o){let s=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let a of[].concat(o["@import"]))a=a.includes('"')||a.includes("'")?a:`"${a}"`,e.sheet.insertRule(`@import ${a};`,s++);delete o["@import"]}oI(o,[],[],t,s=>{e.rules.global.apply(s)})}}return""};return rw(i,{toString:i})}),tq=tu(),nq=(t,e)=>tq(t,()=>n=>{const i=`${da(t.prefix)}k-${Bg(n)}`,o=()=>{if(!e.rules.global.cache.has(i)){e.rules.global.cache.add(i);const r=[];oI(n,[],[],t,a=>r.push(a));const s=`@keyframes ${i}{${r.join("")}}`;e.rules.global.apply(s)}return i};return rw(o,{get name(){return o()},toString:o})}),iq=class{constructor(t,e,n,i){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=n==null?"":String(n),this.prefix=i==null?"":String(i)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+da(this.prefix)+da(this.scale)+this.token}toString(){return this.computedValue}},oq=tu(),rq=(t,e)=>oq(t,()=>(n,i)=>{i=typeof n=="object"&&n||Object(i);const o=`.${n=(n=typeof n=="string"?n:"")||`${da(t.prefix)}t-${Bg(i)}`}`,r={},s=[];for(const l in i){r[l]={};for(const g in i[l]){const c=`--${da(t.prefix)}${l}-${g}`,C=nF(String(i[l][g]),t.prefix,l);r[l][g]=new iq(g,C,l,t.prefix),s.push(`${c}:${C}`)}}const a=()=>{if(s.length&&!e.rules.themed.cache.has(n)){e.rules.themed.cache.add(n);const l=`${i===t.theme?":root,":""}.${n}{${s.join(";")}}`;e.rules.themed.apply(l)}return n};return{...r,get className(){return a()},selector:o,toString:a}}),sq=tu(),aq=tu(),lq=t=>{const e=(n=>{let i=!1;const o=sq(n,r=>{i=!0;const s="prefix"in(r=typeof r=="object"&&r||{})?String(r.prefix):"",a=typeof r.media=="object"&&r.media||{},l=typeof r.root=="object"?r.root||null:globalThis.document||null,g=typeof r.theme=="object"&&r.theme||{},c={prefix:s,media:a,theme:g,themeMap:typeof r.themeMap=="object"&&r.themeMap||{...M8},utils:typeof r.utils=="object"&&r.utils||{}},C=P8(l),d={css:aV(c,C),globalCss:eq(c,C),keyframes:nq(c,C),createTheme:rq(c,C),reset(){C.reset(),d.theme.toString()},theme:{},sheet:C,config:c,prefix:s,getCssText:C.toString,toString:C.toString};return String(d.theme=d.createTheme(g)),d});return i||o.reset(),o})(t);return e.styled=(({config:n,sheet:i})=>aq(n,()=>{const o=aV(n,i);return(...r)=>{const s=o(...r),a=s[Gg].type,l=ne.forwardRef((g,c)=>{const C=g&&g.as||a,{props:d,deferredInjector:h}=s(g);return delete d.as,d.ref=c,h?ne.createElement(ne.Fragment,null,ne.createElement(C,d),ne.createElement(h,null)):ne.createElement(C,d)});return l.className=s.className,l.displayName=`Styled.${a.displayName||a.name||a}`,l.selector=s.selector,l.toString=()=>s.selector,l[Gg]=s[Gg],l}}))(e),e};function qs(t,e,{checkForDefaultPrevented:n=!0}={}){return function(o){if(t==null||t(o),n===!1||!o.defaultPrevented)return e==null?void 0:e(o)}}function iF(t,e=[]){let n=[];function i(r,s){const a=x.createContext(s),l=n.length;n=[...n,s];function g(C){const{scope:d,children:h,...p}=C,v=(d==null?void 0:d[t][l])||a,f=x.useMemo(()=>p,Object.values(p));return x.createElement(v.Provider,{value:f},h)}function c(C,d){const h=(d==null?void 0:d[t][l])||a,p=x.useContext(h);if(p)return p;if(s!==void 0)return s;throw new Error(`\`${C}\` must be used within \`${r}\``)}return g.displayName=r+"Provider",[g,c]}const o=()=>{const r=n.map(s=>x.createContext(s));return function(a){const l=(a==null?void 0:a[t])||r;return x.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return o.scopeName=t,[i,gq(o,...e)]}function gq(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(r){const s=i.reduce((a,{useScope:l,scopeName:g})=>{const C=l(r)[`__scope${g}`];return{...a,...C}},{});return x.useMemo(()=>({[`__scope${e.scopeName}`]:s}),[s])}};return n.scopeName=e.scopeName,n}function nu(t){const e=x.useRef(t);return x.useEffect(()=>{e.current=t}),x.useMemo(()=>(...n)=>{var i;return(i=e.current)===null||i===void 0?void 0:i.call(e,...n)},[])}function cq(t,e=globalThis==null?void 0:globalThis.document){const n=nu(t);x.useEffect(()=>{const i=o=>{o.key==="Escape"&&n(o)};return e.addEventListener("keydown",i),()=>e.removeEventListener("keydown",i)},[n,e])}const mB="dismissableLayer.update",Iq="dismissableLayer.pointerDownOutside",uq="dismissableLayer.focusOutside";let gV;const Cq=x.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),dq=x.forwardRef((t,e)=>{var n;const{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:o,onPointerDownOutside:r,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...g}=t,c=x.useContext(Cq),[C,d]=x.useState(null),h=(n=C==null?void 0:C.ownerDocument)!==null&&n!==void 0?n:globalThis==null?void 0:globalThis.document,[,p]=x.useState({}),v=eu(e,X=>d(X)),f=Array.from(c.layers),[A]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),b=f.indexOf(A),m=C?f.indexOf(C):-1,B=c.layersWithOutsidePointerEventsDisabled.size>0,Z=m>=b,w=hq(X=>{const V=X.target,Y=[...c.branches].some(z=>z.contains(V));!Z||Y||(r==null||r(X),a==null||a(X),X.defaultPrevented||l==null||l())},h),W=Aq(X=>{const V=X.target;[...c.branches].some(z=>z.contains(V))||(s==null||s(X),a==null||a(X),X.defaultPrevented||l==null||l())},h);return cq(X=>{m===c.layers.size-1&&(o==null||o(X),!X.defaultPrevented&&l&&(X.preventDefault(),l()))},h),x.useEffect(()=>{if(C)return i&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(gV=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(C)),c.layers.add(C),cV(),()=>{i&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=gV)}},[C,h,i,c]),x.useEffect(()=>()=>{C&&(c.layers.delete(C),c.layersWithOutsidePointerEventsDisabled.delete(C),cV())},[C,c]),x.useEffect(()=>{const X=()=>p({});return document.addEventListener(mB,X),()=>document.removeEventListener(mB,X)},[]),x.createElement(Dg.div,pn({},g,{ref:v,style:{pointerEvents:B?Z?"auto":"none":void 0,...t.style},onFocusCapture:qs(t.onFocusCapture,W.onFocusCapture),onBlurCapture:qs(t.onBlurCapture,W.onBlurCapture),onPointerDownCapture:qs(t.onPointerDownCapture,w.onPointerDownCapture)}))});function hq(t,e=globalThis==null?void 0:globalThis.document){const n=nu(t),i=x.useRef(!1),o=x.useRef(()=>{});return x.useEffect(()=>{const r=a=>{if(a.target&&!i.current){let c=function(){oF(Iq,n,g,{discrete:!0})};var l=c;const g={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=c,e.addEventListener("click",o.current,{once:!0})):c()}i.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",r)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",r),e.removeEventListener("click",o.current)}},[e,n]),{onPointerDownCapture:()=>i.current=!0}}function Aq(t,e=globalThis==null?void 0:globalThis.document){const n=nu(t),i=x.useRef(!1);return x.useEffect(()=>{const o=r=>{r.target&&!i.current&&oF(uq,n,{originalEvent:r},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function cV(){const t=new CustomEvent(mB);document.dispatchEvent(t)}function oF(t,e,n,{discrete:i}){const o=n.originalEvent.target,r=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&o.addEventListener(t,e,{once:!0}),i?R8(o,r):o.dispatchEvent(r)}const HI=globalThis!=null&&globalThis.document?x.useLayoutEffect:()=>{},pq=IN["useId".toString()]||(()=>{});let fq=0;function mq(t){const[e,n]=x.useState(pq());return HI(()=>{t||n(i=>i??String(fq++))},[t]),t||(e?`radix-${e}`:"")}const bq=["top","right","bottom","left"],Al=Math.min,zo=Math.max,Ef=Math.round,hp=Math.floor,pl=t=>({x:t,y:t}),yq={left:"right",right:"left",bottom:"top",top:"bottom"},vq={start:"end",end:"start"};function bB(t,e,n){return zo(t,Al(e,n))}function ha(t,e){return typeof t=="function"?t(e):t}function Aa(t){return t.split("-")[0]}function iu(t){return t.split("-")[1]}function sw(t){return t==="x"?"y":"x"}function aw(t){return t==="y"?"height":"width"}function ou(t){return["top","bottom"].includes(Aa(t))?"y":"x"}function lw(t){return sw(ou(t))}function Gq(t,e,n){n===void 0&&(n=!1);const i=iu(t),o=lw(t),r=aw(o);let s=o==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(s=kf(s)),[s,kf(s)]}function Bq(t){const e=kf(t);return[yB(t),e,yB(e)]}function yB(t){return t.replace(/start|end/g,e=>vq[e])}function Zq(t,e,n){const i=["left","right"],o=["right","left"],r=["top","bottom"],s=["bottom","top"];switch(t){case"top":case"bottom":return n?e?o:i:e?i:o;case"left":case"right":return e?r:s;default:return[]}}function wq(t,e,n,i){const o=iu(t);let r=Zq(Aa(t),n==="start",i);return o&&(r=r.map(s=>s+"-"+o),e&&(r=r.concat(r.map(yB)))),r}function kf(t){return t.replace(/left|right|bottom|top/g,e=>yq[e])}function Sq(t){return{top:0,right:0,bottom:0,left:0,...t}}function rF(t){return typeof t!="number"?Sq(t):{top:t,right:t,bottom:t,left:t}}function Tf(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}function IV(t,e,n){let{reference:i,floating:o}=t;const r=ou(e),s=lw(e),a=aw(s),l=Aa(e),g=r==="y",c=i.x+i.width/2-o.width/2,C=i.y+i.height/2-o.height/2,d=i[a]/2-o[a]/2;let h;switch(l){case"top":h={x:c,y:i.y-o.height};break;case"bottom":h={x:c,y:i.y+i.height};break;case"right":h={x:i.x+i.width,y:C};break;case"left":h={x:i.x-o.width,y:C};break;default:h={x:i.x,y:i.y}}switch(iu(e)){case"start":h[s]-=d*(n&&g?-1:1);break;case"end":h[s]+=d*(n&&g?-1:1);break}return h}const Rq=async(t,e,n)=>{const{placement:i="bottom",strategy:o="absolute",middleware:r=[],platform:s}=n,a=r.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(e));let g=await s.getElementRects({reference:t,floating:e,strategy:o}),{x:c,y:C}=IV(g,i,l),d=i,h={},p=0;for(let v=0;v<a.length;v++){const{name:f,fn:A}=a[v],{x:b,y:m,data:B,reset:Z}=await A({x:c,y:C,initialPlacement:i,placement:d,strategy:o,middlewareData:h,rects:g,platform:s,elements:{reference:t,floating:e}});if(c=b??c,C=m??C,h={...h,[f]:{...h[f],...B}},Z&&p<=50){p++,typeof Z=="object"&&(Z.placement&&(d=Z.placement),Z.rects&&(g=Z.rects===!0?await s.getElementRects({reference:t,floating:e,strategy:o}):Z.rects),{x:c,y:C}=IV(g,d,l)),v=-1;continue}}return{x:c,y:C,placement:d,strategy:o,middlewareData:h}};async function wd(t,e){var n;e===void 0&&(e={});const{x:i,y:o,platform:r,rects:s,elements:a,strategy:l}=t,{boundary:g="clippingAncestors",rootBoundary:c="viewport",elementContext:C="floating",altBoundary:d=!1,padding:h=0}=ha(e,t),p=rF(h),f=a[d?C==="floating"?"reference":"floating":C],A=Tf(await r.getClippingRect({element:(n=await(r.isElement==null?void 0:r.isElement(f)))==null||n?f:f.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:g,rootBoundary:c,strategy:l})),b=C==="floating"?{...s.floating,x:i,y:o}:s.reference,m=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),B=await(r.isElement==null?void 0:r.isElement(m))?await(r.getScale==null?void 0:r.getScale(m))||{x:1,y:1}:{x:1,y:1},Z=Tf(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({rect:b,offsetParent:m,strategy:l}):b);return{top:(A.top-Z.top+p.top)/B.y,bottom:(Z.bottom-A.bottom+p.bottom)/B.y,left:(A.left-Z.left+p.left)/B.x,right:(Z.right-A.right+p.right)/B.x}}const uV=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:i,placement:o,rects:r,platform:s,elements:a}=e,{element:l,padding:g=0}=ha(t,e)||{};if(l==null)return{};const c=rF(g),C={x:n,y:i},d=lw(o),h=aw(d),p=await s.getDimensions(l),v=d==="y",f=v?"top":"left",A=v?"bottom":"right",b=v?"clientHeight":"clientWidth",m=r.reference[h]+r.reference[d]-C[d]-r.floating[h],B=C[d]-r.reference[d],Z=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l));let w=Z?Z[b]:0;(!w||!await(s.isElement==null?void 0:s.isElement(Z)))&&(w=a.floating[b]||r.floating[h]);const W=m/2-B/2,X=w/2-p[h]/2-1,V=Al(c[f],X),Y=Al(c[A],X),z=V,q=w-p[h]-Y,O=w/2-p[h]/2+W,te=bB(z,O,q),re=iu(o)!=null&&O!=te&&r.reference[h]/2-(O<z?V:Y)-p[h]/2<0?O<z?z-O:q-O:0;return{[d]:C[d]-re,data:{[d]:te,centerOffset:O-te+re}}}}),Wq=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n;const{placement:i,middlewareData:o,rects:r,initialPlacement:s,platform:a,elements:l}=e,{mainAxis:g=!0,crossAxis:c=!0,fallbackPlacements:C,fallbackStrategy:d="bestFit",fallbackAxisSideDirection:h="none",flipAlignment:p=!0,...v}=ha(t,e),f=Aa(i),A=Aa(s)===s,b=await(a.isRTL==null?void 0:a.isRTL(l.floating)),m=C||(A||!p?[kf(s)]:Bq(s));!C&&h!=="none"&&m.push(...wq(s,p,h,b));const B=[s,...m],Z=await wd(e,v),w=[];let W=((n=o.flip)==null?void 0:n.overflows)||[];if(g&&w.push(Z[f]),c){const z=Gq(i,r,b);w.push(Z[z[0]],Z[z[1]])}if(W=[...W,{placement:i,overflows:w}],!w.every(z=>z<=0)){var X,V;const z=(((X=o.flip)==null?void 0:X.index)||0)+1,q=B[z];if(q)return{data:{index:z,overflows:W},reset:{placement:q}};let O=(V=W.filter(te=>te.overflows[0]<=0).sort((te,oe)=>te.overflows[1]-oe.overflows[1])[0])==null?void 0:V.placement;if(!O)switch(d){case"bestFit":{var Y;const te=(Y=W.map(oe=>[oe.placement,oe.overflows.filter(re=>re>0).reduce((re,se)=>re+se,0)]).sort((oe,re)=>oe[1]-re[1])[0])==null?void 0:Y[0];te&&(O=te);break}case"initialPlacement":O=s;break}if(i!==O)return{reset:{placement:O}}}return{}}}};function CV(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function dV(t){return bq.some(e=>t[e]>=0)}const xq=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:i="referenceHidden",...o}=ha(t,e);switch(i){case"referenceHidden":{const r=await wd(e,{...o,elementContext:"reference"}),s=CV(r,n.reference);return{data:{referenceHiddenOffsets:s,referenceHidden:dV(s)}}}case"escaped":{const r=await wd(e,{...o,altBoundary:!0}),s=CV(r,n.floating);return{data:{escapedOffsets:s,escaped:dV(s)}}}default:return{}}}}};async function Vq(t,e){const{placement:n,platform:i,elements:o}=t,r=await(i.isRTL==null?void 0:i.isRTL(o.floating)),s=Aa(n),a=iu(n),l=ou(n)==="y",g=["left","top"].includes(s)?-1:1,c=r&&l?-1:1,C=ha(e,t);let{mainAxis:d,crossAxis:h,alignmentAxis:p}=typeof C=="number"?{mainAxis:C,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...C};return a&&typeof p=="number"&&(h=a==="end"?p*-1:p),l?{x:h*c,y:d*g}:{x:d*g,y:h*c}}const Xq=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){const{x:n,y:i}=e,o=await Vq(e,t);return{x:n+o.x,y:i+o.y,data:o}}}},Nq=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:o}=e,{mainAxis:r=!0,crossAxis:s=!1,limiter:a={fn:f=>{let{x:A,y:b}=f;return{x:A,y:b}}},...l}=ha(t,e),g={x:n,y:i},c=await wd(e,l),C=ou(Aa(o)),d=sw(C);let h=g[d],p=g[C];if(r){const f=d==="y"?"top":"left",A=d==="y"?"bottom":"right",b=h+c[f],m=h-c[A];h=bB(b,h,m)}if(s){const f=C==="y"?"top":"left",A=C==="y"?"bottom":"right",b=p+c[f],m=p-c[A];p=bB(b,p,m)}const v=a.fn({...e,[d]:h,[C]:p});return{...v,data:{x:v.x-n,y:v.y-i}}}}},Yq=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:i,placement:o,rects:r,middlewareData:s}=e,{offset:a=0,mainAxis:l=!0,crossAxis:g=!0}=ha(t,e),c={x:n,y:i},C=ou(o),d=sw(C);let h=c[d],p=c[C];const v=ha(a,e),f=typeof v=="number"?{mainAxis:v,crossAxis:0}:{mainAxis:0,crossAxis:0,...v};if(l){const m=d==="y"?"height":"width",B=r.reference[d]-r.floating[m]+f.mainAxis,Z=r.reference[d]+r.reference[m]-f.mainAxis;h<B?h=B:h>Z&&(h=Z)}if(g){var A,b;const m=d==="y"?"width":"height",B=["top","left"].includes(Aa(o)),Z=r.reference[C]-r.floating[m]+(B&&((A=s.offset)==null?void 0:A[C])||0)+(B?0:f.crossAxis),w=r.reference[C]+r.reference[m]+(B?0:((b=s.offset)==null?void 0:b[C])||0)-(B?f.crossAxis:0);p<Z?p=Z:p>w&&(p=w)}return{[d]:h,[C]:p}}}},Mq=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){const{placement:n,rects:i,platform:o,elements:r}=e,{apply:s=()=>{},...a}=ha(t,e),l=await wd(e,a),g=Aa(n),c=iu(n),C=ou(n)==="y",{width:d,height:h}=i.floating;let p,v;g==="top"||g==="bottom"?(p=g,v=c===(await(o.isRTL==null?void 0:o.isRTL(r.floating))?"start":"end")?"left":"right"):(v=g,p=c==="end"?"top":"bottom");const f=h-l[p],A=d-l[v],b=!e.middlewareData.shift;let m=f,B=A;if(C){const w=d-l.left-l.right;B=c||b?Al(A,w):w}else{const w=h-l.top-l.bottom;m=c||b?Al(f,w):w}if(b&&!c){const w=zo(l.left,0),W=zo(l.right,0),X=zo(l.top,0),V=zo(l.bottom,0);C?B=d-2*(w!==0||W!==0?w+W:zo(l.left,l.right)):m=h-2*(X!==0||V!==0?X+V:zo(l.top,l.bottom))}await s({...e,availableWidth:B,availableHeight:m});const Z=await o.getDimensions(r.floating);return d!==Z.width||h!==Z.height?{reset:{rects:!0}}:{}}}};function fl(t){return sF(t)?(t.nodeName||"").toLowerCase():"#document"}function To(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function ba(t){var e;return(e=(sF(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function sF(t){return t instanceof Node||t instanceof To(t).Node}function pa(t){return t instanceof Element||t instanceof To(t).Element}function Ss(t){return t instanceof HTMLElement||t instanceof To(t).HTMLElement}function hV(t){return typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof To(t).ShadowRoot}function rh(t){const{overflow:e,overflowX:n,overflowY:i,display:o}=fr(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!["inline","contents"].includes(o)}function Hq(t){return["table","td","th"].includes(fl(t))}function gw(t){const e=cw(),n=fr(t);return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(i=>(n.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(n.contain||"").includes(i))}function Fq(t){let e=FI(t);for(;Ss(e)&&!c0(e);){if(gw(e))return e;e=FI(e)}return null}function cw(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function c0(t){return["html","body","#document"].includes(fl(t))}function fr(t){return To(t).getComputedStyle(t)}function I0(t){return pa(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function FI(t){if(fl(t)==="html")return t;const e=t.assignedSlot||t.parentNode||hV(t)&&t.host||ba(t);return hV(e)?e.host:e}function aF(t){const e=FI(t);return c0(e)?t.ownerDocument?t.ownerDocument.body:t.body:Ss(e)&&rh(e)?e:aF(e)}function _f(t,e){var n;e===void 0&&(e=[]);const i=aF(t),o=i===((n=t.ownerDocument)==null?void 0:n.body),r=To(i);return o?e.concat(r,r.visualViewport||[],rh(i)?i:[]):e.concat(i,_f(i))}function lF(t){const e=fr(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const o=Ss(t),r=o?t.offsetWidth:n,s=o?t.offsetHeight:i,a=Ef(n)!==r||Ef(i)!==s;return a&&(n=r,i=s),{width:n,height:i,$:a}}function Iw(t){return pa(t)?t:t.contextElement}function hI(t){const e=Iw(t);if(!Ss(e))return pl(1);const n=e.getBoundingClientRect(),{width:i,height:o,$:r}=lF(e);let s=(r?Ef(n.width):n.width)/i,a=(r?Ef(n.height):n.height)/o;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const Kq=pl(0);function gF(t){const e=To(t);return!cw()||!e.visualViewport?Kq:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function zq(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==To(t)?!1:e}function Yg(t,e,n,i){e===void 0&&(e=!1),n===void 0&&(n=!1);const o=t.getBoundingClientRect(),r=Iw(t);let s=pl(1);e&&(i?pa(i)&&(s=hI(i)):s=hI(t));const a=zq(r,n,i)?gF(r):pl(0);let l=(o.left+a.x)/s.x,g=(o.top+a.y)/s.y,c=o.width/s.x,C=o.height/s.y;if(r){const d=To(r),h=i&&pa(i)?To(i):i;let p=d.frameElement;for(;p&&i&&h!==d;){const v=hI(p),f=p.getBoundingClientRect(),A=fr(p),b=f.left+(p.clientLeft+parseFloat(A.paddingLeft))*v.x,m=f.top+(p.clientTop+parseFloat(A.paddingTop))*v.y;l*=v.x,g*=v.y,c*=v.x,C*=v.y,l+=b,g+=m,p=To(p).frameElement}}return Tf({width:c,height:C,x:l,y:g})}function Lq(t){let{rect:e,offsetParent:n,strategy:i}=t;const o=Ss(n),r=ba(n);if(n===r)return e;let s={scrollLeft:0,scrollTop:0},a=pl(1);const l=pl(0);if((o||!o&&i!=="fixed")&&((fl(n)!=="body"||rh(r))&&(s=I0(n)),Ss(n))){const g=Yg(n);a=hI(n),l.x=g.x+n.clientLeft,l.y=g.y+n.clientTop}return{width:e.width*a.x,height:e.height*a.y,x:e.x*a.x-s.scrollLeft*a.x+l.x,y:e.y*a.y-s.scrollTop*a.y+l.y}}function Eq(t){return Array.from(t.getClientRects())}function cF(t){return Yg(ba(t)).left+I0(t).scrollLeft}function kq(t){const e=ba(t),n=I0(t),i=t.ownerDocument.body,o=zo(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),r=zo(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let s=-n.scrollLeft+cF(t);const a=-n.scrollTop;return fr(i).direction==="rtl"&&(s+=zo(e.clientWidth,i.clientWidth)-o),{width:o,height:r,x:s,y:a}}function Tq(t,e){const n=To(t),i=ba(t),o=n.visualViewport;let r=i.clientWidth,s=i.clientHeight,a=0,l=0;if(o){r=o.width,s=o.height;const g=cw();(!g||g&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}return{width:r,height:s,x:a,y:l}}function _q(t,e){const n=Yg(t,!0,e==="fixed"),i=n.top+t.clientTop,o=n.left+t.clientLeft,r=Ss(t)?hI(t):pl(1),s=t.clientWidth*r.x,a=t.clientHeight*r.y,l=o*r.x,g=i*r.y;return{width:s,height:a,x:l,y:g}}function AV(t,e,n){let i;if(e==="viewport")i=Tq(t,n);else if(e==="document")i=kq(ba(t));else if(pa(e))i=_q(e,n);else{const o=gF(t);i={...e,x:e.x-o.x,y:e.y-o.y}}return Tf(i)}function IF(t,e){const n=FI(t);return n===e||!pa(n)||c0(n)?!1:fr(n).position==="fixed"||IF(n,e)}function Uq(t,e){const n=e.get(t);if(n)return n;let i=_f(t).filter(a=>pa(a)&&fl(a)!=="body"),o=null;const r=fr(t).position==="fixed";let s=r?FI(t):t;for(;pa(s)&&!c0(s);){const a=fr(s),l=gw(s);!l&&a.position==="fixed"&&(o=null),(r?!l&&!o:!l&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||rh(s)&&!l&&IF(t,s))?i=i.filter(c=>c!==s):o=a,s=FI(s)}return e.set(t,i),i}function Pq(t){let{element:e,boundary:n,rootBoundary:i,strategy:o}=t;const s=[...n==="clippingAncestors"?Uq(e,this._c):[].concat(n),i],a=s[0],l=s.reduce((g,c)=>{const C=AV(e,c,o);return g.top=zo(C.top,g.top),g.right=Al(C.right,g.right),g.bottom=Al(C.bottom,g.bottom),g.left=zo(C.left,g.left),g},AV(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Dq(t){return lF(t)}function Jq(t,e,n){const i=Ss(e),o=ba(e),r=n==="fixed",s=Yg(t,!0,r,e);let a={scrollLeft:0,scrollTop:0};const l=pl(0);if(i||!i&&!r)if((fl(e)!=="body"||rh(o))&&(a=I0(e)),i){const g=Yg(e,!0,r,e);l.x=g.x+e.clientLeft,l.y=g.y+e.clientTop}else o&&(l.x=cF(o));return{x:s.left+a.scrollLeft-l.x,y:s.top+a.scrollTop-l.y,width:s.width,height:s.height}}function pV(t,e){return!Ss(t)||fr(t).position==="fixed"?null:e?e(t):t.offsetParent}function uF(t,e){const n=To(t);if(!Ss(t))return n;let i=pV(t,e);for(;i&&Hq(i)&&fr(i).position==="static";)i=pV(i,e);return i&&(fl(i)==="html"||fl(i)==="body"&&fr(i).position==="static"&&!gw(i))?n:i||Fq(t)||n}const Oq=async function(t){let{reference:e,floating:n,strategy:i}=t;const o=this.getOffsetParent||uF,r=this.getDimensions;return{reference:Jq(e,await o(n),i),floating:{x:0,y:0,...await r(n)}}};function Qq(t){return fr(t).direction==="rtl"}const jq={convertOffsetParentRelativeRectToViewportRelativeRect:Lq,getDocumentElement:ba,getClippingRect:Pq,getOffsetParent:uF,getElementRects:Oq,getClientRects:Eq,getDimensions:Dq,getScale:hI,isElement:pa,isRTL:Qq};function qq(t,e){let n=null,i;const o=ba(t);function r(){clearTimeout(i),n&&n.disconnect(),n=null}function s(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),r();const{left:g,top:c,width:C,height:d}=t.getBoundingClientRect();if(a||e(),!C||!d)return;const h=hp(c),p=hp(o.clientWidth-(g+C)),v=hp(o.clientHeight-(c+d)),f=hp(g),b={rootMargin:-h+"px "+-p+"px "+-v+"px "+-f+"px",threshold:zo(0,Al(1,l))||1};let m=!0;function B(Z){const w=Z[0].intersectionRatio;if(w!==l){if(!m)return s();w?s(!1,w):i=setTimeout(()=>{s(!1,1e-7)},100)}m=!1}try{n=new IntersectionObserver(B,{...b,root:o.ownerDocument})}catch{n=new IntersectionObserver(B,b)}n.observe(t)}return s(!0),r}function $q(t,e,n,i){i===void 0&&(i={});const{ancestorScroll:o=!0,ancestorResize:r=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=i,g=Iw(t),c=o||r?[...g?_f(g):[],..._f(e)]:[];c.forEach(A=>{o&&A.addEventListener("scroll",n,{passive:!0}),r&&A.addEventListener("resize",n)});const C=g&&a?qq(g,n):null;let d=-1,h=null;s&&(h=new ResizeObserver(A=>{let[b]=A;b&&b.target===g&&h&&(h.unobserve(e),cancelAnimationFrame(d),d=requestAnimationFrame(()=>{h&&h.observe(e)})),n()}),g&&!l&&h.observe(g),h.observe(e));let p,v=l?Yg(t):null;l&&f();function f(){const A=Yg(t);v&&(A.x!==v.x||A.y!==v.y||A.width!==v.width||A.height!==v.height)&&n(),v=A,p=requestAnimationFrame(f)}return n(),()=>{c.forEach(A=>{o&&A.removeEventListener("scroll",n),r&&A.removeEventListener("resize",n)}),C&&C(),h&&h.disconnect(),h=null,l&&cancelAnimationFrame(p)}}const e6=(t,e,n)=>{const i=new Map,o={platform:jq,...n},r={...o.platform,_c:i};return Rq(t,e,{...o,platform:r})},t6=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:i,padding:o}=typeof t=="function"?t(n):t;return i&&e(i)?i.current!=null?uV({element:i.current,padding:o}).fn(n):{}:i?uV({element:i,padding:o}).fn(n):{}}}};var tf=typeof document<"u"?x.useLayoutEffect:x.useEffect;function Uf(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,i,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(i=n;i--!==0;)if(!Uf(t[i],e[i]))return!1;return!0}if(o=Object.keys(t),n=o.length,n!==Object.keys(e).length)return!1;for(i=n;i--!==0;)if(!{}.hasOwnProperty.call(e,o[i]))return!1;for(i=n;i--!==0;){const r=o[i];if(!(r==="_owner"&&t.$$typeof)&&!Uf(t[r],e[r]))return!1}return!0}return t!==t&&e!==e}function CF(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function fV(t,e){const n=CF(t);return Math.round(e*n)/n}function mV(t){const e=x.useRef(t);return tf(()=>{e.current=t}),e}function n6(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:i=[],platform:o,elements:{reference:r,floating:s}={},transform:a=!0,whileElementsMounted:l,open:g}=t,[c,C]=x.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[d,h]=x.useState(i);Uf(d,i)||h(i);const[p,v]=x.useState(null),[f,A]=x.useState(null),b=x.useCallback(re=>{re!=w.current&&(w.current=re,v(re))},[v]),m=x.useCallback(re=>{re!==W.current&&(W.current=re,A(re))},[A]),B=r||p,Z=s||f,w=x.useRef(null),W=x.useRef(null),X=x.useRef(c),V=mV(l),Y=mV(o),z=x.useCallback(()=>{if(!w.current||!W.current)return;const re={placement:e,strategy:n,middleware:d};Y.current&&(re.platform=Y.current),e6(w.current,W.current,re).then(se=>{const H={...se,isPositioned:!0};q.current&&!Uf(X.current,H)&&(X.current=H,Ld.flushSync(()=>{C(H)}))})},[d,e,n,Y]);tf(()=>{g===!1&&X.current.isPositioned&&(X.current.isPositioned=!1,C(re=>({...re,isPositioned:!1})))},[g]);const q=x.useRef(!1);tf(()=>(q.current=!0,()=>{q.current=!1}),[]),tf(()=>{if(B&&(w.current=B),Z&&(W.current=Z),B&&Z){if(V.current)return V.current(B,Z,z);z()}},[B,Z,z,V]);const O=x.useMemo(()=>({reference:w,floating:W,setReference:b,setFloating:m}),[b,m]),te=x.useMemo(()=>({reference:B,floating:Z}),[B,Z]),oe=x.useMemo(()=>{const re={position:n,left:0,top:0};if(!te.floating)return re;const se=fV(te.floating,c.x),H=fV(te.floating,c.y);return a?{...re,transform:"translate("+se+"px, "+H+"px)",...CF(te.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:se,top:H}},[n,a,te.floating,c.x,c.y]);return x.useMemo(()=>({...c,update:z,refs:O,elements:te,floatingStyles:oe}),[c,z,O,te,oe])}const i6=x.forwardRef((t,e)=>{const{children:n,width:i=10,height:o=5,...r}=t;return x.createElement(Dg.svg,pn({},r,{ref:e,width:i,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),t.asChild?n:x.createElement("polygon",{points:"0,0 30,0 15,10"}))}),o6=i6;function r6(t){const[e,n]=x.useState(void 0);return HI(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const i=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const r=o[0];let s,a;if("borderBoxSize"in r){const l=r.borderBoxSize,g=Array.isArray(l)?l[0]:l;s=g.inlineSize,a=g.blockSize}else s=t.offsetWidth,a=t.offsetHeight;n({width:s,height:a})});return i.observe(t,{box:"border-box"}),()=>i.unobserve(t)}else n(void 0)},[t]),e}const dF="Popper",[hF,AF]=iF(dF),[s6,pF]=hF(dF),a6=t=>{const{__scopePopper:e,children:n}=t,[i,o]=x.useState(null);return x.createElement(s6,{scope:e,anchor:i,onAnchorChange:o},n)},l6="PopperAnchor",g6=x.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:i,...o}=t,r=pF(l6,n),s=x.useRef(null),a=eu(e,s);return x.useEffect(()=>{r.onAnchorChange((i==null?void 0:i.current)||s.current)}),i?null:x.createElement(Dg.div,pn({},o,{ref:a}))}),fF="PopperContent",[c6,I6]=hF(fF),u6=x.forwardRef((t,e)=>{var n,i,o,r,s,a,l,g;const{__scopePopper:c,side:C="bottom",sideOffset:d=0,align:h="center",alignOffset:p=0,arrowPadding:v=0,collisionBoundary:f=[],collisionPadding:A=0,sticky:b="partial",hideWhenDetached:m=!1,avoidCollisions:B=!0,onPlaced:Z,...w}=t,W=pF(fF,c),[X,V]=x.useState(null),Y=eu(e,Se=>V(Se)),[z,q]=x.useState(null),O=r6(z),te=(n=O==null?void 0:O.width)!==null&&n!==void 0?n:0,oe=(i=O==null?void 0:O.height)!==null&&i!==void 0?i:0,re=C+(h!=="center"?"-"+h:""),se=typeof A=="number"?A:{top:0,right:0,bottom:0,left:0,...A},H=Array.isArray(f)?f:[f],D=H.length>0,T={padding:se,boundary:H.filter(A6),altBoundary:D},{refs:J,floatingStyles:$,placement:Ie,isPositioned:fe,middlewareData:ve}=n6({strategy:"fixed",placement:re,whileElementsMounted:$q,elements:{reference:W.anchor},middleware:[Xq({mainAxis:d+oe,alignmentAxis:p}),B&&Nq({mainAxis:!0,crossAxis:!1,limiter:b==="partial"?Yq():void 0,...T}),B&&Wq({...T}),Mq({...T,apply:({elements:Se,rects:He,availableWidth:Ve,availableHeight:at})=>{const{width:Qe,height:et}=He.reference,ut=Se.floating.style;ut.setProperty("--radix-popper-available-width",`${Ve}px`),ut.setProperty("--radix-popper-available-height",`${at}px`),ut.setProperty("--radix-popper-anchor-width",`${Qe}px`),ut.setProperty("--radix-popper-anchor-height",`${et}px`)}}),z&&t6({element:z,padding:v}),p6({arrowWidth:te,arrowHeight:oe}),m&&xq({strategy:"referenceHidden"})]}),[Ge,Me]=mF(Ie),_e=nu(Z);HI(()=>{fe&&(_e==null||_e())},[fe,_e]);const Bt=(o=ve.arrow)===null||o===void 0?void 0:o.x,St=(r=ve.arrow)===null||r===void 0?void 0:r.y,ot=((s=ve.arrow)===null||s===void 0?void 0:s.centerOffset)!==0,[ee,Ne]=x.useState();return HI(()=>{X&&Ne(window.getComputedStyle(X).zIndex)},[X]),x.createElement("div",{ref:J.setFloating,"data-radix-popper-content-wrapper":"",style:{...$,transform:fe?$.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ee,"--radix-popper-transform-origin":[(a=ve.transformOrigin)===null||a===void 0?void 0:a.x,(l=ve.transformOrigin)===null||l===void 0?void 0:l.y].join(" ")},dir:t.dir},x.createElement(c6,{scope:c,placedSide:Ge,onArrowChange:q,arrowX:Bt,arrowY:St,shouldHideArrow:ot},x.createElement(Dg.div,pn({"data-side":Ge,"data-align":Me},w,{ref:Y,style:{...w.style,animation:fe?void 0:"none",opacity:(g=ve.hide)!==null&&g!==void 0&&g.referenceHidden?0:void 0}}))))}),C6="PopperArrow",d6={top:"bottom",right:"left",bottom:"top",left:"right"},h6=x.forwardRef(function(e,n){const{__scopePopper:i,...o}=e,r=I6(C6,i),s=d6[r.placedSide];return x.createElement("span",{ref:r.onArrowChange,style:{position:"absolute",left:r.arrowX,top:r.arrowY,[s]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[r.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[r.placedSide],visibility:r.shouldHideArrow?"hidden":void 0}},x.createElement(o6,pn({},o,{ref:n,style:{...o.style,display:"block"}})))});function A6(t){return t!==null}const p6=t=>({name:"transformOrigin",options:t,fn(e){var n,i,o,r,s;const{placement:a,rects:l,middlewareData:g}=e,C=((n=g.arrow)===null||n===void 0?void 0:n.centerOffset)!==0,d=C?0:t.arrowWidth,h=C?0:t.arrowHeight,[p,v]=mF(a),f={start:"0%",center:"50%",end:"100%"}[v],A=((i=(o=g.arrow)===null||o===void 0?void 0:o.x)!==null&&i!==void 0?i:0)+d/2,b=((r=(s=g.arrow)===null||s===void 0?void 0:s.y)!==null&&r!==void 0?r:0)+h/2;let m="",B="";return p==="bottom"?(m=C?f:`${A}px`,B=`${-h}px`):p==="top"?(m=C?f:`${A}px`,B=`${l.floating.height+h}px`):p==="right"?(m=`${-h}px`,B=C?f:`${b}px`):p==="left"&&(m=`${l.floating.width+h}px`,B=C?f:`${b}px`),{data:{x:m,y:B}}}});function mF(t){const[e,n="center"]=t.split("-");return[e,n]}const f6=a6,m6=g6,b6=u6,y6=h6;function v6(t,e){return x.useReducer((n,i)=>{const o=e[n][i];return o??n},t)}const bF=t=>{const{present:e,children:n}=t,i=G6(e),o=typeof n=="function"?n({present:i.isPresent}):x.Children.only(n),r=eu(i.ref,o.ref);return typeof n=="function"||i.isPresent?x.cloneElement(o,{ref:r}):null};bF.displayName="Presence";function G6(t){const[e,n]=x.useState(),i=x.useRef({}),o=x.useRef(t),r=x.useRef("none"),s=t?"mounted":"unmounted",[a,l]=v6(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return x.useEffect(()=>{const g=Ap(i.current);r.current=a==="mounted"?g:"none"},[a]),HI(()=>{const g=i.current,c=o.current;if(c!==t){const d=r.current,h=Ap(g);t?l("MOUNT"):h==="none"||(g==null?void 0:g.display)==="none"?l("UNMOUNT"):l(c&&d!==h?"ANIMATION_OUT":"UNMOUNT"),o.current=t}},[t,l]),HI(()=>{if(e){const g=C=>{const h=Ap(i.current).includes(C.animationName);C.target===e&&h&&Ld.flushSync(()=>l("ANIMATION_END"))},c=C=>{C.target===e&&(r.current=Ap(i.current))};return e.addEventListener("animationstart",c),e.addEventListener("animationcancel",g),e.addEventListener("animationend",g),()=>{e.removeEventListener("animationstart",c),e.removeEventListener("animationcancel",g),e.removeEventListener("animationend",g)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:x.useCallback(g=>{g&&(i.current=getComputedStyle(g)),n(g)},[])}}function Ap(t){return(t==null?void 0:t.animationName)||"none"}function B6({prop:t,defaultProp:e,onChange:n=()=>{}}){const[i,o]=Z6({defaultProp:e,onChange:n}),r=t!==void 0,s=r?t:i,a=nu(n),l=x.useCallback(g=>{if(r){const C=typeof g=="function"?g(t):g;C!==t&&a(C)}else o(g)},[r,t,o,a]);return[s,l]}function Z6({defaultProp:t,onChange:e}){const n=x.useState(t),[i]=n,o=x.useRef(i),r=nu(e);return x.useEffect(()=>{o.current!==i&&(r(i),o.current=i)},[i,o,r]),n}const w6=x.forwardRef((t,e)=>x.createElement(Dg.span,pn({},t,{ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}))),S6=w6,[u0,uae]=iF("Tooltip",[AF]),C0=AF(),R6="TooltipProvider",vB="tooltip.open",[Cae,uw]=u0(R6),Cw="Tooltip",[W6,d0]=u0(Cw),x6=t=>{const{__scopeTooltip:e,children:n,open:i,defaultOpen:o=!1,onOpenChange:r,disableHoverableContent:s,delayDuration:a}=t,l=uw(Cw,t.__scopeTooltip),g=C0(e),[c,C]=x.useState(null),d=mq(),h=x.useRef(0),p=s??l.disableHoverableContent,v=a??l.delayDuration,f=x.useRef(!1),[A=!1,b]=B6({prop:i,defaultProp:o,onChange:W=>{W?(l.onOpen(),document.dispatchEvent(new CustomEvent(vB))):l.onClose(),r==null||r(W)}}),m=x.useMemo(()=>A?f.current?"delayed-open":"instant-open":"closed",[A]),B=x.useCallback(()=>{window.clearTimeout(h.current),f.current=!1,b(!0)},[b]),Z=x.useCallback(()=>{window.clearTimeout(h.current),b(!1)},[b]),w=x.useCallback(()=>{window.clearTimeout(h.current),h.current=window.setTimeout(()=>{f.current=!0,b(!0)},v)},[v,b]);return x.useEffect(()=>()=>window.clearTimeout(h.current),[]),x.createElement(f6,g,x.createElement(W6,{scope:e,contentId:d,open:A,stateAttribute:m,trigger:c,onTriggerChange:C,onTriggerEnter:x.useCallback(()=>{l.isOpenDelayed?w():B()},[l.isOpenDelayed,w,B]),onTriggerLeave:x.useCallback(()=>{p?Z():window.clearTimeout(h.current)},[Z,p]),onOpen:B,onClose:Z,disableHoverableContent:p},n))},bV="TooltipTrigger",V6=x.forwardRef((t,e)=>{const{__scopeTooltip:n,...i}=t,o=d0(bV,n),r=uw(bV,n),s=C0(n),a=x.useRef(null),l=eu(e,a,o.onTriggerChange),g=x.useRef(!1),c=x.useRef(!1),C=x.useCallback(()=>g.current=!1,[]);return x.useEffect(()=>()=>document.removeEventListener("pointerup",C),[C]),x.createElement(m6,pn({asChild:!0},s),x.createElement(Dg.button,pn({"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute},i,{ref:l,onPointerMove:qs(t.onPointerMove,d=>{d.pointerType!=="touch"&&!c.current&&!r.isPointerInTransitRef.current&&(o.onTriggerEnter(),c.current=!0)}),onPointerLeave:qs(t.onPointerLeave,()=>{o.onTriggerLeave(),c.current=!1}),onPointerDown:qs(t.onPointerDown,()=>{g.current=!0,document.addEventListener("pointerup",C,{once:!0})}),onFocus:qs(t.onFocus,()=>{g.current||o.onOpen()}),onBlur:qs(t.onBlur,o.onClose),onClick:qs(t.onClick,o.onClose)})))}),X6="TooltipPortal",[dae,N6]=u0(X6,{forceMount:void 0}),Sd="TooltipContent",Y6=x.forwardRef((t,e)=>{const n=N6(Sd,t.__scopeTooltip),{forceMount:i=n.forceMount,side:o="top",...r}=t,s=d0(Sd,t.__scopeTooltip);return x.createElement(bF,{present:i||s.open},s.disableHoverableContent?x.createElement(yF,pn({side:o},r,{ref:e})):x.createElement(M6,pn({side:o},r,{ref:e})))}),M6=x.forwardRef((t,e)=>{const n=d0(Sd,t.__scopeTooltip),i=uw(Sd,t.__scopeTooltip),o=x.useRef(null),r=eu(e,o),[s,a]=x.useState(null),{trigger:l,onClose:g}=n,c=o.current,{onPointerInTransitChange:C}=i,d=x.useCallback(()=>{a(null),C(!1)},[C]),h=x.useCallback((p,v)=>{const f=p.currentTarget,A={x:p.clientX,y:p.clientY},b=L6(A,f.getBoundingClientRect()),m=E6(A,b),B=k6(v.getBoundingClientRect()),Z=_6([...m,...B]);a(Z),C(!0)},[C]);return x.useEffect(()=>()=>d(),[d]),x.useEffect(()=>{if(l&&c){const p=f=>h(f,c),v=f=>h(f,l);return l.addEventListener("pointerleave",p),c.addEventListener("pointerleave",v),()=>{l.removeEventListener("pointerleave",p),c.removeEventListener("pointerleave",v)}}},[l,c,h,d]),x.useEffect(()=>{if(s){const p=v=>{const f=v.target,A={x:v.clientX,y:v.clientY},b=(l==null?void 0:l.contains(f))||(c==null?void 0:c.contains(f)),m=!T6(A,s);b?d():m&&(d(),g())};return document.addEventListener("pointermove",p),()=>document.removeEventListener("pointermove",p)}},[l,c,s,g,d]),x.createElement(yF,pn({},t,{ref:r}))}),[H6,F6]=u0(Cw,{isInside:!1}),yF=x.forwardRef((t,e)=>{const{__scopeTooltip:n,children:i,"aria-label":o,onEscapeKeyDown:r,onPointerDownOutside:s,...a}=t,l=d0(Sd,n),g=C0(n),{onClose:c}=l;return x.useEffect(()=>(document.addEventListener(vB,c),()=>document.removeEventListener(vB,c)),[c]),x.useEffect(()=>{if(l.trigger){const C=d=>{const h=d.target;h!=null&&h.contains(l.trigger)&&c()};return window.addEventListener("scroll",C,{capture:!0}),()=>window.removeEventListener("scroll",C,{capture:!0})}},[l.trigger,c]),x.createElement(dq,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:r,onPointerDownOutside:s,onFocusOutside:C=>C.preventDefault(),onDismiss:c},x.createElement(b6,pn({"data-state":l.stateAttribute},g,a,{ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"}}),x.createElement(jH,null,i),x.createElement(H6,{scope:n,isInside:!0},x.createElement(S6,{id:l.contentId,role:"tooltip"},o||i))))}),K6="TooltipArrow",z6=x.forwardRef((t,e)=>{const{__scopeTooltip:n,...i}=t,o=C0(n);return F6(K6,n).isInside?null:x.createElement(y6,pn({},o,i,{ref:e}))});function L6(t,e){const n=Math.abs(e.top-t.y),i=Math.abs(e.bottom-t.y),o=Math.abs(e.right-t.x),r=Math.abs(e.left-t.x);switch(Math.min(n,i,o,r)){case r:return"left";case o:return"right";case n:return"top";case i:return"bottom";default:throw new Error("unreachable")}}function E6(t,e,n=5){const i=[];switch(e){case"top":i.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":i.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":i.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":i.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return i}function k6(t){const{top:e,right:n,bottom:i,left:o}=t;return[{x:o,y:e},{x:n,y:e},{x:n,y:i},{x:o,y:i}]}function T6(t,e){const{x:n,y:i}=t;let o=!1;for(let r=0,s=e.length-1;r<e.length;s=r++){const a=e[r].x,l=e[r].y,g=e[s].x,c=e[s].y;l>i!=c>i&&n<(g-a)*(i-l)/(c-l)+a&&(o=!o)}return o}function _6(t){const e=t.slice();return e.sort((n,i)=>n.x<i.x?-1:n.x>i.x?1:n.y<i.y?-1:n.y>i.y?1:0),U6(e)}function U6(t){if(t.length<=1)return t.slice();const e=[];for(let i=0;i<t.length;i++){const o=t[i];for(;e.length>=2;){const r=e[e.length-1],s=e[e.length-2];if((r.x-s.x)*(o.y-s.y)>=(r.y-s.y)*(o.x-s.x))e.pop();else break}e.push(o)}e.pop();const n=[];for(let i=t.length-1;i>=0;i--){const o=t[i];for(;n.length>=2;){const r=n[n.length-1],s=n[n.length-2];if((r.x-s.x)*(o.y-s.y)>=(r.y-s.y)*(o.x-s.x))n.pop();else break}n.push(o)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}const P6=x6,D6=V6,J6=Y6,O6=z6;function Q6(t,e){if(t==null)return{};var n={},i=Object.keys(t),o,r;for(r=0;r<i.length;r++)o=i[r],!(e.indexOf(o)>=0)&&(n[o]=t[o]);return n}function An(t,e){if(t==null)return{};var n=Q6(t,e),i,o;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}let Hn;(function(t){t[t.UNSUPPORTED_INPUT=0]="UNSUPPORTED_INPUT",t[t.NO_COMPONENT_FOR_TYPE=1]="NO_COMPONENT_FOR_TYPE",t[t.UNKNOWN_INPUT=2]="UNKNOWN_INPUT",t[t.DUPLICATE_KEYS=3]="DUPLICATE_KEYS",t[t.ALREADY_REGISTERED_TYPE=4]="ALREADY_REGISTERED_TYPE",t[t.CLIPBOARD_ERROR=5]="CLIPBOARD_ERROR",t[t.THEME_ERROR=6]="THEME_ERROR",t[t.PATH_DOESNT_EXIST=7]="PATH_DOESNT_EXIST",t[t.INPUT_TYPE_OVERRIDE=8]="INPUT_TYPE_OVERRIDE",t[t.EMPTY_KEY=9]="EMPTY_KEY"})(Hn||(Hn={}));const j6={[Hn.UNSUPPORTED_INPUT]:(t,e)=>[`An input with type \`${t}\` input was found at path \`${e}\` but it's not supported yet.`],[Hn.NO_COMPONENT_FOR_TYPE]:(t,e)=>[`Type \`${t}\` found at path \`${e}\` can't be displayed in panel because no component supports it yet.`],[Hn.UNKNOWN_INPUT]:(t,e)=>[`input at path \`${t}\` is not recognized.`,e],[Hn.DUPLICATE_KEYS]:(t,e,n)=>[`Key \`${t}\` of path \`${e}\` already exists at path \`${n}\`. Even nested keys need to be unique. Rename one of the keys.`],[Hn.ALREADY_REGISTERED_TYPE]:t=>[`Type ${t} has already been registered. You can't register a component with the same type.`],[Hn.CLIPBOARD_ERROR]:t=>["Error copying the value",t],[Hn.THEME_ERROR]:(t,e)=>[`Error accessing the theme \`${t}.${e}\` value.`],[Hn.PATH_DOESNT_EXIST]:t=>[`Error getting the value at path \`${t}\`. There is probably an error in your \`render\` function.`],[Hn.PATH_DOESNT_EXIST]:t=>[`Error accessing the value at path \`${t}\``],[Hn.INPUT_TYPE_OVERRIDE]:(t,e,n)=>[`Input at path \`${t}\` already exists with type: \`${e}\`. Its type cannot be overridden with type \`${n}\`.`],[Hn.EMPTY_KEY]:()=>["Keys can not be empty, if you want to hide a label use whitespace."]};function vF(t,e,...n){const[i,...o]=j6[e](...n);console[t]("LEVA: "+i,...o)}const ea=vF.bind(null,"warn"),q6=vF.bind(null,"log"),$6=["value"],e$=["schema"],t$=["value"],GF=[],Mg={};function yV(t){let{value:e}=t,n=An(t,$6);for(let i of GF){const o=i(e,n);if(o)return o}}function ya(t,e){let{schema:n}=e,i=An(e,e$);if(t in Mg){ea(Hn.ALREADY_REGISTERED_TYPE,t);return}GF.push((o,r)=>n(o,r)&&t),Mg[t]=i}function tv(t,e,n,i){const{normalize:o}=Mg[t];if(o)return o(e,n,i);if(typeof e!="object"||!("value"in e))return{value:e};const{value:r}=e,s=An(e,t$);return{value:r,settings:s}}function n$(t,e,n,i,o,r){const{sanitize:s}=Mg[t];return s?s(e,n,i,o,r):e}function vV(t,e,n){const{format:i}=Mg[t];return i?i(e,n):e}function i$(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function GV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function wt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?GV(Object(n),!0).forEach(function(i){i$(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):GV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const ml=(t,e,n)=>t>n?n:t<e?e:t,o$=t=>{if(t===""||typeof t=="number")return t;try{const e=za(t);if(!isNaN(e))return e}catch{}return parseFloat(t)},r$=Math.log(10);function BV(t){let e=Math.abs(+String(t).replace(".",""));if(e===0)return .01;for(;e!==0&&e%10===0;)e/=10;const n=Math.floor(Math.log(e)/r$)+1,i=Math.floor(Math.log10(Math.abs(t))),o=Math.pow(10,i-n);return Math.max(o,.001)}const Pf=(t,e,n)=>n===e?0:(ml(t,e,n)-e)/(n-e),Df=(t,e,n)=>t*(n-e)+e,s$=()=>"_"+Math.random().toString(36).substr(2,9),ZV=/\(([0-9+\-*/^ .]+)\)/,wV=/(\d+(?:\.\d+)?) ?\^ ?(\d+(?:\.\d+)?)/,SV=/(\d+(?:\.\d+)?) ?\* ?(\d+(?:\.\d+)?)/,RV=/(\d+(?:\.\d+)?) ?\/ ?(\d+(?:\.\d+)?)/,WV=/(\d+(?:\.\d+)?) ?\+ ?(\d+(?:\.\d+)?)/,xV=/(\d+(?:\.\d+)?) ?- ?(\d+(?:\.\d+)?)/;function za(t){if(isNaN(Number(t)))if(ZV.test(t)){const e=t.replace(ZV,(n,i)=>String(za(i)));return za(e)}else if(wV.test(t)){const e=t.replace(wV,(n,i,o)=>String(Math.pow(Number(i),Number(o))));return za(e)}else if(SV.test(t)){const e=t.replace(SV,(n,i,o)=>String(Number(i)*Number(o)));return za(e)}else if(RV.test(t)){const e=t.replace(RV,(n,i,o)=>{if(o!=0)return String(Number(i)/Number(o));throw new Error("Division by zero")});return za(e)}else if(WV.test(t)){const e=t.replace(WV,(n,i,o)=>String(Number(i)+Number(o)));return za(e)}else if(xV.test(t)){const e=t.replace(xV,(n,i,o)=>String(Number(i)-Number(o)));return za(e)}else return Number(t);return Number(t)}function a$(t,e){return e.reduce((n,i)=>(t&&t.hasOwnProperty(i)&&(n[i]=t[i]),n),{})}function l$(t,e){const n=wt({},t);return e.forEach(i=>i in t&&delete n[i]),n}function g$(t,e){return t.reduce((n,i,o)=>Object.assign(n,{[e[o]]:i}),{})}function BF(t){return Object.prototype.toString.call(t)==="[object Object]"}const c$=t=>BF(t)&&Object.keys(t).length===0;let kr;(function(t){t.BUTTON="BUTTON",t.BUTTON_GROUP="BUTTON_GROUP",t.MONITOR="MONITOR",t.FOLDER="FOLDER"})(kr||(kr={}));let Ur;(function(t){t.SELECT="SELECT",t.IMAGE="IMAGE",t.NUMBER="NUMBER",t.COLOR="COLOR",t.STRING="STRING",t.BOOLEAN="BOOLEAN",t.INTERVAL="INTERVAL",t.VECTOR3D="VECTOR3D",t.VECTOR2D="VECTOR2D"})(Ur||(Ur={}));const I$=["type","__customInput"],u$=["render","label","optional","order","disabled","hint","onChange","onEditStart","onEditEnd","transient"],C$=["type"];function ZF(t,e,n={},i){var o,r;if(typeof t!="object"||Array.isArray(t))return{type:i,input:t,options:wt({key:e,label:e,optional:!1,disabled:!1,order:0},n)};if("__customInput"in t){const{type:Z,__customInput:w}=t,W=An(t,I$);return ZF(w,e,W,Z)}const{render:s,label:a,optional:l,order:g=0,disabled:c,hint:C,onChange:d,onEditStart:h,onEditEnd:p,transient:v}=t,f=An(t,u$),A=wt({render:s,key:e,label:a??e,hint:C,transient:v??!!d,onEditStart:h,onEditEnd:p,disabled:c,optional:l,order:g},n);let{type:b}=f,m=An(f,C$);if(b=i??b,b in kr)return{type:b,input:m,options:A};let B;return i&&BF(m)&&"value"in m?B=m.value:B=c$(m)?void 0:m,{type:b,input:B,options:wt(wt({},A),{},{onChange:d,optional:(o=A.optional)!==null&&o!==void 0?o:!1,disabled:(r=A.disabled)!==null&&r!==void 0?r:!1})}}function d$(t,e,n,i){const o=ZF(t,e),{type:r,input:s,options:a}=o;if(r)return r in kr?o:{type:r,input:tv(r,s,n,i),options:a};let l=yV(s);return l?{type:l,input:tv(l,s,n,i),options:a}:(l=yV({value:s}),l?{type:l,input:tv(l,{value:s},n,i),options:a}:!1)}function VV(t,e,n,i,o){const{value:r,type:s,settings:a}=t;t.value=wF({type:s,value:r,settings:a},e,n,i),t.fromPanel=o}const h$=function(e,n,i){this.type="LEVA_ERROR",this.message="LEVA: "+e,this.previousValue=n,this.error=i};function wF({type:t,value:e,settings:n},i,o,r){const s=t!=="SELECT"&&typeof i=="function"?i(e):i;let a;try{a=n$(t,s,n,e,o,r)}catch(l){throw new h$(`The value \`${i}\` did not result in a correct value.`,e,l)}return Bd(a,e)?e:a}const SF=(t,e,n=!1)=>{let i=0;return function(){const o=arguments,r=n&&!i,s=()=>t.apply(this,o);window.clearTimeout(i),i=window.setTimeout(s,e),r&&s()}},RF=t=>t.shiftKey?5:t.altKey?1/5:1;function A$(t,e){const n=console.error;console.error=()=>{},A5.render(t,e),console.error=n}const p$=["value"],f$=["min","max"],m$=t=>{if(typeof t=="number")return!0;if(typeof t=="string"){const e=parseFloat(t);return isNaN(e)?!1:t.substring((""+e).length).trim().length<4}return!1},WF=(t,{min:e=-1/0,max:n=1/0,suffix:i})=>{const o=parseFloat(t);if(t===""||isNaN(o))throw Error("Invalid number");const r=ml(o,e,n);return i?r+i:r},b$=(t,{pad:e=0,suffix:n})=>{const i=parseFloat(t).toFixed(e);return n?i+n:i},xF=t=>{let{value:e}=t,n=An(t,p$);const{min:i=-1/0,max:o=1/0}=n,r=An(n,f$);let s=parseFloat(e);const a=typeof e=="string"?e.substring((""+s).length):void 0;s=ml(s,i,o);let l=n.step;l||(Number.isFinite(i)?Number.isFinite(o)?l=+(Math.abs(o-i)/100).toPrecision(1):l=+(Math.abs(s-i)/100).toPrecision(1):Number.isFinite(o)&&(l=+(Math.abs(o-s)/100).toPrecision(1)));const g=l?BV(l)*10:BV(s);l=l||g/10;const c=Math.round(ml(Math.log10(1/g),0,2));return{value:a?s+a:s,settings:wt({initialValue:s,step:l,pad:c,min:i,max:o,suffix:a},r)}},VF=(t,{step:e,initialValue:n})=>{const i=Math.round((t-n)/e);return n+i*e};var XF=Object.freeze({__proto__:null,schema:m$,sanitize:WF,format:b$,normalize:xF,sanitizeStep:VF});function Pn(){return Pn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Pn.apply(this,arguments)}const NF=x.createContext({});function Pi(){return x.useContext(NF)}const dw=x.createContext(null),YF=x.createContext(null),MF=x.createContext(null);function sh(){return x.useContext(YF)}function y$(){return x.useContext(MF)}const HF=()=>({colors:{elevation1:"#292d39",elevation2:"#181c20",elevation3:"#373c4b",accent1:"#0066dc",accent2:"#007bff",accent3:"#3c93ff",highlight1:"#535760",highlight2:"#8c92a4",highlight3:"#fefefe",vivid1:"#ffcc00",folderWidgetColor:"$highlight2",folderTextColor:"$highlight3",toolTipBackground:"$highlight3",toolTipText:"$elevation2"},radii:{xs:"2px",sm:"3px",lg:"10px"},space:{xs:"3px",sm:"6px",md:"10px",rowGap:"7px",colGap:"7px"},fonts:{mono:"ui-monospace, SFMono-Regular, Menlo, 'Roboto Mono', monospace",sans:"system-ui, sans-serif"},fontSizes:{root:"11px",toolTip:"$root"},sizes:{rootWidth:"280px",controlWidth:"160px",numberInputMinWidth:"38px",scrubberWidth:"8px",scrubberHeight:"16px",rowHeight:"24px",folderTitleHeight:"20px",checkboxSize:"16px",joystickWidth:"100px",joystickHeight:"100px",colorPickerWidth:"$controlWidth",colorPickerHeight:"100px",imagePreviewWidth:"$controlWidth",imagePreviewHeight:"100px",monitorHeight:"60px",titleBarHeight:"39px"},shadows:{level1:"0 0 9px 0 #00000088",level2:"0 4px 14px #00000033"},borderWidths:{root:"0px",input:"1px",focus:"1px",hover:"1px",active:"1px",folder:"1px"},fontWeights:{label:"normal",folder:"normal",button:"normal"}});function pp(t,e){const[n,i]=t.split(" "),o={};return n!=="none"&&(o.boxShadow=`${e.inset?"inset ":""}0 0 0 $borderWidths${[e.key]} $colors${n!=="default"&&n||e.borderColor}`),i&&(o.backgroundColor=i),o}const Ju={$inputStyle:()=>t=>pp(t,{key:"$input",borderColor:"$highlight1",inset:!0}),$focusStyle:()=>t=>pp(t,{key:"$focus",borderColor:"$accent2"}),$hoverStyle:()=>t=>pp(t,{key:"$hover",borderColor:"$accent1",inset:!0}),$activeStyle:()=>t=>pp(t,{key:"$active",borderColor:"$accent1",inset:!0})},{styled:Gt,css:hae,createTheme:v$,globalCss:G$,keyframes:Aae}=lq({prefix:"leva",theme:HF(),utils:wt(wt({},Ju),{},{$flex:()=>({display:"flex",alignItems:"center"}),$flexCenter:()=>({display:"flex",alignItems:"center",justifyContent:"center"}),$reset:()=>({outline:"none",fontSize:"inherit",fontWeight:"inherit",color:"inherit",fontFamily:"inherit",border:"none",backgroundColor:"transparent",appearance:"none"}),$draggable:()=>({touchAction:"none",WebkitUserDrag:"none",userSelect:"none"}),$focus:t=>({"&:focus":Ju.$focusStyle()(t)}),$focusWithin:t=>({"&:focus-within":Ju.$focusStyle()(t)}),$hover:t=>({"&:hover":Ju.$hoverStyle()(t)}),$active:t=>({"&:active":Ju.$activeStyle()(t)})})}),B$=G$({".leva__panel__dragged":{WebkitUserDrag:"none",userSelect:"none",input:{userSelect:"none"},"*":{cursor:"ew-resize !important"}}});function Z$(t){const e=HF();if(!t)return{theme:e,className:""};Object.keys(t).forEach(i=>{Object.assign(e[i],t[i])});const n=v$(e);return{theme:e,className:n.className}}function la(t,e){const{theme:n}=x.useContext(dw);if(!(t in n)||!(e in n[t]))return ea(Hn.THEME_ERROR,t,e),"";let i=e;for(;;){let o=n[t][i];if(typeof o=="string"&&o.charAt(0)==="$")i=o.substr(1);else return o}}const FF=Gt("input",{$reset:"",padding:"0 $sm",width:0,minWidth:0,flex:1,height:"100%",variants:{levaType:{number:{textAlign:"right"}},as:{textarea:{padding:"$sm"}}}}),KF=Gt("div",{$draggable:"",height:"100%",$flexCenter:"",position:"relative",padding:"0 $xs",fontSize:"0.8em",opacity:.8,cursor:"default",touchAction:"none",[`& + ${FF}`]:{paddingLeft:0}}),w$=Gt(KF,{cursor:"ew-resize",marginRight:"-$xs",textTransform:"uppercase",opacity:.3,"&:hover":{opacity:1},variants:{dragging:{true:{backgroundColor:"$accent2",opacity:1}}}}),S$=Gt("div",{$flex:"",position:"relative",borderRadius:"$sm",overflow:"hidden",color:"inherit",height:"$rowHeight",backgroundColor:"$elevation3",$inputStyle:"$elevation1",$hover:"",$focusWithin:"",variants:{textArea:{true:{height:"auto"}}}}),R$=["innerLabel","value","onUpdate","onChange","onKeyDown","type","id","inputType","rows"],W$=["onUpdate"];function hw(t){let{innerLabel:e,value:n,onUpdate:i,onChange:o,onKeyDown:r,type:s,id:a,inputType:l="text",rows:g=0}=t,c=An(t,R$);const{id:C,emitOnEditStart:d,emitOnEditEnd:h,disabled:p}=Pi(),v=a||C,f=x.useRef(null),A=g>0,b=A?"textarea":"input",m=x.useCallback(w=>W=>{const X=W.currentTarget.value;w(X)},[]);ne.useEffect(()=>{const w=f.current,W=m(X=>{i(X),h()});return w==null||w.addEventListener("blur",W),()=>w==null?void 0:w.removeEventListener("blur",W)},[m,i,h]);const B=x.useCallback(w=>{w.key==="Enter"&&m(i)(w)},[m,i]),Z=Object.assign({as:b},A?{rows:g}:{},c);return ne.createElement(S$,{textArea:A},e&&typeof e=="string"?ne.createElement(KF,null,e):e,ne.createElement(FF,Pn({levaType:s,ref:f,id:v,type:l,autoComplete:"off",spellCheck:"false",value:n,onChange:m(o),onFocus:()=>d(),onKeyPress:B,onKeyDown:r,disabled:p},Z)))}function x$(t){let{onUpdate:e}=t,n=An(t,W$);const i=x.useCallback(r=>e(o$(r)),[e]),o=x.useCallback(r=>{const s=r.key==="ArrowUp"?1:r.key==="ArrowDown"?-1:0;if(s){r.preventDefault();const a=r.altKey?.1:r.shiftKey?10:1;e(l=>parseFloat(l)+s*a)}},[e]);return ne.createElement(hw,Pn({},n,{onUpdate:i,onKeyDown:o,type:"number"}))}const Jf=Gt("div",{}),GB=Gt("div",{position:"relative",background:"$elevation2",transition:"height 300ms ease",variants:{fill:{true:{},false:{}},flat:{false:{},true:{}},isRoot:{true:{},false:{paddingLeft:"$md","&::after":{content:'""',position:"absolute",left:0,top:0,width:"$borderWidths$folder",height:"100%",backgroundColor:"$folderWidgetColor",opacity:.4,transform:"translateX(-50%)"}}}},compoundVariants:[{isRoot:!0,fill:!1,css:{overflowY:"auto",maxHeight:"calc(100vh - 20px - $$titleBarHeight)"}},{isRoot:!0,flat:!1,css:{borderRadius:"$lg"}}]}),V$=Gt("div",{$flex:"",color:"$folderTextColor",userSelect:"none",cursor:"pointer",height:"$folderTitleHeight",fontWeight:"$folder","> svg":{marginLeft:-4,marginRight:4,cursor:"pointer",fill:"$folderWidgetColor",opacity:.6},"&:hover > svg":{fill:"$folderWidgetColor"},[`&:hover + ${GB}::after`]:{opacity:.6},[`${Jf}:hover > & + ${GB}::after`]:{opacity:.6},[`${Jf}:hover > & > svg`]:{opacity:1}}),zF=Gt("div",{position:"relative",display:"grid",gridTemplateColumns:"100%",rowGap:"$rowGap",transition:"opacity 250ms ease",variants:{toggled:{true:{opacity:1,transitionDelay:"250ms"},false:{opacity:0,transitionDelay:"0ms",pointerEvents:"none"}},isRoot:{true:{"& > div":{paddingLeft:"$md",paddingRight:"$md"},"& > div:first-of-type":{paddingTop:"$sm"},"& > div:last-of-type":{paddingBottom:"$sm"},[`> ${Jf}:not(:first-of-type)`]:{paddingTop:"$sm",marginTop:"$md",borderTop:"$borderWidths$folder solid $colors$elevation1"}}}}}),LF=Gt("div",{position:"relative",zIndex:100,display:"grid",rowGap:"$rowGap",gridTemplateRows:"minmax($sizes$rowHeight, max-content)",alignItems:"center",color:"$highlight2",[`${zF} > &`]:{"&:first-of-type":{marginTop:"$rowGap"},"&:last-of-type":{marginBottom:"$rowGap"}},variants:{disabled:{true:{pointerEvents:"none"},false:{"&:hover,&:focus-within":{color:"$highlight3"}}}}}),EF=Gt(LF,{gridTemplateColumns:"auto $sizes$controlWidth",columnGap:"$colGap"}),X$=Gt("div",{$flex:"",height:"100%",position:"relative",overflow:"hidden","& > div":{marginLeft:"$colGap",padding:"0 $xs",opacity:.4},"& > div:hover":{opacity:.8},"& > div > svg":{display:"none",cursor:"pointer",width:13,minWidth:13,height:13,backgroundColor:"$elevation2"},"&:hover > div > svg":{display:"block"},variants:{align:{top:{height:"100%",alignItems:"flex-start",paddingTop:"$sm"}}}}),N$=Gt("input",{$reset:"",height:0,width:0,opacity:0,margin:0,"& + label":{position:"relative",$flexCenter:"",height:"100%",userSelect:"none",cursor:"pointer",paddingLeft:2,paddingRight:"$sm",pointerEvents:"auto"},"& + label:after":{content:'""',width:6,height:6,backgroundColor:"$elevation3",borderRadius:"50%",$activeStyle:""},"&:focus + label:after":{$focusStyle:""},"& + label:active:after":{backgroundColor:"$accent1",$focusStyle:""},"&:checked + label:after":{backgroundColor:"$accent1"}}),BB=Gt("label",{fontWeight:"$label",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap","& > svg":{display:"block"}}),Y$=Gt("div",{opacity:1,variants:{disabled:{true:{opacity:.6,pointerEvents:"none",[`& ${BB}`]:{pointerEvents:"auto"}}}}}),kF=Gt("div",{position:"fixed",top:0,bottom:0,right:0,left:0,zIndex:1e3,userSelect:"none"}),M$=Gt("div",{background:"$toolTipBackground",fontFamily:"$sans",fontSize:"$toolTip",padding:"$xs $sm",color:"$toolTipText",borderRadius:"$xs",boxShadow:"$level2",maxWidth:260}),H$=Gt(O6,{fill:"$toolTipBackground"});function Aw({children:t}){const{className:e}=x.useContext(dw);return ne.createElement(x8,{className:e},t)}const F$=["align"];function K$(){const{id:t,disable:e,disabled:n}=Pi();return ne.createElement(ne.Fragment,null,ne.createElement(N$,{id:t+"__disable",type:"checkbox",checked:!n,onChange:()=>e(!n)}),ne.createElement("label",{htmlFor:t+"__disable"}))}function z$(t){const{id:e,optional:n,hint:i}=Pi(),o=t.htmlFor||(e?{htmlFor:e}:null),r=!i&&typeof t.children=="string"?{title:t.children}:null;return ne.createElement(ne.Fragment,null,n&&ne.createElement(K$,null),i!==void 0?ne.createElement(P6,null,ne.createElement(D6,{asChild:!0},ne.createElement(BB,Pn({},o,t))),ne.createElement(J6,{side:"top",sideOffset:2},ne.createElement(M$,null,i,ne.createElement(H$,null)))):ne.createElement(BB,Pn({},o,r,t)))}function Qr(t){let{align:e}=t,n=An(t,F$);const{value:i,label:o,key:r,disabled:s}=Pi(),{hideCopyButton:a}=y$(),l=!a&&r!==void 0,[g,c]=x.useState(!1),C=async()=>{try{await navigator.clipboard.writeText(JSON.stringify({[r]:i??""})),c(!0)}catch{ea(Hn.CLIPBOARD_ERROR,{[r]:i})}};return ne.createElement(X$,{align:e,onPointerLeave:()=>c(!1)},ne.createElement(z$,n),l&&!s&&ne.createElement("div",{title:`Click to copy ${typeof o=="string"?o:r} value`},g?ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},ne.createElement("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),ne.createElement("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})):ne.createElement("svg",{onClick:C,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},ne.createElement("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),ne.createElement("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"}))))}const L$=["toggled"],E$=Gt("svg",{fill:"currentColor",transition:"transform 350ms ease, fill 250ms ease"});function pw(t){let{toggled:e}=t,n=An(t,L$);return ne.createElement(E$,Pn({width:"9",height:"5",viewBox:"0 0 9 5",xmlns:"http://www.w3.org/2000/svg",style:{transform:`rotate(${e?0:-90}deg)`}},n),ne.createElement("path",{d:"M3.8 4.4c.4.3 1 .3 1.4 0L8 1.7A1 1 0 007.4 0H1.6a1 1 0 00-.7 1.7l3 2.7z"}))}const k$=["input"];function mr(t){let{input:e}=t,n=An(t,k$);return e?ne.createElement(EF,n):ne.createElement(LF,n)}function TF({value:t,type:e,settings:n,setValue:i}){const[o,r]=x.useState(vV(e,t,n)),s=x.useRef(t),a=x.useRef(n);a.current=n;const l=x.useCallback(c=>r(vV(e,c,a.current)),[e]),g=x.useCallback(c=>{try{i(c)}catch(C){const{type:d,previousValue:h}=C;if(d!=="LEVA_ERROR")throw C;l(h)}},[l,i]);return x.useEffect(()=>{Bd(t,s.current)||l(t),s.current=t},[t,l]),{displayValue:o,onChange:r,onUpdate:g}}function ah(t,e){const{emitOnEditStart:n,emitOnEditEnd:i}=Pi();return Ij(o=>{o.first&&(document.body.classList.add("leva__panel__dragged"),n==null||n());const r=t(o);return o.last&&(document.body.classList.remove("leva__panel__dragged"),i==null||i()),r},e)}function T$(t){const e=x.useRef(null),n=x.useRef(null),i=x.useRef(!1);return x.useEffect(()=>{const o=SF(()=>{e.current.width=e.current.offsetWidth*window.devicePixelRatio,e.current.height=e.current.offsetHeight*window.devicePixelRatio,t(e.current,n.current)},250);return window.addEventListener("resize",o),i.current||(o(),i.current=!0),()=>window.removeEventListener("resize",o)},[t]),x.useEffect(()=>{n.current=e.current.getContext("2d")},[]),[e,n]}function _F(){const t=x.useRef(null),e=x.useRef({x:0,y:0}),n=x.useCallback(i=>{Object.assign(e.current,i),t.current&&(t.current.style.transform=`translate3d(${e.current.x}px, ${e.current.y}px, 0)`)},[]);return[t,n]}const _$=["__refCount"],nv=(t,e)=>{if(!t[e])return null;const n=t[e];return An(n,_$)};function U$(t){const e=sh(),[n,i]=x.useState(nv(e.getData(),t)),o=x.useCallback(g=>e.setValueAtPath(t,g,!0),[t,e]),r=x.useCallback(g=>e.setSettingsAtPath(t,g),[t,e]),s=x.useCallback(g=>e.disableInputAtPath(t,g),[t,e]),a=x.useCallback(()=>e.emitOnEditStart(t),[t,e]),l=x.useCallback(()=>e.emitOnEditEnd(t),[t,e]);return x.useEffect(()=>{i(nv(e.getData(),t));const g=e.useStore.subscribe(c=>nv(c.data,t),i,{equalityFn:ih});return()=>g()},[e,t]),[n,{set:o,setSettings:r,disable:s,storeId:e.storeId,emitOnEditStart:a,emitOnEditEnd:l}]}const P$=Gt("div",{variants:{hasRange:{true:{position:"relative",display:"grid",gridTemplateColumns:"auto $sizes$numberInputMinWidth",columnGap:"$colGap",alignItems:"center"}}}}),UF=Gt("div",{position:"relative",width:"100%",height:2,borderRadius:"$xs",backgroundColor:"$elevation1"}),ZB=Gt("div",{position:"absolute",width:"$scrubberWidth",height:"$scrubberHeight",borderRadius:"$xs",boxShadow:"0 0 0 2px $colors$elevation2",backgroundColor:"$accent2",cursor:"pointer",$active:"none $accent1",$hover:"none $accent3",variants:{position:{left:{borderTopRightRadius:0,borderBottomRightRadius:0,transform:"translateX(calc(-0.5 * ($sizes$scrubberWidth + 4px)))"},right:{borderTopLeftRadius:0,borderBottomLeftRadius:0,transform:"translateX(calc(0.5 * ($sizes$scrubberWidth + 4px)))"}}}}),PF=Gt("div",{position:"relative",$flex:"",height:"100%",cursor:"pointer",touchAction:"none"}),DF=Gt("div",{position:"absolute",height:"100%",backgroundColor:"$accent2"});function D$({value:t,min:e,max:n,onDrag:i,step:o,initialValue:r}){const s=x.useRef(null),a=x.useRef(null),l=x.useRef(0),g=la("sizes","scrubberWidth"),c=ah(({event:d,first:h,xy:[p],movement:[v],memo:f})=>{if(h){const{width:b,left:m}=s.current.getBoundingClientRect();l.current=b-parseFloat(g),f=(d==null?void 0:d.target)===a.current?t:Df((p-m)/b,e,n)}const A=f+Df(v/l.current,0,n-e);return i(VF(A,{step:o,initialValue:r})),f}),C=Pf(t,e,n);return ne.createElement(PF,Pn({ref:s},c()),ne.createElement(UF,null,ne.createElement(DF,{style:{left:0,right:`${(1-C)*100}%`}})),ne.createElement(ZB,{ref:a,style:{left:`calc(${C} * (100% - ${g}))`}}))}const J$=ne.memo(({label:t,onUpdate:e,step:n,innerLabelTrim:i})=>{const[o,r]=x.useState(!1),s=ah(({active:a,delta:[l],event:g,memo:c=0})=>(r(a),c+=l/2,Math.abs(c)>=1&&(e(C=>parseFloat(C)+Math.floor(c)*n*RF(g)),c=0),c));return ne.createElement(w$,Pn({dragging:o,title:t.length>1?t:""},s()),t.slice(0,i))});function JF({label:t,id:e,displayValue:n,onUpdate:i,onChange:o,settings:r,innerLabelTrim:s=1}){const a=s>0&&ne.createElement(J$,{label:t,step:r.step,onUpdate:i,innerLabelTrim:s});return ne.createElement(x$,{id:e,value:String(n),onUpdate:i,onChange:o,innerLabel:a})}function O$(){const t=Pi(),{label:e,value:n,onUpdate:i,settings:o,id:r}=t,{min:s,max:a}=o,l=a!==1/0&&s!==-1/0;return ne.createElement(mr,{input:!0},ne.createElement(Qr,null,e),ne.createElement(P$,{hasRange:l},l&&ne.createElement(D$,Pn({value:parseFloat(n),onDrag:i},o)),ne.createElement(JF,Pn({},t,{id:r,label:"value",innerLabelTrim:l?0:1}))))}const{sanitizeStep:Q$}=XF,j$=An(XF,["sanitizeStep"]);var q$=wt({component:O$},j$);const $$=(t,e)=>So().schema({options:So().passesAnyOf(So().object(),So().array())}).test(e),eee=(t,{values:e})=>{if(e.indexOf(t)<0)throw Error("Selected value doesn't match Select options");return t},tee=(t,{values:e})=>e.indexOf(t),nee=t=>{let{value:e,options:n}=t,i,o;return Array.isArray(n)?(o=n,i=n.map(r=>String(r))):(o=Object.values(n),i=Object.keys(n)),"value"in t?o.includes(e)||(i.unshift(String(e)),o.unshift(e)):e=o[0],Object.values(n).includes(e)||(n[String(e)]=e),{value:e,settings:{keys:i,values:o}}};var iee=Object.freeze({__proto__:null,schema:$$,sanitize:eee,format:tee,normalize:nee});const oee=Gt("div",{$flexCenter:"",position:"relative","> svg":{pointerEvents:"none",position:"absolute",right:"$md"}}),wB=Gt("select",{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0}),ree=Gt("div",{display:"flex",alignItems:"center",width:"100%",height:"$rowHeight",backgroundColor:"$elevation3",borderRadius:"$sm",padding:"0 $sm",cursor:"pointer",[`${wB}:focus + &`]:{$focusStyle:""},[`${wB}:hover + &`]:{$hoverStyle:""}});function see({displayValue:t,value:e,onUpdate:n,id:i,settings:o,disabled:r}){const{keys:s,values:a}=o,l=x.useRef();return e===a[t]&&(l.current=s[t]),ne.createElement(oee,null,ne.createElement(wB,{id:i,value:t,onChange:g=>n(a[Number(g.currentTarget.value)]),disabled:r},s.map((g,c)=>ne.createElement("option",{key:g,value:c},g))),ne.createElement(ree,null,l.current),ne.createElement(pw,{toggled:!0}))}function aee(){const{label:t,value:e,displayValue:n,onUpdate:i,id:o,disabled:r,settings:s}=Pi();return ne.createElement(mr,{input:!0},ne.createElement(Qr,null,t),ne.createElement(see,{id:o,value:e,displayValue:n,onUpdate:i,settings:s,disabled:r}))}var lee=wt({component:aee},iee);const gee=t=>So().string().test(t),cee=t=>{if(typeof t!="string")throw Error("Invalid string");return t},Iee=({value:t,editable:e=!0,rows:n=!1})=>({value:t,settings:{editable:e,rows:typeof n=="number"?n:n?5:0}});var uee=Object.freeze({__proto__:null,schema:gee,sanitize:cee,normalize:Iee});const Cee=["displayValue","onUpdate","onChange","editable"],dee=Gt("div",{whiteSpace:"pre-wrap"});function hee(t){let{displayValue:e,onUpdate:n,onChange:i,editable:o=!0}=t,r=An(t,Cee);return o?ne.createElement(hw,Pn({value:e,onUpdate:n,onChange:i},r)):ne.createElement(dee,null,e)}function Aee(){const{label:t,settings:e,displayValue:n,onUpdate:i,onChange:o}=Pi();return ne.createElement(mr,{input:!0},ne.createElement(Qr,null,t),ne.createElement(hee,Pn({displayValue:n,onUpdate:i,onChange:o},e)))}var pee=wt({component:Aee},uee);const fee=t=>So().boolean().test(t),mee=t=>{if(typeof t!="boolean")throw Error("Invalid boolean");return t};var bee=Object.freeze({__proto__:null,schema:fee,sanitize:mee});const yee=Gt("div",{position:"relative",$flex:"",height:"$rowHeight",input:{$reset:"",height:0,width:0,opacity:0,margin:0},label:{position:"relative",$flexCenter:"",userSelect:"none",cursor:"pointer",height:"$checkboxSize",width:"$checkboxSize",backgroundColor:"$elevation3",borderRadius:"$sm",$hover:""},"input:focus + label":{$focusStyle:""},"input:focus:checked + label, input:checked + label:hover":{$hoverStyle:"$accent3"},"input + label:active":{backgroundColor:"$accent1"},"input:checked + label:active":{backgroundColor:"$accent1"},"label > svg":{display:"none",width:"90%",height:"90%",stroke:"$highlight3"},"input:checked + label":{backgroundColor:"$accent2"},"input:checked + label > svg":{display:"block"}});function vee({value:t,onUpdate:e,id:n,disabled:i}){return ne.createElement(yee,null,ne.createElement("input",{id:n,type:"checkbox",checked:t,onChange:o=>e(o.currentTarget.checked),disabled:i}),ne.createElement("label",{htmlFor:n},ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ne.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"}))))}function Gee(){const{label:t,value:e,onUpdate:n,disabled:i,id:o}=Pi();return ne.createElement(mr,{input:!0},ne.createElement(Qr,null,t),ne.createElement(vee,{value:e,onUpdate:n,id:o,disabled:i}))}var Bee=wt({component:Gee},bee);const Zee=["locked"];function wee({value:t,id:e,valueKey:n,settings:i,onUpdate:o,innerLabelTrim:r}){const s=x.useRef(t[n]);s.current=t[n];const a=x.useCallback(g=>o({[n]:wF({type:"NUMBER",value:s.current,settings:i},g)}),[o,i,n]),l=TF({type:"NUMBER",value:t[n],settings:i,setValue:a});return ne.createElement(JF,{id:e,label:n,value:t[n],displayValue:l.displayValue,onUpdate:l.onUpdate,onChange:l.onChange,settings:i,innerLabelTrim:r})}const See=Gt("div",{display:"grid",columnGap:"$colGap",gridAutoFlow:"column dense",alignItems:"center",variants:{withLock:{true:{gridTemplateColumns:"10px auto","> svg":{cursor:"pointer"}}}}});function Ree(t){let{locked:e}=t,n=An(t,Zee);return ne.createElement("svg",Pn({width:"10",height:"10",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),e?ne.createElement("path",{d:"M5 4.63601C5 3.76031 5.24219 3.1054 5.64323 2.67357C6.03934 2.24705 6.64582 1.9783 7.5014 1.9783C8.35745 1.9783 8.96306 2.24652 9.35823 2.67208C9.75838 3.10299 10 3.75708 10 4.63325V5.99999H5V4.63601ZM4 5.99999V4.63601C4 3.58148 4.29339 2.65754 4.91049 1.99307C5.53252 1.32329 6.42675 0.978302 7.5014 0.978302C8.57583 0.978302 9.46952 1.32233 10.091 1.99162C10.7076 2.65557 11 3.57896 11 4.63325V5.99999H12C12.5523 5.99999 13 6.44771 13 6.99999V13C13 13.5523 12.5523 14 12 14H3C2.44772 14 2 13.5523 2 13V6.99999C2 6.44771 2.44772 5.99999 3 5.99999H4ZM3 6.99999H12V13H3V6.99999Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}):ne.createElement("path",{d:"M9 3.63601C9 2.76044 9.24207 2.11211 9.64154 1.68623C10.0366 1.26502 10.6432 1 11.5014 1C12.4485 1 13.0839 1.30552 13.4722 1.80636C13.8031 2.23312 14 2.84313 14 3.63325H15C15 2.68242 14.7626 1.83856 14.2625 1.19361C13.6389 0.38943 12.6743 0 11.5014 0C10.4294 0 9.53523 0.337871 8.91218 1.0021C8.29351 1.66167 8 2.58135 8 3.63601V6H1C0.447715 6 0 6.44772 0 7V13C0 13.5523 0.447715 14 1 14H10C10.5523 14 11 13.5523 11 13V7C11 6.44772 10.5523 6 10 6H9V3.63601ZM1 7H10V13H1V7Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}function fw({value:t,onUpdate:e,settings:n,innerLabelTrim:i}){const{id:o,setSettings:r}=Pi(),{lock:s,locked:a}=n;return ne.createElement(See,{withLock:s},s&&ne.createElement(Ree,{locked:a,onClick:()=>r({locked:!a})}),Object.keys(t).map((l,g)=>ne.createElement(wee,{id:g===0?o:`${o}.${l}`,key:l,valueKey:l,value:t,settings:n[l],onUpdate:e,innerLabelTrim:i})))}const OF=(t,e)=>{const n={};let i=0,o=1/0;Object.entries(t).forEach(([r,s])=>{n[r]=xF(wt({value:s},e[r])).settings,i=Math.max(i,n[r].step),o=Math.min(o,n[r].pad)});for(let r in n){const{step:s,min:a,max:l}=e[r]||{};!isFinite(s)&&(!isFinite(a)||!isFinite(l))&&(n[r].step=i,n[r].pad=o)}return n},Wee=["lock"],xee=["value"];function Vee(t){const e=So().array().length(t).every.number(),n=i=>{if(!i||typeof i!="object")return!1;const o=Object.values(i);return o.length===t&&o.every(r=>isFinite(r))};return i=>e.test(i)||n(i)}function Xee(t){return Array.isArray(t)?"array":"object"}function XC(t,e,n){return Xee(t)===e?t:e==="array"?Object.values(t):g$(t,n)}const Nee=(t,e,n)=>{const i=XC(t,"object",e.keys);for(let s in i)i[s]=WF(i[s],e[s]);const o=Object.keys(i);let r={};if(o.length===e.keys.length)r=i;else{const s=XC(n,"object",e.keys);if(o.length===1&&e.locked){const a=o[0],l=i[a],g=s[a],c=g!==0?l/g:1;for(let C in s)C===a?r[a]=l:r[C]=s[C]*c}else r=wt(wt({},s),i)}return XC(r,e.format,e.keys)},Yee=(t,e)=>XC(t,"object",e.keys),Mee=t=>!!t&&("step"in t||"min"in t||"max"in t);function Hee(t,e,n=[]){const{lock:i=!1}=e,o=An(e,Wee),r=Array.isArray(t)?"array":"object",s=r==="object"?Object.keys(t):n,a=XC(t,"object",s),l=Mee(o)?s.reduce((c,C)=>Object.assign(c,{[C]:o}),{}):o,g=OF(a,l);return{value:r==="array"?t:a,settings:wt(wt({},g),{},{format:r,keys:s,lock:i,locked:!1})}}function QF(t){return{schema:Vee(t.length),normalize:e=>{let{value:n}=e,i=An(e,xee);return Hee(n,i,t)},format:(e,n)=>Yee(e,n),sanitize:(e,n,i)=>Nee(e,n,i)}}var Fee={grad:.9,turn:360,rad:360/(2*Math.PI)},Ps=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},mi=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=Math.pow(10,e)),Math.round(n*t)/n+0},Ir=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),t>n?n:t>e?t:e},jF=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},XV=function(t){return{r:Ir(t.r,0,255),g:Ir(t.g,0,255),b:Ir(t.b,0,255),a:Ir(t.a)}},iv=function(t){return{r:mi(t.r),g:mi(t.g),b:mi(t.b),a:mi(t.a,3)}},Kee=/^#([0-9a-f]{3,8})$/i,fp=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},qF=function(t){var e=t.r,n=t.g,i=t.b,o=t.a,r=Math.max(e,n,i),s=r-Math.min(e,n,i),a=s?r===e?(n-i)/s:r===n?2+(i-e)/s:4+(e-n)/s:0;return{h:60*(a<0?a+6:a),s:r?s/r*100:0,v:r/255*100,a:o}},$F=function(t){var e=t.h,n=t.s,i=t.v,o=t.a;e=e/360*6,n/=100,i/=100;var r=Math.floor(e),s=i*(1-n),a=i*(1-(e-r)*n),l=i*(1-(1-e+r)*n),g=r%6;return{r:255*[i,a,s,s,l,i][g],g:255*[l,i,i,a,s,s][g],b:255*[s,s,l,i,i,a][g],a:o}},NV=function(t){return{h:jF(t.h),s:Ir(t.s,0,100),l:Ir(t.l,0,100),a:Ir(t.a)}},YV=function(t){return{h:mi(t.h),s:mi(t.s),l:mi(t.l),a:mi(t.a,3)}},MV=function(t){return $F((n=(e=t).s,{h:e.h,s:(n*=((i=e.l)<50?i:100-i)/100)>0?2*n/(i+n)*100:0,v:i+n,a:e.a}));var e,n,i},NC=function(t){return{h:(e=qF(t)).h,s:(o=(200-(n=e.s))*(i=e.v)/100)>0&&o<200?n*i/100/(o<=100?o:200-o)*100:0,l:o/2,a:e.a};var e,n,i,o},zee=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Lee=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Eee=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,kee=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,SB={string:[[function(t){var e=Kee.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?mi(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?mi(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=Eee.exec(t)||kee.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:XV({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=zee.exec(t)||Lee.exec(t);if(!e)return null;var n,i,o=NV({h:(n=e[1],i=e[2],i===void 0&&(i="deg"),Number(n)*(Fee[i]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return MV(o)},"hsl"]],object:[[function(t){var e=t.r,n=t.g,i=t.b,o=t.a,r=o===void 0?1:o;return Ps(e)&&Ps(n)&&Ps(i)?XV({r:Number(e),g:Number(n),b:Number(i),a:Number(r)}):null},"rgb"],[function(t){var e=t.h,n=t.s,i=t.l,o=t.a,r=o===void 0?1:o;if(!Ps(e)||!Ps(n)||!Ps(i))return null;var s=NV({h:Number(e),s:Number(n),l:Number(i),a:Number(r)});return MV(s)},"hsl"],[function(t){var e=t.h,n=t.s,i=t.v,o=t.a,r=o===void 0?1:o;if(!Ps(e)||!Ps(n)||!Ps(i))return null;var s=function(a){return{h:jF(a.h),s:Ir(a.s,0,100),v:Ir(a.v,0,100),a:Ir(a.a)}}({h:Number(e),s:Number(n),v:Number(i),a:Number(r)});return $F(s)},"hsv"]]},HV=function(t,e){for(var n=0;n<e.length;n++){var i=e[n][0](t);if(i)return[i,e[n][1]]}return[null,void 0]},eK=function(t){return typeof t=="string"?HV(t.trim(),SB.string):typeof t=="object"&&t!==null?HV(t,SB.object):[null,void 0]},Tee=function(t){return eK(t)[1]},ov=function(t,e){var n=NC(t);return{h:n.h,s:Ir(n.s+100*e,0,100),l:n.l,a:n.a}},rv=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},FV=function(t,e){var n=NC(t);return{h:n.h,s:n.s,l:Ir(n.l+100*e,0,100),a:n.a}},RB=function(){function t(e){this.parsed=eK(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return mi(rv(this.rgba),2)},t.prototype.isDark=function(){return rv(this.rgba)<.5},t.prototype.isLight=function(){return rv(this.rgba)>=.5},t.prototype.toHex=function(){return e=iv(this.rgba),n=e.r,i=e.g,o=e.b,s=(r=e.a)<1?fp(mi(255*r)):"","#"+fp(n)+fp(i)+fp(o)+s;var e,n,i,o,r,s},t.prototype.toRgb=function(){return iv(this.rgba)},t.prototype.toRgbString=function(){return e=iv(this.rgba),n=e.r,i=e.g,o=e.b,(r=e.a)<1?"rgba("+n+", "+i+", "+o+", "+r+")":"rgb("+n+", "+i+", "+o+")";var e,n,i,o,r},t.prototype.toHsl=function(){return YV(NC(this.rgba))},t.prototype.toHslString=function(){return e=YV(NC(this.rgba)),n=e.h,i=e.s,o=e.l,(r=e.a)<1?"hsla("+n+", "+i+"%, "+o+"%, "+r+")":"hsl("+n+", "+i+"%, "+o+"%)";var e,n,i,o,r},t.prototype.toHsv=function(){return e=qF(this.rgba),{h:mi(e.h),s:mi(e.s),v:mi(e.v),a:mi(e.a,3)};var e},t.prototype.invert=function(){return to({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),to(ov(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),to(ov(this.rgba,-e))},t.prototype.grayscale=function(){return to(ov(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),to(FV(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),to(FV(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?to({r:(n=this.rgba).r,g:n.g,b:n.b,a:e}):mi(this.rgba.a,3);var n},t.prototype.hue=function(e){var n=NC(this.rgba);return typeof e=="number"?to({h:e,s:n.s,l:n.l,a:n.a}):mi(n.h)},t.prototype.isEqual=function(e){return this.toHex()===to(e).toHex()},t}(),to=function(t){return t instanceof RB?t:new RB(t)},KV=[],_ee=function(t){t.forEach(function(e){KV.indexOf(e)<0&&(e(RB,SB),KV.push(e))})};function Uee(t,e){var n={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var o in n)i[n[o]]=o;var r={};t.prototype.toName=function(s){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,g=i[this.toHex()];if(g)return g;if(s!=null&&s.closest){var c=this.toRgb(),C=1/0,d="black";if(!r.length)for(var h in n)r[h]=new t(n[h]).toRgb();for(var p in n){var v=(a=c,l=r[p],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));v<C&&(C=v,d=p)}return d}},e.string.push([function(s){var a=s.toLowerCase(),l=a==="transparent"?"#0000":n[a];return l?new t(l).toRgb():null},"name"])}function ru(){return(ru=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function mw(t,e){if(t==null)return{};var n,i,o={},r=Object.keys(t);for(i=0;i<r.length;i++)e.indexOf(n=r[i])>=0||(o[n]=t[n]);return o}function WB(t){var e=x.useRef(t),n=x.useRef(function(i){e.current&&e.current(i)});return e.current=t,n.current}var KI=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),t>n?n:t<e?e:t},YC=function(t){return"touches"in t},xB=function(t){return t&&t.ownerDocument.defaultView||self},zV=function(t,e,n){var i=t.getBoundingClientRect(),o=YC(e)?function(r,s){for(var a=0;a<r.length;a++)if(r[a].identifier===s)return r[a];return r[0]}(e.touches,n):e;return{left:KI((o.pageX-(i.left+xB(t).pageXOffset))/i.width),top:KI((o.pageY-(i.top+xB(t).pageYOffset))/i.height)}},LV=function(t){!YC(t)&&t.preventDefault()},bw=ne.memo(function(t){var e=t.onMove,n=t.onKey,i=mw(t,["onMove","onKey"]),o=x.useRef(null),r=WB(e),s=WB(n),a=x.useRef(null),l=x.useRef(!1),g=x.useMemo(function(){var h=function(f){LV(f),(YC(f)?f.touches.length>0:f.buttons>0)&&o.current?r(zV(o.current,f,a.current)):v(!1)},p=function(){return v(!1)};function v(f){var A=l.current,b=xB(o.current),m=f?b.addEventListener:b.removeEventListener;m(A?"touchmove":"mousemove",h),m(A?"touchend":"mouseup",p)}return[function(f){var A=f.nativeEvent,b=o.current;if(b&&(LV(A),!function(B,Z){return Z&&!YC(B)}(A,l.current)&&b)){if(YC(A)){l.current=!0;var m=A.changedTouches||[];m.length&&(a.current=m[0].identifier)}b.focus(),r(zV(b,A,a.current)),v(!0)}},function(f){var A=f.which||f.keyCode;A<37||A>40||(f.preventDefault(),s({left:A===39?.05:A===37?-.05:0,top:A===40?.05:A===38?-.05:0}))},v]},[s,r]),c=g[0],C=g[1],d=g[2];return x.useEffect(function(){return d},[d]),ne.createElement("div",ru({},i,{onTouchStart:c,onMouseDown:c,className:"react-colorful__interactive",ref:o,onKeyDown:C,tabIndex:0,role:"slider"}))}),lh=function(t){return t.filter(Boolean).join(" ")},yw=function(t){var e=t.color,n=t.left,i=t.top,o=i===void 0?.5:i,r=lh(["react-colorful__pointer",t.className]);return ne.createElement("div",{className:r,style:{top:100*o+"%",left:100*n+"%"}},ne.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},ro=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=Math.pow(10,e)),Math.round(n*t)/n},tK=function(t){var e=t.s,n=t.v,i=t.a,o=(200-e)*n/100;return{h:ro(t.h),s:ro(o>0&&o<200?e*n/100/(o<=100?o:200-o)*100:0),l:ro(o/2),a:ro(i,2)}},VB=function(t){var e=tK(t);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},sv=function(t){var e=tK(t);return"hsla("+e.h+", "+e.s+"%, "+e.l+"%, "+e.a+")"},nK=function(t){var e=t.h,n=t.s,i=t.v,o=t.a;e=e/360*6,n/=100,i/=100;var r=Math.floor(e),s=i*(1-n),a=i*(1-(e-r)*n),l=i*(1-(1-e+r)*n),g=r%6;return{r:ro(255*[i,a,s,s,l,i][g]),g:ro(255*[l,i,i,a,s,s][g]),b:ro(255*[s,s,l,i,i,a][g]),a:ro(o,2)}},iK=function(t){var e=t.r,n=t.g,i=t.b,o=t.a,r=Math.max(e,n,i),s=r-Math.min(e,n,i),a=s?r===e?(n-i)/s:r===n?2+(i-e)/s:4+(e-n)/s:0;return{h:ro(60*(a<0?a+6:a)),s:ro(r?s/r*100:0),v:ro(r/255*100),a:o}},oK=ne.memo(function(t){var e=t.hue,n=t.onChange,i=lh(["react-colorful__hue",t.className]);return ne.createElement("div",{className:i},ne.createElement(bw,{onMove:function(o){n({h:360*o.left})},onKey:function(o){n({h:KI(e+360*o.left,0,360)})},"aria-label":"Hue","aria-valuenow":ro(e),"aria-valuemax":"360","aria-valuemin":"0"},ne.createElement(yw,{className:"react-colorful__hue-pointer",left:e/360,color:VB({h:e,s:100,v:100,a:1})})))}),rK=ne.memo(function(t){var e=t.hsva,n=t.onChange,i={backgroundColor:VB({h:e.h,s:100,v:100,a:1})};return ne.createElement("div",{className:"react-colorful__saturation",style:i},ne.createElement(bw,{onMove:function(o){n({s:100*o.left,v:100-100*o.top})},onKey:function(o){n({s:KI(e.s+100*o.left,0,100),v:KI(e.v-100*o.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+ro(e.s)+"%, Brightness "+ro(e.v)+"%"},ne.createElement(yw,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:VB(e)})))}),vw=function(t,e){if(t===e)return!0;for(var n in t)if(t[n]!==e[n])return!1;return!0};function sK(t,e,n){var i=WB(n),o=x.useState(function(){return t.toHsva(e)}),r=o[0],s=o[1],a=x.useRef({color:e,hsva:r});x.useEffect(function(){if(!t.equal(e,a.current.color)){var g=t.toHsva(e);a.current={hsva:g,color:e},s(g)}},[e,t]),x.useEffect(function(){var g;vw(r,a.current.hsva)||t.equal(g=t.fromHsva(r),a.current.color)||(a.current={hsva:r,color:g},i(g))},[r,t,i]);var l=x.useCallback(function(g){s(function(c){return Object.assign({},c,g)})},[]);return[r,l]}var Pee=typeof window<"u"?x.useLayoutEffect:x.useEffect,Dee=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},EV=new Map,aK=function(t){Pee(function(){var e=t.current?t.current.ownerDocument:document;if(e!==void 0&&!EV.has(e)){var n=e.createElement("style");n.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,EV.set(e,n);var i=Dee();i&&n.setAttribute("nonce",i),e.head.appendChild(n)}},[])},Jee=function(t){var e=t.className,n=t.colorModel,i=t.color,o=i===void 0?n.defaultColor:i,r=t.onChange,s=mw(t,["className","colorModel","color","onChange"]),a=x.useRef(null);aK(a);var l=sK(n,o,r),g=l[0],c=l[1],C=lh(["react-colorful",e]);return ne.createElement("div",ru({},s,{ref:a,className:C}),ne.createElement(rK,{hsva:g,onChange:c}),ne.createElement(oK,{hue:g.h,onChange:c,className:"react-colorful__last-control"}))},Oee=function(t){var e=t.className,n=t.hsva,i=t.onChange,o={backgroundImage:"linear-gradient(90deg, "+sv(Object.assign({},n,{a:0}))+", "+sv(Object.assign({},n,{a:1}))+")"},r=lh(["react-colorful__alpha",e]),s=ro(100*n.a);return ne.createElement("div",{className:r},ne.createElement("div",{className:"react-colorful__alpha-gradient",style:o}),ne.createElement(bw,{onMove:function(a){i({a:a.left})},onKey:function(a){i({a:KI(n.a+a.left)})},"aria-label":"Alpha","aria-valuetext":s+"%","aria-valuenow":s,"aria-valuemin":"0","aria-valuemax":"100"},ne.createElement(yw,{className:"react-colorful__alpha-pointer",left:n.a,color:sv(n)})))},Qee=function(t){var e=t.className,n=t.colorModel,i=t.color,o=i===void 0?n.defaultColor:i,r=t.onChange,s=mw(t,["className","colorModel","color","onChange"]),a=x.useRef(null);aK(a);var l=sK(n,o,r),g=l[0],c=l[1],C=lh(["react-colorful",e]);return ne.createElement("div",ru({},s,{ref:a,className:C}),ne.createElement(rK,{hsva:g,onChange:c}),ne.createElement(oK,{hue:g.h,onChange:c}),ne.createElement(Oee,{hsva:g,onChange:c,className:"react-colorful__last-control"}))},jee={defaultColor:{r:0,g:0,b:0,a:1},toHsva:iK,fromHsva:nK,equal:vw},qee=function(t){return ne.createElement(Qee,ru({},t,{colorModel:jee}))},$ee={defaultColor:{r:0,g:0,b:0},toHsva:function(t){return iK({r:t.r,g:t.g,b:t.b,a:1})},fromHsva:function(t){return{r:(e=nK(t)).r,g:e.g,b:e.b};var e},equal:vw},ete=function(t){return ne.createElement(Jee,ru({},t,{colorModel:$ee}))},tte=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function gh(t,e){var n=nte(t);if(typeof n.path!="string"){var i=t.webkitRelativePath;Object.defineProperty(n,"path",{value:typeof e=="string"?e:typeof i=="string"&&i.length>0?i:t.name,writable:!1,configurable:!1,enumerable:!0})}return n}function nte(t){var e=t.name,n=e&&e.lastIndexOf(".")!==-1;if(n&&!t.type){var i=e.split(".").pop().toLowerCase(),o=tte.get(i);o&&Object.defineProperty(t,"type",{value:o,writable:!1,configurable:!1,enumerable:!0})}return t}var ite=[".DS_Store","Thumbs.db"];function ote(t){return QI(this,void 0,void 0,function(){return jI(this,function(e){return Of(t)&&rte(t)?[2,gte(t.dataTransfer,t.type)]:ste(t)?[2,ate(t)]:Array.isArray(t)&&t.every(function(n){return"getFile"in n&&typeof n.getFile=="function"})?[2,lte(t)]:[2,[]]})})}function rte(t){return Of(t.dataTransfer)}function ste(t){return Of(t)&&Of(t.target)}function Of(t){return typeof t=="object"&&t!==null}function ate(t){return XB(t.target.files).map(function(e){return gh(e)})}function lte(t){return QI(this,void 0,void 0,function(){var e;return jI(this,function(n){switch(n.label){case 0:return[4,Promise.all(t.map(function(i){return i.getFile()}))];case 1:return e=n.sent(),[2,e.map(function(i){return gh(i)})]}})})}function gte(t,e){return QI(this,void 0,void 0,function(){var n,i;return jI(this,function(o){switch(o.label){case 0:return t===null?[2,[]]:t.items?(n=XB(t.items).filter(function(r){return r.kind==="file"}),e!=="drop"?[2,n]:[4,Promise.all(n.map(cte))]):[3,2];case 1:return i=o.sent(),[2,kV(lK(i))];case 2:return[2,kV(XB(t.files).map(function(r){return gh(r)}))]}})})}function kV(t){return t.filter(function(e){return ite.indexOf(e.name)===-1})}function XB(t){if(t===null)return[];for(var e=[],n=0;n<t.length;n++){var i=t[n];e.push(i)}return e}function cte(t){if(typeof t.webkitGetAsEntry!="function")return TV(t);var e=t.webkitGetAsEntry();return e&&e.isDirectory?gK(e):TV(t)}function lK(t){return t.reduce(function(e,n){return I7(e,Array.isArray(n)?lK(n):[n])},[])}function TV(t){var e=t.getAsFile();if(!e)return Promise.reject(t+" is not a File");var n=gh(e);return Promise.resolve(n)}function Ite(t){return QI(this,void 0,void 0,function(){return jI(this,function(e){return[2,t.isDirectory?gK(t):ute(t)]})})}function gK(t){var e=t.createReader();return new Promise(function(n,i){var o=[];function r(){var s=this;e.readEntries(function(a){return QI(s,void 0,void 0,function(){var l,g,c;return jI(this,function(C){switch(C.label){case 0:if(a.length)return[3,5];C.label=1;case 1:return C.trys.push([1,3,,4]),[4,Promise.all(o)];case 2:return l=C.sent(),n(l),[3,4];case 3:return g=C.sent(),i(g),[3,4];case 4:return[3,6];case 5:c=Promise.all(a.map(Ite)),o.push(c),r(),C.label=6;case 6:return[2]}})})},function(a){i(a)})}r()})}function ute(t){return QI(this,void 0,void 0,function(){return jI(this,function(e){return[2,new Promise(function(n,i){t.file(function(o){var r=gh(o,t.fullPath);n(r)},function(o){i(o)})})]})})}var Cte=function(t,e){if(t&&e){var n=Array.isArray(e)?e:e.split(","),i=t.name||"",o=(t.type||"").toLowerCase(),r=o.replace(/\/.*$/,"");return n.some(function(s){var a=s.trim().toLowerCase();return a.charAt(0)==="."?i.toLowerCase().endsWith(a):a.endsWith("/*")?r===a.replace(/\/.*$/,""):o===a})}return!0};function _V(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function UV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_V(Object(n),!0).forEach(function(i){cK(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_V(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function cK(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function PV(t,e){return pte(t)||Ate(t,e)||hte(t,e)||dte()}function dte(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hte(t,e){if(t){if(typeof t=="string")return DV(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return DV(t,e)}}function DV(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Ate(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var i=[],o=!0,r=!1,s,a;try{for(n=n.call(t);!(o=(s=n.next()).done)&&(i.push(s.value),!(e&&i.length===e));o=!0);}catch(l){r=!0,a=l}finally{try{!o&&n.return!=null&&n.return()}finally{if(r)throw a}}return i}}function pte(t){if(Array.isArray(t))return t}var fte="file-invalid-type",mte="file-too-large",bte="file-too-small",yte="too-many-files",vte=function(e){e=Array.isArray(e)&&e.length===1?e[0]:e;var n=Array.isArray(e)?"one of ".concat(e.join(", ")):e;return{code:fte,message:"File type must be ".concat(n)}},JV=function(e){return{code:mte,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},OV=function(e){return{code:bte,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},Gte={code:yte,message:"Too many files"};function IK(t,e){var n=t.type==="application/x-moz-file"||Cte(t,e);return[n,n?null:vte(e)]}function uK(t,e,n){if(Ou(t.size))if(Ou(e)&&Ou(n)){if(t.size>n)return[!1,JV(n)];if(t.size<e)return[!1,OV(e)]}else{if(Ou(e)&&t.size<e)return[!1,OV(e)];if(Ou(n)&&t.size>n)return[!1,JV(n)]}return[!0,null]}function Ou(t){return t!=null}function Bte(t){var e=t.files,n=t.accept,i=t.minSize,o=t.maxSize,r=t.multiple,s=t.maxFiles;return!r&&e.length>1||r&&s>=1&&e.length>s?!1:e.every(function(a){var l=IK(a,n),g=PV(l,1),c=g[0],C=uK(a,i,o),d=PV(C,1),h=d[0];return c&&h})}function Qf(t){return typeof t.isPropagationStopped=="function"?t.isPropagationStopped():typeof t.cancelBubble<"u"?t.cancelBubble:!1}function mp(t){return t.dataTransfer?Array.prototype.some.call(t.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!t.target&&!!t.target.files}function QV(t){t.preventDefault()}function Zte(t){return t.indexOf("MSIE")!==-1||t.indexOf("Trident/")!==-1}function wte(t){return t.indexOf("Edge/")!==-1}function Ste(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Zte(t)||wte(t)}function ls(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(i){for(var o=arguments.length,r=new Array(o>1?o-1:0),s=1;s<o;s++)r[s-1]=arguments[s];return e.some(function(a){return!Qf(i)&&a&&a.apply(void 0,[i].concat(r)),Qf(i)})}}function Rte(){return"showOpenFilePicker"in window}function Wte(t){return t=typeof t=="string"?t.split(","):t,[{description:"everything",accept:Array.isArray(t)?t.filter(function(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||/\w+\/[-+.\w]+/g.test(e)}).reduce(function(e,n){return UV(UV({},e),{},cK({},n,[]))},{}):{}}]}function xte(t){return t instanceof DOMException&&(t.name==="AbortError"||t.code===t.ABORT_ERR)}function Vte(t){return t instanceof DOMException&&(t.name==="SecurityError"||t.code===t.SECURITY_ERR)}var Xte=["children"],Nte=["open"],Yte=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Mte=["refKey","onChange","onClick"];function Hte(t){return zte(t)||Kte(t)||CK(t)||Fte()}function Fte(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Kte(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function zte(t){if(Array.isArray(t))return NB(t)}function av(t,e){return kte(t)||Ete(t,e)||CK(t,e)||Lte()}function Lte(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CK(t,e){if(t){if(typeof t=="string")return NB(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return NB(t,e)}}function NB(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Ete(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var i=[],o=!0,r=!1,s,a;try{for(n=n.call(t);!(o=(s=n.next()).done)&&(i.push(s.value),!(e&&i.length===e));o=!0);}catch(l){r=!0,a=l}finally{try{!o&&n.return!=null&&n.return()}finally{if(r)throw a}}return i}}function kte(t){if(Array.isArray(t))return t}function jV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,i)}return n}function Mn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?jV(Object(n),!0).forEach(function(i){YB(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function YB(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jf(t,e){if(t==null)return{};var n=Tte(t,e),i,o;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}function Tte(t,e){if(t==null)return{};var n={},i=Object.keys(t),o,r;for(r=0;r<i.length;r++)o=i[r],!(e.indexOf(o)>=0)&&(n[o]=t[o]);return n}var Gw=x.forwardRef(function(t,e){var n=t.children,i=jf(t,Xte),o=hK(i),r=o.open,s=jf(o,Nte);return x.useImperativeHandle(e,function(){return{open:r}},[r]),ne.createElement(x.Fragment,null,n(Mn(Mn({},s),{},{open:r})))});Gw.displayName="Dropzone";var dK={disabled:!1,getFilesFromEvent:ote,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!0};Gw.defaultProps=dK;Gw.propTypes={children:yn.func,accept:yn.oneOfType([yn.string,yn.arrayOf(yn.string)]),multiple:yn.bool,preventDropOnDocument:yn.bool,noClick:yn.bool,noKeyboard:yn.bool,noDrag:yn.bool,noDragEventsBubbling:yn.bool,minSize:yn.number,maxSize:yn.number,maxFiles:yn.number,disabled:yn.bool,getFilesFromEvent:yn.func,onFileDialogCancel:yn.func,onFileDialogOpen:yn.func,useFsAccessApi:yn.bool,onDragEnter:yn.func,onDragLeave:yn.func,onDragOver:yn.func,onDrop:yn.func,onDropAccepted:yn.func,onDropRejected:yn.func,validator:yn.func};var MB={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function hK(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Mn(Mn({},dK),t),n=e.accept,i=e.disabled,o=e.getFilesFromEvent,r=e.maxSize,s=e.minSize,a=e.multiple,l=e.maxFiles,g=e.onDragEnter,c=e.onDragLeave,C=e.onDragOver,d=e.onDrop,h=e.onDropAccepted,p=e.onDropRejected,v=e.onFileDialogCancel,f=e.onFileDialogOpen,A=e.useFsAccessApi,b=e.preventDropOnDocument,m=e.noClick,B=e.noKeyboard,Z=e.noDrag,w=e.noDragEventsBubbling,W=e.validator,X=x.useMemo(function(){return typeof f=="function"?f:qV},[f]),V=x.useMemo(function(){return typeof v=="function"?v:qV},[v]),Y=x.useRef(null),z=x.useRef(null),q=x.useReducer(_te,MB),O=av(q,2),te=O[0],oe=O[1],re=te.isFocused,se=te.isFileDialogActive,H=te.draggedFiles,D=x.useRef(typeof window<"u"&&window.isSecureContext&&A&&Rte()),T=function(){!D.current&&se&&setTimeout(function(){if(z.current){var F=z.current.files;F.length||(oe({type:"closeDialog"}),V())}},300)};x.useEffect(function(){return window.addEventListener("focus",T,!1),function(){window.removeEventListener("focus",T,!1)}},[z,se,V,D]);var J=x.useRef([]),$=function(F){Y.current&&Y.current.contains(F.target)||(F.preventDefault(),J.current=[])};x.useEffect(function(){return b&&(document.addEventListener("dragover",QV,!1),document.addEventListener("drop",$,!1)),function(){b&&(document.removeEventListener("dragover",QV),document.removeEventListener("drop",$))}},[Y,b]);var Ie=x.useCallback(function(L){L.preventDefault(),L.persist(),Ve(L),J.current=[].concat(Hte(J.current),[L.target]),mp(L)&&Promise.resolve(o(L)).then(function(F){Qf(L)&&!w||(oe({draggedFiles:F,isDragActive:!0,type:"setDraggedFiles"}),g&&g(L))})},[o,g,w]),fe=x.useCallback(function(L){L.preventDefault(),L.persist(),Ve(L);var F=mp(L);if(F&&L.dataTransfer)try{L.dataTransfer.dropEffect="copy"}catch{}return F&&C&&C(L),!1},[C,w]),ve=x.useCallback(function(L){L.preventDefault(),L.persist(),Ve(L);var F=J.current.filter(function(Ye){return Y.current&&Y.current.contains(Ye)}),ce=F.indexOf(L.target);ce!==-1&&F.splice(ce,1),J.current=F,!(F.length>0)&&(oe({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),mp(L)&&c&&c(L))},[Y,c,w]),Ge=x.useCallback(function(L,F){var ce=[],Ye=[];L.forEach(function(Xe){var Fe=IK(Xe,n),tt=av(Fe,2),ze=tt[0],Ae=tt[1],ie=uK(Xe,s,r),me=av(ie,2),xe=me[0],Ke=me[1],ke=W?W(Xe):null;if(ze&&xe&&!ke)ce.push(Xe);else{var lt=[Ae,Ke];ke&&(lt=lt.concat(ke)),Ye.push({file:Xe,errors:lt.filter(function(mt){return mt})})}}),(!a&&ce.length>1||a&&l>=1&&ce.length>l)&&(ce.forEach(function(Xe){Ye.push({file:Xe,errors:[Gte]})}),ce.splice(0)),oe({acceptedFiles:ce,fileRejections:Ye,type:"setFiles"}),d&&d(ce,Ye,F),Ye.length>0&&p&&p(Ye,F),ce.length>0&&h&&h(ce,F)},[oe,a,n,s,r,l,d,h,p,W]),Me=x.useCallback(function(L){L.preventDefault(),L.persist(),Ve(L),J.current=[],mp(L)&&Promise.resolve(o(L)).then(function(F){Qf(L)&&!w||Ge(F,L)}),oe({type:"reset"})},[o,Ge,w]),_e=x.useCallback(function(){if(D.current){oe({type:"openDialog"}),X();var L={multiple:a,types:Wte(n)};window.showOpenFilePicker(L).then(function(F){return o(F)}).then(function(F){Ge(F,null),oe({type:"closeDialog"})}).catch(function(F){xte(F)?(V(F),oe({type:"closeDialog"})):Vte(F)&&(D.current=!1,z.current&&(z.current.value=null,z.current.click()))});return}z.current&&(oe({type:"openDialog"}),X(),z.current.value=null,z.current.click())},[oe,X,V,A,Ge,n,a]),Bt=x.useCallback(function(L){!Y.current||!Y.current.isEqualNode(L.target)||(L.key===" "||L.key==="Enter"||L.keyCode===32||L.keyCode===13)&&(L.preventDefault(),_e())},[Y,_e]),St=x.useCallback(function(){oe({type:"focus"})},[]),ot=x.useCallback(function(){oe({type:"blur"})},[]),ee=x.useCallback(function(){m||(Ste()?setTimeout(_e,0):_e())},[m,_e]),Ne=function(F){return i?null:F},Se=function(F){return B?null:Ne(F)},He=function(F){return Z?null:Ne(F)},Ve=function(F){w&&F.stopPropagation()},at=x.useMemo(function(){return function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},F=L.refKey,ce=F===void 0?"ref":F,Ye=L.role,Xe=L.onKeyDown,Fe=L.onFocus,tt=L.onBlur,ze=L.onClick,Ae=L.onDragEnter,ie=L.onDragOver,me=L.onDragLeave,xe=L.onDrop,Ke=jf(L,Yte);return Mn(Mn(YB({onKeyDown:Se(ls(Xe,Bt)),onFocus:Se(ls(Fe,St)),onBlur:Se(ls(tt,ot)),onClick:Ne(ls(ze,ee)),onDragEnter:He(ls(Ae,Ie)),onDragOver:He(ls(ie,fe)),onDragLeave:He(ls(me,ve)),onDrop:He(ls(xe,Me)),role:typeof Ye=="string"&&Ye!==""?Ye:"button"},ce,Y),!i&&!B?{tabIndex:0}:{}),Ke)}},[Y,Bt,St,ot,ee,Ie,fe,ve,Me,B,Z,i]),Qe=x.useCallback(function(L){L.stopPropagation()},[]),et=x.useMemo(function(){return function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},F=L.refKey,ce=F===void 0?"ref":F,Ye=L.onChange,Xe=L.onClick,Fe=jf(L,Mte),tt=YB({accept:n,multiple:a,type:"file",style:{display:"none"},onChange:Ne(ls(Ye,Me)),onClick:Ne(ls(Xe,Qe)),tabIndex:-1},ce,z);return Mn(Mn({},tt),Fe)}},[z,n,a,Me,i]),ut=H.length,xt=ut>0&&Bte({files:H,accept:n,minSize:s,maxSize:r,multiple:a,maxFiles:l}),on=ut>0&&!xt;return Mn(Mn({},te),{},{isDragAccept:xt,isDragReject:on,isFocused:re&&!i,getRootProps:at,getInputProps:et,rootRef:Y,inputRef:z,open:Ne(_e)})}function _te(t,e){switch(e.type){case"focus":return Mn(Mn({},t),{},{isFocused:!0});case"blur":return Mn(Mn({},t),{},{isFocused:!1});case"openDialog":return Mn(Mn({},MB),{},{isFileDialogActive:!0});case"closeDialog":return Mn(Mn({},t),{},{isFileDialogActive:!1});case"setDraggedFiles":var n=e.isDragActive,i=e.draggedFiles;return Mn(Mn({},t),{},{draggedFiles:i,isDragActive:n});case"setFiles":return Mn(Mn({},t),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections});case"reset":return Mn({},MB);default:return t}}function qV(){}/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Ute=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1};/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Pte=Ute;function $V(t){return Pte(t)===!0&&Object.prototype.toString.call(t)==="[object Object]"}var AK=function(e){var n,i;return!($V(e)===!1||(n=e.constructor,typeof n!="function")||(i=n.prototype,$V(i)===!1)||i.hasOwnProperty("isPrototypeOf")===!1)};/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Dte=AK,Bw=function(e){return Dte(e)||typeof e=="function"||Array.isArray(e)};/*!
 * for-in <https://github.com/jonschlinkert/for-in>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Jte=function(e,n,i){for(var o in e)if(n.call(i,e[o],o,e)===!1)break},Ote=Bw,Qte=Jte;function pK(t,e){for(var n=arguments.length,i=0;++i<n;){var o=arguments[i];HB(o)&&Qte(o,jte,t)}return t}function jte(t,e){if(qte(e)){var n=this[e];HB(t)&&HB(n)?pK(n,t):this[e]=t}}function HB(t){return Ote(t)&&!Array.isArray(t)}function qte(t){return t!=="__proto__"&&t!=="constructor"&&t!=="prototype"}var $te=pK;/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var ene=function(t,e,n,i,o){if(!tne(t)||!e)return t;if(e=bp(e),n&&(e+="."+bp(n)),i&&(e+="."+bp(i)),o&&(e+="."+bp(o)),e in t)return t[e];for(var r=e.split("."),s=r.length,a=-1;t&&++a<s;){for(var l=r[a];l[l.length-1]==="\\";)l=l.slice(0,-1)+"."+r[++a];t=t[l]}return t};function tne(t){return t!==null&&(typeof t=="object"||typeof t=="function")}function bp(t){return t?Array.isArray(t)?t.join("."):t:""}/*!
 * assign-symbols <https://github.com/jonschlinkert/assign-symbols>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var nne=function(t,e){if(t===null||typeof t>"u")throw new TypeError("expected first argument to be an object.");if(typeof e>"u"||typeof Symbol>"u"||typeof Object.getOwnPropertySymbols!="function")return t;for(var n=Object.prototype.propertyIsEnumerable,i=Object(t),o=arguments.length,r=0;++r<o;)for(var s=Object(arguments[r]),a=Object.getOwnPropertySymbols(s),l=0;l<a.length;l++){var g=a[l];n.call(s,g)&&(i[g]=s[g])}return i},ine=Bw,one=nne,rne=Object.assign||function(t){if(t===null||typeof t>"u")throw new TypeError("Cannot convert undefined or null to object");eX(t)||(t={});for(var e=1;e<arguments.length;e++){var n=arguments[e];ane(n)&&(n=lne(n)),eX(n)&&(sne(t,n),one(t,n))}return t};function sne(t,e){for(var n in e)gne(e,n)&&(t[n]=e[n])}function ane(t){return t&&typeof t=="string"}function lne(t){var e={};for(var n in t)e[n]=t[n];return e}function eX(t){return t&&typeof t=="object"||ine(t)}function gne(t,e){return Object.prototype.hasOwnProperty.call(t,e)}/*!
 * split-string <https://github.com/jonschlinkert/split-string>
 *
 * Copyright (c) 2015-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var cne=rne,Ine=function(t,e,n){if(typeof t!="string")throw new TypeError("expected a string");typeof e=="function"&&(n=e,e=null),typeof e=="string"&&(e={sep:e});var i=cne({sep:"."},e),o=i.quotes||['"',"'","`"],r;i.brackets===!0?r={"<":">","(":")","[":"]","{":"}"}:i.brackets&&(r=i.brackets);var s=[],a=[],l=[""],g=i.sep,c=t.length,C=-1,d;function h(){if(r&&a.length)return r[a[a.length-1]]}for(;++C<c;){var p=t[C],v=t[C+1],f={val:p,idx:C,arr:l,str:t};if(s.push(f),p==="\\"){f.val=Cne(i,t,C)===!0?p+v:v,f.escaped=!0,typeof n=="function"&&n(f),l[l.length-1]+=f.val,C++;continue}if(r&&r[p]){a.push(p);var A=h(),b=C+1;if(t.indexOf(A,b+1)!==-1)for(;a.length&&b<c;){var m=t[++b];if(m==="\\"){m++;continue}if(o.indexOf(m)!==-1){b=FB(t,m,b+1);continue}if(A=h(),a.length&&t.indexOf(A,b+1)===-1)break;if(r[m]){a.push(m);continue}A===m&&a.pop()}if(d=b,d===-1){l[l.length-1]+=p;continue}p=t.slice(C,d+1),f.val=p,f.idx=C=d}if(o.indexOf(p)!==-1){if(d=FB(t,p,C+1),d===-1){l[l.length-1]+=p;continue}une(p,i)===!0?p=t.slice(C,d+1):p=t.slice(C+1,d),f.val=p,f.idx=C=d}if(typeof n=="function"&&(n(f,s),p=f.val,C=f.idx),f.val===g&&f.split!==!1){l.push("");continue}l[l.length-1]+=f.val}return l};function FB(t,e,n,i){var o=t.indexOf(e,n);return t.charAt(o-1)==="\\"?FB(t,e,o+1):o}function une(t,e){return e.keepDoubleQuotes===!0&&t==='"'||e.keepSingleQuotes===!0&&t==="'"?!0:e.keepQuotes}function Cne(t,e,n){return typeof t.keepEscaping=="function"?t.keepEscaping(e,n):t.keepEscaping===!0||e[n+1]==="\\"}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var dne=function(e){return typeof e<"u"&&e!==null&&(typeof e=="object"||typeof e=="function")},tX=dne,hne=function(e){tX(e)||(e={});for(var n=arguments.length,i=1;i<n;i++){var o=arguments[i];tX(o)&&Ane(e,o)}return e};function Ane(t,e){for(var n in e)pne(e,n)&&(t[n]=e[n])}function pne(t,e){return Object.prototype.hasOwnProperty.call(t,e)}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var fne=function(e){return typeof e<"u"&&e!==null&&(typeof e=="object"||typeof e=="function")};/*!
 * set-value <https://github.com/jonschlinkert/set-value>
 *
 * Copyright (c) 2014-2015, 2017, Jon Schlinkert.
 * Released under the MIT License.
 */var mne=Ine,bne=hne,nX=AK,iX=fne,yne=function(t,e,n){if(!iX(t)||(Array.isArray(e)&&(e=[].concat.apply([],e).join(".")),typeof e!="string"))return t;for(var i=mne(e,{sep:".",brackets:!0}).filter(vne),o=i.length,r=-1,s=t;++r<o;){var a=i[r];if(r!==o-1){iX(s[a])||(s[a]={}),s=s[a];continue}nX(s[a])&&nX(n)?s[a]=bne({},s[a],n):s[a]=n}return t};function vne(t){return t!=="__proto__"&&t!=="constructor"&&t!=="prototype"}var lv=Bw,oX=$te,Gne=ene,rX=yne,Bne=function(e,n,i){if(!lv(e))throw new TypeError("expected an object");if(typeof n!="string"||i==null)return oX.apply(null,arguments);if(typeof i=="string")return rX(e,n,i),e;var o=Gne(e,n);return lv(i)&&lv(o)&&(i=oX({},o,i)),rX(e,n,i),e};const Zne=LI(Bne),Zw=(...t)=>t.filter(Boolean).join(".");function wne(t){const e=t.split(".");return[e.pop(),e.join(".")||void 0]}function Sne(t,e){return Object.entries(a$(t,e)).reduce((n,[,{value:i,disabled:o,key:r}])=>(n[r]=o?void 0:i,n),{})}function Rne(t,e){const n=x.useRef();return(e?Bd:ih)(t,n.current)||(n.current=t),n.current}function fK(t,e){return x.useMemo(t,Rne(e,!0))}function Wne(t){const e=x.useRef(null),n=x.useRef(null),i=x.useRef(!0);return x.useLayoutEffect(()=>{t||(e.current.style.height="0px",e.current.style.overflow="hidden")},[]),x.useEffect(()=>{if(i.current){i.current=!1;return}let o;const r=e.current,s=()=>{t&&(r.style.removeProperty("height"),r.style.removeProperty("overflow"),n.current.scrollIntoView({behavior:"smooth",block:"nearest"}))};r.addEventListener("transitionend",s,{once:!0});const{height:a}=n.current.getBoundingClientRect();return r.style.height=a+"px",t||(r.style.overflow="hidden",o=window.setTimeout(()=>r.style.height="0px",50)),()=>{r.removeEventListener("transitionend",s),clearTimeout(o)}},[t]),{wrapperRef:e,contentRef:n}}const xne=t=>{const[e,n]=x.useState(t.getVisiblePaths());return x.useEffect(()=>{n(t.getVisiblePaths());const i=t.useStore.subscribe(t.getVisiblePaths,n,{equalityFn:ih});return()=>i()},[t]),e};function Vne(t,e,n){return t.useStore(o=>{const r=wt(wt({},n),o.data);return Sne(r,e)},ih)}function mK(t=3){const e=x.useRef(null),n=x.useRef(null),[i,o]=x.useState(!1),r=x.useCallback(()=>o(!0),[]),s=x.useCallback(()=>o(!1),[]);return x.useLayoutEffect(()=>{if(i){const{bottom:a,top:l,left:g}=e.current.getBoundingClientRect(),{height:c}=n.current.getBoundingClientRect(),C=a+c>window.innerHeight-40?"up":"down";n.current.style.position="fixed",n.current.style.zIndex="10000",n.current.style.left=g+"px",C==="down"?n.current.style.top=a+t+"px":n.current.style.bottom=window.innerHeight-l+t+"px"}},[t,i]),{popinRef:e,wrapperRef:n,shown:i,show:r,hide:s}}_ee([Uee]);const Xne={rgb:"toRgb",hsl:"toHsl",hsv:"toHsv",hex:"toHex"};So.extend({color:()=>t=>to(t).isValid()});const Nne=t=>So().color().test(t);function bK(t,{format:e,hasAlpha:n,isString:i}){const o=Xne[e]+(i&&e!=="hex"?"String":""),r=t[o]();return typeof r=="object"&&!n?l$(r,["a"]):r}const yK=(t,e)=>{const n=to(t);if(!n.isValid())throw Error("Invalid color");return bK(n,e)},Yne=(t,e)=>bK(to(t),wt(wt({},e),{},{isString:!0,format:"hex"})),Mne=({value:t})=>{const e=Tee(t),n=e==="name"?"hex":e,i=typeof t=="object"?"a"in t:e==="hex"&&t.length===8||/^(rgba)|(hsla)|(hsva)/.test(t),o={format:n,hasAlpha:i,isString:typeof t=="string"};return{value:yK(t,o),settings:o}};var Hne=Object.freeze({__proto__:null,schema:Nne,sanitize:yK,format:Yne,normalize:Mne});const Fne=Gt("div",{position:"relative",boxSizing:"border-box",borderRadius:"$sm",overflow:"hidden",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",backgroundColor:"#fff",backgroundImage:`url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')`,$inputStyle:"",$hover:"",zIndex:1,variants:{active:{true:{$inputStyle:"$accent1"}}},"&::before":{content:'""',position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:"currentColor",zIndex:1}}),Kne=Gt("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto",columnGap:"$colGap",alignItems:"center"}),zne=Gt("div",{width:"$colorPickerWidth",height:"$colorPickerHeight",".react-colorful":{width:"100%",height:"100%",boxShadow:"$level2",cursor:"crosshair"},".react-colorful__saturation":{borderRadius:"$sm $sm 0 0"},".react-colorful__alpha, .react-colorful__hue":{height:10},".react-colorful__last-control":{borderRadius:"0 0 $sm $sm"},".react-colorful__pointer":{height:12,width:12}});function sX(t,e){return e!=="rgb"?to(t).toRgb():t}function Lne({value:t,displayValue:e,settings:n,onUpdate:i}){const{emitOnEditStart:o,emitOnEditEnd:r}=Pi(),{format:s,hasAlpha:a}=n,{popinRef:l,wrapperRef:g,shown:c,show:C,hide:d}=mK(),h=x.useRef(0),[p,v]=x.useState(()=>sX(t,s)),f=a?qee:ete,A=()=>{v(sX(t,s)),C(),o()},b=()=>{d(),r(),window.clearTimeout(h.current)},m=()=>{h.current=window.setTimeout(b,500)};return x.useEffect(()=>()=>window.clearTimeout(h.current),[]),ne.createElement(ne.Fragment,null,ne.createElement(Fne,{ref:l,active:c,onClick:()=>A(),style:{color:e}}),c&&ne.createElement(Aw,null,ne.createElement(kF,{onPointerUp:b}),ne.createElement(zne,{ref:g,onMouseEnter:()=>window.clearTimeout(h.current),onMouseLeave:B=>B.buttons===0&&m()},ne.createElement(f,{color:p,onChange:i}))))}function Ene(){const{value:t,displayValue:e,label:n,onChange:i,onUpdate:o,settings:r}=Pi();return ne.createElement(mr,{input:!0},ne.createElement(Qr,null,n),ne.createElement(Kne,null,ne.createElement(Lne,{value:t,displayValue:e,onChange:i,onUpdate:o,settings:r}),ne.createElement(hw,{value:e,onChange:i,onUpdate:o})))}var kne=wt({component:Ene},Hne);function Tne(){const{label:t,displayValue:e,onUpdate:n,settings:i}=Pi();return ne.createElement(mr,{input:!0},ne.createElement(Qr,null,t),ne.createElement(fw,{value:e,settings:i,onUpdate:n}))}var _ne=wt({component:Tne},QF(["x","y","z"]));const Une=Gt("div",{$flexCenter:"",position:"relative",backgroundColor:"$elevation3",borderRadius:"$sm",cursor:"pointer",height:"$rowHeight",width:"$rowHeight",touchAction:"none",$draggable:"",$hover:"","&:active":{cursor:"none"},"&::after":{content:'""',backgroundColor:"$accent2",height:4,width:4,borderRadius:2}}),Pne=Gt("div",{$flexCenter:"",width:"$joystickWidth",height:"$joystickHeight",borderRadius:"$sm",boxShadow:"$level2",position:"fixed",zIndex:1e4,overflow:"hidden",$draggable:"",transform:"translate(-50%, -50%)",variants:{isOutOfBounds:{true:{backgroundColor:"$elevation1"},false:{backgroundColor:"$elevation3"}}},"> div":{position:"absolute",$flexCenter:"",borderStyle:"solid",borderWidth:1,borderColor:"$highlight1",backgroundColor:"$elevation3",width:"80%",height:"80%","&::after,&::before":{content:'""',position:"absolute",zindex:10,backgroundColor:"$highlight1"},"&::before":{width:"100%",height:1},"&::after":{height:"100%",width:1}},"> span":{position:"relative",zindex:100,width:10,height:10,backgroundColor:"$accent2",borderRadius:"50%"}});function Dne({value:t,settings:e,onUpdate:n}){const i=x.useRef(),o=x.useRef(0),r=x.useRef(0),s=x.useRef(1),[a,l]=x.useState(!1),[g,c]=x.useState(!1),[C,d]=_F(),h=x.useRef(null),p=x.useRef(null);x.useLayoutEffect(()=>{if(a){const{top:q,left:O,width:te,height:oe}=h.current.getBoundingClientRect();p.current.style.left=O+te/2+"px",p.current.style.top=q+oe/2+"px"}},[a]);const{keys:[v,f],joystick:A}=e,b=A==="invertY"?1:-1,{[v]:{step:m},[f]:{step:B}}=e,Z=la("sizes","joystickWidth"),w=la("sizes","joystickHeight"),W=parseFloat(Z)*.8/2,X=parseFloat(w)*.8/2,V=x.useCallback(()=>{i.current||(c(!0),o.current&&d({x:o.current*W}),r.current&&d({y:r.current*-X}),i.current=window.setInterval(()=>{n(q=>{const O=m*o.current*s.current,te=b*B*r.current*s.current;return Array.isArray(q)?{[v]:q[0]+O,[f]:q[1]+te}:{[v]:q[v]+O,[f]:q[f]+te}})},16))},[W,X,n,d,m,B,v,f,b]),Y=x.useCallback(()=>{window.clearTimeout(i.current),i.current=void 0,c(!1)},[]);x.useEffect(()=>{function q(O){s.current=RF(O)}return window.addEventListener("keydown",q),window.addEventListener("keyup",q),()=>{window.clearTimeout(i.current),window.removeEventListener("keydown",q),window.removeEventListener("keyup",q)}},[]);const z=ah(({first:q,active:O,delta:[te,oe],movement:[re,se]})=>{q&&l(!0);const H=ml(re,-W,W),D=ml(se,-X,X);o.current=Math.abs(re)>Math.abs(H)?Math.sign(re-H):0,r.current=Math.abs(se)>Math.abs(D)?Math.sign(D-se):0;let T=t[v],J=t[f];O?(o.current||(T+=te*m*s.current,d({x:H})),r.current||(J-=b*oe*B*s.current,d({y:D})),o.current||r.current?V():Y(),n({[v]:T,[f]:J})):(l(!1),o.current=0,r.current=0,d({x:0,y:0}),Y())});return ne.createElement(Une,Pn({ref:h},z()),a&&ne.createElement(Aw,null,ne.createElement(Pne,{ref:p,isOutOfBounds:g},ne.createElement("div",null),ne.createElement("span",{ref:C}))))}const Jne=Gt("div",{display:"grid",columnGap:"$colGap",variants:{withJoystick:{true:{gridTemplateColumns:"$sizes$rowHeight auto"},false:{gridTemplateColumns:"auto"}}}});function One(){const{label:t,displayValue:e,onUpdate:n,settings:i}=Pi();return ne.createElement(mr,{input:!0},ne.createElement(Qr,null,t),ne.createElement(Jne,{withJoystick:!!i.joystick},i.joystick&&ne.createElement(Dne,{value:e,settings:i,onUpdate:n}),ne.createElement(fw,{value:e,settings:i,onUpdate:n})))}const Qne=["joystick"],vK=QF(["x","y"]),jne=t=>{let{joystick:e=!0}=t,n=An(t,Qne);const{value:i,settings:o}=vK.normalize(n);return{value:i,settings:wt(wt({},o),{},{joystick:e})}};var qne=wt(wt({component:One},vK),{},{normalize:jne});const $ne=t=>{if(t!==void 0){if(t instanceof File)try{return URL.createObjectURL(t)}catch{return}if(typeof t=="string"&&t.indexOf("blob:")===0)return t;throw Error("Invalid image format [undefined | blob |File].")}},eie=(t,e)=>typeof e=="object"&&"image"in e,tie=({image:t})=>({value:t});var nie=Object.freeze({__proto__:null,sanitize:$ne,schema:eie,normalize:tie});const iie=Gt("div",{position:"relative",display:"grid",gridTemplateColumns:"$sizes$rowHeight auto 20px",columnGap:"$colGap",alignItems:"center"}),oie=Gt("div",{$flexCenter:"",overflow:"hidden",height:"$rowHeight",background:"$elevation3",textAlign:"center",color:"inherit",borderRadius:"$sm",outline:"none",userSelect:"none",cursor:"pointer",$inputStyle:"",$hover:"",$focusWithin:"",$active:"$accent1 $elevation1",variants:{isDragAccept:{true:{$inputStyle:"$accent1",backgroundColor:"$elevation1"}}}}),rie=Gt("div",{boxSizing:"border-box",borderRadius:"$sm",height:"$rowHeight",width:"$rowHeight",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center",variants:{hasImage:{true:{cursor:"pointer",$hover:"",$active:""}}}}),sie=Gt("div",{$flexCenter:"",width:"$imagePreviewWidth",height:"$imagePreviewHeight",borderRadius:"$sm",boxShadow:"$level2",pointerEvents:"none",$inputStyle:"",backgroundSize:"cover",backgroundPosition:"center"}),aie=Gt("div",{fontSize:"0.8em",height:"100%",padding:"$rowGap $md"}),lie=Gt("div",{$flexCenter:"",top:"0",right:"0",marginRight:"$sm",height:"100%",cursor:"pointer",variants:{disabled:{true:{color:"$elevation3",cursor:"default"}}},"&::after,&::before":{content:'""',position:"absolute",height:2,width:10,borderRadius:1,backgroundColor:"currentColor"},"&::after":{transform:"rotate(45deg)"},"&::before":{transform:"rotate(-45deg)"}});function gie(){const{label:t,value:e,onUpdate:n,disabled:i}=Pi(),{popinRef:o,wrapperRef:r,shown:s,show:a,hide:l}=mK(),g=x.useCallback(p=>{p.length&&n(p[0])},[n]),c=x.useCallback(p=>{p.stopPropagation(),n(void 0)},[n]),{getRootProps:C,getInputProps:d,isDragAccept:h}=hK({maxFiles:1,accept:"image/*",onDrop:g,disabled:i});return ne.createElement(mr,{input:!0},ne.createElement(Qr,null,t),ne.createElement(iie,null,ne.createElement(rie,{ref:o,hasImage:!!e,onPointerDown:()=>!!e&&a(),onPointerUp:l,style:{backgroundImage:e?`url(${e})`:"none"}}),s&&!!e&&ne.createElement(Aw,null,ne.createElement(kF,{onPointerUp:l,style:{cursor:"pointer"}}),ne.createElement(sie,{ref:r,style:{backgroundImage:`url(${e})`}})),ne.createElement(oie,C({isDragAccept:h}),ne.createElement("input",d()),ne.createElement(aie,null,h?"drop image":"click or drop")),ne.createElement(lie,{onClick:c,disabled:!e})))}var cie=wt({component:gie},nie);const aX=So().number(),Iie=(t,e)=>So().array().length(2).every.number().test(t)&&So().schema({min:aX,max:aX}).test(e),qf=t=>({min:t[0],max:t[1]}),GK=(t,{bounds:[e,n]},i)=>{const o=Array.isArray(t)?qf(t):t,r={min:i[0],max:i[1]},{min:s,max:a}=wt(wt({},r),o);return[ml(Number(s),e,Math.max(e,a)),ml(Number(a),Math.min(n,s),n)]},uie=({value:t,min:e,max:n})=>{const i={min:e,max:n},o=OF(qf(t),{min:i,max:i}),r=[e,n],s=wt(wt({},o),{},{bounds:r});return{value:GK(qf(t),s,t),settings:s}};var Cie=Object.freeze({__proto__:null,schema:Iie,format:qf,sanitize:GK,normalize:uie});const die=["value","bounds","onDrag"],hie=["bounds"],Aie=Gt("div",{display:"grid",columnGap:"$colGap",gridTemplateColumns:"auto calc($sizes$numberInputMinWidth * 2 + $space$rowGap)"});function pie(t){let{value:e,bounds:[n,i],onDrag:o}=t,r=An(t,die);const s=x.useRef(null),a=x.useRef(null),l=x.useRef(null),g=x.useRef(0),c=la("sizes","scrubberWidth"),C=ah(({event:p,first:v,xy:[f],movement:[A],memo:b={}})=>{if(v){const{width:B,left:Z}=s.current.getBoundingClientRect();g.current=B-parseFloat(c);const w=(p==null?void 0:p.target)===a.current||(p==null?void 0:p.target)===l.current;b.pos=Df((f-Z)/B,n,i);const W=Math.abs(b.pos-e.min)-Math.abs(b.pos-e.max);b.key=W<0||W===0&&b.pos<=e.min?"min":"max",w&&(b.pos=e[b.key])}const m=b.pos+Df(A/g.current,0,i-n);return o({[b.key]:Q$(m,r[b.key])}),b}),d=`calc(${Pf(e.min,n,i)} * (100% - ${c} - 8px) + 4px)`,h=`calc(${1-Pf(e.max,n,i)} * (100% - ${c} - 8px) + 4px)`;return ne.createElement(PF,Pn({ref:s},C()),ne.createElement(UF,null,ne.createElement(DF,{style:{left:d,right:h}})),ne.createElement(ZB,{position:"left",ref:a,style:{left:d}}),ne.createElement(ZB,{position:"right",ref:l,style:{right:h}}))}function fie(){const{label:t,displayValue:e,onUpdate:n,settings:i}=Pi(),o=An(i,hie);return ne.createElement(ne.Fragment,null,ne.createElement(mr,{input:!0},ne.createElement(Qr,null,t),ne.createElement(Aie,null,ne.createElement(pie,Pn({value:e},i,{onDrag:n})),ne.createElement(fw,{value:e,settings:o,onUpdate:n,innerLabelTrim:0}))))}var mie=wt({component:fie},Cie);const bie=()=>{const t=new Map;return{on:(e,n)=>{let i=t.get(e);i===void 0&&(i=new Set,t.set(e,i)),i.add(n)},off:(e,n)=>{const i=t.get(e);i!==void 0&&(i.delete(n),i.size===0&&t.delete(e))},emit:(e,...n)=>{const i=t.get(e);if(i!==void 0)for(const o of i)o(...n)}}},yie=["type","value"],vie=["onChange","transient","onEditStart","onEditEnd"],Gie=function(){const e=E2(uj(()=>({data:{}}))),n=bie();this.storeId=s$(),this.useStore=e;const i={},o=new Set;this.getVisiblePaths=()=>{const s=this.getData(),a=Object.keys(s),l=[];Object.entries(i).forEach(([c,C])=>{C.render&&a.some(d=>d.indexOf(c)===0)&&!C.render(this.get)&&l.push(c+".")});const g=[];return o.forEach(c=>{c in s&&s[c].__refCount>0&&l.every(C=>c.indexOf(C)===-1)&&(!s[c].render||s[c].render(this.get))&&g.push(c)}),g},this.setOrderedPaths=s=>{s.forEach(a=>o.add(a))},this.orderPaths=s=>(this.setOrderedPaths(s),s),this.disposePaths=s=>{e.setState(a=>{const l=a.data;return s.forEach(g=>{if(g in l){const c=l[g];c.__refCount--,c.__refCount===0&&c.type in kr&&delete l[g]}}),{data:l}})},this.dispose=()=>{e.setState(()=>({data:{}}))},this.getFolderSettings=s=>i[s]||{},this.getData=()=>e.getState().data,this.addData=(s,a)=>{e.setState(l=>{const g=l.data;return Object.entries(s).forEach(([c,C])=>{let d=g[c];if(d){const{type:h,value:p}=C,v=An(C,yie);h!==d.type?ea(Hn.INPUT_TYPE_OVERRIDE,h):((d.__refCount===0||a)&&Object.assign(d,v),d.__refCount++)}else g[c]=wt(wt({},C),{},{__refCount:1})}),{data:g}})},this.setValueAtPath=(s,a,l)=>{e.setState(g=>{const c=g.data;return VV(c[s],a,s,this,l),{data:c}})},this.setSettingsAtPath=(s,a)=>{e.setState(l=>{const g=l.data;return g[s].settings=wt(wt({},g[s].settings),a),{data:g}})},this.disableInputAtPath=(s,a)=>{e.setState(l=>{const g=l.data;return g[s].disabled=a,{data:g}})},this.set=(s,a)=>{e.setState(l=>{const g=l.data;return Object.entries(s).forEach(([c,C])=>{try{VV(g[c],C,void 0,void 0,a)}catch{}}),{data:g}})},this.getInput=s=>{try{return this.getData()[s]}catch{ea(Hn.PATH_DOESNT_EXIST,s)}},this.get=s=>{var a;return(a=this.getInput(s))===null||a===void 0?void 0:a.value},this.emitOnEditStart=s=>{n.emit(`onEditStart:${s}`,this.get(s),s,wt(wt({},this.getInput(s)),{},{get:this.get}))},this.emitOnEditEnd=s=>{n.emit(`onEditEnd:${s}`,this.get(s),s,wt(wt({},this.getInput(s)),{},{get:this.get}))},this.subscribeToEditStart=(s,a)=>{const l=`onEditStart:${s}`;return n.on(l,a),()=>n.off(l,a)},this.subscribeToEditEnd=(s,a)=>{const l=`onEditEnd:${s}`;return n.on(l,a),()=>n.off(l,a)};const r=(s,a,l)=>{const g={};return Object.entries(s).forEach(([c,C])=>{if(c==="")return ea(Hn.EMPTY_KEY);let d=Zw(a,c);if(C.type===kr.FOLDER){const h=r(C.schema,d,l);Object.assign(g,h),d in i||(i[d]=C.settings)}else if(c in l)ea(Hn.DUPLICATE_KEYS,c,d,l[c].path);else{const h=d$(C,c,d,g);if(h){const{type:p,options:v,input:f}=h,{onChange:A,transient:b,onEditStart:m,onEditEnd:B}=v,Z=An(v,vie);g[d]=wt(wt(wt({type:p},Z),f),{},{fromPanel:!0}),l[c]={path:d,onChange:A,transient:b,onEditStart:m,onEditEnd:B}}else ea(Hn.UNKNOWN_INPUT,d,C)}}),g};this.getDataFromSchema=s=>{const a={};return[r(s,"",a),a]}},BK=new Gie,Bie={collapsed:!1};function MC(t,e){return{type:kr.FOLDER,schema:t,settings:wt(wt({},Bie),e)}}const lX=t=>"__levaInput"in t,Zie=(t,e)=>{const n={},i=e?e.toLowerCase():null;return t.forEach(o=>{const[r,s]=wne(o);(!i||r.toLowerCase().indexOf(i)>-1)&&Zne(n,s,{[r]:{__levaInput:!0,path:o}})}),n},wie=["type","label","path","valueKey","value","settings","setValue","disabled"];function Sie(t){let{type:e,label:n,path:i,valueKey:o,value:r,settings:s,setValue:a,disabled:l}=t,g=An(t,wie);const{displayValue:c,onChange:C,onUpdate:d}=TF({type:e,value:r,settings:s,setValue:a}),h=Mg[e].component;return h?ne.createElement(NF.Provider,{value:wt({key:o,path:i,id:""+i,label:n,displayValue:c,value:r,onChange:C,onUpdate:d,settings:s,setValue:a,disabled:l},g)},ne.createElement(Y$,{disabled:l},ne.createElement(h,null))):(ea(Hn.NO_COMPONENT_FOR_TYPE,e,i),null)}const Rie=Gt("button",{display:"block",$reset:"",fontWeight:"$button",height:"$rowHeight",borderStyle:"none",borderRadius:"$sm",backgroundColor:"$elevation1",color:"$highlight1","&:not(:disabled)":{color:"$highlight3",backgroundColor:"$accent2",cursor:"pointer",$hover:"$accent3",$active:"$accent3 $accent1",$focus:""}});function Wie({onClick:t,settings:e,label:n}){const i=sh();return ne.createElement(mr,null,ne.createElement(Rie,{disabled:e.disabled,onClick:()=>t(i.get)},n))}const xie=Gt("div",{$flex:"",justifyContent:"flex-end",gap:"$colGap"}),Vie=Gt("button",{$reset:"",cursor:"pointer",borderRadius:"$xs","&:hover":{backgroundColor:"$elevation3"}}),Xie=({label:t,opts:e})=>{let n=typeof t=="string"&&t.trim()===""?null:t,i=e;return typeof e.opts=="object"&&(i.label!==void 0&&(n=e.label),i=e.opts),{label:n,opts:i}};function Nie(t){const{label:e,opts:n}=Xie(t),i=sh();return ne.createElement(mr,{input:!!e},e&&ne.createElement(Qr,null,e),ne.createElement(xie,null,Object.entries(n).map(([o,r])=>ne.createElement(Vie,{key:o,onClick:()=>r(i.get)},o))))}const Yie=Gt("canvas",{height:"$monitorHeight",width:"100%",display:"block",borderRadius:"$sm"}),ZK=100;function Mie(t,e){t.push(e),t.length>ZK&&t.shift()}const Hie=x.forwardRef(function({initialValue:t},e){const n=la("colors","highlight3"),i=la("colors","elevation2"),o=la("colors","highlight1"),[r,s]=x.useMemo(()=>[to(o).alpha(.4).toRgbString(),to(o).alpha(.1).toRgbString()],[o]),a=x.useRef([t]),l=x.useRef(t),g=x.useRef(t),c=x.useRef(),C=x.useCallback((p,v)=>{if(!p)return;const{width:f,height:A}=p,b=new Path2D,m=f/ZK,B=A*.05;for(let W=0;W<a.current.length;W++){const X=Pf(a.current[W],l.current,g.current),V=m*W,Y=A-X*(A-B*2)-B;b.lineTo(V,Y)}v.clearRect(0,0,f,A);const Z=new Path2D(b);Z.lineTo(m*(a.current.length+1),A),Z.lineTo(0,A),Z.lineTo(0,0);const w=v.createLinearGradient(0,0,0,A);w.addColorStop(0,r),w.addColorStop(1,s),v.fillStyle=w,v.fill(Z),v.strokeStyle=i,v.lineJoin="round",v.lineWidth=14,v.stroke(b),v.strokeStyle=n,v.lineWidth=2,v.stroke(b)},[n,i,r,s]),[d,h]=T$(C);return x.useImperativeHandle(e,()=>({frame:p=>{(l.current===void 0||p<l.current)&&(l.current=p),(g.current===void 0||p>g.current)&&(g.current=p),Mie(a.current,p),c.current=requestAnimationFrame(()=>C(d.current,h.current))}}),[d,h,C]),x.useEffect(()=>()=>cancelAnimationFrame(c.current),[]),ne.createElement(Yie,{ref:d})}),gX=t=>Number.isFinite(t)?t.toPrecision(2):t.toString(),Fie=x.forwardRef(function({initialValue:t},e){const[n,i]=x.useState(gX(t));return x.useImperativeHandle(e,()=>({frame:o=>i(gX(o))}),[]),ne.createElement("div",null,n)});function cX(t){return typeof t=="function"?t():t.current}function Kie({label:t,objectOrFn:e,settings:n}){const i=x.useRef(),o=x.useRef(cX(e));return x.useEffect(()=>{const r=window.setInterval(()=>{var s;document.hidden||(s=i.current)===null||s===void 0||s.frame(cX(e))},n.interval);return()=>window.clearInterval(r)},[e,n.interval]),ne.createElement(mr,{input:!0},ne.createElement(Qr,{align:"top"},t),n.graph?ne.createElement(Hie,{ref:i,initialValue:o.current}):ne.createElement(Fie,{ref:i,initialValue:o.current}))}const zie=["type","label","key"],Lie={[kr.BUTTON]:Wie,[kr.BUTTON_GROUP]:Nie,[kr.MONITOR]:Kie},Eie=ne.memo(({path:t})=>{const[e,{set:n,setSettings:i,disable:o,storeId:r,emitOnEditStart:s,emitOnEditEnd:a}]=U$(t);if(!e)return null;const{type:l,label:g,key:c}=e,C=An(e,zie);if(l in kr){const d=Lie[l];return ne.createElement(d,Pn({label:g,path:t},C))}return l in Mg?ne.createElement(Sie,Pn({key:r+t,type:l,label:g,storeId:r,path:t,valueKey:c,setValue:n,setSettings:i,disable:o,emitOnEditStart:s,emitOnEditEnd:a},C)):(q6(Hn.UNSUPPORTED_INPUT,l,t),null)});function kie({toggle:t,toggled:e,name:n}){return ne.createElement(V$,{onClick:()=>t()},ne.createElement(pw,{toggled:e}),ne.createElement("div",null,n))}const Tie=({name:t,path:e,tree:n})=>{const i=sh(),o=Zw(e,t),{collapsed:r,color:s}=i.getFolderSettings(o),[a,l]=x.useState(!r),g=x.useRef(null),c=la("colors","folderWidgetColor"),C=la("colors","folderTextColor");return x.useLayoutEffect(()=>{g.current.style.setProperty("--leva-colors-folderWidgetColor",s||c),g.current.style.setProperty("--leva-colors-folderTextColor",s||C)},[s,c,C]),ne.createElement(Jf,{ref:g},ne.createElement(kie,{name:t,toggled:a,toggle:()=>l(d=>!d)}),ne.createElement(wK,{parent:o,tree:n,toggled:a}))},wK=ne.memo(({isRoot:t=!1,fill:e=!1,flat:n=!1,parent:i,tree:o,toggled:r})=>{const{wrapperRef:s,contentRef:a}=Wne(r),l=sh(),g=([C,d])=>{var h;return(lX(d)?(h=l.getInput(d.path))===null||h===void 0?void 0:h.order:l.getFolderSettings(Zw(i,C)).order)||0},c=Object.entries(o).sort((C,d)=>g(C)-g(d));return ne.createElement(GB,{ref:s,isRoot:t,fill:e,flat:n},ne.createElement(zF,{ref:a,isRoot:t,toggled:r},c.map(([C,d])=>lX(d)?ne.createElement(Eie,{key:d.path,valueKey:d.valueKey,path:d.path}):ne.createElement(Tie,{key:C,name:C,path:i,tree:d}))))}),_ie=Gt("div",{position:"relative",fontFamily:"$mono",fontSize:"$root",color:"$rootText",backgroundColor:"$elevation1",variants:{fill:{false:{position:"fixed",top:"10px",right:"10px",zIndex:1e3,width:"$rootWidth"},true:{position:"relative",width:"100%"}},flat:{false:{borderRadius:"$lg",boxShadow:"$level1"}},oneLineLabels:{true:{[`${EF}`]:{gridTemplateColumns:"auto",gridAutoColumns:"minmax(max-content, 1fr)",gridAutoRows:"minmax($sizes$rowHeight), auto)",rowGap:0,columnGap:0,marginTop:"$rowGap"}}},hideTitleBar:{true:{$$titleBarHeight:"0px"},false:{$$titleBarHeight:"$sizes$titleBarHeight"}}},"&,*,*:after,*:before":{boxSizing:"border-box"},"*::selection":{backgroundColor:"$accent2"}}),SK=40,$f=Gt("i",{$flexCenter:"",width:SK,userSelect:"none",cursor:"pointer","> svg":{fill:"$highlight1",transition:"transform 350ms ease, fill 250ms ease"},"&:hover > svg":{fill:"$highlight3"},variants:{active:{true:{"> svg":{fill:"$highlight2"}}}}}),Uie=Gt("div",{display:"flex",alignItems:"stretch",justifyContent:"space-between",height:"$titleBarHeight",variants:{mode:{drag:{cursor:"grab"}}}}),Pie=Gt("div",{$flex:"",position:"relative",width:"100%",overflow:"hidden",transition:"height 250ms ease",color:"$highlight3",paddingLeft:"$md",[`> ${$f}`]:{height:30},variants:{toggled:{true:{height:30},false:{height:0}}}}),Die=Gt("input",{$reset:"",flex:1,position:"relative",height:30,width:"100%",backgroundColor:"transparent",fontSize:"10px",borderRadius:"$root","&:focus":{},"&::placeholder":{color:"$highlight2"}}),Jie=Gt("div",{touchAction:"none",$flexCenter:"",flex:1,"> svg":{fill:"$highlight1"},color:"$highlight1",variants:{drag:{true:{$draggable:"","> svg":{transition:"fill 250ms ease"},"&:hover":{color:"$highlight3"},"&:hover > svg":{fill:"$highlight3"}}},filterEnabled:{false:{paddingRight:SK}}}}),Oie=ne.forwardRef(({setFilter:t,toggle:e},n)=>{const[i,o]=x.useState(""),r=x.useMemo(()=>SF(t,250),[t]),s=()=>{t(""),o("")},a=l=>{const g=l.currentTarget.value;e(!0),o(g)};return x.useEffect(()=>{r(i)},[i,r]),ne.createElement(ne.Fragment,null,ne.createElement(Die,{ref:n,value:i,placeholder:"[Open filter with CMD+SHIFT+L]",onPointerDown:l=>l.stopPropagation(),onChange:a}),ne.createElement($f,{onClick:()=>s(),style:{visibility:i?"visible":"hidden"}},ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"14",viewBox:"0 0 20 20",fill:"currentColor"},ne.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"}))))});function Qie({setFilter:t,onDrag:e,onDragStart:n,onDragEnd:i,toggle:o,toggled:r,title:s,drag:a,filterEnabled:l,from:g}){const[c,C]=x.useState(!1),d=x.useRef(null);x.useEffect(()=>{var p,v;c?(p=d.current)===null||p===void 0||p.focus():(v=d.current)===null||v===void 0||v.blur()},[c]);const h=ah(({offset:[p,v],first:f,last:A})=>{e({x:p,y:v}),f&&n({x:p,y:v}),A&&i({x:p,y:v})},{filterTaps:!0,from:({offset:[p,v]})=>[(g==null?void 0:g.x)||p,(g==null?void 0:g.y)||v]});return x.useEffect(()=>{const p=v=>{v.key==="L"&&v.shiftKey&&v.metaKey&&C(f=>!f)};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[]),ne.createElement(ne.Fragment,null,ne.createElement(Uie,{mode:a?"drag":void 0},ne.createElement($f,{active:!r,onClick:()=>o()},ne.createElement(pw,{toggled:r,width:12,height:8})),ne.createElement(Jie,Pn({},a?h():{},{drag:a,filterEnabled:l}),s===void 0&&a?ne.createElement("svg",{width:"20",height:"10",viewBox:"0 0 28 14",xmlns:"http://www.w3.org/2000/svg"},ne.createElement("circle",{cx:"2",cy:"2",r:"2"}),ne.createElement("circle",{cx:"14",cy:"2",r:"2"}),ne.createElement("circle",{cx:"26",cy:"2",r:"2"}),ne.createElement("circle",{cx:"2",cy:"12",r:"2"}),ne.createElement("circle",{cx:"14",cy:"12",r:"2"}),ne.createElement("circle",{cx:"26",cy:"12",r:"2"})):s),l&&ne.createElement($f,{active:c,onClick:()=>C(p=>!p)},ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",viewBox:"0 0 20 20"},ne.createElement("path",{d:"M9 9a2 2 0 114 0 2 2 0 01-4 0z"}),ne.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z",clipRule:"evenodd"})))),ne.createElement(Pie,{toggled:c},ne.createElement(Oie,{ref:d,setFilter:t,toggle:o})))}const jie=["store","hidden","theme","collapsed"];function qie(t){let{store:e,hidden:n=!1,theme:i,collapsed:o=!1}=t,r=An(t,jie);const s=fK(()=>Z$(i),[i]),[a,l]=x.useState(!o),g=typeof o=="object"?!o.collapsed:a,c=x.useMemo(()=>typeof o=="object"?C=>{typeof C=="function"?o.onChange(!C(!o.collapsed)):o.onChange(!C)}:l,[o]);return!e||n?null:ne.createElement(dw.Provider,{value:s},ne.createElement($ie,Pn({store:e},r,{toggled:g,setToggle:c,rootClass:s.className})))}const $ie=ne.memo(({store:t,rootClass:e,fill:n=!1,flat:i=!1,neverHide:o=!1,oneLineLabels:r=!1,titleBar:s={title:void 0,drag:!0,filter:!0,position:void 0,onDrag:void 0,onDragStart:void 0,onDragEnd:void 0},hideCopyButton:a=!1,toggled:l,setToggle:g})=>{var c,C;const d=xne(t),[h,p]=x.useState(""),v=x.useMemo(()=>Zie(d,h),[d,h]),[f,A]=_F(),b=o||d.length>0,m=typeof s=="object"&&s.title||void 0,B=typeof s=="object"&&(c=s.drag)!==null&&c!==void 0?c:!0,Z=typeof s=="object"&&(C=s.filter)!==null&&C!==void 0?C:!0,w=typeof s=="object"&&s.position||void 0,W=typeof s=="object"&&s.onDrag||void 0,X=typeof s=="object"&&s.onDragStart||void 0,V=typeof s=="object"&&s.onDragEnd||void 0;return ne.useEffect(()=>{A({x:w==null?void 0:w.x,y:w==null?void 0:w.y})},[w,A]),B$(),ne.createElement(MF.Provider,{value:{hideCopyButton:a}},ne.createElement(_ie,{ref:f,className:e,fill:n,flat:i,oneLineLabels:r,hideTitleBar:!s,style:{display:b?"block":"none"}},s&&ne.createElement(Qie,{onDrag:Y=>{A(Y),W==null||W(Y)},onDragStart:Y=>X==null?void 0:X(Y),onDragEnd:Y=>V==null?void 0:V(Y),setFilter:p,toggle:Y=>g(z=>Y??!z),toggled:l,title:m,drag:B,filterEnabled:Z,from:w}),b&&ne.createElement(YF.Provider,{value:t},ne.createElement(wK,{isRoot:!0,fill:n,flat:i,tree:v,toggled:l}))))}),eoe=["isRoot"];let em=!1,dg=null;function toe(t){let{isRoot:e=!1}=t,n=An(t,eoe);return x.useEffect(()=>(em=!0,!e&&dg&&(dg.remove(),dg=null),()=>{e||(em=!1)}),[e]),ne.createElement(qie,Pn({store:BK},n))}function noe(t){x.useEffect(()=>{t&&!em&&(dg||(dg=document.getElementById("leva__root")||Object.assign(document.createElement("div"),{id:"leva__root"}),document.body&&(document.body.appendChild(dg),A$(ne.createElement(toe,{isRoot:!0}),dg))),em=!0)},[t])}function ioe(t,e,n,i,o){let r,s,a,l,g;return typeof t=="string"?(s=t,r=e,Array.isArray(n)?g=n:n&&("store"in n?(l=n,g=i):(a=n,Array.isArray(i)?g=i:(l=i,g=o)))):(r=t,Array.isArray(e)?g=e:(l=e,g=n)),{schema:r,folderName:s,folderSettings:a,hookSettings:l,deps:g||[]}}function RK(t,e,n,i,o){const{folderName:r,schema:s,folderSettings:a,hookSettings:l,deps:g}=ioe(t,e,n,i,o),c=typeof s=="function",C=x.useRef(!1),d=x.useRef(!0),h=fK(()=>{C.current=!0;const z=typeof s=="function"?s():s;return r?{[r]:MC(z,a)}:z},g),p=!(l!=null&&l.store);noe(p);const[v]=x.useState(()=>(l==null?void 0:l.store)||BK),[f,A]=x.useMemo(()=>v.getDataFromSchema(h),[v,h]),[b,m,B,Z,w]=x.useMemo(()=>{const z=[],q=[],O={},te={},oe={};return Object.values(A).forEach(({path:re,onChange:se,onEditStart:H,onEditEnd:D,transient:T})=>{z.push(re),se?(O[re]=se,T||q.push(re)):q.push(re),H&&(te[re]=H),D&&(oe[re]=D)}),[z,q,O,te,oe]},[A]),W=x.useMemo(()=>v.orderPaths(b),[b,v]),X=Vne(v,m,f),V=x.useCallback(z=>{const q=Object.entries(z).reduce((O,[te,oe])=>Object.assign(O,{[A[te].path]:oe}),{});v.set(q,!1)},[v,A]),Y=x.useCallback(z=>v.get(A[z].path),[v,A]);return x.useEffect(()=>{const z=!d.current&&C.current;return v.addData(f,z),d.current=!1,C.current=!1,()=>v.disposePaths(W)},[v,W,f]),x.useEffect(()=>{const z=[];return Object.entries(B).forEach(([q,O])=>{O(v.get(q),q,wt({initial:!0,get:v.get},v.getInput(q)));const te=v.useStore.subscribe(oe=>{const re=oe.data[q];return[re.disabled?void 0:re.value,re]},([oe,re])=>O(oe,q,wt({initial:!1,get:v.get},re)),{equalityFn:ih});z.push(te)}),()=>z.forEach(q=>q())},[v,B]),x.useEffect(()=>{const z=[];return Object.entries(Z).forEach(([q,O])=>z.push(v.subscribeToEditStart(q,O))),Object.entries(w).forEach(([q,O])=>z.push(v.subscribeToEditEnd(q,O))),()=>z.forEach(q=>q())},[Z,w,v]),c?[X,V,Y]:X}ya(Ur.SELECT,lee);ya(Ur.IMAGE,cie);ya(Ur.NUMBER,q$);ya(Ur.COLOR,kne);ya(Ur.STRING,pee);ya(Ur.BOOLEAN,Bee);ya(Ur.INTERVAL,mie);ya(Ur.VECTOR3D,_ne);ya(Ur.VECTOR2D,qne);const ooe=$I`
    //
    // GLSL textureless classic 3D noise "cnoise",
    // with an RSL-style periodic variant "pnoise".
    // Author:  Stefan Gustavson (stefan.gustavson@liu.se)
    // Version: 2011-10-11
    //
    // Many thanks to Ian McEwan of Ashima Arts for the
    // ideas for permutation and gradient selection.
    //
    // Copyright (c) 2011 Stefan Gustavson. All rights reserved.
    // Distributed under the MIT license. See LICENSE file.
    // https://github.com/stegu/webgl-noise
    //

    vec3 mod289(vec3 x)
    {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }

    vec4 mod289(vec4 x)
    {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }

    vec4 permute(vec4 x)
    {
    return mod289(((x*34.0)+10.0)*x);
    }

    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }

    vec3 fade(vec3 t) {
    return t*t*t*(t*(t*6.0-15.0)+10.0);
    }

    // Classic Perlin noise
    float cnoise(vec3 P)
    {
    vec3 Pi0 = floor(P); // Integer part for indexing
    vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
    Pi0 = mod289(Pi0);
    Pi1 = mod289(Pi1);
    vec3 Pf0 = fract(P); // Fractional part for interpolation
    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
    vec4 iy = vec4(Pi0.yy, Pi1.yy);
    vec4 iz0 = Pi0.zzzz;
    vec4 iz1 = Pi1.zzzz;

    vec4 ixy = permute(permute(ix) + iy);
    vec4 ixy0 = permute(ixy + iz0);
    vec4 ixy1 = permute(ixy + iz1);

    vec4 gx0 = ixy0 * (1.0 / 7.0);
    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
    gx0 = fract(gx0);
    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
    vec4 sz0 = step(gz0, vec4(0.0));
    gx0 -= sz0 * (step(0.0, gx0) - 0.5);
    gy0 -= sz0 * (step(0.0, gy0) - 0.5);

    vec4 gx1 = ixy1 * (1.0 / 7.0);
    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
    gx1 = fract(gx1);
    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
    vec4 sz1 = step(gz1, vec4(0.0));
    gx1 -= sz1 * (step(0.0, gx1) - 0.5);
    gy1 -= sz1 * (step(0.0, gy1) - 0.5);

    vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
    vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
    vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
    vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
    vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
    vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
    vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
    vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
    g000 *= norm0.x;
    g010 *= norm0.y;
    g100 *= norm0.z;
    g110 *= norm0.w;
    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
    g001 *= norm1.x;
    g011 *= norm1.y;
    g101 *= norm1.z;
    g111 *= norm1.w;

    float n000 = dot(g000, Pf0);
    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
    float n111 = dot(g111, Pf1);

    vec3 fade_xyz = fade(Pf0);
    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
    return 2.2 * n_xyz;
    }

    // Classic Perlin noise, periodic variant
    float pnoise(vec3 P, vec3 rep)
    {
    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period
    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period
    Pi0 = mod289(Pi0);
    Pi1 = mod289(Pi1);
    vec3 Pf0 = fract(P); // Fractional part for interpolation
    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
    vec4 iy = vec4(Pi0.yy, Pi1.yy);
    vec4 iz0 = Pi0.zzzz;
    vec4 iz1 = Pi1.zzzz;

    vec4 ixy = permute(permute(ix) + iy);
    vec4 ixy0 = permute(ixy + iz0);
    vec4 ixy1 = permute(ixy + iz1);

    vec4 gx0 = ixy0 * (1.0 / 7.0);
    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
    gx0 = fract(gx0);
    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
    vec4 sz0 = step(gz0, vec4(0.0));
    gx0 -= sz0 * (step(0.0, gx0) - 0.5);
    gy0 -= sz0 * (step(0.0, gy0) - 0.5);

    vec4 gx1 = ixy1 * (1.0 / 7.0);
    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
    gx1 = fract(gx1);
    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
    vec4 sz1 = step(gz1, vec4(0.0));
    gx1 -= sz1 * (step(0.0, gx1) - 0.5);
    gy1 -= sz1 * (step(0.0, gy1) - 0.5);

    vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
    vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
    vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
    vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
    vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
    vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
    vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
    vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
    g000 *= norm0.x;
    g010 *= norm0.y;
    g100 *= norm0.z;
    g110 *= norm0.w;
    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
    g001 *= norm1.x;
    g011 *= norm1.y;
    g101 *= norm1.z;
    g111 *= norm1.w;

    float n000 = dot(g000, Pf0);
    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
    float n111 = dot(g111, Pf1);

    vec3 fade_xyz = fade(Pf0);
    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
    return 2.2 * n_xyz;
    }

`,roe=$I`

  /*${Ft.common}*/
  
  uniform float seaHeight;
  uniform float seaSpeed;
  uniform vec2 seaFrequency;
  uniform float seaNoiseFactor;
  uniform float seaWaveAmplitude;
  uniform float uTime;
  varying float vElevation;
  varying vec2 vUv;
  uniform sampler2D colorMap;

  ${ooe}

  float turbulence( vec3 p ) {

    float w = 100.0;
    float t = -.5;
  
    for (float f = 1.0 ; f <= 10.0 ; f++ ){
      float power = pow( 2.0, f );
      t += abs( pnoise( vec3( power * p ), vec3( 10.0, 10.0, 10.0 ) ) / power );
    }
  
    return t;
  
  }



  void main() {

    vUv = uv;
    vec4 modelPosition = modelMatrix * vec4(position, 1.0);

    // color map from the island png, so the sea would be static under the island
    float colorMapAlpha = texture2D(colorMap, vUv).a;

    // large waves according to normal vector
    float mainElevations = sin(modelPosition.x * seaFrequency.x + uTime * seaSpeed) *
                           sin(modelPosition.y * seaFrequency.y + uTime * seaSpeed) *
                           sin(modelPosition.z + uTime * seaSpeed) *
                           seaHeight;

    // smaller waves according to position
    float smallElevations = abs(turbulence(0.1 * seaNoiseFactor * normal * uTime)) * 0.05 * seaWaveAmplitude;

    // adding the large wave and small waves
    float elevation = mainElevations + smallElevations;

    if(colorMapAlpha == 0.0) {
      modelPosition -= elevation;
    }

    vec4 viewPosition = viewMatrix * modelPosition;
    vec4 projectedPosition = projectionMatrix * viewPosition;

    // out gl position
    gl_Position = projectedPosition;
    // pass elevation to fragment shader
    vElevation = elevation;
  }

`,soe=$I`

uniform vec3 seaTroughColor;
uniform vec3 seaCrestColor;
uniform vec2 seaFrequency;
uniform float seaWaveFactor;
uniform float seaWaveColorOffset;
varying float vElevation;
uniform sampler2D colorMap;
varying vec2 vUv;

void main() {

  float waveStrength = (vElevation * seaWaveColorOffset) * seaWaveFactor;
  vec3 color = mix(seaTroughColor, seaCrestColor, waveStrength);

  // float colorMapAlpha = texture2D(colorMap, vUv).a;

  gl_FragColor = vec4(color, 1.0);
}
`;function aoe({noiseLevel:t=1,noiseFactor:e=.1,height:n=.1,frequency:i={x:2,y:2},speed:o=1,troughColor:r="#8997c3",crestColor:s="#81d4de",waveColorOffset:a=0,waveFactor:l=1,waveAmplitude:g=1}){const[c,C,d]=dB("/bg.png");Pg(p=>{h&&(h.uniforms.uTime.value=p.clock.elapsedTime)});const h=x.useMemo(()=>{if(t&&c)return new ao({uniforms:{colorMap:{value:c},seaHeight:{value:n},seaWaveAmplitude:{value:g},seaFrequency:{value:new We(i.x,i.y)},seaTroughColor:{value:new je(r)},seaCrestColor:{value:new je(s)},seaSpeed:{value:s},seaWaveColorOffset:{value:a},seaWaveFactor:{value:l},seaNoiseFactor:{value:e},uTime:{value:0}},vertexShader:roe,fragmentShader:soe,transparent:!0})},[t,c]);return x.useEffect(()=>{h&&(h.uniforms.seaHeight.value=n,h.uniforms.seaFrequency.value.x=i.x,h.uniforms.seaFrequency.value.y=i.y,h.uniforms.seaSpeed.value=o,h.uniforms.seaTroughColor.value=new je(r),h.uniforms.seaCrestColor.value=new je(s),h.uniforms.seaWaveColorOffset.value=a,h.uniforms.seaWaveFactor.value=l,h.uniforms.seaNoiseFactor.value=e,h.uniforms.seaWaveAmplitude.value=g)},[n,i.x,i.y,o,r,s,a,l,g,e,c]),Pe.jsx("mesh",{material:h,children:Pe.jsx("sphereGeometry",{args:[5,512,512]})})}const loe="astor_place_bold_regular.json",goe=x.forwardRef(({text:t,fonts:e,size:n=2,curveSegments:i=12,bevelEnabled:o=!1,children:r},s)=>{const a=x.useRef(null),l=x.useRef(null);return x.useImperativeHandle(s,()=>({get wrapper(){return a.current},get inner(){return l.current}})),Pe.jsx("group",{ref:a,children:Pe.jsxs(_j,{ref:l,position:new E(0,7,0),curveSegments:i,bevelEnabled:o,font:e||loe,size:n,children:[t&&t.toUpperCase(),Pe.jsx("meshNormalMaterial",{}),r]})})});var coe=Object.defineProperty,Ioe=(t,e)=>{for(var n in e)coe(t,n,{get:e[n],enumerable:!0})},Pr={};Ioe(Pr,{assign:()=>doe,colors:()=>cl,createStringInterpolator:()=>Xw,skipAnimation:()=>MK,to:()=>YK,willAdvance:()=>Nw});var ww=Ih(),Nt=t=>ch(t,ww),Sw=Ih();Nt.write=t=>ch(t,Sw);var h0=Ih();Nt.onStart=t=>ch(t,h0);var Rw=Ih();Nt.onFrame=t=>ch(t,Rw);var Ww=Ih();Nt.onFinish=t=>ch(t,Ww);var AI=[];Nt.setTimeout=(t,e)=>{const n=Nt.now()+e,i=()=>{const r=AI.findIndex(s=>s.cancel==i);~r&&AI.splice(r,1),Oa-=~r?1:0},o={time:n,handler:t,cancel:i};return AI.splice(WK(n),0,o),Oa+=1,xK(),o};var WK=t=>~(~AI.findIndex(e=>e.time>t)||~AI.length);Nt.cancel=t=>{h0.delete(t),Rw.delete(t),Ww.delete(t),ww.delete(t),Sw.delete(t)};Nt.sync=t=>{KB=!0,Nt.batchedUpdates(t),KB=!1};Nt.throttle=t=>{let e;function n(){try{t(...e)}finally{e=null}}function i(...o){e=o,Nt.onStart(n)}return i.handler=t,i.cancel=()=>{h0.delete(n),e=null},i};var xw=typeof window<"u"?window.requestAnimationFrame:()=>{};Nt.use=t=>xw=t;Nt.now=typeof performance<"u"?()=>performance.now():Date.now;Nt.batchedUpdates=t=>t();Nt.catch=console.error;Nt.frameLoop="always";Nt.advance=()=>{Nt.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):XK()};var Ja=-1,Oa=0,KB=!1;function ch(t,e){KB?(e.delete(t),t(0)):(e.add(t),xK())}function xK(){Ja<0&&(Ja=0,Nt.frameLoop!=="demand"&&xw(VK))}function uoe(){Ja=-1}function VK(){~Ja&&(xw(VK),Nt.batchedUpdates(XK))}function XK(){const t=Ja;Ja=Nt.now();const e=WK(Ja);if(e&&(NK(AI.splice(0,e),n=>n.handler()),Oa-=e),!Oa){uoe();return}h0.flush(),ww.flush(t?Math.min(64,Ja-t):16.667),Rw.flush(),Sw.flush(),Ww.flush()}function Ih(){let t=new Set,e=t;return{add(n){Oa+=e==t&&!t.has(n)?1:0,t.add(n)},delete(n){return Oa-=e==t&&t.has(n)?1:0,t.delete(n)},flush(n){e.size&&(t=new Set,Oa-=e.size,NK(e,i=>i(n)&&t.add(i)),Oa+=t.size,e=t)}}}function NK(t,e){t.forEach(n=>{try{e(n)}catch(i){Nt.catch(i)}})}function zB(){}var Coe=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),De={arr:Array.isArray,obj:t=>!!t&&t.constructor.name==="Object",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",und:t=>t===void 0};function Os(t,e){if(De.arr(t)){if(!De.arr(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return t===e}var gn=(t,e)=>t.forEach(e);function fa(t,e,n){if(De.arr(t)){for(let i=0;i<t.length;i++)e.call(n,t[i],`${i}`);return}for(const i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i)}var ur=t=>De.und(t)?[]:De.arr(t)?t:[t];function HC(t,e){if(t.size){const n=Array.from(t);t.clear(),gn(n,e)}}var CC=(t,...e)=>HC(t,n=>n(...e)),Vw=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Xw,YK,cl=null,MK=!1,Nw=zB,doe=t=>{t.to&&(YK=t.to),t.now&&(Nt.now=t.now),t.colors!==void 0&&(cl=t.colors),t.skipAnimation!=null&&(MK=t.skipAnimation),t.createStringInterpolator&&(Xw=t.createStringInterpolator),t.requestAnimationFrame&&Nt.use(t.requestAnimationFrame),t.batchedUpdates&&(Nt.batchedUpdates=t.batchedUpdates),t.willAdvance&&(Nw=t.willAdvance),t.frameLoop&&(Nt.frameLoop=t.frameLoop)},FC=new Set,gr=[],gv=[],tm=0,A0={get idle(){return!FC.size&&!gr.length},start(t){tm>t.priority?(FC.add(t),Nt.onStart(hoe)):(HK(t),Nt(LB))},advance:LB,sort(t){if(tm)Nt.onFrame(()=>A0.sort(t));else{const e=gr.indexOf(t);~e&&(gr.splice(e,1),FK(t))}},clear(){gr=[],FC.clear()}};function hoe(){FC.forEach(HK),FC.clear(),Nt(LB)}function HK(t){gr.includes(t)||FK(t)}function FK(t){gr.splice(Aoe(gr,e=>e.priority>t.priority),0,t)}function LB(t){const e=gv;for(let n=0;n<gr.length;n++){const i=gr[n];tm=i.priority,i.idle||(Nw(i),i.advance(t),i.idle||e.push(i))}return tm=0,gv=gr,gv.length=0,gr=e,gr.length>0}function Aoe(t,e){const n=t.findIndex(e);return n<0?t.length:n}var poe=(t,e,n)=>Math.min(Math.max(n,t),e),foe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},Kr="[-+]?\\d*\\.?\\d+",nm=Kr+"%";function p0(...t){return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}var moe=new RegExp("rgb"+p0(Kr,Kr,Kr)),boe=new RegExp("rgba"+p0(Kr,Kr,Kr,Kr)),yoe=new RegExp("hsl"+p0(Kr,nm,nm)),voe=new RegExp("hsla"+p0(Kr,nm,nm,Kr)),Goe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Boe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Zoe=/^#([0-9a-fA-F]{6})$/,woe=/^#([0-9a-fA-F]{8})$/;function Soe(t){let e;return typeof t=="number"?t>>>0===t&&t>=0&&t<=4294967295?t:null:(e=Zoe.exec(t))?parseInt(e[1]+"ff",16)>>>0:cl&&cl[t]!==void 0?cl[t]:(e=moe.exec(t))?(Fc(e[1])<<24|Fc(e[2])<<16|Fc(e[3])<<8|255)>>>0:(e=boe.exec(t))?(Fc(e[1])<<24|Fc(e[2])<<16|Fc(e[3])<<8|CX(e[4]))>>>0:(e=Goe.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=woe.exec(t))?parseInt(e[1],16)>>>0:(e=Boe.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=yoe.exec(t))?(IX(uX(e[1]),yp(e[2]),yp(e[3]))|255)>>>0:(e=voe.exec(t))?(IX(uX(e[1]),yp(e[2]),yp(e[3]))|CX(e[4]))>>>0:null}function cv(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function IX(t,e,n){const i=n<.5?n*(1+e):n+e-n*e,o=2*n-i,r=cv(o,i,t+1/3),s=cv(o,i,t),a=cv(o,i,t-1/3);return Math.round(r*255)<<24|Math.round(s*255)<<16|Math.round(a*255)<<8}function Fc(t){const e=parseInt(t,10);return e<0?0:e>255?255:e}function uX(t){return(parseFloat(t)%360+360)%360/360}function CX(t){const e=parseFloat(t);return e<0?0:e>1?255:Math.round(e*255)}function yp(t){const e=parseFloat(t);return e<0?0:e>100?1:e/100}function dX(t){let e=Soe(t);if(e===null)return t;e=e||0;const n=(e&4278190080)>>>24,i=(e&16711680)>>>16,o=(e&65280)>>>8,r=(e&255)/255;return`rgba(${n}, ${i}, ${o}, ${r})`}var Rd=(t,e,n)=>{if(De.fun(t))return t;if(De.arr(t))return Rd({range:t,output:e,extrapolate:n});if(De.str(t.output[0]))return Xw(t);const i=t,o=i.output,r=i.range||[0,1],s=i.extrapolateLeft||i.extrapolate||"extend",a=i.extrapolateRight||i.extrapolate||"extend",l=i.easing||(g=>g);return g=>{const c=Woe(g,r);return Roe(g,r[c],r[c+1],o[c],o[c+1],l,s,a,i.map)}};function Roe(t,e,n,i,o,r,s,a,l){let g=l?l(t):t;if(g<e){if(s==="identity")return g;s==="clamp"&&(g=e)}if(g>n){if(a==="identity")return g;a==="clamp"&&(g=n)}return i===o?i:e===n?t<=e?i:o:(e===-1/0?g=-g:n===1/0?g=g-e:g=(g-e)/(n-e),g=r(g),i===-1/0?g=-g:o===1/0?g=g+i:g=g*(o-i)+i,g)}function Woe(t,e){for(var n=1;n<e.length-1&&!(e[n]>=t);++n);return n-1}var xoe=(t,e="end")=>n=>{n=e==="end"?Math.min(n,.999):Math.max(n,.001);const i=n*t,o=e==="end"?Math.floor(i):Math.ceil(i);return poe(0,1,o/t)},im=1.70158,vp=im*1.525,hX=im+1,AX=2*Math.PI/3,pX=2*Math.PI/4.5,Gp=t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,Voe={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>t===0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t===1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>hX*t*t*t-im*t*t,easeOutBack:t=>1+hX*Math.pow(t-1,3)+im*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*((vp+1)*2*t-vp)/2:(Math.pow(2*t-2,2)*((vp+1)*(t*2-2)+vp)+2)/2,easeInElastic:t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*AX),easeOutElastic:t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*AX)+1,easeInOutElastic:t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*pX))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*pX)/2+1,easeInBounce:t=>1-Gp(1-t),easeOutBounce:Gp,easeInOutBounce:t=>t<.5?(1-Gp(1-2*t))/2:(1+Gp(2*t-1))/2,steps:xoe},Wd=Symbol.for("FluidValue.get"),zI=Symbol.for("FluidValue.observers"),As=t=>!!(t&&t[Wd]),or=t=>t&&t[Wd]?t[Wd]():t,fX=t=>t[zI]||null;function Xoe(t,e){t.eventObserved?t.eventObserved(e):t(e)}function om(t,e){const n=t[zI];n&&n.forEach(i=>{Xoe(i,e)})}var Noe=class{constructor(t){if(!t&&!(t=this.get))throw Error("Unknown getter");Yoe(this,t)}},Yoe=(t,e)=>KK(t,Wd,e);function uh(t,e){if(t[Wd]){let n=t[zI];n||KK(t,zI,n=new Set),n.has(e)||(n.add(e),t.observerAdded&&t.observerAdded(n.size,e))}return e}function rm(t,e){const n=t[zI];if(n&&n.has(e)){const i=n.size-1;i?n.delete(e):t[zI]=null,t.observerRemoved&&t.observerRemoved(i,e)}}var KK=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),nf=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Moe=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,mX=new RegExp(`(${nf.source})(%|[a-z]+)`,"i"),Hoe=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,f0=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,zK=t=>{const[e,n]=Foe(t);if(!e||Vw())return t;const i=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(i)return i.trim();if(n&&n.startsWith("--")){const o=window.getComputedStyle(document.documentElement).getPropertyValue(n);return o||t}else{if(n&&f0.test(n))return zK(n);if(n)return n}return t},Foe=t=>{const e=f0.exec(t);if(!e)return[,];const[,n,i]=e;return[n,i]},Iv,Koe=(t,e,n,i,o)=>`rgba(${Math.round(e)}, ${Math.round(n)}, ${Math.round(i)}, ${o})`,LK=t=>{Iv||(Iv=cl?new RegExp(`(${Object.keys(cl).join("|")})(?!\\w)`,"g"):/^\b$/);const e=t.output.map(r=>or(r).replace(f0,zK).replace(Moe,dX).replace(Iv,dX)),n=e.map(r=>r.match(nf).map(Number)),o=n[0].map((r,s)=>n.map(a=>{if(!(s in a))throw Error('The arity of each "output" value must be equal');return a[s]})).map(r=>Rd({...t,output:r}));return r=>{var l;const s=!mX.test(e[0])&&((l=e.find(g=>mX.test(g)))==null?void 0:l.replace(nf,""));let a=0;return e[0].replace(nf,()=>`${o[a++](r)}${s||""}`).replace(Hoe,Koe)}},Yw="react-spring: ",EK=t=>{const e=t;let n=!1;if(typeof e!="function")throw new TypeError(`${Yw}once requires a function parameter`);return(...i)=>{n||(e(...i),n=!0)}},zoe=EK(console.warn);function Loe(){zoe(`${Yw}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var Eoe=EK(console.warn);function koe(){Eoe(`${Yw}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function m0(t){return De.str(t)&&(t[0]=="#"||/\d/.test(t)||!Vw()&&f0.test(t)||t in(cl||{}))}var Mw=Vw()?x.useEffect:x.useLayoutEffect,Toe=()=>{const t=x.useRef(!1);return Mw(()=>(t.current=!0,()=>{t.current=!1}),[]),t};function kK(){const t=x.useState()[1],e=Toe();return()=>{e.current&&t(Math.random())}}function _oe(t,e){const[n]=x.useState(()=>({inputs:e,result:t()})),i=x.useRef(),o=i.current;let r=o;return r?e&&r.inputs&&Uoe(e,r.inputs)||(r={inputs:e,result:t()}):r=n,x.useEffect(()=>{i.current=r,o==n&&(n.inputs=n.result=void 0)},[r]),r.result}function Uoe(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}var TK=t=>x.useEffect(t,Poe),Poe=[];function bX(t){const e=x.useRef();return x.useEffect(()=>{e.current=t}),e.current}var xd=Symbol.for("Animated:node"),Doe=t=>!!t&&t[xd]===t,ds=t=>t&&t[xd],Hw=(t,e)=>Coe(t,xd,e),b0=t=>t&&t[xd]&&t[xd].getPayload(),_K=class{constructor(){Hw(this,this)}getPayload(){return this.payload||[]}},Ch=class extends _K{constructor(t){super(),this._value=t,this.done=!0,this.durationProgress=0,De.num(this._value)&&(this.lastPosition=this._value)}static create(t){return new Ch(t)}getPayload(){return[this]}getValue(){return this._value}setValue(t,e){return De.num(t)&&(this.lastPosition=t,e&&(t=Math.round(t/e)*e,this.done&&(this.lastPosition=t))),this._value===t?!1:(this._value=t,!0)}reset(){const{done:t}=this;this.done=!1,De.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,t&&(this.lastVelocity=null),this.v0=null)}},Vd=class extends Ch{constructor(t){super(0),this._string=null,this._toString=Rd({output:[t,t]})}static create(t){return new Vd(t)}getValue(){const t=this._string;return t??(this._string=this._toString(this._value))}setValue(t){if(De.str(t)){if(t==this._string)return!1;this._string=t,this._value=1}else if(super.setValue(t))this._string=null;else return!1;return!0}reset(t){t&&(this._toString=Rd({output:[this.getValue(),t]})),this._value=0,super.reset()}},sm={dependencies:null},Fw=class extends _K{constructor(t){super(),this.source=t,this.setValue(t)}getValue(t){const e={};return fa(this.source,(n,i)=>{Doe(n)?e[i]=n.getValue(t):As(n)?e[i]=or(n):t||(e[i]=n)}),e}setValue(t){this.source=t,this.payload=this._makePayload(t)}reset(){this.payload&&gn(this.payload,t=>t.reset())}_makePayload(t){if(t){const e=new Set;return fa(t,this._addToPayload,e),Array.from(e)}}_addToPayload(t){sm.dependencies&&As(t)&&sm.dependencies.add(t);const e=b0(t);e&&gn(e,n=>this.add(n))}},UK=class extends Fw{constructor(t){super(t)}static create(t){return new UK(t)}getValue(){return this.source.map(t=>t.getValue())}setValue(t){const e=this.getPayload();return t.length==e.length?e.map((n,i)=>n.setValue(t[i])).some(Boolean):(super.setValue(t.map(Joe)),!0)}};function Joe(t){return(m0(t)?Vd:Ch).create(t)}function EB(t){const e=ds(t);return e?e.constructor:De.arr(t)?UK:m0(t)?Vd:Ch}var yX=(t,e)=>{const n=!De.fun(t)||t.prototype&&t.prototype.isReactComponent;return x.forwardRef((i,o)=>{const r=x.useRef(null),s=n&&x.useCallback(p=>{r.current=joe(o,p)},[o]),[a,l]=Qoe(i,e),g=kK(),c=()=>{const p=r.current;if(n&&!p)return;(p?e.applyAnimatedValues(p,a.getValue(!0)):!1)===!1&&g()},C=new Ooe(c,l),d=x.useRef();Mw(()=>(d.current=C,gn(l,p=>uh(p,C)),()=>{d.current&&(gn(d.current.deps,p=>rm(p,d.current)),Nt.cancel(d.current.update))})),x.useEffect(c,[]),TK(()=>()=>{const p=d.current;gn(p.deps,v=>rm(v,p))});const h=e.getComponentProps(a.getValue());return x.createElement(t,{...h,ref:s})})},Ooe=class{constructor(t,e){this.update=t,this.deps=e}eventObserved(t){t.type=="change"&&Nt.write(this.update)}};function Qoe(t,e){const n=new Set;return sm.dependencies=n,t.style&&(t={...t,style:e.createAnimatedStyle(t.style)}),t=new Fw(t),sm.dependencies=null,[t,n]}function joe(t,e){return t&&(De.fun(t)?t(e):t.current=e),e}var vX=Symbol.for("AnimatedComponent"),qoe=(t,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:n=o=>new Fw(o),getComponentProps:i=o=>o}={})=>{const o={applyAnimatedValues:e,createAnimatedStyle:n,getComponentProps:i},r=s=>{const a=GX(s)||"Anonymous";return De.str(s)?s=r[s]||(r[s]=yX(s,o)):s=s[vX]||(s[vX]=yX(s,o)),s.displayName=`Animated(${a})`,s};return fa(t,(s,a)=>{De.arr(t)&&(a=GX(s)),r[a]=r(s)}),{animated:r}},GX=t=>De.str(t)?t:t&&De.str(t.displayName)?t.displayName:De.fun(t)&&t.name||null;function tg(t,...e){return De.fun(t)?t(...e):t}var KC=(t,e)=>t===!0||!!(e&&t&&(De.fun(t)?t(e):ur(t).includes(e))),PK=(t,e)=>De.obj(t)?e&&t[e]:t,DK=(t,e)=>t.default===!0?t[e]:t.default?t.default[e]:void 0,$oe=t=>t,Kw=(t,e=$oe)=>{let n=ere;t.default&&t.default!==!0&&(t=t.default,n=Object.keys(t));const i={};for(const o of n){const r=e(t[o],o);De.und(r)||(i[o]=r)}return i},ere=["config","onProps","onStart","onChange","onPause","onResume","onRest"],tre={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function nre(t){const e={};let n=0;if(fa(t,(i,o)=>{tre[o]||(e[o]=i,n++)}),n)return e}function JK(t){const e=nre(t);if(e){const n={to:e};return fa(t,(i,o)=>o in e||(n[o]=i)),n}return{...t}}function Xd(t){return t=or(t),De.arr(t)?t.map(Xd):m0(t)?Pr.createStringInterpolator({range:[0,1],output:[t,t]})(1):t}function ire(t){for(const e in t)return!0;return!1}function kB(t){return De.fun(t)||De.arr(t)&&De.obj(t[0])}function ore(t,e){var n;(n=t.ref)==null||n.delete(t),e==null||e.delete(t)}function rre(t,e){var n;e&&t.ref!==e&&((n=t.ref)==null||n.delete(t),e.add(t),t.ref=e)}var OK={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},TB={...OK.default,mass:1,damping:1,easing:Voe.linear,clamp:!1},sre=class{constructor(){this.velocity=0,Object.assign(this,TB)}};function are(t,e,n){n&&(n={...n},BX(n,e),e={...n,...e}),BX(t,e),Object.assign(t,e);for(const s in TB)t[s]==null&&(t[s]=TB[s]);let{frequency:i,damping:o}=t;const{mass:r}=t;return De.und(i)||(i<.01&&(i=.01),o<0&&(o=0),t.tension=Math.pow(2*Math.PI/i,2)*r,t.friction=4*Math.PI*o*r/i),t}function BX(t,e){if(!De.und(e.decay))t.duration=void 0;else{const n=!De.und(e.tension)||!De.und(e.friction);(n||!De.und(e.frequency)||!De.und(e.damping)||!De.und(e.mass))&&(t.duration=void 0,t.decay=void 0),n&&(t.frequency=void 0)}}var ZX=[],lre=class{constructor(){this.changed=!1,this.values=ZX,this.toValues=null,this.fromValues=ZX,this.config=new sre,this.immediate=!1}};function QK(t,{key:e,props:n,defaultProps:i,state:o,actions:r}){return new Promise((s,a)=>{let l,g,c=KC(n.cancel??(i==null?void 0:i.cancel),e);if(c)h();else{De.und(n.pause)||(o.paused=KC(n.pause,e));let p=i==null?void 0:i.pause;p!==!0&&(p=o.paused||KC(p,e)),l=tg(n.delay||0,e),p?(o.resumeQueue.add(d),r.pause()):(r.resume(),d())}function C(){o.resumeQueue.add(d),o.timeouts.delete(g),g.cancel(),l=g.time-Nt.now()}function d(){l>0&&!Pr.skipAnimation?(o.delayed=!0,g=Nt.setTimeout(h,l),o.pauseQueue.add(C),o.timeouts.add(g)):h()}function h(){o.delayed&&(o.delayed=!1),o.pauseQueue.delete(C),o.timeouts.delete(g),t<=(o.cancelId||0)&&(c=!0);try{r.start({...n,callId:t,cancel:c},s)}catch(p){a(p)}}})}var zw=(t,e)=>e.length==1?e[0]:e.some(n=>n.cancelled)?pI(t.get()):e.every(n=>n.noop)?jK(t.get()):Hr(t.get(),e.every(n=>n.finished)),jK=t=>({value:t,noop:!0,finished:!0,cancelled:!1}),Hr=(t,e,n=!1)=>({value:t,finished:e,cancelled:n}),pI=t=>({value:t,cancelled:!0,finished:!1});function qK(t,e,n,i){const{callId:o,parentId:r,onRest:s}=e,{asyncTo:a,promise:l}=n;return!r&&t===a&&!e.reset?l:n.promise=(async()=>{n.asyncId=o,n.asyncTo=t;const g=Kw(e,(f,A)=>A==="onRest"?void 0:f);let c,C;const d=new Promise((f,A)=>(c=f,C=A)),h=f=>{const A=o<=(n.cancelId||0)&&pI(i)||o!==n.asyncId&&Hr(i,!1);if(A)throw f.result=A,C(f),f},p=(f,A)=>{const b=new wX,m=new SX;return(async()=>{if(Pr.skipAnimation)throw Nd(n),m.result=Hr(i,!1),C(m),m;h(b);const B=De.obj(f)?{...f}:{...A,to:f};B.parentId=o,fa(g,(w,W)=>{De.und(B[W])&&(B[W]=w)});const Z=await i.start(B);return h(b),n.paused&&await new Promise(w=>{n.resumeQueue.add(w)}),Z})()};let v;if(Pr.skipAnimation)return Nd(n),Hr(i,!1);try{let f;De.arr(t)?f=(async A=>{for(const b of A)await p(b)})(t):f=Promise.resolve(t(p,i.stop.bind(i))),await Promise.all([f.then(c),d]),v=Hr(i.get(),!0,!1)}catch(f){if(f instanceof wX)v=f.result;else if(f instanceof SX)v=f.result;else throw f}finally{o==n.asyncId&&(n.asyncId=r,n.asyncTo=r?a:void 0,n.promise=r?l:void 0)}return De.fun(s)&&Nt.batchedUpdates(()=>{s(v,i,i.item)}),v})()}function Nd(t,e){HC(t.timeouts,n=>n.cancel()),t.pauseQueue.clear(),t.resumeQueue.clear(),t.asyncId=t.asyncTo=t.promise=void 0,e&&(t.cancelId=e)}var wX=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},SX=class extends Error{constructor(){super("SkipAnimationSignal")}},_B=t=>t instanceof Lw,gre=1,Lw=class extends Noe{constructor(){super(...arguments),this.id=gre++,this._priority=0}get priority(){return this._priority}set priority(t){this._priority!=t&&(this._priority=t,this._onPriorityChange(t))}get(){const t=ds(this);return t&&t.getValue()}to(...t){return Pr.to(this,t)}interpolate(...t){return Loe(),Pr.to(this,t)}toJSON(){return this.get()}observerAdded(t){t==1&&this._attach()}observerRemoved(t){t==0&&this._detach()}_attach(){}_detach(){}_onChange(t,e=!1){om(this,{type:"change",parent:this,value:t,idle:e})}_onPriorityChange(t){this.idle||A0.sort(this),om(this,{type:"priority",parent:this,priority:t})}},Hg=Symbol.for("SpringPhase"),$K=1,UB=2,PB=4,uv=t=>(t[Hg]&$K)>0,Fa=t=>(t[Hg]&UB)>0,Qu=t=>(t[Hg]&PB)>0,RX=(t,e)=>e?t[Hg]|=UB|$K:t[Hg]&=~UB,WX=(t,e)=>e?t[Hg]|=PB:t[Hg]&=~PB,cre=class extends Lw{constructor(t,e){if(super(),this.animation=new lre,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!De.und(t)||!De.und(e)){const n=De.obj(t)?{...t}:{...e,from:t};De.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(Fa(this)||this._state.asyncTo)||Qu(this)}get goal(){return or(this.animation.to)}get velocity(){const t=ds(this);return t instanceof Ch?t.lastVelocity||0:t.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return uv(this)}get isAnimating(){return Fa(this)}get isPaused(){return Qu(this)}get isDelayed(){return this._state.delayed}advance(t){let e=!0,n=!1;const i=this.animation;let{toValues:o}=i;const{config:r}=i,s=b0(i.to);!s&&As(i.to)&&(o=ur(or(i.to))),i.values.forEach((g,c)=>{if(g.done)return;const C=g.constructor==Vd?1:s?s[c].lastPosition:o[c];let d=i.immediate,h=C;if(!d){if(h=g.lastPosition,r.tension<=0){g.done=!0;return}let p=g.elapsedTime+=t;const v=i.fromValues[c],f=g.v0!=null?g.v0:g.v0=De.arr(r.velocity)?r.velocity[c]:r.velocity;let A;const b=r.precision||(v==C?.005:Math.min(1,Math.abs(C-v)*.001));if(De.und(r.duration))if(r.decay){const m=r.decay===!0?.998:r.decay,B=Math.exp(-(1-m)*p);h=v+f/(1-m)*(1-B),d=Math.abs(g.lastPosition-h)<=b,A=f*B}else{A=g.lastVelocity==null?f:g.lastVelocity;const m=r.restVelocity||b/10,B=r.clamp?0:r.bounce,Z=!De.und(B),w=v==C?g.v0>0:v<C;let W,X=!1;const V=1,Y=Math.ceil(t/V);for(let z=0;z<Y&&(W=Math.abs(A)>m,!(!W&&(d=Math.abs(C-h)<=b,d)));++z){Z&&(X=h==C||h>C==w,X&&(A=-A*B,h=C));const q=-r.tension*1e-6*(h-C),O=-r.friction*.001*A,te=(q+O)/r.mass;A=A+te*V,h=h+A*V}}else{let m=1;r.duration>0&&(this._memoizedDuration!==r.duration&&(this._memoizedDuration=r.duration,g.durationProgress>0&&(g.elapsedTime=r.duration*g.durationProgress,p=g.elapsedTime+=t)),m=(r.progress||0)+p/this._memoizedDuration,m=m>1?1:m<0?0:m,g.durationProgress=m),h=v+r.easing(m)*(C-v),A=(h-g.lastPosition)/t,d=m==1}g.lastVelocity=A,Number.isNaN(h)&&(console.warn("Got NaN while animating:",this),d=!0)}s&&!s[c].done&&(d=!1),d?g.done=!0:e=!1,g.setValue(h,r.round)&&(n=!0)});const a=ds(this),l=a.getValue();if(e){const g=or(i.to);(l!==g||n)&&!r.decay?(a.setValue(g),this._onChange(g)):n&&r.decay&&this._onChange(l),this._stop()}else n&&this._onChange(l)}set(t){return Nt.batchedUpdates(()=>{this._stop(),this._focus(t),this._set(t)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(Fa(this)){const{to:t,config:e}=this.animation;Nt.batchedUpdates(()=>{this._onStart(),e.decay||this._set(t,!1),this._stop()})}return this}update(t){return(this.queue||(this.queue=[])).push(t),this}start(t,e){let n;return De.und(t)?(n=this.queue||[],this.queue=[]):n=[De.obj(t)?t:{...e,to:t}],Promise.all(n.map(i=>this._update(i))).then(i=>zw(this,i))}stop(t){const{to:e}=this.animation;return this._focus(this.get()),Nd(this._state,t&&this._lastCallId),Nt.batchedUpdates(()=>this._stop(e,t)),this}reset(){this._update({reset:!0})}eventObserved(t){t.type=="change"?this._start():t.type=="priority"&&(this.priority=t.priority+1)}_prepareNode(t){const e=this.key||"";let{to:n,from:i}=t;n=De.obj(n)?n[e]:n,(n==null||kB(n))&&(n=void 0),i=De.obj(i)?i[e]:i,i==null&&(i=void 0);const o={to:n,from:i};return uv(this)||(t.reverse&&([n,i]=[i,n]),i=or(i),De.und(i)?ds(this)||this._set(n):this._set(i)),o}_update({...t},e){const{key:n,defaultProps:i}=this;t.default&&Object.assign(i,Kw(t,(s,a)=>/^on/.test(a)?PK(s,n):s)),VX(this,t,"onProps"),qu(this,"onProps",t,this);const o=this._prepareNode(t);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const r=this._state;return QK(++this._lastCallId,{key:n,props:t,defaultProps:i,state:r,actions:{pause:()=>{Qu(this)||(WX(this,!0),CC(r.pauseQueue),qu(this,"onPause",Hr(this,ju(this,this.animation.to)),this))},resume:()=>{Qu(this)&&(WX(this,!1),Fa(this)&&this._resume(),CC(r.resumeQueue),qu(this,"onResume",Hr(this,ju(this,this.animation.to)),this))},start:this._merge.bind(this,o)}}).then(s=>{if(t.loop&&s.finished&&!(e&&s.noop)){const a=e9(t);if(a)return this._update(a,!0)}return s})}_merge(t,e,n){if(e.cancel)return this.stop(!0),n(pI(this));const i=!De.und(t.to),o=!De.und(t.from);if(i||o)if(e.callId>this._lastToId)this._lastToId=e.callId;else return n(pI(this));const{key:r,defaultProps:s,animation:a}=this,{to:l,from:g}=a;let{to:c=l,from:C=g}=t;o&&!i&&(!e.default||De.und(c))&&(c=C),e.reverse&&([c,C]=[C,c]);const d=!Os(C,g);d&&(a.from=C),C=or(C);const h=!Os(c,l);h&&this._focus(c);const p=kB(e.to),{config:v}=a,{decay:f,velocity:A}=v;(i||o)&&(v.velocity=0),e.config&&!p&&are(v,tg(e.config,r),e.config!==s.config?tg(s.config,r):void 0);let b=ds(this);if(!b||De.und(c))return n(Hr(this,!0));const m=De.und(e.reset)?o&&!e.default:!De.und(C)&&KC(e.reset,r),B=m?C:this.get(),Z=Xd(c),w=De.num(Z)||De.arr(Z)||m0(Z),W=!p&&(!w||KC(s.immediate||e.immediate,r));if(h){const z=EB(c);if(z!==b.constructor)if(W)b=this._set(Z);else throw Error(`Cannot animate between ${b.constructor.name} and ${z.name}, as the "to" prop suggests`)}const X=b.constructor;let V=As(c),Y=!1;if(!V){const z=m||!uv(this)&&d;(h||z)&&(Y=Os(Xd(B),Z),V=!Y),(!Os(a.immediate,W)&&!W||!Os(v.decay,f)||!Os(v.velocity,A))&&(V=!0)}if(Y&&Fa(this)&&(a.changed&&!m?V=!0:V||this._stop(l)),!p&&((V||As(l))&&(a.values=b.getPayload(),a.toValues=As(c)?null:X==Vd?[1]:ur(Z)),a.immediate!=W&&(a.immediate=W,!W&&!m&&this._set(l)),V)){const{onRest:z}=a;gn(ure,O=>VX(this,e,O));const q=Hr(this,ju(this,l));CC(this._pendingCalls,q),this._pendingCalls.add(n),a.changed&&Nt.batchedUpdates(()=>{var O;a.changed=!m,z==null||z(q,this),m?tg(s.onRest,q):(O=a.onStart)==null||O.call(a,q,this)})}m&&this._set(B),p?n(qK(e.to,e,this._state,this)):V?this._start():Fa(this)&&!h?this._pendingCalls.add(n):n(jK(B))}_focus(t){const e=this.animation;t!==e.to&&(fX(this)&&this._detach(),e.to=t,fX(this)&&this._attach())}_attach(){let t=0;const{to:e}=this.animation;As(e)&&(uh(e,this),_B(e)&&(t=e.priority+1)),this.priority=t}_detach(){const{to:t}=this.animation;As(t)&&rm(t,this)}_set(t,e=!0){const n=or(t);if(!De.und(n)){const i=ds(this);if(!i||!Os(n,i.getValue())){const o=EB(n);!i||i.constructor!=o?Hw(this,o.create(n)):i.setValue(n),i&&Nt.batchedUpdates(()=>{this._onChange(n,e)})}}return ds(this)}_onStart(){const t=this.animation;t.changed||(t.changed=!0,qu(this,"onStart",Hr(this,ju(this,t.to)),this))}_onChange(t,e){e||(this._onStart(),tg(this.animation.onChange,t,this)),tg(this.defaultProps.onChange,t,this),super._onChange(t,e)}_start(){const t=this.animation;ds(this).reset(or(t.to)),t.immediate||(t.fromValues=t.values.map(e=>e.lastPosition)),Fa(this)||(RX(this,!0),Qu(this)||this._resume())}_resume(){Pr.skipAnimation?this.finish():A0.start(this)}_stop(t,e){if(Fa(this)){RX(this,!1);const n=this.animation;gn(n.values,o=>{o.done=!0}),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),om(this,{type:"idle",parent:this});const i=e?pI(this.get()):Hr(this.get(),ju(this,t??n.to));CC(this._pendingCalls,i),n.changed&&(n.changed=!1,qu(this,"onRest",i,this))}}};function ju(t,e){const n=Xd(e),i=Xd(t.get());return Os(i,n)}function e9(t,e=t.loop,n=t.to){const i=tg(e);if(i){const o=i!==!0&&JK(i),r=(o||t).reverse,s=!o||o.reset;return Yd({...t,loop:e,default:!1,pause:void 0,to:!r||kB(n)?n:void 0,from:s?t.from:void 0,reset:s,...o})}}function Yd(t){const{to:e,from:n}=t=JK(t),i=new Set;return De.obj(e)&&xX(e,i),De.obj(n)&&xX(n,i),t.keys=i.size?Array.from(i):null,t}function Ire(t){const e=Yd(t);return De.und(e.default)&&(e.default=Kw(e)),e}function xX(t,e){fa(t,(n,i)=>n!=null&&e.add(i))}var ure=["onStart","onRest","onChange","onPause","onResume"];function VX(t,e,n){t.animation[n]=e[n]!==DK(e,n)?PK(e[n],t.key):void 0}function qu(t,e,...n){var i,o,r,s;(o=(i=t.animation)[e])==null||o.call(i,...n),(s=(r=t.defaultProps)[e])==null||s.call(r,...n)}var Cre=["onStart","onChange","onRest"],dre=1,hre=class{constructor(t,e){this.id=dre++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),e&&(this._flush=e),t&&this.start({default:!0,...t})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(t=>t.idle&&!t.isDelayed&&!t.isPaused)}get item(){return this._item}set item(t){this._item=t}get(){const t={};return this.each((e,n)=>t[n]=e.get()),t}set(t){for(const e in t){const n=t[e];De.und(n)||this.springs[e].set(n)}}update(t){return t&&this.queue.push(Yd(t)),this}start(t){let{queue:e}=this;return t?e=ur(t).map(Yd):this.queue=[],this._flush?this._flush(this,e):(r9(this,e),DB(this,e))}stop(t,e){if(t!==!!t&&(e=t),e){const n=this.springs;gn(ur(e),i=>n[i].stop(!!t))}else Nd(this._state,this._lastAsyncId),this.each(n=>n.stop(!!t));return this}pause(t){if(De.und(t))this.start({pause:!0});else{const e=this.springs;gn(ur(t),n=>e[n].pause())}return this}resume(t){if(De.und(t))this.start({pause:!1});else{const e=this.springs;gn(ur(t),n=>e[n].resume())}return this}each(t){fa(this.springs,t)}_onFrame(){const{onStart:t,onChange:e,onRest:n}=this._events,i=this._active.size>0,o=this._changed.size>0;(i&&!this._started||o&&!this._started)&&(this._started=!0,HC(t,([a,l])=>{l.value=this.get(),a(l,this,this._item)}));const r=!i&&this._started,s=o||r&&n.size?this.get():null;o&&e.size&&HC(e,([a,l])=>{l.value=s,a(l,this,this._item)}),r&&(this._started=!1,HC(n,([a,l])=>{l.value=s,a(l,this,this._item)}))}eventObserved(t){if(t.type=="change")this._changed.add(t.parent),t.idle||this._active.add(t.parent);else if(t.type=="idle")this._active.delete(t.parent);else return;Nt.onFrame(this._onFrame)}};function DB(t,e){return Promise.all(e.map(n=>t9(t,n))).then(n=>zw(t,n))}async function t9(t,e,n){const{keys:i,to:o,from:r,loop:s,onRest:a,onResolve:l}=e,g=De.obj(e.default)&&e.default;s&&(e.loop=!1),o===!1&&(e.to=null),r===!1&&(e.from=null);const c=De.arr(o)||De.fun(o)?o:void 0;c?(e.to=void 0,e.onRest=void 0,g&&(g.onRest=void 0)):gn(Cre,v=>{const f=e[v];if(De.fun(f)){const A=t._events[v];e[v]=({finished:b,cancelled:m})=>{const B=A.get(f);B?(b||(B.finished=!1),m&&(B.cancelled=!0)):A.set(f,{value:null,finished:b||!1,cancelled:m||!1})},g&&(g[v]=e[v])}});const C=t._state;e.pause===!C.paused?(C.paused=e.pause,CC(e.pause?C.pauseQueue:C.resumeQueue)):C.paused&&(e.pause=!0);const d=(i||Object.keys(t.springs)).map(v=>t.springs[v].start(e)),h=e.cancel===!0||DK(e,"cancel")===!0;(c||h&&C.asyncId)&&d.push(QK(++t._lastAsyncId,{props:e,state:C,actions:{pause:zB,resume:zB,start(v,f){h?(Nd(C,t._lastAsyncId),f(pI(t))):(v.onRest=a,f(qK(c,v,C,t)))}}})),C.paused&&await new Promise(v=>{C.resumeQueue.add(v)});const p=zw(t,await Promise.all(d));if(s&&p.finished&&!(n&&p.noop)){const v=e9(e,s,o);if(v)return r9(t,[v]),t9(t,v,!0)}return l&&Nt.batchedUpdates(()=>l(p,t,t.item)),p}function XX(t,e){const n={...t.springs};return e&&gn(ur(e),i=>{De.und(i.keys)&&(i=Yd(i)),De.obj(i.to)||(i={...i,to:void 0}),o9(n,i,o=>i9(o))}),n9(t,n),n}function n9(t,e){fa(e,(n,i)=>{t.springs[i]||(t.springs[i]=n,uh(n,t))})}function i9(t,e){const n=new cre;return n.key=t,e&&uh(n,e),n}function o9(t,e,n){e.keys&&gn(e.keys,i=>{(t[i]||(t[i]=n(i)))._prepareNode(e)})}function r9(t,e){gn(e,n=>{o9(t.springs,n,i=>i9(i,t))})}var y0=({children:t,...e})=>{const n=x.useContext(am),i=e.pause||!!n.pause,o=e.immediate||!!n.immediate;e=_oe(()=>({pause:i,immediate:o}),[i,o]);const{Provider:r}=am;return x.createElement(r,{value:e},t)},am=Are(y0,{});y0.Provider=am.Provider;y0.Consumer=am.Consumer;function Are(t,e){return Object.assign(t,x.createContext(e)),t.Provider._context=t,t.Consumer._context=t,t}var pre=()=>{const t=[],e=function(i){koe();const o=[];return gn(t,(r,s)=>{if(De.und(i))o.push(r.start());else{const a=n(i,r,s);a&&o.push(r.start(a))}}),o};e.current=t,e.add=function(i){t.includes(i)||t.push(i)},e.delete=function(i){const o=t.indexOf(i);~o&&t.splice(o,1)},e.pause=function(){return gn(t,i=>i.pause(...arguments)),this},e.resume=function(){return gn(t,i=>i.resume(...arguments)),this},e.set=function(i){gn(t,(o,r)=>{const s=De.fun(i)?i(r,o):i;s&&o.set(s)})},e.start=function(i){const o=[];return gn(t,(r,s)=>{if(De.und(i))o.push(r.start());else{const a=this._getProps(i,r,s);a&&o.push(r.start(a))}}),o},e.stop=function(){return gn(t,i=>i.stop(...arguments)),this},e.update=function(i){return gn(t,(o,r)=>o.update(this._getProps(i,o,r))),this};const n=function(i,o,r){return De.fun(i)?i(r,o):i};return e._getProps=n,e};function fre(t,e,n){const i=De.fun(e)&&e;i&&!n&&(n=[]);const o=x.useMemo(()=>i||arguments.length==3?pre():void 0,[]),r=x.useRef(0),s=kK(),a=x.useMemo(()=>({ctrls:[],queue:[],flush(A,b){const m=XX(A,b);return r.current>0&&!a.queue.length&&!Object.keys(m).some(Z=>!A.springs[Z])?DB(A,b):new Promise(Z=>{n9(A,m),a.queue.push(()=>{Z(DB(A,b))}),s()})}}),[]),l=x.useRef([...a.ctrls]),g=[],c=bX(t)||0;x.useMemo(()=>{gn(l.current.slice(t,c),A=>{ore(A,o),A.stop(!0)}),l.current.length=t,C(c,t)},[t]),x.useMemo(()=>{C(0,Math.min(c,t))},n);function C(A,b){for(let m=A;m<b;m++){const B=l.current[m]||(l.current[m]=new hre(null,a.flush)),Z=i?i(m,B):e[m];Z&&(g[m]=Ire(Z))}}const d=l.current.map((A,b)=>XX(A,g[b])),h=x.useContext(y0),p=bX(h),v=h!==p&&ire(h);Mw(()=>{r.current++,a.ctrls=l.current;const{queue:A}=a;A.length&&(a.queue=[],gn(A,b=>b())),gn(l.current,(b,m)=>{o==null||o.add(b),v&&b.start({default:h});const B=g[m];B&&(rre(b,B.ref),b.ref?b.queue.push(B):b.start(B))})}),TK(()=>()=>{gn(a.ctrls,A=>A.stop(!0))});const f=d.map(A=>({...A}));return o?[f,o]:f}function mre(t,e){const n=De.fun(t),[[i],o]=fre(1,n?t:[t],n?e||[]:e);return n||arguments.length==2?[i,o]:i}var bre=class extends Lw{constructor(t,e){super(),this.source=t,this.idle=!0,this._active=new Set,this.calc=Rd(...e);const n=this._get(),i=EB(n);Hw(this,i.create(n))}advance(t){const e=this._get(),n=this.get();Os(e,n)||(ds(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&NX(this._active)&&Cv(this)}_get(){const t=De.arr(this.source)?this.source.map(or):ur(or(this.source));return this.calc(...t)}_start(){this.idle&&!NX(this._active)&&(this.idle=!1,gn(b0(this),t=>{t.done=!1}),Pr.skipAnimation?(Nt.batchedUpdates(()=>this.advance()),Cv(this)):A0.start(this))}_attach(){let t=1;gn(ur(this.source),e=>{As(e)&&uh(e,this),_B(e)&&(e.idle||this._active.add(e),t=Math.max(t,e.priority+1))}),this.priority=t,this._start()}_detach(){gn(ur(this.source),t=>{As(t)&&rm(t,this)}),this._active.clear(),Cv(this)}eventObserved(t){t.type=="change"?t.idle?this.advance():(this._active.add(t.parent),this._start()):t.type=="idle"?this._active.delete(t.parent):t.type=="priority"&&(this.priority=ur(this.source).reduce((e,n)=>Math.max(e,(_B(n)?n.priority:0)+1),0))}};function yre(t){return t.idle!==!1}function NX(t){return!t.size||Array.from(t).every(yre)}function Cv(t){t.idle||(t.idle=!0,gn(b0(t),e=>{e.done=!0}),om(t,{type:"idle",parent:t}))}Pr.assign({createStringInterpolator:LK,to:(t,e)=>new bre(t,e)});var vre=["primitive"].concat(Object.keys(X3).filter(t=>/^[A-Z]/.test(t)).map(t=>t[0].toLowerCase()+t.slice(1)));Pr.assign({createStringInterpolator:LK,colors:foe,frameLoop:"demand"});DQ(()=>{Nt.advance()});var Gre=qoe(vre,{applyAnimatedValues:ql}),Bre=Gre.animated;function Zre({tiltFactor:t=.1}){const e=x.useRef(null),n=x.useRef(null),[i,o]=x.useState(!1),r=new kg(0,0,0);x.useEffect(()=>o(!0),[]),Pg(({mouse:a,viewport:l,camera:g})=>{var d,h,p,v,f,A;const c=a.x*l.width*t,C=a.y*l.height*t;(h=(d=e.current)==null?void 0:d.inner)==null||h.geometry.center(),(v=(p=e.current)==null?void 0:p.inner)==null||v.setRotationFromEuler(r.set(C,-c,0,"XYZ")),(A=(f=e.current)==null?void 0:f.wrapper)==null||A.quaternion.copy(g.quaternion)});const{scale:s}=mre({scale:i?1:.5,config:OK.wobbly,delay:2e3});return Pe.jsx(Bre.mesh,{visible:i,scale:s,children:Pe.jsx(goe,{ref:e,innerRef:n,text:"MALLORCA",size:1})})}function wre(){const{islandColorRatio:t,islandScale:e,seaHeight:n,seaFrequency:i,seaSpeed:o,seaTroughColor:r,seaCrestColor:s,seaWaveColorOffset:a,seaWaveFactor:l,seaNoiseFactor:g,seaWaveAmplitude:c,bannerTiltFactor:C}=RK({island:MC({islandColorRatio:{label:"colorRatio",value:.5,min:0,max:1},islandScale:{label:"scale",value:.28,min:.1,max:1}}),sea:MC({seaHeight:{label:"height",value:.02,min:.01,max:1},seaFrequency:{label:"frequency",value:{x:2,y:2},min:0,max:4},seaSpeed:{label:"speed",value:1,min:.1,max:10},seaTroughColor:{label:"wave trough",value:"#8997c3"},seaCrestColor:{label:"wave crest",value:"#81d4de"},seaWaveColorOffset:{label:"color offset",value:1.9,min:-2,max:10},seaWaveFactor:{label:"color factor",value:10,min:1,max:50},seaWaveAmplitude:{label:"noise amplitude",value:.7,min:.1,max:10},seaNoiseFactor:{label:"noise factor",value:.6,min:.1,max:10}}),banner:MC({bannerTiltFactor:{label:"tilt factor",value:.025,min:.01,max:1}})});return Pe.jsxs(JH,{children:[Pe.jsx("ambientLight",{intensity:.35}),Pe.jsx("directionalLight",{intensity:2,color:"#ffcc33",position:[100,-30,-10],castShadow:!0}),Pe.jsxs(x.Suspense,{fallback:Pe.jsx(Pe.Fragment,{children:"loading"}),children:[Pe.jsx(o7,{}),Pe.jsx(n7,{background:!1,preset:"sunset"}),Pe.jsx(Jj,{makeDefault:!0,position:[20,10,10]}),Pe.jsx(aoe,{height:n,frequency:i,speed:o,troughColor:r,crestColor:s,waveColorOffset:a,waveFactor:l,waveAmplitude:c,noiseFactor:g}),Pe.jsx(G8,{islandScale:e,islandColorRatio:t})]}),Pe.jsx(x.Suspense,{children:Pe.jsx(Zre,{tiltFactor:C})}),Pe.jsx(A8,{}),Pe.jsx(vH,{})]})}var Ew={exports:{}},fI=typeof Reflect=="object"?Reflect:null,YX=fI&&typeof fI.apply=="function"?fI.apply:function(e,n,i){return Function.prototype.apply.call(e,n,i)},of;fI&&typeof fI.ownKeys=="function"?of=fI.ownKeys:Object.getOwnPropertySymbols?of=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:of=function(e){return Object.getOwnPropertyNames(e)};function Sre(t){console&&console.warn&&console.warn(t)}var s9=Number.isNaN||function(e){return e!==e};function fn(){fn.init.call(this)}Ew.exports=fn;Ew.exports.once=Vre;fn.EventEmitter=fn;fn.prototype._events=void 0;fn.prototype._eventsCount=0;fn.prototype._maxListeners=void 0;var MX=10;function v0(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(fn,"defaultMaxListeners",{enumerable:!0,get:function(){return MX},set:function(t){if(typeof t!="number"||t<0||s9(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");MX=t}});fn.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};fn.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||s9(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function a9(t){return t._maxListeners===void 0?fn.defaultMaxListeners:t._maxListeners}fn.prototype.getMaxListeners=function(){return a9(this)};fn.prototype.emit=function(e){for(var n=[],i=1;i<arguments.length;i++)n.push(arguments[i]);var o=e==="error",r=this._events;if(r!==void 0)o=o&&r.error===void 0;else if(!o)return!1;if(o){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=r[e];if(l===void 0)return!1;if(typeof l=="function")YX(l,this,n);else for(var g=l.length,c=u9(l,g),i=0;i<g;++i)YX(c[i],this,n);return!0};function l9(t,e,n,i){var o,r,s;if(v0(n),r=t._events,r===void 0?(r=t._events=Object.create(null),t._eventsCount=0):(r.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),r=t._events),s=r[e]),s===void 0)s=r[e]=n,++t._eventsCount;else if(typeof s=="function"?s=r[e]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),o=a9(t),o>0&&s.length>o&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,Sre(a)}return t}fn.prototype.addListener=function(e,n){return l9(this,e,n,!1)};fn.prototype.on=fn.prototype.addListener;fn.prototype.prependListener=function(e,n){return l9(this,e,n,!0)};function Rre(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g9(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=Rre.bind(i);return o.listener=n,i.wrapFn=o,o}fn.prototype.once=function(e,n){return v0(n),this.on(e,g9(this,e,n)),this};fn.prototype.prependOnceListener=function(e,n){return v0(n),this.prependListener(e,g9(this,e,n)),this};fn.prototype.removeListener=function(e,n){var i,o,r,s,a;if(v0(n),o=this._events,o===void 0)return this;if(i=o[e],i===void 0)return this;if(i===n||i.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,i.listener||n));else if(typeof i!="function"){for(r=-1,s=i.length-1;s>=0;s--)if(i[s]===n||i[s].listener===n){a=i[s].listener,r=s;break}if(r<0)return this;r===0?i.shift():Wre(i,r),i.length===1&&(o[e]=i[0]),o.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};fn.prototype.off=fn.prototype.removeListener;fn.prototype.removeAllListeners=function(e){var n,i,o;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var r=Object.keys(i),s;for(o=0;o<r.length;++o)s=r[o],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=i[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(o=n.length-1;o>=0;o--)this.removeListener(e,n[o]);return this};function c9(t,e,n){var i=t._events;if(i===void 0)return[];var o=i[e];return o===void 0?[]:typeof o=="function"?n?[o.listener||o]:[o]:n?xre(o):u9(o,o.length)}fn.prototype.listeners=function(e){return c9(this,e,!0)};fn.prototype.rawListeners=function(e){return c9(this,e,!1)};fn.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):I9.call(t,e)};fn.prototype.listenerCount=I9;function I9(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}fn.prototype.eventNames=function(){return this._eventsCount>0?of(this._events):[]};function u9(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function Wre(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function xre(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function Vre(t,e){return new Promise(function(n,i){function o(s){t.removeListener(e,r),i(s)}function r(){typeof t.removeListener=="function"&&t.removeListener("error",o),n([].slice.call(arguments))}C9(t,e,r,{once:!0}),e!=="error"&&Xre(t,o,{once:!0})})}function Xre(t,e,n){typeof t.on=="function"&&C9(t,"error",e,n)}function C9(t,e,n,i){if(typeof t.on=="function")i.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function o(r){i.once&&t.removeEventListener(e,o),n(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Nre=Ew.exports;function Yre(t,e){var n=atob(t);if(e){for(var i=new Uint8Array(n.length),o=0,r=n.length;o<r;++o)i[o]=n.charCodeAt(o);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return n}function Mre(t,e,n){var i=e===void 0?null:e,o=n===void 0?!1:n,r=Yre(t,o),s=r.indexOf(`
`,10)+1,a=r.substring(s)+(i?"//# sourceMappingURL="+i:""),l=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(l)}function Hre(t,e,n){var i;return function(r){return i=i||Mre(t,e,n),new Worker(i,r)}}var Fre=Hre("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK",null,!1);class Kre extends Nre{constructor(n){let{allowSleep:i=!1,axisIndex:o=0,broadphase:r="Naive",defaultContactMaterial:s={contactEquationStiffness:1e6},frictionGravity:a=null,gravity:l=[0,-9.81,0],iterations:g=5,quatNormalizeFast:c=!1,quatNormalizeSkip:C=0,size:d=1e3,solver:h="GS",tolerance:p=.001}=n;super();Sb(this,"messageQueue",[]);Sb(this,"worker",null);this.config={allowSleep:i,axisIndex:o,broadphase:r,defaultContactMaterial:s,frictionGravity:a,gravity:l,iterations:g,quatNormalizeFast:c,quatNormalizeSkip:C,size:d,solver:h,tolerance:p},this.buffers={positions:new Float32Array(d*3),quaternions:new Float32Array(d*4)}}get axisIndex(){return this.config.axisIndex}set axisIndex(n){this.config.axisIndex=n,this.postMessage({op:"setAxisIndex",props:n})}get broadphase(){return this.config.broadphase}set broadphase(n){this.config.broadphase=n,this.postMessage({op:"setBroadphase",props:n})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(n){this.config.frictionGravity=n,this.postMessage({op:"setFrictionGravity",props:n})}get gravity(){return this.config.gravity}set gravity(n){this.config.gravity=n,this.postMessage({op:"setGravity",props:n})}get iterations(){return this.config.iterations}set iterations(n){this.config.iterations=n,this.postMessage({op:"setIterations",props:n})}get tolerance(){return this.config.tolerance}set tolerance(n){this.config.tolerance=n,this.postMessage({op:"setTolerance",props:n})}addBodies(n){let{props:i,type:o,uuid:r}=n;this.postMessage({op:"addBodies",props:i,type:o,uuid:r})}addConstraint(n){let{props:[i,o,r],type:s,uuid:a}=n;this.postMessage({op:"addConstraint",props:[i,o,r],type:s,uuid:a})}addContactMaterial(n){let{props:i,uuid:o}=n;this.postMessage({op:"addContactMaterial",props:i,uuid:o})}addRay(n){let{props:i,uuid:o}=n;this.postMessage({op:"addRay",props:i,uuid:o})}addRaycastVehicle(n){let{props:[i,o,r,s,a,l],uuid:g}=n;this.postMessage({op:"addRaycastVehicle",props:[i,o,r,s,a,l],uuid:g})}addSpring(n){let{props:[i,o,r],uuid:s}=n;this.postMessage({op:"addSpring",props:[i,o,r],uuid:s})}applyForce(n){let{props:i,uuid:o}=n;this.postMessage({op:"applyForce",props:i,uuid:o})}applyImpulse(n){let{props:i,uuid:o}=n;this.postMessage({op:"applyImpulse",props:i,uuid:o})}applyLocalForce(n){let{props:i,uuid:o}=n;this.postMessage({op:"applyLocalForce",props:i,uuid:o})}applyLocalImpulse(n){let{props:i,uuid:o}=n;this.postMessage({op:"applyLocalImpulse",props:i,uuid:o})}applyRaycastVehicleEngineForce(n){let{props:i,uuid:o}=n;this.postMessage({op:"applyRaycastVehicleEngineForce",props:i,uuid:o})}applyTorque(n){let{props:i,uuid:o}=n;this.postMessage({op:"applyTorque",props:i,uuid:o})}connect(){this.worker=new Fre,this.worker.onmessage=n=>{if(n.data.op==="frame"){this.buffers.positions=n.data.positions,this.buffers.quaternions=n.data.quaternions,this.emit(n.data.op,n.data);return}this.emit(n.data.type,n.data)};for(const n of this.messageQueue)this.worker.postMessage(n);this.messageQueue.length=0}disableConstraint(n){let{uuid:i}=n;this.postMessage({op:"disableConstraint",uuid:i})}disableConstraintMotor(n){let{uuid:i}=n;this.postMessage({op:"disableConstraintMotor",uuid:i})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(n){let{uuid:i}=n;this.postMessage({op:"enableConstraint",uuid:i})}enableConstraintMotor(n){let{uuid:i}=n;this.postMessage({op:"enableConstraintMotor",uuid:i})}init(){const{allowSleep:n,axisIndex:i,broadphase:o,defaultContactMaterial:r,frictionGravity:s,gravity:a,iterations:l,quatNormalizeFast:g,quatNormalizeSkip:c,solver:C,tolerance:d}=this.config;this.postMessage({op:"init",props:{allowSleep:n,axisIndex:i,broadphase:o,defaultContactMaterial:r,frictionGravity:s,gravity:a,iterations:l,quatNormalizeFast:g,quatNormalizeSkip:c,solver:C,tolerance:d}})}removeBodies(n){let{uuid:i}=n;this.postMessage({op:"removeBodies",uuid:i})}removeConstraint(n){let{uuid:i}=n;this.postMessage({op:"removeConstraint",uuid:i})}removeContactMaterial(n){let{uuid:i}=n;this.postMessage({op:"removeContactMaterial",uuid:i})}removeRay(n){let{uuid:i}=n;this.postMessage({op:"removeRay",uuid:i})}removeRaycastVehicle(n){let{uuid:i}=n;this.postMessage({op:"removeRaycastVehicle",uuid:i})}removeSpring(n){let{uuid:i}=n;this.postMessage({op:"removeSpring",uuid:i})}setAllowSleep(n){let{props:i,uuid:o}=n;this.postMessage({op:"setAllowSleep",props:i,uuid:o})}setAngularDamping(n){let{props:i,uuid:o}=n;this.postMessage({op:"setAngularDamping",props:i,uuid:o})}setAngularFactor(n){let{props:i,uuid:o}=n;this.postMessage({op:"setAngularFactor",props:i,uuid:o})}setAngularVelocity(n){let{props:i,uuid:o}=n;this.postMessage({op:"setAngularVelocity",props:i,uuid:o})}setCollisionFilterGroup(n){let{props:i,uuid:o}=n;this.postMessage({op:"setCollisionFilterGroup",props:i,uuid:o})}setCollisionFilterMask(n){let{props:i,uuid:o}=n;this.postMessage({op:"setCollisionFilterMask",props:i,uuid:o})}setCollisionResponse(n){let{props:i,uuid:o}=n;this.postMessage({op:"setCollisionResponse",props:i,uuid:o})}setConstraintMotorMaxForce(n){let{props:i,uuid:o}=n;this.postMessage({op:"setConstraintMotorMaxForce",props:i,uuid:o})}setConstraintMotorSpeed(n){let{props:i,uuid:o}=n;this.postMessage({op:"setConstraintMotorSpeed",props:i,uuid:o})}setFixedRotation(n){let{props:i,uuid:o}=n;this.postMessage({op:"setFixedRotation",props:i,uuid:o})}setIsTrigger(n){let{props:i,uuid:o}=n;this.postMessage({op:"setIsTrigger",props:i,uuid:o})}setLinearDamping(n){let{props:i,uuid:o}=n;this.postMessage({op:"setLinearDamping",props:i,uuid:o})}setLinearFactor(n){let{props:i,uuid:o}=n;this.postMessage({op:"setLinearFactor",props:i,uuid:o})}setMass(n){let{props:i,uuid:o}=n;this.postMessage({op:"setMass",props:i,uuid:o})}setMaterial(n){let{props:i,uuid:o}=n;this.postMessage({op:"setMaterial",props:i,uuid:o})}setPosition(n){let{props:i,uuid:o}=n;this.postMessage({op:"setPosition",props:i,uuid:o})}setQuaternion(n){let{props:[i,o,r,s],uuid:a}=n;this.postMessage({op:"setQuaternion",props:[i,o,r,s],uuid:a})}setRaycastVehicleBrake(n){let{props:i,uuid:o}=n;this.postMessage({op:"setRaycastVehicleBrake",props:i,uuid:o})}setRaycastVehicleSteeringValue(n){let{props:i,uuid:o}=n;this.postMessage({op:"setRaycastVehicleSteeringValue",props:i,uuid:o})}setRotation(n){let{props:i,uuid:o}=n;this.postMessage({op:"setRotation",props:i,uuid:o})}setSleepSpeedLimit(n){let{props:i,uuid:o}=n;this.postMessage({op:"setSleepSpeedLimit",props:i,uuid:o})}setSleepTimeLimit(n){let{props:i,uuid:o}=n;this.postMessage({op:"setSleepTimeLimit",props:i,uuid:o})}setSpringDamping(n){let{props:i,uuid:o}=n;this.postMessage({op:"setSpringDamping",props:i,uuid:o})}setSpringRestLength(n){let{props:i,uuid:o}=n;this.postMessage({op:"setSpringRestLength",props:i,uuid:o})}setSpringStiffness(n){let{props:i,uuid:o}=n;this.postMessage({op:"setSpringStiffness",props:i,uuid:o})}setUserData(n){let{props:i,uuid:o}=n;this.postMessage({op:"setUserData",props:i,uuid:o})}setVelocity(n){let{props:i,uuid:o}=n;this.postMessage({op:"setVelocity",props:i,uuid:o})}sleep(n){let{uuid:i}=n;this.postMessage({op:"sleep",uuid:i})}step(n){var i;const{buffers:{positions:o,quaternions:r}}=this;!o.byteLength&&!r.byteLength||(i=this.worker)==null||i.postMessage({op:"step",positions:o,props:n,quaternions:r},[o.buffer,r.buffer])}subscribe(n){let{props:{id:i,target:o,type:r},uuid:s}=n;this.postMessage({op:"subscribe",props:{id:i,target:o,type:r},uuid:s})}terminate(){var n;(n=this.worker)==null||n.terminate(),this.worker=null}unsubscribe(n){let{props:i}=n;this.postMessage({op:"unsubscribe",props:i})}wakeUp(n){let{uuid:i}=n;this.postMessage({op:"wakeUp",uuid:i})}postMessage(n){if(this.worker)return this.worker.postMessage(n);this.messageQueue.push(n)}}class oa{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const n=this.elements;n[0]=e.x,n[4]=e.y,n[8]=e.z}getTrace(e){e===void 0&&(e=new U);const n=this.elements;return e.x=n[0],e.y=n[4],e.z=n[8],e}vmult(e,n){n===void 0&&(n=new U);const i=this.elements,o=e.x,r=e.y,s=e.z;return n.x=i[0]*o+i[1]*r+i[2]*s,n.y=i[3]*o+i[4]*r+i[5]*s,n.z=i[6]*o+i[7]*r+i[8]*s,n}smult(e){for(let n=0;n<this.elements.length;n++)this.elements[n]*=e}mmult(e,n){n===void 0&&(n=new oa);const i=this.elements,o=e.elements,r=n.elements,s=i[0],a=i[1],l=i[2],g=i[3],c=i[4],C=i[5],d=i[6],h=i[7],p=i[8],v=o[0],f=o[1],A=o[2],b=o[3],m=o[4],B=o[5],Z=o[6],w=o[7],W=o[8];return r[0]=s*v+a*b+l*Z,r[1]=s*f+a*m+l*w,r[2]=s*A+a*B+l*W,r[3]=g*v+c*b+C*Z,r[4]=g*f+c*m+C*w,r[5]=g*A+c*B+C*W,r[6]=d*v+h*b+p*Z,r[7]=d*f+h*m+p*w,r[8]=d*A+h*B+p*W,n}scale(e,n){n===void 0&&(n=new oa);const i=this.elements,o=n.elements;for(let r=0;r!==3;r++)o[3*r+0]=e.x*i[3*r+0],o[3*r+1]=e.y*i[3*r+1],o[3*r+2]=e.z*i[3*r+2];return n}solve(e,n){n===void 0&&(n=new U);const i=3,o=4,r=[];let s,a;for(s=0;s<i*o;s++)r.push(0);for(s=0;s<3;s++)for(a=0;a<3;a++)r[s+o*a]=this.elements[s+3*a];r[3+4*0]=e.x,r[3+4*1]=e.y,r[3+4*2]=e.z;let l=3;const g=l;let c;const C=4;let d;do{if(s=g-l,r[s+o*s]===0){for(a=s+1;a<g;a++)if(r[s+o*a]!==0){c=C;do d=C-c,r[d+o*s]+=r[d+o*a];while(--c);break}}if(r[s+o*s]!==0)for(a=s+1;a<g;a++){const h=r[s+o*a]/r[s+o*s];c=C;do d=C-c,r[d+o*a]=d<=s?0:r[d+o*a]-r[d+o*s]*h;while(--c)}}while(--l);if(n.z=r[2*o+3]/r[2*o+2],n.y=(r[1*o+3]-r[1*o+2]*n.z)/r[1*o+1],n.x=(r[0*o+3]-r[0*o+2]*n.z-r[0*o+1]*n.y)/r[0*o+0],isNaN(n.x)||isNaN(n.y)||isNaN(n.z)||n.x===1/0||n.y===1/0||n.z===1/0)throw`Could not solve equation! Got x=[${n.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return n}e(e,n,i){if(i===void 0)return this.elements[n+3*e];this.elements[n+3*e]=i}copy(e){for(let n=0;n<e.elements.length;n++)this.elements[n]=e.elements[n];return this}toString(){let e="";const n=",";for(let i=0;i<9;i++)e+=this.elements[i]+n;return e}reverse(e){e===void 0&&(e=new oa);const n=3,i=6,o=zre;let r,s;for(r=0;r<3;r++)for(s=0;s<3;s++)o[r+i*s]=this.elements[r+3*s];o[3+6*0]=1,o[3+6*1]=0,o[3+6*2]=0,o[4+6*0]=0,o[4+6*1]=1,o[4+6*2]=0,o[5+6*0]=0,o[5+6*1]=0,o[5+6*2]=1;let a=3;const l=a;let g;const c=i;let C;do{if(r=l-a,o[r+i*r]===0){for(s=r+1;s<l;s++)if(o[r+i*s]!==0){g=c;do C=c-g,o[C+i*r]+=o[C+i*s];while(--g);break}}if(o[r+i*r]!==0)for(s=r+1;s<l;s++){const d=o[r+i*s]/o[r+i*r];g=c;do C=c-g,o[C+i*s]=C<=r?0:o[C+i*s]-o[C+i*r]*d;while(--g)}}while(--a);r=2;do{s=r-1;do{const d=o[r+i*s]/o[r+i*r];g=i;do C=i-g,o[C+i*s]=o[C+i*s]-o[C+i*r]*d;while(--g)}while(s--)}while(--r);r=2;do{const d=1/o[r+i*r];g=i;do C=i-g,o[C+i*r]=o[C+i*r]*d;while(--g)}while(r--);r=2;do{s=2;do{if(C=o[n+s+i*r],isNaN(C)||C===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(r,s,C)}while(s--)}while(r--);return e}setRotationFromQuaternion(e){const n=e.x,i=e.y,o=e.z,r=e.w,s=n+n,a=i+i,l=o+o,g=n*s,c=n*a,C=n*l,d=i*a,h=i*l,p=o*l,v=r*s,f=r*a,A=r*l,b=this.elements;return b[3*0+0]=1-(d+p),b[3*0+1]=c-A,b[3*0+2]=C+f,b[3*1+0]=c+A,b[3*1+1]=1-(g+p),b[3*1+2]=h-v,b[3*2+0]=C-f,b[3*2+1]=h+v,b[3*2+2]=1-(g+d),this}transpose(e){e===void 0&&(e=new oa);const n=this.elements,i=e.elements;let o;return i[0]=n[0],i[4]=n[4],i[8]=n[8],o=n[1],i[1]=n[3],i[3]=o,o=n[2],i[2]=n[6],i[6]=o,o=n[5],i[5]=n[7],i[7]=o,e}}const zre=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class U{constructor(e,n,i){e===void 0&&(e=0),n===void 0&&(n=0),i===void 0&&(i=0),this.x=e,this.y=n,this.z=i}cross(e,n){n===void 0&&(n=new U);const i=e.x,o=e.y,r=e.z,s=this.x,a=this.y,l=this.z;return n.x=a*r-l*o,n.y=l*i-s*r,n.z=s*o-a*i,n}set(e,n,i){return this.x=e,this.y=n,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,n){if(n)n.x=e.x+this.x,n.y=e.y+this.y,n.z=e.z+this.z;else return new U(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,n){if(n)n.x=this.x-e.x,n.y=this.y-e.y,n.z=this.z-e.z;else return new U(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new oa([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,n=this.y,i=this.z,o=Math.sqrt(e*e+n*n+i*i);if(o>0){const r=1/o;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return o}unit(e){e===void 0&&(e=new U);const n=this.x,i=this.y,o=this.z;let r=Math.sqrt(n*n+i*i+o*o);return r>0?(r=1/r,e.x=n*r,e.y=i*r,e.z=o*r):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,n=this.y,i=this.z;return Math.sqrt(e*e+n*n+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){const n=this.x,i=this.y,o=this.z,r=e.x,s=e.y,a=e.z;return Math.sqrt((r-n)*(r-n)+(s-i)*(s-i)+(a-o)*(a-o))}distanceSquared(e){const n=this.x,i=this.y,o=this.z,r=e.x,s=e.y,a=e.z;return(r-n)*(r-n)+(s-i)*(s-i)+(a-o)*(a-o)}scale(e,n){n===void 0&&(n=new U);const i=this.x,o=this.y,r=this.z;return n.x=e*i,n.y=e*o,n.z=e*r,n}vmul(e,n){return n===void 0&&(n=new U),n.x=e.x*this.x,n.y=e.y*this.y,n.z=e.z*this.z,n}addScaledVector(e,n,i){return i===void 0&&(i=new U),i.x=this.x+e*n.x,i.y=this.y+e*n.y,i.z=this.z+e*n.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new U),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,n){const i=this.length();if(i>0){const o=Lre,r=1/i;o.set(this.x*r,this.y*r,this.z*r);const s=Ere;Math.abs(o.x)<.9?(s.set(1,0,0),o.cross(s,e)):(s.set(0,1,0),o.cross(s,e)),o.cross(e,n)}else e.set(1,0,0),n.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,n,i){const o=this.x,r=this.y,s=this.z;i.x=o+(e.x-o)*n,i.y=r+(e.y-r)*n,i.z=s+(e.z-s)*n}almostEquals(e,n){return n===void 0&&(n=1e-6),!(Math.abs(this.x-e.x)>n||Math.abs(this.y-e.y)>n||Math.abs(this.z-e.z)>n)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,n){return this.negate(HX),HX.almostEquals(e,n)}clone(){return new U(this.x,this.y,this.z)}}U.ZERO=new U(0,0,0);U.UNIT_X=new U(1,0,0);U.UNIT_Y=new U(0,1,0);U.UNIT_Z=new U(0,0,1);const Lre=new U,Ere=new U,HX=new U;class br{constructor(e){e===void 0&&(e={}),this.lowerBound=new U,this.upperBound=new U,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,n,i,o){const r=this.lowerBound,s=this.upperBound,a=i;r.copy(e[0]),a&&a.vmult(r,r),s.copy(r);for(let l=1;l<e.length;l++){let g=e[l];a&&(a.vmult(g,FX),g=FX),g.x>s.x&&(s.x=g.x),g.x<r.x&&(r.x=g.x),g.y>s.y&&(s.y=g.y),g.y<r.y&&(r.y=g.y),g.z>s.z&&(s.z=g.z),g.z<r.z&&(r.z=g.z)}return n&&(n.vadd(r,r),n.vadd(s,s)),o&&(r.x-=o,r.y-=o,r.z-=o,s.x+=o,s.y+=o,s.z+=o),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new br().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const n=this.lowerBound,i=this.upperBound,o=e.lowerBound,r=e.upperBound,s=o.x<=i.x&&i.x<=r.x||n.x<=r.x&&r.x<=i.x,a=o.y<=i.y&&i.y<=r.y||n.y<=r.y&&r.y<=i.y,l=o.z<=i.z&&i.z<=r.z||n.z<=r.z&&r.z<=i.z;return s&&a&&l}volume(){const e=this.lowerBound,n=this.upperBound;return(n.x-e.x)*(n.y-e.y)*(n.z-e.z)}contains(e){const n=this.lowerBound,i=this.upperBound,o=e.lowerBound,r=e.upperBound;return n.x<=o.x&&i.x>=r.x&&n.y<=o.y&&i.y>=r.y&&n.z<=o.z&&i.z>=r.z}getCorners(e,n,i,o,r,s,a,l){const g=this.lowerBound,c=this.upperBound;e.copy(g),n.set(c.x,g.y,g.z),i.set(c.x,c.y,g.z),o.set(g.x,c.y,c.z),r.set(c.x,g.y,c.z),s.set(g.x,c.y,g.z),a.set(g.x,g.y,c.z),l.copy(c)}toLocalFrame(e,n){const i=KX,o=i[0],r=i[1],s=i[2],a=i[3],l=i[4],g=i[5],c=i[6],C=i[7];this.getCorners(o,r,s,a,l,g,c,C);for(let d=0;d!==8;d++){const h=i[d];e.pointToLocal(h,h)}return n.setFromPoints(i)}toWorldFrame(e,n){const i=KX,o=i[0],r=i[1],s=i[2],a=i[3],l=i[4],g=i[5],c=i[6],C=i[7];this.getCorners(o,r,s,a,l,g,c,C);for(let d=0;d!==8;d++){const h=i[d];e.pointToWorld(h,h)}return n.setFromPoints(i)}overlapsRay(e){const{direction:n,from:i}=e,o=1/n.x,r=1/n.y,s=1/n.z,a=(this.lowerBound.x-i.x)*o,l=(this.upperBound.x-i.x)*o,g=(this.lowerBound.y-i.y)*r,c=(this.upperBound.y-i.y)*r,C=(this.lowerBound.z-i.z)*s,d=(this.upperBound.z-i.z)*s,h=Math.max(Math.max(Math.min(a,l),Math.min(g,c)),Math.min(C,d)),p=Math.min(Math.min(Math.max(a,l),Math.max(g,c)),Math.max(C,d));return!(p<0||h>p)}}const FX=new U,KX=[new U,new U,new U,new U,new U,new U,new U,new U];class no{constructor(e,n,i,o){e===void 0&&(e=0),n===void 0&&(n=0),i===void 0&&(i=0),o===void 0&&(o=1),this.x=e,this.y=n,this.z=i,this.w=o}set(e,n,i,o){return this.x=e,this.y=n,this.z=i,this.w=o,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,n){const i=Math.sin(n*.5);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(n*.5),this}toAxisAngle(e){e===void 0&&(e=new U),this.normalize();const n=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,n]}setFromVectors(e,n){if(e.isAntiparallelTo(n)){const i=kre,o=Tre;e.tangents(i,o),this.setFromAxisAngle(i,Math.PI)}else{const i=e.cross(n);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*n.length()**2)+e.dot(n),this.normalize()}return this}mult(e,n){n===void 0&&(n=new no);const i=this.x,o=this.y,r=this.z,s=this.w,a=e.x,l=e.y,g=e.z,c=e.w;return n.x=i*c+s*a+o*g-r*l,n.y=o*c+s*l+r*a-i*g,n.z=r*c+s*g+i*l-o*a,n.w=s*c-i*a-o*l-r*g,n}inverse(e){e===void 0&&(e=new no);const n=this.x,i=this.y,o=this.z,r=this.w;this.conjugate(e);const s=1/(n*n+i*i+o*o+r*r);return e.x*=s,e.y*=s,e.z*=s,e.w*=s,e}conjugate(e){return e===void 0&&(e=new no),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,n){n===void 0&&(n=new U);const i=e.x,o=e.y,r=e.z,s=this.x,a=this.y,l=this.z,g=this.w,c=g*i+a*r-l*o,C=g*o+l*i-s*r,d=g*r+s*o-a*i,h=-s*i-a*o-l*r;return n.x=c*g+h*-s+C*-l-d*-a,n.y=C*g+h*-a+d*-s-c*-l,n.z=d*g+h*-l+c*-a-C*-s,n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,n){n===void 0&&(n="YZX");let i,o,r;const s=this.x,a=this.y,l=this.z,g=this.w;switch(n){case"YZX":const c=s*a+l*g;if(c>.499&&(i=2*Math.atan2(s,g),o=Math.PI/2,r=0),c<-.499&&(i=-2*Math.atan2(s,g),o=-Math.PI/2,r=0),i===void 0){const C=s*s,d=a*a,h=l*l;i=Math.atan2(2*a*g-2*s*l,1-2*d-2*h),o=Math.asin(2*c),r=Math.atan2(2*s*g-2*a*l,1-2*C-2*h)}break;default:throw new Error(`Euler order ${n} not supported yet.`)}e.y=i,e.z=o,e.x=r}setFromEuler(e,n,i,o){o===void 0&&(o="XYZ");const r=Math.cos(e/2),s=Math.cos(n/2),a=Math.cos(i/2),l=Math.sin(e/2),g=Math.sin(n/2),c=Math.sin(i/2);return o==="XYZ"?(this.x=l*s*a+r*g*c,this.y=r*g*a-l*s*c,this.z=r*s*c+l*g*a,this.w=r*s*a-l*g*c):o==="YXZ"?(this.x=l*s*a+r*g*c,this.y=r*g*a-l*s*c,this.z=r*s*c-l*g*a,this.w=r*s*a+l*g*c):o==="ZXY"?(this.x=l*s*a-r*g*c,this.y=r*g*a+l*s*c,this.z=r*s*c+l*g*a,this.w=r*s*a-l*g*c):o==="ZYX"?(this.x=l*s*a-r*g*c,this.y=r*g*a+l*s*c,this.z=r*s*c-l*g*a,this.w=r*s*a+l*g*c):o==="YZX"?(this.x=l*s*a+r*g*c,this.y=r*g*a+l*s*c,this.z=r*s*c-l*g*a,this.w=r*s*a-l*g*c):o==="XZY"&&(this.x=l*s*a-r*g*c,this.y=r*g*a-l*s*c,this.z=r*s*c+l*g*a,this.w=r*s*a+l*g*c),this}clone(){return new no(this.x,this.y,this.z,this.w)}slerp(e,n,i){i===void 0&&(i=new no);const o=this.x,r=this.y,s=this.z,a=this.w;let l=e.x,g=e.y,c=e.z,C=e.w,d,h,p,v,f;return h=o*l+r*g+s*c+a*C,h<0&&(h=-h,l=-l,g=-g,c=-c,C=-C),1-h>1e-6?(d=Math.acos(h),p=Math.sin(d),v=Math.sin((1-n)*d)/p,f=Math.sin(n*d)/p):(v=1-n,f=n),i.x=v*o+f*l,i.y=v*r+f*g,i.z=v*s+f*c,i.w=v*a+f*C,i}integrate(e,n,i,o){o===void 0&&(o=new no);const r=e.x*i.x,s=e.y*i.y,a=e.z*i.z,l=this.x,g=this.y,c=this.z,C=this.w,d=n*.5;return o.x+=d*(r*C+s*c-a*g),o.y+=d*(s*C+a*l-r*c),o.z+=d*(a*C+r*g-s*l),o.w+=d*(-r*l-s*g-a*c),o}}const kre=new U,Tre=new U,_re={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class ht{constructor(e){e===void 0&&(e={}),this.id=ht.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,n){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,n,i,o){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}ht.idCounter=0;ht.types=_re;class bo{constructor(e){e===void 0&&(e={}),this.position=new U,this.quaternion=new no,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,n){return bo.pointToLocalFrame(this.position,this.quaternion,e,n)}pointToWorld(e,n){return bo.pointToWorldFrame(this.position,this.quaternion,e,n)}vectorToWorldFrame(e,n){return n===void 0&&(n=new U),this.quaternion.vmult(e,n),n}static pointToLocalFrame(e,n,i,o){return o===void 0&&(o=new U),i.vsub(e,o),n.conjugate(zX),zX.vmult(o,o),o}static pointToWorldFrame(e,n,i,o){return o===void 0&&(o=new U),n.vmult(i,o),o.vadd(e,o),o}static vectorToWorldFrame(e,n,i){return i===void 0&&(i=new U),e.vmult(n,i),i}static vectorToLocalFrame(e,n,i,o){return o===void 0&&(o=new U),n.w*=-1,n.vmult(i,o),n.w*=-1,o}}const zX=new no;new U;new U;new U;new U;new U,new U,new U,new U,new U,new U,new U,new U;new U;new no;new br;new oa;new oa;new oa;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new no;new U;new U;new U;new U;class JB{constructor(){this.rayFromWorld=new U,this.rayToWorld=new U,this.hitNormalWorld=new U,this.hitPointWorld=new U,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,n,i,o,r,s,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(n),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(o),this.shape=r,this.body=s,this.distance=a}}let d9,h9,A9,p9,f9,m9,b9;const kw={CLOSEST:1,ANY:2,ALL:4};d9=ht.types.SPHERE;h9=ht.types.PLANE;A9=ht.types.BOX;p9=ht.types.CYLINDER;f9=ht.types.CONVEXPOLYHEDRON;m9=ht.types.HEIGHTFIELD;b9=ht.types.TRIMESH;class zi{get[d9](){return this._intersectSphere}get[h9](){return this._intersectPlane}get[A9](){return this._intersectBox}get[p9](){return this._intersectConvex}get[f9](){return this._intersectConvex}get[m9](){return this._intersectHeightfield}get[b9](){return this._intersectTrimesh}constructor(e,n){e===void 0&&(e=new U),n===void 0&&(n=new U),this.from=e.clone(),this.to=n.clone(),this.direction=new U,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=zi.ANY,this.result=new JB,this.hasHit=!1,this.callback=i=>{}}intersectWorld(e,n){return this.mode=n.mode||zi.ANY,this.result=n.result||new JB,this.skipBackfaces=!!n.skipBackfaces,this.collisionFilterMask=typeof n.collisionFilterMask<"u"?n.collisionFilterMask:-1,this.collisionFilterGroup=typeof n.collisionFilterGroup<"u"?n.collisionFilterGroup:-1,this.checkCollisionResponse=typeof n.checkCollisionResponse<"u"?n.checkCollisionResponse:!0,n.from&&this.from.copy(n.from),n.to&&this.to.copy(n.to),this.callback=n.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(LX),dv.length=0,e.broadphase.aabbQuery(e,LX,dv),this.intersectBodies(dv),this.hasHit}intersectBody(e,n){n&&(this.result=n,this.updateDirection());const i=this.checkCollisionResponse;if(i&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const o=Ure,r=Pre;for(let s=0,a=e.shapes.length;s<a;s++){const l=e.shapes[s];if(!(i&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[s],r),e.quaternion.vmult(e.shapeOffsets[s],o),o.vadd(e.position,o),this.intersectShape(l,r,o,e),this.result.shouldStop))break}}intersectBodies(e,n){n&&(this.result=n,this.updateDirection());for(let i=0,o=e.length;!this.result.shouldStop&&i<o;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,n,i,o){const r=this.from;if(sse(r,this.direction,i)>e.boundingSphereRadius)return;const a=this[e.type];a&&a.call(this,e,n,i,o,e)}_intersectBox(e,n,i,o,r){return this._intersectConvex(e.convexPolyhedronRepresentation,n,i,o,r)}_intersectPlane(e,n,i,o,r){const s=this.from,a=this.to,l=this.direction,g=new U(0,0,1);n.vmult(g,g);const c=new U;s.vsub(i,c);const C=c.dot(g);a.vsub(i,c);const d=c.dot(g);if(C*d>0||s.distanceTo(a)<C)return;const h=g.dot(l);if(Math.abs(h)<this.precision)return;const p=new U,v=new U,f=new U;s.vsub(i,p);const A=-g.dot(p)/h;l.scale(A,v),s.vadd(v,f),this.reportIntersection(g,f,r,o,-1)}getAABB(e){const{lowerBound:n,upperBound:i}=e,o=this.to,r=this.from;n.x=Math.min(o.x,r.x),n.y=Math.min(o.y,r.y),n.z=Math.min(o.z,r.z),i.x=Math.max(o.x,r.x),i.y=Math.max(o.y,r.y),i.z=Math.max(o.z,r.z)}_intersectHeightfield(e,n,i,o,r){e.data,e.elementSize;const s=Dre;s.from.copy(this.from),s.to.copy(this.to),bo.pointToLocalFrame(i,n,s.from,s.from),bo.pointToLocalFrame(i,n,s.to,s.to),s.updateDirection();const a=Jre;let l,g,c,C;l=g=0,c=C=e.data.length-1;const d=new br;s.getAABB(d),e.getIndexOfPosition(d.lowerBound.x,d.lowerBound.y,a,!0),l=Math.max(l,a[0]),g=Math.max(g,a[1]),e.getIndexOfPosition(d.upperBound.x,d.upperBound.y,a,!0),c=Math.min(c,a[0]+1),C=Math.min(C,a[1]+1);for(let h=l;h<c;h++)for(let p=g;p<C;p++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(h,p,d),!!d.overlapsRay(s)){if(e.getConvexTrianglePillar(h,p,!1),bo.pointToWorldFrame(i,n,e.pillarOffset,Bp),this._intersectConvex(e.pillarConvex,n,Bp,o,r,EX),this.result.shouldStop)return;e.getConvexTrianglePillar(h,p,!0),bo.pointToWorldFrame(i,n,e.pillarOffset,Bp),this._intersectConvex(e.pillarConvex,n,Bp,o,r,EX)}}}_intersectSphere(e,n,i,o,r){const s=this.from,a=this.to,l=e.radius,g=(a.x-s.x)**2+(a.y-s.y)**2+(a.z-s.z)**2,c=2*((a.x-s.x)*(s.x-i.x)+(a.y-s.y)*(s.y-i.y)+(a.z-s.z)*(s.z-i.z)),C=(s.x-i.x)**2+(s.y-i.y)**2+(s.z-i.z)**2-l**2,d=c**2-4*g*C,h=Ore,p=Qre;if(!(d<0))if(d===0)s.lerp(a,d,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,r,o,-1);else{const v=(-c-Math.sqrt(d))/(2*g),f=(-c+Math.sqrt(d))/(2*g);if(v>=0&&v<=1&&(s.lerp(a,v,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,r,o,-1)),this.result.shouldStop)return;f>=0&&f<=1&&(s.lerp(a,f,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,r,o,-1))}}_intersectConvex(e,n,i,o,r,s){const a=jre,l=kX,g=s&&s.faceList||null,c=e.faces,C=e.vertices,d=e.faceNormals,h=this.direction,p=this.from,v=this.to,f=p.distanceTo(v),A=g?g.length:c.length,b=this.result;for(let m=0;!b.shouldStop&&m<A;m++){const B=g?g[m]:m,Z=c[B],w=d[B],W=n,X=i;l.copy(C[Z[0]]),W.vmult(l,l),l.vadd(X,l),l.vsub(p,l),W.vmult(w,a);const V=h.dot(a);if(Math.abs(V)<this.precision)continue;const Y=a.dot(l)/V;if(!(Y<0)){h.scale(Y,Ao),Ao.vadd(p,Ao),Wr.copy(C[Z[0]]),W.vmult(Wr,Wr),X.vadd(Wr,Wr);for(let z=1;!b.shouldStop&&z<Z.length-1;z++){gs.copy(C[Z[z]]),cs.copy(C[Z[z+1]]),W.vmult(gs,gs),W.vmult(cs,cs),X.vadd(gs,gs),X.vadd(cs,cs);const q=Ao.distanceTo(p);!(zi.pointInTriangle(Ao,Wr,gs,cs)||zi.pointInTriangle(Ao,gs,Wr,cs))||q>f||this.reportIntersection(a,Ao,r,o,B)}}}}_intersectTrimesh(e,n,i,o,r,s){const a=qre,l=ose,g=rse,c=kX,C=$re,d=ese,h=tse,p=ise,v=nse,f=e.indices;e.vertices;const A=this.from,b=this.to,m=this.direction;g.position.copy(i),g.quaternion.copy(n),bo.vectorToLocalFrame(i,n,m,C),bo.pointToLocalFrame(i,n,A,d),bo.pointToLocalFrame(i,n,b,h),h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,d.x*=e.scale.x,d.y*=e.scale.y,d.z*=e.scale.z,h.vsub(d,C),C.normalize();const B=d.distanceSquared(h);e.tree.rayQuery(this,g,l);for(let Z=0,w=l.length;!this.result.shouldStop&&Z!==w;Z++){const W=l[Z];e.getNormal(W,a),e.getVertex(f[W*3],Wr),Wr.vsub(d,c);const X=C.dot(a),V=a.dot(c)/X;if(V<0)continue;C.scale(V,Ao),Ao.vadd(d,Ao),e.getVertex(f[W*3+1],gs),e.getVertex(f[W*3+2],cs);const Y=Ao.distanceSquared(d);!(zi.pointInTriangle(Ao,gs,Wr,cs)||zi.pointInTriangle(Ao,Wr,gs,cs))||Y>B||(bo.vectorToWorldFrame(n,a,v),bo.pointToWorldFrame(i,n,Ao,p),this.reportIntersection(v,p,r,o,W))}l.length=0}reportIntersection(e,n,i,o,r){const s=this.from,a=this.to,l=s.distanceTo(n),g=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(g.hitFaceIndex=typeof r<"u"?r:-1,this.mode){case zi.ALL:this.hasHit=!0,g.set(s,a,e,n,i,o,l),g.hasHit=!0,this.callback(g);break;case zi.CLOSEST:(l<g.distance||!g.hasHit)&&(this.hasHit=!0,g.hasHit=!0,g.set(s,a,e,n,i,o,l));break;case zi.ANY:this.hasHit=!0,g.hasHit=!0,g.set(s,a,e,n,i,o,l),g.shouldStop=!0;break}}static pointInTriangle(e,n,i,o){o.vsub(n,ng),i.vsub(n,$u),e.vsub(n,hv);const r=ng.dot(ng),s=ng.dot($u),a=ng.dot(hv),l=$u.dot($u),g=$u.dot(hv);let c,C;return(c=l*a-s*g)>=0&&(C=r*g-s*a)>=0&&c+C<r*l-s*s}}zi.CLOSEST=kw.CLOSEST;zi.ANY=kw.ANY;zi.ALL=kw.ALL;const LX=new br,dv=[],$u=new U,hv=new U,Ure=new U,Pre=new no,Ao=new U,Wr=new U,gs=new U,cs=new U;new U;new JB;const EX={faceList:[0]},Bp=new U,Dre=new zi,Jre=[],Ore=new U,Qre=new U,jre=new U;new U;new U;const kX=new U,qre=new U,$re=new U,ese=new U,tse=new U,nse=new U,ise=new U;new br;const ose=[],rse=new bo,ng=new U,Zp=new U;function sse(t,e,n){n.vsub(t,ng);const i=ng.dot(e);return e.scale(i,Zp),Zp.vadd(t,Zp),n.distanceTo(Zp)}new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new zi;new U;new U;new U;new U(1,0,0),new U(0,1,0),new U(0,0,1);new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new br;new U;new br;new U;new U;new U;new U;new U;new U;new U;new br;new U;new bo;new br;ht.types.SPHERE,ht.types.SPHERE|ht.types.PLANE,ht.types.BOX|ht.types.BOX,ht.types.SPHERE|ht.types.BOX,ht.types.PLANE|ht.types.BOX,ht.types.CONVEXPOLYHEDRON,ht.types.SPHERE|ht.types.CONVEXPOLYHEDRON,ht.types.PLANE|ht.types.CONVEXPOLYHEDRON,ht.types.BOX|ht.types.CONVEXPOLYHEDRON,ht.types.SPHERE|ht.types.HEIGHTFIELD,ht.types.BOX|ht.types.HEIGHTFIELD,ht.types.CONVEXPOLYHEDRON|ht.types.HEIGHTFIELD,ht.types.PARTICLE|ht.types.SPHERE,ht.types.PLANE|ht.types.PARTICLE,ht.types.BOX|ht.types.PARTICLE,ht.types.PARTICLE|ht.types.CONVEXPOLYHEDRON,ht.types.CYLINDER,ht.types.SPHERE|ht.types.CYLINDER,ht.types.PLANE|ht.types.CYLINDER,ht.types.BOX|ht.types.CYLINDER,ht.types.CONVEXPOLYHEDRON|ht.types.CYLINDER,ht.types.HEIGHTFIELD|ht.types.CYLINDER,ht.types.PARTICLE|ht.types.CYLINDER,ht.types.SPHERE|ht.types.TRIMESH,ht.types.PLANE|ht.types.TRIMESH;new U;new U;new U;new U;new U;new no;new no;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new br;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U,new U,new U,new U,new U,new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new no;new U;new U;new U;new U;new U;new U;new U;new U;new U;new br;new zi;const eC=globalThis.performance||{};if(!eC.now){let t=Date.now();eC.timing&&eC.timing.navigationStart&&(t=eC.timing.navigationStart),eC.now=()=>Date.now()-t}new U;class ra{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const n=this.elements;n[0]=e.x,n[4]=e.y,n[8]=e.z}getTrace(e){e===void 0&&(e=new P);const n=this.elements;return e.x=n[0],e.y=n[4],e.z=n[8],e}vmult(e,n){n===void 0&&(n=new P);const i=this.elements,o=e.x,r=e.y,s=e.z;return n.x=i[0]*o+i[1]*r+i[2]*s,n.y=i[3]*o+i[4]*r+i[5]*s,n.z=i[6]*o+i[7]*r+i[8]*s,n}smult(e){for(let n=0;n<this.elements.length;n++)this.elements[n]*=e}mmult(e,n){n===void 0&&(n=new ra);const i=this.elements,o=e.elements,r=n.elements,s=i[0],a=i[1],l=i[2],g=i[3],c=i[4],C=i[5],d=i[6],h=i[7],p=i[8],v=o[0],f=o[1],A=o[2],b=o[3],m=o[4],B=o[5],Z=o[6],w=o[7],W=o[8];return r[0]=s*v+a*b+l*Z,r[1]=s*f+a*m+l*w,r[2]=s*A+a*B+l*W,r[3]=g*v+c*b+C*Z,r[4]=g*f+c*m+C*w,r[5]=g*A+c*B+C*W,r[6]=d*v+h*b+p*Z,r[7]=d*f+h*m+p*w,r[8]=d*A+h*B+p*W,n}scale(e,n){n===void 0&&(n=new ra);const i=this.elements,o=n.elements;for(let r=0;r!==3;r++)o[3*r+0]=e.x*i[3*r+0],o[3*r+1]=e.y*i[3*r+1],o[3*r+2]=e.z*i[3*r+2];return n}solve(e,n){n===void 0&&(n=new P);const i=3,o=4,r=[];let s,a;for(s=0;s<i*o;s++)r.push(0);for(s=0;s<3;s++)for(a=0;a<3;a++)r[s+o*a]=this.elements[s+3*a];r[3+4*0]=e.x,r[3+4*1]=e.y,r[3+4*2]=e.z;let l=3;const g=l;let c;const C=4;let d;do{if(s=g-l,r[s+o*s]===0){for(a=s+1;a<g;a++)if(r[s+o*a]!==0){c=C;do d=C-c,r[d+o*s]+=r[d+o*a];while(--c);break}}if(r[s+o*s]!==0)for(a=s+1;a<g;a++){const h=r[s+o*a]/r[s+o*s];c=C;do d=C-c,r[d+o*a]=d<=s?0:r[d+o*a]-r[d+o*s]*h;while(--c)}}while(--l);if(n.z=r[2*o+3]/r[2*o+2],n.y=(r[1*o+3]-r[1*o+2]*n.z)/r[1*o+1],n.x=(r[0*o+3]-r[0*o+2]*n.z-r[0*o+1]*n.y)/r[0*o+0],isNaN(n.x)||isNaN(n.y)||isNaN(n.z)||n.x===1/0||n.y===1/0||n.z===1/0)throw`Could not solve equation! Got x=[${n.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return n}e(e,n,i){if(i===void 0)return this.elements[n+3*e];this.elements[n+3*e]=i}copy(e){for(let n=0;n<e.elements.length;n++)this.elements[n]=e.elements[n];return this}toString(){let e="";const n=",";for(let i=0;i<9;i++)e+=this.elements[i]+n;return e}reverse(e){e===void 0&&(e=new ra);const n=3,i=6,o=ase;let r,s;for(r=0;r<3;r++)for(s=0;s<3;s++)o[r+i*s]=this.elements[r+3*s];o[3+6*0]=1,o[3+6*1]=0,o[3+6*2]=0,o[4+6*0]=0,o[4+6*1]=1,o[4+6*2]=0,o[5+6*0]=0,o[5+6*1]=0,o[5+6*2]=1;let a=3;const l=a;let g;const c=i;let C;do{if(r=l-a,o[r+i*r]===0){for(s=r+1;s<l;s++)if(o[r+i*s]!==0){g=c;do C=c-g,o[C+i*r]+=o[C+i*s];while(--g);break}}if(o[r+i*r]!==0)for(s=r+1;s<l;s++){const d=o[r+i*s]/o[r+i*r];g=c;do C=c-g,o[C+i*s]=C<=r?0:o[C+i*s]-o[C+i*r]*d;while(--g)}}while(--a);r=2;do{s=r-1;do{const d=o[r+i*s]/o[r+i*r];g=i;do C=i-g,o[C+i*s]=o[C+i*s]-o[C+i*r]*d;while(--g)}while(s--)}while(--r);r=2;do{const d=1/o[r+i*r];g=i;do C=i-g,o[C+i*r]=o[C+i*r]*d;while(--g)}while(r--);r=2;do{s=2;do{if(C=o[n+s+i*r],isNaN(C)||C===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(r,s,C)}while(s--)}while(r--);return e}setRotationFromQuaternion(e){const n=e.x,i=e.y,o=e.z,r=e.w,s=n+n,a=i+i,l=o+o,g=n*s,c=n*a,C=n*l,d=i*a,h=i*l,p=o*l,v=r*s,f=r*a,A=r*l,b=this.elements;return b[3*0+0]=1-(d+p),b[3*0+1]=c-A,b[3*0+2]=C+f,b[3*1+0]=c+A,b[3*1+1]=1-(g+p),b[3*1+2]=h-v,b[3*2+0]=C-f,b[3*2+1]=h+v,b[3*2+2]=1-(g+d),this}transpose(e){e===void 0&&(e=new ra);const n=this.elements,i=e.elements;let o;return i[0]=n[0],i[4]=n[4],i[8]=n[8],o=n[1],i[1]=n[3],i[3]=o,o=n[2],i[2]=n[6],i[6]=o,o=n[5],i[5]=n[7],i[7]=o,e}}const ase=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class P{constructor(e,n,i){e===void 0&&(e=0),n===void 0&&(n=0),i===void 0&&(i=0),this.x=e,this.y=n,this.z=i}cross(e,n){n===void 0&&(n=new P);const i=e.x,o=e.y,r=e.z,s=this.x,a=this.y,l=this.z;return n.x=a*r-l*o,n.y=l*i-s*r,n.z=s*o-a*i,n}set(e,n,i){return this.x=e,this.y=n,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,n){if(n)n.x=e.x+this.x,n.y=e.y+this.y,n.z=e.z+this.z;else return new P(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,n){if(n)n.x=this.x-e.x,n.y=this.y-e.y,n.z=this.z-e.z;else return new P(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new ra([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,n=this.y,i=this.z,o=Math.sqrt(e*e+n*n+i*i);if(o>0){const r=1/o;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return o}unit(e){e===void 0&&(e=new P);const n=this.x,i=this.y,o=this.z;let r=Math.sqrt(n*n+i*i+o*o);return r>0?(r=1/r,e.x=n*r,e.y=i*r,e.z=o*r):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,n=this.y,i=this.z;return Math.sqrt(e*e+n*n+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){const n=this.x,i=this.y,o=this.z,r=e.x,s=e.y,a=e.z;return Math.sqrt((r-n)*(r-n)+(s-i)*(s-i)+(a-o)*(a-o))}distanceSquared(e){const n=this.x,i=this.y,o=this.z,r=e.x,s=e.y,a=e.z;return(r-n)*(r-n)+(s-i)*(s-i)+(a-o)*(a-o)}scale(e,n){n===void 0&&(n=new P);const i=this.x,o=this.y,r=this.z;return n.x=e*i,n.y=e*o,n.z=e*r,n}vmul(e,n){return n===void 0&&(n=new P),n.x=e.x*this.x,n.y=e.y*this.y,n.z=e.z*this.z,n}addScaledVector(e,n,i){return i===void 0&&(i=new P),i.x=this.x+e*n.x,i.y=this.y+e*n.y,i.z=this.z+e*n.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new P),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,n){const i=this.length();if(i>0){const o=lse,r=1/i;o.set(this.x*r,this.y*r,this.z*r);const s=gse;Math.abs(o.x)<.9?(s.set(1,0,0),o.cross(s,e)):(s.set(0,1,0),o.cross(s,e)),o.cross(e,n)}else e.set(1,0,0),n.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,n,i){const o=this.x,r=this.y,s=this.z;i.x=o+(e.x-o)*n,i.y=r+(e.y-r)*n,i.z=s+(e.z-s)*n}almostEquals(e,n){return n===void 0&&(n=1e-6),!(Math.abs(this.x-e.x)>n||Math.abs(this.y-e.y)>n||Math.abs(this.z-e.z)>n)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,n){return this.negate(TX),TX.almostEquals(e,n)}clone(){return new P(this.x,this.y,this.z)}}P.ZERO=new P(0,0,0);P.UNIT_X=new P(1,0,0);P.UNIT_Y=new P(0,1,0);P.UNIT_Z=new P(0,0,1);const lse=new P,gse=new P,TX=new P;class yr{constructor(e){e===void 0&&(e={}),this.lowerBound=new P,this.upperBound=new P,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,n,i,o){const r=this.lowerBound,s=this.upperBound,a=i;r.copy(e[0]),a&&a.vmult(r,r),s.copy(r);for(let l=1;l<e.length;l++){let g=e[l];a&&(a.vmult(g,_X),g=_X),g.x>s.x&&(s.x=g.x),g.x<r.x&&(r.x=g.x),g.y>s.y&&(s.y=g.y),g.y<r.y&&(r.y=g.y),g.z>s.z&&(s.z=g.z),g.z<r.z&&(r.z=g.z)}return n&&(n.vadd(r,r),n.vadd(s,s)),o&&(r.x-=o,r.y-=o,r.z-=o,s.x+=o,s.y+=o,s.z+=o),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new yr().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const n=this.lowerBound,i=this.upperBound,o=e.lowerBound,r=e.upperBound,s=o.x<=i.x&&i.x<=r.x||n.x<=r.x&&r.x<=i.x,a=o.y<=i.y&&i.y<=r.y||n.y<=r.y&&r.y<=i.y,l=o.z<=i.z&&i.z<=r.z||n.z<=r.z&&r.z<=i.z;return s&&a&&l}volume(){const e=this.lowerBound,n=this.upperBound;return(n.x-e.x)*(n.y-e.y)*(n.z-e.z)}contains(e){const n=this.lowerBound,i=this.upperBound,o=e.lowerBound,r=e.upperBound;return n.x<=o.x&&i.x>=r.x&&n.y<=o.y&&i.y>=r.y&&n.z<=o.z&&i.z>=r.z}getCorners(e,n,i,o,r,s,a,l){const g=this.lowerBound,c=this.upperBound;e.copy(g),n.set(c.x,g.y,g.z),i.set(c.x,c.y,g.z),o.set(g.x,c.y,c.z),r.set(c.x,g.y,c.z),s.set(g.x,c.y,g.z),a.set(g.x,g.y,c.z),l.copy(c)}toLocalFrame(e,n){const i=UX,o=i[0],r=i[1],s=i[2],a=i[3],l=i[4],g=i[5],c=i[6],C=i[7];this.getCorners(o,r,s,a,l,g,c,C);for(let d=0;d!==8;d++){const h=i[d];e.pointToLocal(h,h)}return n.setFromPoints(i)}toWorldFrame(e,n){const i=UX,o=i[0],r=i[1],s=i[2],a=i[3],l=i[4],g=i[5],c=i[6],C=i[7];this.getCorners(o,r,s,a,l,g,c,C);for(let d=0;d!==8;d++){const h=i[d];e.pointToWorld(h,h)}return n.setFromPoints(i)}overlapsRay(e){const{direction:n,from:i}=e,o=1/n.x,r=1/n.y,s=1/n.z,a=(this.lowerBound.x-i.x)*o,l=(this.upperBound.x-i.x)*o,g=(this.lowerBound.y-i.y)*r,c=(this.upperBound.y-i.y)*r,C=(this.lowerBound.z-i.z)*s,d=(this.upperBound.z-i.z)*s,h=Math.max(Math.max(Math.min(a,l),Math.min(g,c)),Math.min(C,d)),p=Math.min(Math.min(Math.max(a,l),Math.max(g,c)),Math.max(C,d));return!(p<0||h>p)}}const _X=new P,UX=[new P,new P,new P,new P,new P,new P,new P,new P];class io{constructor(e,n,i,o){e===void 0&&(e=0),n===void 0&&(n=0),i===void 0&&(i=0),o===void 0&&(o=1),this.x=e,this.y=n,this.z=i,this.w=o}set(e,n,i,o){return this.x=e,this.y=n,this.z=i,this.w=o,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,n){const i=Math.sin(n*.5);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(n*.5),this}toAxisAngle(e){e===void 0&&(e=new P),this.normalize();const n=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,n]}setFromVectors(e,n){if(e.isAntiparallelTo(n)){const i=cse,o=Ise;e.tangents(i,o),this.setFromAxisAngle(i,Math.PI)}else{const i=e.cross(n);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*n.length()**2)+e.dot(n),this.normalize()}return this}mult(e,n){n===void 0&&(n=new io);const i=this.x,o=this.y,r=this.z,s=this.w,a=e.x,l=e.y,g=e.z,c=e.w;return n.x=i*c+s*a+o*g-r*l,n.y=o*c+s*l+r*a-i*g,n.z=r*c+s*g+i*l-o*a,n.w=s*c-i*a-o*l-r*g,n}inverse(e){e===void 0&&(e=new io);const n=this.x,i=this.y,o=this.z,r=this.w;this.conjugate(e);const s=1/(n*n+i*i+o*o+r*r);return e.x*=s,e.y*=s,e.z*=s,e.w*=s,e}conjugate(e){return e===void 0&&(e=new io),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,n){n===void 0&&(n=new P);const i=e.x,o=e.y,r=e.z,s=this.x,a=this.y,l=this.z,g=this.w,c=g*i+a*r-l*o,C=g*o+l*i-s*r,d=g*r+s*o-a*i,h=-s*i-a*o-l*r;return n.x=c*g+h*-s+C*-l-d*-a,n.y=C*g+h*-a+d*-s-c*-l,n.z=d*g+h*-l+c*-a-C*-s,n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,n){n===void 0&&(n="YZX");let i,o,r;const s=this.x,a=this.y,l=this.z,g=this.w;switch(n){case"YZX":const c=s*a+l*g;if(c>.499&&(i=2*Math.atan2(s,g),o=Math.PI/2,r=0),c<-.499&&(i=-2*Math.atan2(s,g),o=-Math.PI/2,r=0),i===void 0){const C=s*s,d=a*a,h=l*l;i=Math.atan2(2*a*g-2*s*l,1-2*d-2*h),o=Math.asin(2*c),r=Math.atan2(2*s*g-2*a*l,1-2*C-2*h)}break;default:throw new Error(`Euler order ${n} not supported yet.`)}e.y=i,e.z=o,e.x=r}setFromEuler(e,n,i,o){o===void 0&&(o="XYZ");const r=Math.cos(e/2),s=Math.cos(n/2),a=Math.cos(i/2),l=Math.sin(e/2),g=Math.sin(n/2),c=Math.sin(i/2);return o==="XYZ"?(this.x=l*s*a+r*g*c,this.y=r*g*a-l*s*c,this.z=r*s*c+l*g*a,this.w=r*s*a-l*g*c):o==="YXZ"?(this.x=l*s*a+r*g*c,this.y=r*g*a-l*s*c,this.z=r*s*c-l*g*a,this.w=r*s*a+l*g*c):o==="ZXY"?(this.x=l*s*a-r*g*c,this.y=r*g*a+l*s*c,this.z=r*s*c+l*g*a,this.w=r*s*a-l*g*c):o==="ZYX"?(this.x=l*s*a-r*g*c,this.y=r*g*a+l*s*c,this.z=r*s*c-l*g*a,this.w=r*s*a+l*g*c):o==="YZX"?(this.x=l*s*a+r*g*c,this.y=r*g*a+l*s*c,this.z=r*s*c-l*g*a,this.w=r*s*a-l*g*c):o==="XZY"&&(this.x=l*s*a-r*g*c,this.y=r*g*a-l*s*c,this.z=r*s*c+l*g*a,this.w=r*s*a+l*g*c),this}clone(){return new io(this.x,this.y,this.z,this.w)}slerp(e,n,i){i===void 0&&(i=new io);const o=this.x,r=this.y,s=this.z,a=this.w;let l=e.x,g=e.y,c=e.z,C=e.w,d,h,p,v,f;return h=o*l+r*g+s*c+a*C,h<0&&(h=-h,l=-l,g=-g,c=-c,C=-C),1-h>1e-6?(d=Math.acos(h),p=Math.sin(d),v=Math.sin((1-n)*d)/p,f=Math.sin(n*d)/p):(v=1-n,f=n),i.x=v*o+f*l,i.y=v*r+f*g,i.z=v*s+f*c,i.w=v*a+f*C,i}integrate(e,n,i,o){o===void 0&&(o=new io);const r=e.x*i.x,s=e.y*i.y,a=e.z*i.z,l=this.x,g=this.y,c=this.z,C=this.w,d=n*.5;return o.x+=d*(r*C+s*c-a*g),o.y+=d*(s*C+a*l-r*c),o.z+=d*(a*C+r*g-s*l),o.w+=d*(-r*l-s*g-a*c),o}}const cse=new P,Ise=new P,use={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class At{constructor(e){e===void 0&&(e={}),this.id=At.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,n){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,n,i,o){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}At.idCounter=0;At.types=use;class yo{constructor(e){e===void 0&&(e={}),this.position=new P,this.quaternion=new io,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,n){return yo.pointToLocalFrame(this.position,this.quaternion,e,n)}pointToWorld(e,n){return yo.pointToWorldFrame(this.position,this.quaternion,e,n)}vectorToWorldFrame(e,n){return n===void 0&&(n=new P),this.quaternion.vmult(e,n),n}static pointToLocalFrame(e,n,i,o){return o===void 0&&(o=new P),i.vsub(e,o),n.conjugate(PX),PX.vmult(o,o),o}static pointToWorldFrame(e,n,i,o){return o===void 0&&(o=new P),n.vmult(i,o),o.vadd(e,o),o}static vectorToWorldFrame(e,n,i){return i===void 0&&(i=new P),e.vmult(n,i),i}static vectorToLocalFrame(e,n,i,o){return o===void 0&&(o=new P),n.w*=-1,n.vmult(i,o),n.w*=-1,o}}const PX=new io;new P;new P;new P;new P;new P,new P,new P,new P,new P,new P,new P,new P;new P;new io;new yr;new ra;new ra;new ra;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new io;new P;new P;new P;new P;class OB{constructor(){this.rayFromWorld=new P,this.rayToWorld=new P,this.hitNormalWorld=new P,this.hitPointWorld=new P,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,n,i,o,r,s,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(n),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(o),this.shape=r,this.body=s,this.distance=a}}let y9,v9,G9,B9,Z9,w9,S9;const Tw={CLOSEST:1,ANY:2,ALL:4};y9=At.types.SPHERE;v9=At.types.PLANE;G9=At.types.BOX;B9=At.types.CYLINDER;Z9=At.types.CONVEXPOLYHEDRON;w9=At.types.HEIGHTFIELD;S9=At.types.TRIMESH;class Li{get[y9](){return this._intersectSphere}get[v9](){return this._intersectPlane}get[G9](){return this._intersectBox}get[B9](){return this._intersectConvex}get[Z9](){return this._intersectConvex}get[w9](){return this._intersectHeightfield}get[S9](){return this._intersectTrimesh}constructor(e,n){e===void 0&&(e=new P),n===void 0&&(n=new P),this.from=e.clone(),this.to=n.clone(),this.direction=new P,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Li.ANY,this.result=new OB,this.hasHit=!1,this.callback=i=>{}}intersectWorld(e,n){return this.mode=n.mode||Li.ANY,this.result=n.result||new OB,this.skipBackfaces=!!n.skipBackfaces,this.collisionFilterMask=typeof n.collisionFilterMask<"u"?n.collisionFilterMask:-1,this.collisionFilterGroup=typeof n.collisionFilterGroup<"u"?n.collisionFilterGroup:-1,this.checkCollisionResponse=typeof n.checkCollisionResponse<"u"?n.checkCollisionResponse:!0,n.from&&this.from.copy(n.from),n.to&&this.to.copy(n.to),this.callback=n.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(DX),Av.length=0,e.broadphase.aabbQuery(e,DX,Av),this.intersectBodies(Av),this.hasHit}intersectBody(e,n){n&&(this.result=n,this.updateDirection());const i=this.checkCollisionResponse;if(i&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const o=Cse,r=dse;for(let s=0,a=e.shapes.length;s<a;s++){const l=e.shapes[s];if(!(i&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[s],r),e.quaternion.vmult(e.shapeOffsets[s],o),o.vadd(e.position,o),this.intersectShape(l,r,o,e),this.result.shouldStop))break}}intersectBodies(e,n){n&&(this.result=n,this.updateDirection());for(let i=0,o=e.length;!this.result.shouldStop&&i<o;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,n,i,o){const r=this.from;if(Rse(r,this.direction,i)>e.boundingSphereRadius)return;const a=this[e.type];a&&a.call(this,e,n,i,o,e)}_intersectBox(e,n,i,o,r){return this._intersectConvex(e.convexPolyhedronRepresentation,n,i,o,r)}_intersectPlane(e,n,i,o,r){const s=this.from,a=this.to,l=this.direction,g=new P(0,0,1);n.vmult(g,g);const c=new P;s.vsub(i,c);const C=c.dot(g);a.vsub(i,c);const d=c.dot(g);if(C*d>0||s.distanceTo(a)<C)return;const h=g.dot(l);if(Math.abs(h)<this.precision)return;const p=new P,v=new P,f=new P;s.vsub(i,p);const A=-g.dot(p)/h;l.scale(A,v),s.vadd(v,f),this.reportIntersection(g,f,r,o,-1)}getAABB(e){const{lowerBound:n,upperBound:i}=e,o=this.to,r=this.from;n.x=Math.min(o.x,r.x),n.y=Math.min(o.y,r.y),n.z=Math.min(o.z,r.z),i.x=Math.max(o.x,r.x),i.y=Math.max(o.y,r.y),i.z=Math.max(o.z,r.z)}_intersectHeightfield(e,n,i,o,r){e.data,e.elementSize;const s=hse;s.from.copy(this.from),s.to.copy(this.to),yo.pointToLocalFrame(i,n,s.from,s.from),yo.pointToLocalFrame(i,n,s.to,s.to),s.updateDirection();const a=Ase;let l,g,c,C;l=g=0,c=C=e.data.length-1;const d=new yr;s.getAABB(d),e.getIndexOfPosition(d.lowerBound.x,d.lowerBound.y,a,!0),l=Math.max(l,a[0]),g=Math.max(g,a[1]),e.getIndexOfPosition(d.upperBound.x,d.upperBound.y,a,!0),c=Math.min(c,a[0]+1),C=Math.min(C,a[1]+1);for(let h=l;h<c;h++)for(let p=g;p<C;p++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(h,p,d),!!d.overlapsRay(s)){if(e.getConvexTrianglePillar(h,p,!1),yo.pointToWorldFrame(i,n,e.pillarOffset,wp),this._intersectConvex(e.pillarConvex,n,wp,o,r,JX),this.result.shouldStop)return;e.getConvexTrianglePillar(h,p,!0),yo.pointToWorldFrame(i,n,e.pillarOffset,wp),this._intersectConvex(e.pillarConvex,n,wp,o,r,JX)}}}_intersectSphere(e,n,i,o,r){const s=this.from,a=this.to,l=e.radius,g=(a.x-s.x)**2+(a.y-s.y)**2+(a.z-s.z)**2,c=2*((a.x-s.x)*(s.x-i.x)+(a.y-s.y)*(s.y-i.y)+(a.z-s.z)*(s.z-i.z)),C=(s.x-i.x)**2+(s.y-i.y)**2+(s.z-i.z)**2-l**2,d=c**2-4*g*C,h=pse,p=fse;if(!(d<0))if(d===0)s.lerp(a,d,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,r,o,-1);else{const v=(-c-Math.sqrt(d))/(2*g),f=(-c+Math.sqrt(d))/(2*g);if(v>=0&&v<=1&&(s.lerp(a,v,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,r,o,-1)),this.result.shouldStop)return;f>=0&&f<=1&&(s.lerp(a,f,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,r,o,-1))}}_intersectConvex(e,n,i,o,r,s){const a=mse,l=OX,g=s&&s.faceList||null,c=e.faces,C=e.vertices,d=e.faceNormals,h=this.direction,p=this.from,v=this.to,f=p.distanceTo(v),A=g?g.length:c.length,b=this.result;for(let m=0;!b.shouldStop&&m<A;m++){const B=g?g[m]:m,Z=c[B],w=d[B],W=n,X=i;l.copy(C[Z[0]]),W.vmult(l,l),l.vadd(X,l),l.vsub(p,l),W.vmult(w,a);const V=h.dot(a);if(Math.abs(V)<this.precision)continue;const Y=a.dot(l)/V;if(!(Y<0)){h.scale(Y,po),po.vadd(p,po),xr.copy(C[Z[0]]),W.vmult(xr,xr),X.vadd(xr,xr);for(let z=1;!b.shouldStop&&z<Z.length-1;z++){Is.copy(C[Z[z]]),us.copy(C[Z[z+1]]),W.vmult(Is,Is),W.vmult(us,us),X.vadd(Is,Is),X.vadd(us,us);const q=po.distanceTo(p);!(Li.pointInTriangle(po,xr,Is,us)||Li.pointInTriangle(po,Is,xr,us))||q>f||this.reportIntersection(a,po,r,o,B)}}}}_intersectTrimesh(e,n,i,o,r,s){const a=bse,l=wse,g=Sse,c=OX,C=yse,d=vse,h=Gse,p=Zse,v=Bse,f=e.indices;e.vertices;const A=this.from,b=this.to,m=this.direction;g.position.copy(i),g.quaternion.copy(n),yo.vectorToLocalFrame(i,n,m,C),yo.pointToLocalFrame(i,n,A,d),yo.pointToLocalFrame(i,n,b,h),h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,d.x*=e.scale.x,d.y*=e.scale.y,d.z*=e.scale.z,h.vsub(d,C),C.normalize();const B=d.distanceSquared(h);e.tree.rayQuery(this,g,l);for(let Z=0,w=l.length;!this.result.shouldStop&&Z!==w;Z++){const W=l[Z];e.getNormal(W,a),e.getVertex(f[W*3],xr),xr.vsub(d,c);const X=C.dot(a),V=a.dot(c)/X;if(V<0)continue;C.scale(V,po),po.vadd(d,po),e.getVertex(f[W*3+1],Is),e.getVertex(f[W*3+2],us);const Y=po.distanceSquared(d);!(Li.pointInTriangle(po,Is,xr,us)||Li.pointInTriangle(po,xr,Is,us))||Y>B||(yo.vectorToWorldFrame(n,a,v),yo.pointToWorldFrame(i,n,po,p),this.reportIntersection(v,p,r,o,W))}l.length=0}reportIntersection(e,n,i,o,r){const s=this.from,a=this.to,l=s.distanceTo(n),g=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(g.hitFaceIndex=typeof r<"u"?r:-1,this.mode){case Li.ALL:this.hasHit=!0,g.set(s,a,e,n,i,o,l),g.hasHit=!0,this.callback(g);break;case Li.CLOSEST:(l<g.distance||!g.hasHit)&&(this.hasHit=!0,g.hasHit=!0,g.set(s,a,e,n,i,o,l));break;case Li.ANY:this.hasHit=!0,g.hasHit=!0,g.set(s,a,e,n,i,o,l),g.shouldStop=!0;break}}static pointInTriangle(e,n,i,o){o.vsub(n,ig),i.vsub(n,tC),e.vsub(n,pv);const r=ig.dot(ig),s=ig.dot(tC),a=ig.dot(pv),l=tC.dot(tC),g=tC.dot(pv);let c,C;return(c=l*a-s*g)>=0&&(C=r*g-s*a)>=0&&c+C<r*l-s*s}}Li.CLOSEST=Tw.CLOSEST;Li.ANY=Tw.ANY;Li.ALL=Tw.ALL;const DX=new yr,Av=[],tC=new P,pv=new P,Cse=new P,dse=new io,po=new P,xr=new P,Is=new P,us=new P;new P;new OB;const JX={faceList:[0]},wp=new P,hse=new Li,Ase=[],pse=new P,fse=new P,mse=new P;new P;new P;const OX=new P,bse=new P,yse=new P,vse=new P,Gse=new P,Bse=new P,Zse=new P;new yr;const wse=[],Sse=new yo,ig=new P,Sp=new P;function Rse(t,e,n){n.vsub(t,ig);const i=ig.dot(e);return e.scale(i,Sp),Sp.vadd(t,Sp),n.distanceTo(Sp)}new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new Li;new P;new P;new P;new P(1,0,0),new P(0,1,0),new P(0,0,1);new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new yr;new P;new yr;new P;new P;new P;new P;new P;new P;new P;new yr;new P;new yo;new yr;At.types.SPHERE,At.types.SPHERE|At.types.PLANE,At.types.BOX|At.types.BOX,At.types.SPHERE|At.types.BOX,At.types.PLANE|At.types.BOX,At.types.CONVEXPOLYHEDRON,At.types.SPHERE|At.types.CONVEXPOLYHEDRON,At.types.PLANE|At.types.CONVEXPOLYHEDRON,At.types.BOX|At.types.CONVEXPOLYHEDRON,At.types.SPHERE|At.types.HEIGHTFIELD,At.types.BOX|At.types.HEIGHTFIELD,At.types.CONVEXPOLYHEDRON|At.types.HEIGHTFIELD,At.types.PARTICLE|At.types.SPHERE,At.types.PLANE|At.types.PARTICLE,At.types.BOX|At.types.PARTICLE,At.types.PARTICLE|At.types.CONVEXPOLYHEDRON,At.types.CYLINDER,At.types.SPHERE|At.types.CYLINDER,At.types.PLANE|At.types.CYLINDER,At.types.BOX|At.types.CYLINDER,At.types.CONVEXPOLYHEDRON|At.types.CYLINDER,At.types.HEIGHTFIELD|At.types.CYLINDER,At.types.PARTICLE|At.types.CYLINDER,At.types.SPHERE|At.types.TRIMESH,At.types.PLANE|At.types.TRIMESH;new P;new P;new P;new P;new P;new io;new io;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new yr;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P,new P,new P,new P,new P,new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new io;new P;new P;new P;new P;new P;new P;new P;new P;new P;new yr;new Li;const nC=globalThis.performance||{};if(!nC.now){let t=Date.now();nC.timing&&nC.timing.navigationStart&&(t=nC.timing.navigationStart),nC.now=()=>Date.now()-t}new P;const Wse=x.createContext(null),xse=()=>x.useContext(Wse),R9=x.createContext(null),Vse=()=>{const t=x.useContext(R9);if(!t)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return t};new E(1,1,1);new E;new Wt;const QX=new Ot;function Xse(t){const e=x.useRef(null);return t&&typeof t!="function"?t:e}function jX(t){return t.charAt(0).toUpperCase()+t.slice(1)}function Gi(t,e){const n=e===void 0?"":`/${e}`;return typeof t=="function"?null:t&&t.current&&`${t.current.uuid}${n}`}const Nse=new kg,Yse=new yi,Mse=t=>e=>t(Nse.setFromQuaternion(Yse.fromArray(e)).toArray());let W9=0;function fv(t,e,n,i,o,r){return r===void 0&&(r="bodies"),s=>{const a=W9++;n[a]={[i]:s};const l=Gi(t,o);return l&&e.subscribe({props:{id:a,target:r,type:i},uuid:l}),()=>{delete n[a],e.unsubscribe({props:a})}}}function qX(t,e){let{position:n=[0,0,0],rotation:i=[0,0,0],userData:o={}}=e;t.userData=o,t.position.set(...n),t.rotation.set(...i),t.updateMatrix()}function $X(t,e,n){let{onCollide:i,onCollideBegin:o,onCollideEnd:r}=e;t[n]={collide:i,collideBegin:o,collideEnd:r}}function x9(t,e,n,i,o){i===void 0&&(i=null),o===void 0&&(o=[]);const r=Xse(i),{events:s,refs:a,scaleOverrides:l,subscriptions:g,worker:c}=Vse(),C=xse();x.useLayoutEffect(()=>{r.current||(r.current=new Ot);const h=r.current,p=c,v=h instanceof CI?(h.instanceMatrix.setUsage(ZM),h.count):1,f=h instanceof CI?new Array(v).fill(0).map((b,m)=>`${h.uuid}/${m}`):[h.uuid],A=h instanceof CI?f.map((b,m)=>{const B=e(m);return qX(QX,B),h.setMatrixAt(m,QX.matrix),h.instanceMatrix.needsUpdate=!0,a[b]=h,C==null||C.add(b,B,t),$X(s,B,b),{...B,args:n(B.args)}}):f.map((b,m)=>{const B=e(m);return qX(h,B),a[b]=h,C==null||C.add(b,B,t),$X(s,B,b),{...B,args:n(B.args)}});return p.addBodies({props:A.map(b=>{let{onCollide:m,onCollideBegin:B,onCollideEnd:Z,...w}=b;return{onCollide:!!m,...w}}),type:t,uuid:f}),()=>{f.forEach(b=>{delete a[b],C==null||C.remove(b),delete s[b]}),p.removeBodies({uuid:f})}},o);const d=x.useMemo(()=>{const h=(m,B)=>{const Z=`set${jX(m)}`;return{set:w=>{const W=Gi(r,B);W&&c[Z]({props:w,uuid:W})},subscribe:fv(r,c,g,m,B)}},p=m=>({copy:Z=>{let{w,x:W,y:X,z:V}=Z;const Y=Gi(r,m);Y&&c.setQuaternion({props:[W,X,V,w],uuid:Y})},set:(Z,w,W,X)=>{const V=Gi(r,m);V&&c.setQuaternion({props:[Z,w,W,X],uuid:V})},subscribe:fv(r,c,g,"quaternion",m)}),v=m=>({copy:B=>{let{x:Z,y:w,z:W}=B;const X=Gi(r,m);X&&c.setRotation({props:[Z,w,W],uuid:X})},set:(B,Z,w)=>{const W=Gi(r,m);W&&c.setRotation({props:[B,Z,w],uuid:W})},subscribe:B=>{const Z=W9++,w="bodies",W="quaternion",X=Gi(r,m);return g[Z]={[W]:Mse(B)},X&&c.subscribe({props:{id:Z,target:w,type:W},uuid:X}),()=>{delete g[Z],c.unsubscribe({props:Z})}}}),f=(m,B)=>{const Z=`set${jX(m)}`;return{copy:w=>{let{x:W,y:X,z:V}=w;const Y=Gi(r,B);Y&&c[Z]({props:[W,X,V],uuid:Y})},set:(w,W,X)=>{const V=Gi(r,B);V&&c[Z]({props:[w,W,X],uuid:V})},subscribe:fv(r,c,g,m,B)}};function A(m){return{allowSleep:h("allowSleep",m),angularDamping:h("angularDamping",m),angularFactor:f("angularFactor",m),angularVelocity:f("angularVelocity",m),applyForce(B,Z){const w=Gi(r,m);w&&c.applyForce({props:[B,Z],uuid:w})},applyImpulse(B,Z){const w=Gi(r,m);w&&c.applyImpulse({props:[B,Z],uuid:w})},applyLocalForce(B,Z){const w=Gi(r,m);w&&c.applyLocalForce({props:[B,Z],uuid:w})},applyLocalImpulse(B,Z){const w=Gi(r,m);w&&c.applyLocalImpulse({props:[B,Z],uuid:w})},applyTorque(B){const Z=Gi(r,m);Z&&c.applyTorque({props:[B],uuid:Z})},collisionFilterGroup:h("collisionFilterGroup",m),collisionFilterMask:h("collisionFilterMask",m),collisionResponse:h("collisionResponse",m),fixedRotation:h("fixedRotation",m),isTrigger:h("isTrigger",m),linearDamping:h("linearDamping",m),linearFactor:f("linearFactor",m),mass:h("mass",m),material:h("material",m),position:f("position",m),quaternion:p(m),rotation:v(m),scaleOverride(B){const Z=Gi(r,m);Z&&(l[Z]=new E(...B))},sleep(){const B=Gi(r,m);B&&c.sleep({uuid:B})},sleepSpeedLimit:h("sleepSpeedLimit",m),sleepTimeLimit:h("sleepTimeLimit",m),userData:h("userData",m),velocity:f("velocity",m),wakeUp(){const B=Gi(r,m);B&&c.wakeUp({uuid:B})}}}const b={};return{...A(void 0),at:m=>b[m]||(b[m]=A(m))}},[]);return[r,d]}function dC(t,e,n){return x9("Plane",t,()=>[],e,n)}function Hse(t,e,n){const i=[1,1,1];return x9("Box",t,function(o){return o===void 0&&(o=i),o},e,n)}const Fse=new E,Kse=new E(1,1,1),zse=new yi,Rp=new Wt;function eN(t,e,n,i,o){return i===void 0&&(i=Kse),t!==void 0?(Rp.compose(Fse.fromArray(e,t*3),zse.fromArray(n,t*4),i),o&&(o.matrixAutoUpdate=!1,o.matrix.copy(Rp)),Rp):Rp.identity()}const Lse=()=>{const t=[];return e=>t.includes(e)?!1:!!t.push(e)};function Ese(t){let{allowSleep:e=!1,axisIndex:n=0,broadphase:i="Naive",children:o,defaultContactMaterial:r={contactEquationStiffness:1e6},frictionGravity:s=null,gravity:a=[0,-9.81,0],isPaused:l=!1,iterations:g=5,maxSubSteps:c=10,quatNormalizeFast:C=!1,quatNormalizeSkip:d=0,shouldInvalidate:h=!0,size:p=1e3,solver:v="GS",stepSize:f=1/60,tolerance:A=.001}=t;const{invalidate:b}=li(),[{bodies:m,events:B,refs:Z,scaleOverrides:w,subscriptions:W,worker:X}]=x.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new Kre({allowSleep:e,axisIndex:n,broadphase:i,defaultContactMaterial:r,frictionGravity:s,gravity:a,iterations:g,quatNormalizeFast:C,quatNormalizeSkip:d,size:p,solver:v,tolerance:A})}));let V=0;const Y=x.useCallback((se,H)=>{l||(V+=H,X.step({maxSubSteps:c,stepSize:f,timeSinceLastCalled:V}),V=0)},[l,c,f]),z=se=>{var H;let{body:D,contact:{bi:T,bj:J,...$},target:Ie,...fe}=se;const ve=(H=B[Ie])==null?void 0:H.collide;ve&&ve({body:Z[D],contact:{bi:Z[T],bj:Z[J],...$},target:Z[Ie],...fe})},q=se=>{var H,D;let{bodyA:T,bodyB:J}=se;const $=(H=B[T])==null?void 0:H.collideBegin;$&&$({body:Z[J],op:"event",target:Z[T],type:"collideBegin"});const Ie=(D=B[J])==null?void 0:D.collideBegin;Ie&&Ie({body:Z[T],op:"event",target:Z[J],type:"collideBegin"})},O=se=>{var H,D;let{bodyA:T,bodyB:J}=se;const $=(H=B[T])==null?void 0:H.collideEnd;$&&$({body:Z[J],op:"event",target:Z[T],type:"collideEnd"});const Ie=(D=B[J])==null?void 0:D.collideEnd;Ie&&Ie({body:Z[T],op:"event",target:Z[J],type:"collideEnd"})},te=se=>{let{active:H,bodies:D=[],observations:T,positions:J,quaternions:$}=se;for(let Ie=0;Ie<D.length;Ie++)m[D[Ie]]=Ie;if(T.forEach(Ie=>{let[fe,ve,Ge]=Ie;const _e=(W[fe]||{})[Ge];_e&&_e(ve)}),!!H){for(const Ie of Object.values(Z).filter(Lse()))if(Ie instanceof CI)for(let fe=0;fe<Ie.count;fe++){const ve=`${Ie.uuid}/${fe}`,Ge=m[ve];Ge!==void 0&&(Ie.setMatrixAt(fe,eN(Ge,J,$,w[ve])),Ie.instanceMatrix.needsUpdate=!0)}else{const fe=w[Ie.uuid]||Ie.scale;eN(m[Ie.uuid],J,$,fe,Ie)}h&&b()}},oe=se=>{var H;let{body:D,ray:{uuid:T,...J},...$}=se;const Ie=(H=B[T])==null?void 0:H.rayhit;Ie&&Ie({body:D?Z[D]:null,ray:{uuid:T,...J},...$})};Pg(Y),x.useEffect(()=>(X.connect(),X.init(),X.on("collide",z),X.on("collideBegin",q),X.on("collideEnd",O),X.on("frame",te),X.on("rayhit",oe),()=>{X.terminate(),X.removeAllListeners()}),[]),x.useEffect(()=>{X.axisIndex=n},[n]),x.useEffect(()=>{X.broadphase=i},[i]),x.useEffect(()=>{X.gravity=a},[a]),x.useEffect(()=>{X.iterations=g},[g]),x.useEffect(()=>{X.tolerance=A},[A]);const re=x.useMemo(()=>({bodies:m,events:B,refs:Z,scaleOverrides:w,subscriptions:W,worker:X}),[m,B,Z,W,X]);return Pe.jsx(R9.Provider,{value:re,children:o})}function kse({devMode:t,position:e}){const[n]=Hse(()=>({mass:1,position:e,rotation:[Math.PI/5,Math.PI/7,0]}),x.useRef(null));return Pe.jsxs("mesh",{ref:n,castShadow:!0,children:[Pe.jsx("boxGeometry",{}),Pe.jsx("meshLambertMaterial",{color:"red"})]})}function Tse({devMode:t}){const[e]=dC(()=>({position:[0,0,.1],rotation:[-Math.PI/2,0,0]}),x.useRef(null));return Pe.jsxs("group",{receiveShadow:!0,children:[Pe.jsx("mesh",{ref:e,children:Pe.jsx("planeGeometry",{args:[200,200]})}),Pe.jsx(Qj,{args:[200,200],position:[0,0,.1],fadeDistance:300,sectionColor:"blanchedalmond",cellColor:"grey",receiveShadow:!0})]})}function _se({devMode:t,distance:e=10,altitude:n=100}){const[i]=dC(()=>({position:[0,n/2,-e]}),x.useRef(null)),[o]=dC(()=>({position:[0,n/2,e],rotation:[0,-Math.PI,0]}),x.useRef(null)),[r]=dC(()=>({position:[e,n/2,0],rotation:[0,-Math.PI/2,0]}),x.useRef(null)),[s]=dC(()=>({position:[-e,n/2,0],rotation:[0,Math.PI/2,0]}),x.useRef(null));return x.useEffect(()=>{var a;(a=i.current)==null||a.position.setZ(-e)},[e]),Pe.jsxs("group",{children:[Pe.jsxs("mesh",{ref:i,visible:t,children:[Pe.jsx("planeGeometry",{args:[n,n]}),Pe.jsx("meshBasicMaterial",{color:"green"})]}),Pe.jsxs("mesh",{ref:o,visible:t,children:[Pe.jsx("planeGeometry",{args:[n,n]}),Pe.jsx("meshBasicMaterial",{color:"pink"})]}),Pe.jsxs("mesh",{ref:r,visible:t,children:[Pe.jsx("planeGeometry",{args:[n,n]}),Pe.jsx("meshBasicMaterial",{color:"blue"})]}),Pe.jsxs("mesh",{ref:s,visible:t,children:[Pe.jsx("planeGeometry",{args:[n,n]}),Pe.jsx("meshBasicMaterial",{color:"yellow"})]})]})}function Use(){const{gravity:t,boxes:e,devMode:n}=RK({gravity:{value:[0,-9.81,0],step:.1,min:-9.81,max:9.81},boxes:{value:100,min:1,max:500},cannon:MC({devMode:{label:"Dev mode",value:!1}})}),i=x.useMemo(()=>{let r=[],s=e;for(;s>0;)r.push(Math.random()*200),s--;return r},[e]),o=new E(0,0,0);return Pe.jsxs(JH,{camera:{fov:8,position:[100,100,100],near:10,far:1e3},children:[Pe.jsx("ambientLight",{intensity:1}),Pe.jsx("spotLight",{castShadow:!0,angle:Math.PI/2,lookAt:()=>o,position:[0,100,0],decay:.01,intensity:1}),Pe.jsxs(Ese,{gravity:t,children:[i.map((r,s)=>Pe.jsx(kse,{devMode:n,position:[0,r,0]},s)),Pe.jsx(_se,{devMode:n}),Pe.jsx(Tse,{devMode:n})]}),Pe.jsx(vH,{target:[0,0,0]})]})}const Pse=Rl.div`
    display: flex;
    position: fixed;
    flex-direction: column;
    align-items: stretch;
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 0;
    overflow: hidden;
`,tN=Rl(S5)`
    text-decoration:none;
    color: inherit;
    /* :hover {
        text-decoration: underline
    } */

    &:before {
        content: " . ";
    }

    &:first-child {
        &:before {
            content: none;
        }
    }

`,Dse=Rl.h5`
    margin: 0;
    padding: 0;
    font-family: "rift-soft";
    text-transform: uppercase;
    font-style: italic;
    font-weight: 400;
    font-size: 1.5rem;
`,Jse=Rl.div`
    display: flex;
    flex-flow: row;
    height: auto;
    width: 100%;
    padding: 1rem 1rem 1rem 1.6rem;
`;function Ose(){const n=kd().pathname.split("/").reduce((i,o,r)=>(i.length===0?i.push({name:o,url:o}):i.push({name:o,url:`${i[r-1].url}/${o}`}),i),[]);return n.shift(),Pe.jsx(Jse,{children:Pe.jsxs(Dse,{children:[Pe.jsx(tN,{to:"/",children:"h3nr7"}),n.map((i,o)=>Pe.jsx(tN,{to:i.url,children:i.name},o))]})})}function Qse({children:t}){return Pe.jsx(jse,{children:t})}const jse=Rl.div`
    display: inline-grid;
    align-items: center;
    grid-template-columns: repeat(3, 1fr);
    gap: 25px;
    align-items: flex-start;
    padding: 0 25px;
    flex-wrap: wrap; 
    overflow: auto;
`;function iC({children:t,name:e,link:n}){return Pe.jsxs(qse,{children:[t,Pe.jsx(S5,{to:n,children:e})]})}const qse=Rl.div`
    display: flex;
    flex: 3;
    padding: 0 25px;
    border: 1px solid rgba(0, 0, 0, 0.5);
    flex-basis: 33.33333%;
    box-sizing: content-box;
    min-height: 200px;
    border-radius: 3px;
    /* flex: 3; */
    &:nth-child(3n) {
      margin: 0px;
    }

`;function $se({}){return Pe.jsxs(Qse,{children:[Pe.jsx(iC,{name:"Alpha",link:"alpha",children:"hello"}),Pe.jsx(iC,{name:"Beta",link:"beta",children:"hello"}),Pe.jsx(iC,{name:"Theta",link:"theta",children:"hello"}),Pe.jsx(iC,{name:"Gamma",link:"gamma",children:"hello"}),Pe.jsx(iC,{name:"Zeta",link:"zeta",children:"hello"})]})}function eae(){return Pe.jsx(Pse,{children:Pe.jsxs(Lk,{children:[Pe.jsx(Ose,{}),Pe.jsxs(Yk,{children:[Pe.jsx(lC,{index:!0,element:Pe.jsx($se,{})}),Pe.jsx(lC,{path:"alpha",element:Pe.jsx(wre,{})}),Pe.jsx(lC,{path:"beta",element:Pe.jsx(Use,{})}),Pe.jsx(lC,{path:"gamma",element:Pe.jsx(f4,{})})]})]})})}mv.createRoot(document.getElementById("root")).render(Pe.jsx(ne.StrictMode,{children:Pe.jsx(eae,{})}));
